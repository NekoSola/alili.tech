<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="ES6-Promise"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>ES6-Promise | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/12m8jcvj96c/",
				"appid": "1613049289050283", 
				"title": "ES6-Promise | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-05T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/fnyaov465/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/x5l3bwwlrih/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f12m8jcvj96c%2f&text=ES6-Promise"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f12m8jcvj96c%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f12m8jcvj96c%2f&text=ES6-Promise"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f12m8jcvj96c%2f&title=ES6-Promise"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f12m8jcvj96c%2f&is_video=false&description=ES6-Promise"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=ES6-Promise&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f12m8jcvj96c%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f12m8jcvj96c%2f&title=ES6-Promise"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f12m8jcvj96c%2f&title=ES6-Promise"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f12m8jcvj96c%2f&title=ES6-Promise"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f12m8jcvj96c%2f&title=ES6-Promise"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">ES6-Promise</h1><div class="meta"><div class="postdate"><time datetime="2019-02-05" itemprop="datePublished">2019-02-05</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e前段时间看到关于microTask的文章，\x3ca href=\x22https:\/\/jakearchibald.com\/2015\/tasks-microtasks-queues-and-schedules\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《Tasks, microTasks, queues and schedules》\x3c\/a\x3e，感觉有必要澄清一下。本篇里用setTimeout来实现的Promise，和浏览器原生的Promise是有本质区别的。多数时候感觉不到差异，但正如文章所说，如果不搞清楚microTasks，在实战中一旦遇到和这家伙有关的问题，真得会一点方向都没有。\x22Yeah, it\x27ll bite you in obscure places (ouch). \x22推荐一读。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e前两天看到前端早读课的一篇“【第666期】剖析\x26nbsp;Promise 内部机制”，从实现角度讲解promise底层实现原理的。看得我两天里寝食难安，脑袋疼胸口闷，严重怀疑脑洞太小。终于还是把逻辑理顺了。短短几十行代码威力如此惊人，逼得我把洪荒之力都用完了……\x3cbr\x3e趁热打铁把自己的理解记录一下~\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3ePromise使用场景\x3c\/h1\x3e\n\x3cp\x3e要弄清原理，必须要非常清楚Promise想实现什么。\x3cbr\x3e比如现在有两件事情，第一件事情是要洗衣服，第二件事情是晾衣服。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function wash(){\n    console.log(\x27开始洗衣服...\x27);\n    setTimeout(()=\x3e{\n        console.log(\x27洗完了！\x27);\n        return \x27一堆洗干净的衣服\x27;\n    }, 2000);\n}\n\nfunction hang(clothes){\n    console.log(\x27开始晾衣服...\x27);\n    \/*...晾衣服中...*\/\n    console.log(clothes\x2b\x27晾完了！\x27);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewash\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始洗衣服...\x27\x3c\/span\x3e);\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27洗完了！\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27一堆洗干净的衣服\x27\x3c\/span\x3e;\n    }, \x3cspan class=\x22hljs-number\x22\x3e2000\x3c\/span\x3e);\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehang\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始晾衣服...\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/*...晾衣服中...*\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27晾完了！\x27\x3c\/span\x3e);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e晾衣服hang(clothes)是一定要等洗衣服wash()结束，然后接收到洗好了的衣服clothes以后，才能执行的。\x3cbr\x3e类似这种有明确先后执行顺序，并且可能会有依赖关系的（没有前面执行完返回的结果后面就处理不下去）场景，就是Promise的用武之地。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3ePromise语法\x3c\/h1\x3e\n\x3cp\x3e先看下怎么用Promise来完成先洗衣服后晾干这两步的。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e第一步：\x3cp\x3evar promise = new Promise(wash);\x3cbr\x3e   告诉Promise立刻执行wash开始洗衣服。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e第二步：\x3cp\x3epromise.then(hang);\x3cbr\x3e   告诉Promise等wash结束以后执行hang开始晾衣服。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3ePromise用起来就是这么简单！这么清爽！\x3cbr\x3e如果等晾干以后还要收衣服的话，就继续再后面加：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22   promise.then(hang).then(pickup);   \/\/pickup就是收衣服方法，等后面再实现\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ceylon\x22\x3e\x3ccode\x3e   promise.\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(hang).\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(pickup);   \x3cspan class=\x22hljs-comment\x22\x3e\/\/pickup就是收衣服方法，等后面再实现\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么问题来了，promise怎么知道衣服啥时候洗完？\x3cbr\x3ePromise规定，丢给Promise执行的方法，需要将一个方法(resolve)作为参数，在执行完成以后，将返回的结果传给这个resolve方法。（有点难说清楚，上代码试试）\x3cbr\x3e这样就需要改写wash方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function wash(resolve){\n    console.log(\x27开始洗衣服...\x27);\n    setTimeout(()=\x3e{\n        console.log(\x27洗完了！\x27);\n        resolve(\x27一堆洗干净的衣服\x27);\n    }, 2000);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewash\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始洗衣服...\x27\x3c\/span\x3e);\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27洗完了！\x27\x3c\/span\x3e);\n        resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27一堆洗干净的衣服\x27\x3c\/span\x3e);\n    }, \x3cspan class=\x22hljs-number\x22\x3e2000\x3c\/span\x3e);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eresolve(\x27一堆干净的衣服\x27)会调用Promise里的resolve方法，Promise就会知道洗衣服wash操作已经成功完成了，可以接下去处理then后面的事情了。\x3cbr\x3e把事情变得稍微复杂点试试。衣服洗完了要晾出去，晾完以后要等晒干，晒干了以后要收衣服。我们需要重写hang方法并新增dry和pickup方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function hang(clothes){\n    console.log(\x27开始晾衣服...\x27);\n    \/*...晾衣服中...*\/\n    console.log(clothes\x2b\x27晾好了！\x27);\n    return \x27一堆晾好的衣服\x27;\n}\n\nfunction dry(clothes){\n    console.log(\x27等衣服干...\x27);\n    \/*...晾干中...*\/\n    console.log(clothes\x2b\x27晾干了！\x27);\n    return \x27一堆晾干的衣服\x27;\n}\n\nfunction pickup(clothes){\n    console.log(\x27开始收衣服...\x27);\n    \/*...收衣服中...*\/\n    console.log(clothes\x2b\x27收完了！\x27);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehang\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始晾衣服...\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/*...晾衣服中...*\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27晾好了！\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27一堆晾好的衣服\x27\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edry\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27等衣服干...\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/*...晾干中...*\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27晾干了！\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27一堆晾干的衣服\x27\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epickup\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始收衣服...\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/*...收衣服中...*\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27收完了！\x27\x3c\/span\x3e);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对比之前的代码，发现多了一行return语句，将处理后得到的结果输出，作为参数传入接下去的要处理的方法。\x3cbr\x3e准备好了wash,hang,dry,pickup四个方法后，执行一下看看：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var promise = new Promise(wash);\npromise.then(hang).then(dry).then(pickup);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pony\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ePromise\x3c\/span\x3e(wash);\n\x3cspan class=\x22hljs-title\x22\x3epromise\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3ethen\x3c\/span\x3e(hang).\x3cspan class=\x22hljs-title\x22\x3ethen\x3c\/span\x3e(dry).\x3cspan class=\x22hljs-title\x22\x3ethen\x3c\/span\x3e(pickup);\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e输出结果如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22开始洗衣服...\n洗完了，去晾干!\n开始晾衣服...\n一堆洗干净的衣服晾完了！\n等衣服干...\n一堆晾好的衣服晾干了!\n开始收衣服...\n一堆晾干了的衣服收完了!\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e开始洗衣服...\n洗完了，去晾干!\n开始晾衣服...\n一堆洗干净的衣服晾完了！\n等衣服干...\n一堆晾好的衣服晾干了!\n开始收衣服...\n一堆晾干了的衣服收完了!\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e再稍微复杂点儿试试~\x3cbr\x3e上面输出结果可以看到，从’开始晾衣服...’到’一堆晾干了的衣服收完了!’几乎是同时输出的。每个动作都应该有段时间间隔才对呀~再改\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function hang(clothes){\n    console.log(\x27开始晾衣服...\x27);\n    setTimeout(()=\x3e{\n        console.log(clothes\x2b\x27晾完了！\x27);\n    }, 3000);\n    return (\x26quot;一堆晾好的衣服\x26quot;);\n}\n\nfunction dry(clothes){\n    console.log(\x27等衣服干...\x27);\n    setTimeout(()=\x3e{\n        console.log(clothes\x2b\x27晾干了!\x27);\n    }, 3000);\n    return (\x26quot;一堆晾干了的衣服\x26quot;);\n}\n\nfunction pickup(clothes){\n    console.log(\x27开始收衣服...\x27);\n    setTimeout(()=\x3e{\n        console.log(clothes\x2b\x27收完了!\x27);\n    }, 3000)\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehang\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始晾衣服...\x27\x3c\/span\x3e);\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27晾完了！\x27\x3c\/span\x3e);\n    }, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x22一堆晾好的衣服\x22\x3c\/span\x3e);\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edry\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27等衣服干...\x27\x3c\/span\x3e);\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27晾干了!\x27\x3c\/span\x3e);\n    }, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x22一堆晾干了的衣服\x22\x3c\/span\x3e);\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epickup\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始收衣服...\x27\x3c\/span\x3e);\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27收完了!\x27\x3c\/span\x3e);\n    }, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e)\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e执行一下看看……\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22开始洗衣服...\n洗完了！\n开始晾衣服...\n等衣服干...\n开始收衣服...\n一堆洗干净的衣服晾完了！\n一堆晾好的衣服晾干了!\n一堆晾干了的衣服收完了!\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e开始洗衣服...\n洗完了！\n开始晾衣服...\n等衣服干...\n开始收衣服...\n一堆洗干净的衣服晾完了！\n一堆晾好的衣服晾干了!\n一堆晾干了的衣服收完了!\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e问题比较明显：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e第一.顺序乱了\x3c\/li\x3e\n\x3cli\x3e第二.从’洗完了’到’开始收衣服...’同时输出\x3c\/li\x3e\n\x3cli\x3e第三.最后三句话隔了3秒后同时输出\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e可以看出then执行的方法并不会等setTimeout执行完才去执行接下去的then中的方法，因为then执行的方法都是同步的。咋办呢？再改~\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function hang(clothes){\n    console.log(\x27开始晾衣服...\x27);\n    return new Promise(resolve=\x3e{\n        setTimeout(()=\x3e{\n            console.log(clothes\x2b\x27晾完了！\x27);\n            resolve(\x26quot;一堆晾好的衣服\x26quot;);\n        }, 3000)\n    });\n}\n\nfunction dry(clothes){\n    console.log(\x27等衣服干...\x27);\n    return new Promise(resolve=\x3e{\n        setTimeout(()=\x3e{\n            console.log(clothes\x2b\x27晾干了!\x27);\n            resolve(\x27一堆晾干了的衣服\x27);\n        }, 3000)\n    });\n}\n\nfunction pickup(clothes){\n    console.log(\x27开始收衣服...\x27);\n    setTimeout(()=\x3e{\n        console.log(clothes\x2b\x27收完了!\x27);\n    }, 3000)\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehang\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始晾衣服...\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n        setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27晾完了！\x27\x3c\/span\x3e);\n            resolve(\x3cspan class=\x22hljs-string\x22\x3e\x22一堆晾好的衣服\x22\x3c\/span\x3e);\n        }, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e)\n    });\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edry\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27等衣服干...\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n        setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27晾干了!\x27\x3c\/span\x3e);\n            resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27一堆晾干了的衣服\x27\x3c\/span\x3e);\n        }, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e)\n    });\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epickup\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始收衣服...\x27\x3c\/span\x3e);\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27收完了!\x27\x3c\/span\x3e);\n    }, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e)\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ehang和dry方法返回值改成了一个Promise对象。这里有点难理解，then传入的方法如果返回的是个Promise对象，那么再后面的then传入的方法就会等到这个Promise（实际上是传入Promise的方法）调用了resolve()为止，才会继续执行。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3ePromise原理\x3c\/h1\x3e\n\x3cp\x3e最头疼的部分来了，看看new Promise(wash).then(hang).then(dry).then(pickup)到底怎么实现的。\x3cbr\x3e\x3cstrong\x3e首先new Promise(wash):\x3c\/strong\x3e\x3cbr\x3e实例化Promise并传入一个方法，这个方法就立刻开始执行了，所以Promise里会执行wash(resolve)方法；\x3cbr\x3ewash方法中通过调用resolve(‘一堆洗干净的衣服’)通知Promise自己执行完了，所以Promise里会有一个resolve(_result_value)方法处理wash的返回结果；\x3cbr\x3e\x3cstrong\x3e再看then(hang):\x3c\/strong\x3e\x3cbr\x3ethen是Promise的实例方法，所以Promise里会有一个this.then = function(mission){...}实例方法。\x3cbr\x3e再根据Promise的实现结果，即then后面的方法要等到wash中执行到resolve(‘一堆洗干净的衣服’)以后才能开始执行。实现方法就是在调用then(hang)的时候，不直接执行hang方法，而是把hang方法存起来，由resolve(_result_value)来触发。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e初步实现\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function myPromise(fn){\n    const missions = [];\/\/待执行队列\n    var value = null;\n    \n    \/\/执行传入的方法\n    fn(resolve);\n    \n    \/\/当传入的方法中调用resolve(value)时，异步执行mission\n    function resolve(_return_value){\n        value = _return_value;\n        missions.forEach(mission=\x3e{\n            mission(value);\n        });\n    }\n\n    \/\/执行then方法时，将传入的方法加入missions，等待resolve触发。\n    this.then = function(mission){\n        missions.push(mission);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emyPromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e missions = [];\x3cspan class=\x22hljs-comment\x22\x3e\/\/待执行队列\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e value = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行传入的方法\x3c\/span\x3e\n    fn(resolve);\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/当传入的方法中调用resolve(value)时，异步执行mission\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolve\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e_return_value\x3c\/span\x3e)\x3c\/span\x3e{\n        value = _return_value;\n        missions.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3emission\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n            mission(value);\n        });\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行then方法时，将传入的方法加入missions，等待resolve触发。\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.then = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emission\x3c\/span\x3e)\x3c\/span\x3e{\n        missions.push(mission);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e同时修改一下wash方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function wash(resolve){\n    console.log(\x27开始洗衣服...\x27);\n    console.log(\x27洗完了！\x27);\n    resolve(\x27一堆洗干净的衣服\x27);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewash\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始洗衣服...\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27洗完了！\x27\x3c\/span\x3e);\n    resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27一堆洗干净的衣服\x27\x3c\/span\x3e);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e执行new myPromise(wash).then(hang);\x3cbr\x3e输出结果:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22开始洗衣服...\n洗完了！\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e开始洗衣服...\n洗完了！\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e晾衣服动作没执行~\x3cbr\x3e来看一下发生了什么\x3cbr\x3enew myPromise(wash)触发执行wash(resolve)方法=\x26gt;wash(resolve)触发执行resolve(‘一堆洗干净的衣服’)=\x26gt;resolve(_return_value)执行mission(value)……等下，还没执行then(hang)之前missions里还没任务呢！\x3cbr\x3e所以需要改下resolve方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function resolve(_return_value){\n    value = _return_value;\n    setTimeout(()=\x3e{\n        missions.forEach(mission=\x3e{\n            mission(value);\n        })\n    }, 0);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ceylon\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e resolve(\x3cspan class=\x22hljs-number\x22\x3e_\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e_\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e = \x3cspan class=\x22hljs-number\x22\x3e_\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e_\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e;\n    setTimeout(()=\x26gt;{\n        missions.forEach(mission=\x26gt;{\n            mission(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e);\n        })\n    }, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在执行一下new myPromise(wash).then(hang);结果就对了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e增加状态控制\x3c\/h2\x3e\n\x3cp\x3e如果我们想这样使用:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var promise = new myPromise(wash);\nsetTimeout(()=\x3e{\n    promise.then(hang)\n}, 1000)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lisp\x22\x3e\x3ccode\x3evar promise = new myPromise(\x3cspan class=\x22hljs-name\x22\x3ewash\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\nsetTimeout(()=\x26gt;{\n    promise.then(\x3cspan class=\x22hljs-name\x22\x3ehang\x3c\/span\x3e)\n}, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e开始洗衣服以后干别的事情去了，过一段时间回来如果洗完了就直接晾衣服，没洗完就接着等待。\x3cbr\x3e因为hang也是个异步操作，会延迟到mission(value)之后才执行，所以此时myPromise又没法正常工作了。\x3cbr\x3e解决办法是给myPromise增加一个状态state。当没有触发resovle(_return_value)时，状态处在pending处理中；当触发了resovle(_return_value)时，状态置为fulfilled已处理。而this.then = function(mission){...}在处理前先对状态做个判断，pending时将mission插入missions任务队列，fulfilled时就直接执行mission(value)。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function resolve(_return_value){\n    state = \x27fulfilled\x27;\n    ...\/\/省略其他未改动代码\n}\n\nthis.then = function(mission){\n    if(state === \x27fulfilled\x27){\n        mission(value);\n    }else{\n        missions.push(mission);\n    }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolve\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(_return_value)\x3c\/span\x3e\x3c\/span\x3e{\n    state = \x3cspan class=\x22hljs-string\x22\x3e\x27fulfilled\x27\x3c\/span\x3e;\n    ...\x3cspan class=\x22hljs-comment\x22\x3e\/\/省略其他未改动代码\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.then = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(mission)\x3c\/span\x3e\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(state === \x3cspan class=\x22hljs-string\x22\x3e\x27fulfilled\x27\x3c\/span\x3e){\n        mission(value);\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n        missions.push(mission);\n    }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e任务链处理\x3c\/h2\x3e\n\x3cp\x3e目前执行new myPromise(wash).then(hang).then(dry).then(pickup)会报错。then方法没有设置返回值。稍微调整下代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.then = function(mission){\n    if(state === \x27fulfilled\x27){\n        mission(value);\n    }else{\n        missions.push(mission);\n    }\n    return this;\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.then = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(mission)\x3c\/span\x3e\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(state === \x3cspan class=\x22hljs-string\x22\x3e\x27fulfilled\x27\x3c\/span\x3e){\n        mission(value);\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n        missions.push(mission);\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e简化hang, dry, pickup方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function hang(clothes){\n    console.log(\x27开始晾衣服...\x27);\n    console.log(clothes\x2b\x27晾完了！\x27);\n    return (\x26quot;一堆晾好的衣服\x26quot;);\n}\n\nfunction dry(clothes) {\n    console.log(\x27等衣服干...\x27);\n    console.log(clothes \x2b \x27晾干了!\x27);\n    return (\x27一堆晾干了的衣服\x27);\n}\n\nfunction pickup(clothes){\n    console.log(\x27开始收衣服...\x27);\n    console.log(clothes\x2b\x27收完了!\x27);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehang\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始晾衣服...\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27晾完了！\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x22一堆晾好的衣服\x22\x3c\/span\x3e);\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edry\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27等衣服干...\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27晾干了!\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x27一堆晾干了的衣服\x27\x3c\/span\x3e);\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epickup\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eclothes\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27开始收衣服...\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(clothes\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27收完了!\x27\x3c\/span\x3e);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e执行new myPromise(wash).then(hang).then(dry).then(pickup)，错是不报了。但是then之间没有正常传递返回的值。clothes始终是“一堆洗干净的衣服”。\x3cbr\x3emyPromise中的value是在执行resolve(_return_value)时赋值的。一个myPromise对象只有一个初始任务（这里是wash），初始任务就执行了一次resovle(‘一堆洗干净的衣服’)。而所有的then方法返回的都是同一个myPromise对象，所以value指向的都是同一个值。\x3cbr\x3e解决思路是，每次调用then方法后，返回一个新的myPromise对象 new myPromise(fn);在fn中执行then方法中要执行的操作。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.then = function(mission){\n    function fn(resolve){\n        if(state === \x27pending\x27){\n            missions.push(mission)\n        }else{\n            const result = mission(value);\n            resolve(result);\/\/关键！\n        }\n    }\n    \n    return new myPromise(fn);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.then = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(mission)\x3c\/span\x3e\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efn\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(resolve)\x3c\/span\x3e\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(state === \x3cspan class=\x22hljs-string\x22\x3e\x27pending\x27\x3c\/span\x3e){\n            missions.push(mission)\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = mission(value);\n            resolve(result);\x3cspan class=\x22hljs-comment\x22\x3e\/\/关键！\x3c\/span\x3e\n        }\n    }\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e myPromise(fn);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当触发mission(value)时，将返回的结果作为result执行resolve(result)，这就将result传递给了下一个myPromise。\x3cbr\x3ethen直接触发mission(value)执行的操作和resolve(_result_value)是一样的，所以resolve也要调整\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function resolve(_return_value){\n    value = _return_value;\n    state = \x27fulfilled\x27;\n    setTimeout(()=\x3e{\n        missions.forEach(mission=\x3e{\n            const result = mission(value);\n            resolve(result); \/\/死循环\n        })\n    }, 0);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolve\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e_return_value\x3c\/span\x3e)\x3c\/span\x3e{\n    value = _return_value;\n    state = \x3cspan class=\x22hljs-string\x22\x3e\x27fulfilled\x27\x3c\/span\x3e;\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n        missions.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3emission\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = mission(value);\n            resolve(result); \x3cspan class=\x22hljs-comment\x22\x3e\/\/死循环\x3c\/span\x3e\n        })\n    }, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e执行下？死循环！resolve中应该调用的是then创建的新myPromise的resolve方法，而不是他本身。所以then方法必须把自己创建的myPromise的resolve传递出来。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var next_resolve = null;\/\/保存then生成的下一个myPromise的resolve方法\nthis.then = function(mission){\n    function fn(resolve){\n        next_resolve = resolve;\n        if(state === \x27pending\x27){\n            missions.push(mission)\n        }else{\n            const result = mission(value);\n            resolve(result);\n        }\n    }\n\n    return new myPromise(fn);\n}\n\nfunction resolve(_return_value){\n    value = _return_value;\n    state = \x27fulfilled\x27;\n    setTimeout(()=\x3e{\n        missions.forEach(mission=\x3e{\n            const result = mission(value);\n            next_resolve(result); \n        })\n    }, 0);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e next_resolve = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/保存then生成的下一个myPromise的resolve方法\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.then = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emission\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efn\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e)\x3c\/span\x3e{\n        next_resolve = resolve;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(state === \x3cspan class=\x22hljs-string\x22\x3e\x27pending\x27\x3c\/span\x3e){\n            missions.push(mission)\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = mission(value);\n            resolve(result);\n        }\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e myPromise(fn);\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolve\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e_return_value\x3c\/span\x3e)\x3c\/span\x3e{\n    value = _return_value;\n    state = \x3cspan class=\x22hljs-string\x22\x3e\x27fulfilled\x27\x3c\/span\x3e;\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n        missions.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3emission\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = mission(value);\n            next_resolve(result); \n        })\n    }, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e执行下代码看看结果吧~\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3ePromise对象传递\x3c\/h2\x3e\n\x3cp\x3e最后一个问题~（最后一关逻辑有点绕）\x3cbr\x3e还记得之前用Promise对象来作为hang()和dry()的返回值的场景吗？hang()返回Promise对象后，Promise中resolve(‘一堆晾好的衣服’)被执行后，才会将’一堆晾好的衣服’作为参数传递给dry(clothes)方法并开始执行。\x3cbr\x3e这种情况下，用前面写好的myPromise执行一下，又不对了。dry()和pickup()的形参变成了一个new myPromise，结果肯定出错嘛。\x3cbr\x3e解决思路是，当遇到任务的返回值是一个object或者function，并且有自己的then方法的时候，就将它当做是一个Promise对象处理，等这个Promise对象中的方法处理到resolve(_return_result)的时候，把_return_result作为参数输出传递给后续的任务。\x3cbr\x3e重写then和resolve\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.then = function(mission){\n    var fn = function(resolve){\n        next_resolve = resolve;\n        if(state === \x27pending\x27){\n            missions.push(mission)\n        }else{\n            const result = mission(value);\n            if(result \x26amp;\x26amp; (typeof result == \x27object\x27 || typeof result == \x27function\x27)){\n                if(result.then \x26amp;\x26amp; typeof result.then == \x27function\x27){\n                    result.then(next_resolve);\/\/关键！\n                }\n            }else{\n                next_resolve(result);\n            }\n        }\n    }\n\n    return new myPromise(fn);\n}\n\nfunction resolve(_return_value){\n    value = _return_value;\n    state = \x27fulfilled\x27;\n    setTimeout(()=\x3e{\n        missions.forEach(mission=\x3e{\n            const result = mission(value);\n            if(result \x26amp;\x26amp; (typeof result == \x27object\x27 || typeof result == \x27function\x27)){\n                if(result.then \x26amp;\x26amp; typeof result.then == \x27function\x27){\n                    result.then(next_resolve);\/\/关键！\n                }\n            }else{\n                next_resolve(result);\n            }\n        })\n    }, 0);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.then = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emission\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fn = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e)\x3c\/span\x3e{\n        next_resolve = resolve;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(state === \x3cspan class=\x22hljs-string\x22\x3e\x27pending\x27\x3c\/span\x3e){\n            missions.push(mission)\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = mission(value);\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(result \x26amp;\x26amp; (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e result == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e || \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e result == \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e)){\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(result.then \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e result.then == \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e){\n                    result.then(next_resolve);\x3cspan class=\x22hljs-comment\x22\x3e\/\/关键！\x3c\/span\x3e\n                }\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                next_resolve(result);\n            }\n        }\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e myPromise(fn);\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolve\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e_return_value\x3c\/span\x3e)\x3c\/span\x3e{\n    value = _return_value;\n    state = \x3cspan class=\x22hljs-string\x22\x3e\x27fulfilled\x27\x3c\/span\x3e;\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n        missions.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3emission\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = mission(value);\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(result \x26amp;\x26amp; (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e result == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e || \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e result == \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e)){\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(result.then \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e result.then == \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e){\n                    result.then(next_resolve);\x3cspan class=\x22hljs-comment\x22\x3e\/\/关键！\x3c\/span\x3e\n                }\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                next_resolve(result);\n            }\n        })\n    }, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e有必要解释一下result.then(next_resolve)。result此时是一个Promise对象（取名resultPromise），我们需要在resultPromise对象方法执行到resolve(_result_value)时，获取到_result_value并传递给next_resolve(result)执行。\x3cbr\x3e而then方法正是干这事儿的：将next_resolve放进resultPromise的执行队列missions里，resultPromise执行resolve(_result_value)，state状态变为fulfilled，触发执行next_resolve(_result_value)。后面就是next_promise状态变为fulfilled，触发执行接下去的mission...\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e最后把公共代码提取出来整理一下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function myPromise(fn){\n    const missions = [];  \/\/待执行队列\n    var value = null;\n    var state = \x27pending\x27;\n    var next_resolve = null;\n\n    \/\/执行传入的方法\n    fn(resolve);\n\n    \/\/当传入的方法中调用resolve(value)时，异步执行mission\n    function resolve(_return_value){\n        value = _return_value;\n        state = \x27fulfilled\x27;\n        setTimeout(()=\x3e{\n            missions.forEach(mission=\x3e{\n                handle(mission);\n            })\n        }, 0);\n    }\n\n    \/\/执行then方法时，将传入的方法加入missions，等待resolve触发。\n    this.then = function(mission){\n        var fn = function(resolve){\n            next_resolve = resolve;\n            if(state === \x27pending\x27){\n                missions.push(mission)\n            }else{\n                handle(mission);\n            }\n        }\n        return new myPromise(fn);\n    }\n\n    function handle(mission){\n        const result = mission(value);\n        \/\/当处理结果为Promise对象时，将next_resolve推入待执行队列\n        if(result \x26amp;\x26amp; (typeof result == \x27object\x27 || typeof result == \x27function\x27)){\n            if(result.then \x26amp;\x26amp; typeof result.then == \x27function\x27){\n                result.then(next_resolve);\n            }\n        }else{\n            next_resolve(result);\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emyPromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e missions = [];  \x3cspan class=\x22hljs-comment\x22\x3e\/\/待执行队列\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e value = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e state = \x3cspan class=\x22hljs-string\x22\x3e\x27pending\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e next_resolve = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行传入的方法\x3c\/span\x3e\n    fn(resolve);\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/当传入的方法中调用resolve(value)时，异步执行mission\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolve\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e_return_value\x3c\/span\x3e)\x3c\/span\x3e{\n        value = _return_value;\n        state = \x3cspan class=\x22hljs-string\x22\x3e\x27fulfilled\x27\x3c\/span\x3e;\n        setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n            missions.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3emission\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n                handle(mission);\n            })\n        }, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/执行then方法时，将传入的方法加入missions，等待resolve触发。\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.then = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emission\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fn = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e)\x3c\/span\x3e{\n            next_resolve = resolve;\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(state === \x3cspan class=\x22hljs-string\x22\x3e\x27pending\x27\x3c\/span\x3e){\n                missions.push(mission)\n            }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                handle(mission);\n            }\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e myPromise(fn);\n    }\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehandle\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emission\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = mission(value);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/当处理结果为Promise对象时，将next_resolve推入待执行队列\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(result \x26amp;\x26amp; (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e result == \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e || \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e result == \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e)){\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(result.then \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e result.then == \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e){\n                result.then(next_resolve);\n            }\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            next_resolve(result);\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e代码和前端早读课的“剖析\x26nbsp;Promise 内部机制”稍有区别，但个人觉得这样写逻辑更清晰一些。至于promise的reject部分，偷懒省略啦~ 当是留点思考空间咯~\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>ES6-Promise</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006557624">https://segmentfault.com/a/1190000006557624</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/12m8jcvj96c/" target="_blank">https://alili.tech/archive/12m8jcvj96c/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>