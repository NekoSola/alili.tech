<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="[聊一聊系列]聊一聊网页的分段传输与渲染那些事儿"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>[聊一聊系列]聊一聊网页的分段传输与渲染那些事儿 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/pvnblupgzo8/",
				"appid": "1613049289050283", 
				"title": "[聊一聊系列]聊一聊网页的分段传输与渲染那些事儿 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-07T02:30:15"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/7dgk15zw3qf/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/opv3ixk5fd/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fpvnblupgzo8%2f&text=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%bd%91%e9%a1%b5%e7%9a%84%e5%88%86%e6%ae%b5%e4%bc%a0%e8%be%93%e4%b8%8e%e6%b8%b2%e6%9f%93%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fpvnblupgzo8%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fpvnblupgzo8%2f&text=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%bd%91%e9%a1%b5%e7%9a%84%e5%88%86%e6%ae%b5%e4%bc%a0%e8%be%93%e4%b8%8e%e6%b8%b2%e6%9f%93%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fpvnblupgzo8%2f&title=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%bd%91%e9%a1%b5%e7%9a%84%e5%88%86%e6%ae%b5%e4%bc%a0%e8%be%93%e4%b8%8e%e6%b8%b2%e6%9f%93%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fpvnblupgzo8%2f&is_video=false&description=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%bd%91%e9%a1%b5%e7%9a%84%e5%88%86%e6%ae%b5%e4%bc%a0%e8%be%93%e4%b8%8e%e6%b8%b2%e6%9f%93%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%bd%91%e9%a1%b5%e7%9a%84%e5%88%86%e6%ae%b5%e4%bc%a0%e8%be%93%e4%b8%8e%e6%b8%b2%e6%9f%93%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fpvnblupgzo8%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fpvnblupgzo8%2f&title=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%bd%91%e9%a1%b5%e7%9a%84%e5%88%86%e6%ae%b5%e4%bc%a0%e8%be%93%e4%b8%8e%e6%b8%b2%e6%9f%93%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpvnblupgzo8%2f&title=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%bd%91%e9%a1%b5%e7%9a%84%e5%88%86%e6%ae%b5%e4%bc%a0%e8%be%93%e4%b8%8e%e6%b8%b2%e6%9f%93%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpvnblupgzo8%2f&title=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%bd%91%e9%a1%b5%e7%9a%84%e5%88%86%e6%ae%b5%e4%bc%a0%e8%be%93%e4%b8%8e%e6%b8%b2%e6%9f%93%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpvnblupgzo8%2f&title=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%bd%91%e9%a1%b5%e7%9a%84%e5%88%86%e6%ae%b5%e4%bc%a0%e8%be%93%e4%b8%8e%e6%b8%b2%e6%9f%93%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">[聊一聊系列]聊一聊网页的分段传输与渲染那些事儿</h1><div class="meta"><div class="postdate"><time datetime="2019-02-07" itemprop="datePublished">2019-02-07</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e欢迎大家收看聊一聊系列，这一套系列文章，可以帮助前端工程师们了解前端的方方面面（不仅仅是代码）：\x3cbr\x3e\x3ca href=\x22https:\/\/segmentfault.com\/blog\/frontenddriver\x22\x3ehttps:\/\/segmentfault.com\/blog...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e这一节，请跟随笔者聊一聊，网页的分段传输与渲染，用一些非常规手段优化我们的网站响应速度。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e1 CHUNKED编码\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e1.1 传统的渲染方法\x3c\/h3\x3e\n\x3ch4\x3e1.1.1 传统的渲染方法怎么做？\x3c\/h4\x3e\n\x3cp\x3e按照常理，我们渲染一张网页，必定是网页全部拼装完毕，然后生成HTML字符串，传送至客户端。这也意味着，如果一张网页处理的有快有慢的话，必须串行等到所有的逻辑都处理完毕。后端才能进行返回。（这也是我们目前网页的一般逻辑）。如下面的例子，三个很慢的读数据操作，均执行完毕后，才传送渲染页面。渲染效果如图1.1.1，15s之后才传送并渲染出页面：\x3cbr\x3enormal.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c?php\nfunction getOneData() {\n    usleep(5000000);\n    return \x27我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x3e的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x3e的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x3e的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x3e的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据\x27; \n}\n\n$var1 = getOneData();\n\nfunction getTwoData() {\n    usleep(5000000);\n    return \x27是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据\x27;\n}\n$var2 = getTwoData();\n\nfunction getThreeData() {\n    usleep(5000000);\n    return \x27我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x3e的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x3e的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x3e的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x3e的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据\x27; \n}\n$var3 = getThreeData();\n\n\/\/ 渲染模板并输出\ninclude(\x27.\/normal.html.php\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetOneData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    usleep(\x3cspan class=\x22hljs-number\x22\x3e5000000\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x26gt;的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x26gt;的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x26gt;的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x26gt;的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据\x27\x3c\/span\x3e; \n}\n\n$var1 = getOneData();\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetTwoData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    usleep(\x3cspan class=\x22hljs-number\x22\x3e5000000\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据\x27\x3c\/span\x3e;\n}\n$var2 = getTwoData();\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetThreeData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    usleep(\x3cspan class=\x22hljs-number\x22\x3e5000000\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x26gt;的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x26gt;的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x26gt;的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x26gt;的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据\x27\x3c\/span\x3e; \n}\n$var3 = getThreeData();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染模板并输出\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/normal.html.php\x27\x3c\/span\x3e);\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3enormal.html.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE HTML\x3e\n\x3chtml\x3e\n    \x3chead\x3e\n        \x3cmeta charset=\x26quot;utf-8\x26quot; \/\x3e\n    \x3c\/head\x3e\n    \x3cbody\x3e\n        \x3cdiv\x3e1. \x3c?php echo $var1;?\x3e\x3c\/div\x3e\n        \x3cdiv\x3e2. \x3c?php echo $var2;?\x3e\x3c\/div\x3e\n        \x3cdiv\x3e3. \x3c?php echo $var3;?\x3e\x3c\/div\x3e\n    \x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE HTML\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e1. \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e $var1;\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e2. \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e $var2;\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e3. \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e $var3;\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVzhwc\x22 src=\x22https:\/\/static.alili.tech\/img\/bVzhwc\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图1.1.1\x3c\/p\x3e\n\x3cp\x3e上述例子，在本文后github中的normal文件夹中。\x3c\/p\x3e\n\x3ch4\x3e1.1.2 传统的渲染方法有哪些弊端？\x3c\/h4\x3e\n\x3cp\x3e如上所示，我们能看到，直出的网页中，存在着后端数据串行，互相等待的尴尬局面。这也为我们后续的优化埋下了伏笔。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e1.2 分段传输\x3c\/h3\x3e\n\x3ch4\x3e1.2.1 何为分段传输？\x3c\/h4\x3e\n\x3cp\x3ehttp1.1中引入了一个http首部，Transfer-Encoding:chunked。这个首部标识了实体采用chunked编码传输，chunked编码可以将实体分块儿进行传输，并且chunked编码的每一块内容都会自标识长度。这给了web开发者一个启示，如果需要多个数据，而多个数据均返回较慢的话。可以处理完一块就返回一块，让浏览器尽早的接收到html，可以先行渲染。\x3c\/p\x3e\n\x3ch4\x3e1.2.2 如何分段传输？\x3c\/h4\x3e\n\x3cp\x3e既然知道了我们可以将网页一块儿一块儿的传送，那么我们就可以将上面的网页进行改造，拿好一块儿需要的数据，便渲染一块儿，无需等待，而模板方面，自然也要拆分为三段，供服务端拿一块儿的模板，就渲染一块儿出去，效果如图1.2.2.1。\x3cbr\x3enormal.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c?php\nfunction getOneData() {\n    usleep(5000000);\n    return \x27我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x3e的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x3e的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x3e的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x3e的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据\x27;\n}\n\/\/ 取出第一块儿的数据\n$var1 = getOneData();\n\/\/ 渲染第一块儿\ninclude(\x27.\/normal1.html.php\x27);\n\/\/刷新到缓冲区，渲染第一份儿模板，传送到客户端\nob_flush();\nflush();\n\nfunction getTwoData() {\n    usleep(5000000);\n    return \x27我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出\x3e的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出\x3e的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出\x3e的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出\x3e的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据\x27;\n}\n\/\/ 取出第二块儿的数据\n$var2 = getTwoData();\n\/\/ 渲染第二块儿\ninclude(\x27.\/normal2.html.php\x27);\n\/\/刷新到缓冲区，渲染第二份儿模板，传送到客户端\nob_flush();\nflush();\n\nfunction getThreeData() {\n    usleep(5000000);\n    return \x27我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x3e的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x3e的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x3e的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x3e的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据\x27;\n}\n\/\/ 获取第三块儿的数据\n$var3 = getThreeData();\n\/\/ 渲染第三块儿\ninclude(\x27.\/normal3.html.php\x27);\n\/\/ 将第三份儿的模板，传送到客户端\nob_flush();\nflush();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetOneData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    usleep(\x3cspan class=\x22hljs-number\x22\x3e5000000\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x26gt;的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x26gt;的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x26gt;的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出\x26gt;的第一个数据我是取出的第一个数据我是取出的第一个数据我是取出的第一个数据\x27\x3c\/span\x3e;\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 取出第一块儿的数据\x3c\/span\x3e\n$var1 = getOneData();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染第一块儿\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/normal1.html.php\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/刷新到缓冲区，渲染第一份儿模板，传送到客户端\x3c\/span\x3e\nob_flush();\nflush();\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetTwoData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    usleep(\x3cspan class=\x22hljs-number\x22\x3e5000000\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出\x26gt;的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出\x26gt;的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出\x26gt;的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出\x26gt;的第二个数据我是取出的第二个数据我是取出的第二个数据我是取出的第二个数据\x27\x3c\/span\x3e;\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 取出第二块儿的数据\x3c\/span\x3e\n$var2 = getTwoData();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染第二块儿\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/normal2.html.php\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/刷新到缓冲区，渲染第二份儿模板，传送到客户端\x3c\/span\x3e\nob_flush();\nflush();\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetThreeData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    usleep(\x3cspan class=\x22hljs-number\x22\x3e5000000\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x26gt;的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x26gt;的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x26gt;的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出\x26gt;的第三个数据我是取出的第三个数据我是取出的第三个数据我是取出的第三个数据\x27\x3c\/span\x3e;\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取第三块儿的数据\x3c\/span\x3e\n$var3 = getThreeData();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染第三块儿\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/normal3.html.php\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将第三份儿的模板，传送到客户端\x3c\/span\x3e\nob_flush();\nflush();\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3enormal1.html.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE HTML\x3e\n\x3chtml\x3e\n    \x3chead\x3e\n        \x3cmeta charset=\x26quot;utf-8\x26quot; \/\x3e\n    \x3c\/head\x3e\n    \x3cbody\x3e\n        \x3cdiv\x3e1. \x3c?php echo $var1;?\x3e\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE HTML\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e1. \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e $var1;\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3enormal2.html.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv\x3e2. \x3c?php echo $var2;?\x3e\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e2. \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e $var2;\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3enormal3.html.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22        \x3cdiv\x3e3. \x3c?php echo $var3;?\x3e\x3c\/div\x3e\n    \x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e3. \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e $var3;\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVzhwa\x22 src=\x22https:\/\/static.alili.tech\/img\/bVzhwa\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图1.2.2.1\x3cbr\x3e上述例子，在本文后github中的chunked文件夹中。\x3c\/p\x3e\n\x3cp\x3e对比图图1.1.1与图1.2.2.1我们可以发现，虽然最后总的处理时长不变，但是采用了分段输出的网页，可以尽早的将一段HTML渲染到客户端，这样\x3cstrong\x3e用户可以使用先到达的部分\x3c\/strong\x3e。另一方面，尽早的页面反馈，也\x3cstrong\x3e可以减少用户等待的焦躁情绪\x3c\/strong\x3e。综上，使用此种优化方法，可以提速网页的渲染速度。\x3c\/p\x3e\n\x3ch4\x3e1.2.3 分段传输小TIPs\x3c\/h4\x3e\n\x3cp\x3e我们代码虽然如上所述，但是读者尝试的时候可能会发现，并没有什么效果。和我截图并不一样，还是等到15s后一起渲染出来了。这里要提醒大家一下，可能是由于nginx配置的原因。如果使用的是nginx做server的话，要使用如下配置才能看到效果。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22http {\n    ....\n    fastcgi_buffer_size 1k; \n    fastcgi_buffers 16 1k; \n    gzip  off;\n    ....\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3ehttp {\n    ....\n    fastcgi_buffer_size \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3ek; \n    fastcgi_buffers \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3ek; \n    gzip  off;\n    ....\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其实读者们可以这么理解上面的配置，nginx会在攒够一块儿缓冲区的量后，可以将一块儿数据发出去。上面我们配置了fastcgi_buffers 16 1k; 就是16块儿，大小为1K的缓存。\x3c\/p\x3e\n\x3cp\x3e我们的数据量太小了，连默认的一块儿缓冲区都填不满，没法看到分块儿发送的效果，所以这里我们将缓冲区给调小为1K，这样就能1K为单位分块儿，1K一发，体现出实验效果了。笔者这里建议做实验的时候，最好把gzip给关了，因为，咱们做实验的时候数据量不大，实际使用中建议chunked与gzip均开启(如图1.2.3.1，如果量比较大的话，gzip与chunked均开启使用效果更佳哦~~~)。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVzikq\x22 src=\x22https:\/\/static.alili.tech\/img\/bVzikq\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图1.2.3.1\x3c\/p\x3e\n\x3ch4\x3e1.2.4 分段传输适用场景\x3c\/h4\x3e\n\x3cp\x3e\x3cstrong\x3e当页面的某些后端处理比较耗时的时候，可以试试采用分段传输，可以渲染一部分，就发送一部分到客户端，虽然总时长不变，但是浏览器在全部传输完之前不会处于干等状态。可以尽早的渲染并给予用户反馈。\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e2 BIGPIPE\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e2.1 分段传输的局限\x3c\/h3\x3e\n\x3cp\x3e刚刚笔者和读者们一起做了分段传输的实验，思路是基于读者们想展示的网页也是上快下慢的。可是读者们有没有想过，如果整个网页中，最快的是下方，而最慢的是上方呢？这样我们就无法利用分段传输的优势了吗？如图2.1.1，整个页面依旧是被最慢的第一部分数据渲染给hold住了。而后两块儿渲染较快，完全可以先传输过来。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c?php\n\/\/ 获取第一块儿数据最慢\nfunction getOneData() {\n    usleep(2000000);\n    $str = \x27\x27; \n    for ($i = 0; $i \x3c 500; $i\x2b\x2b) {\n        $str .= \x27我是取出的第一个数据\x27;\n    }   \n    return $str;\n}\n\n$var1 = getOneData();\n\/\/ 渲染第一块儿\ninclude(\x27.\/normal1.html.php\x27);\nob_flush();\nflush();\n\n\/\/ 获取第二块儿数据较快\nfunction getTwoData() {\n    $str = \x27\x27; \n    for ($i = 0; $i \x3c 500; $i\x2b\x2b) {\n        $str .= \x27我是取出的第二个数据\x27;\n    }   \n    return $str;\n}\n$var2 = getTwoData();\n\/\/ 渲染第二块儿\ninclude(\x27.\/normal2.html.php\x27);\nob_flush();\nflush();\n\n\/\/ 获取地三块儿数据也较快\nfunction getThreeData() {\n    $str = \x27\x27; \n    for ($i = 0; $i \x3c 500; $i\x2b\x2b) {\n        $str .= \x27我是取出的第三个数据\x27;\n    }   \n    return $str;\n}\n$var3 = getThreeData();\n\/\/ 渲染第三块儿\ninclude(\x27.\/normal3.html.php\x27);\nob_flush();\nflush();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取第一块儿数据最慢\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetOneData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    usleep(\x3cspan class=\x22hljs-number\x22\x3e2000000\x3c\/span\x3e);\n    $str = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e; \n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e ($i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; $i \x26lt; \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e; $i\x2b\x2b) {\n        $str .= \x3cspan class=\x22hljs-string\x22\x3e\x27我是取出的第一个数据\x27\x3c\/span\x3e;\n    }   \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $str;\n}\n\n$var1 = getOneData();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染第一块儿\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/normal1.html.php\x27\x3c\/span\x3e);\nob_flush();\nflush();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取第二块儿数据较快\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetTwoData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    $str = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e; \n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e ($i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; $i \x26lt; \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e; $i\x2b\x2b) {\n        $str .= \x3cspan class=\x22hljs-string\x22\x3e\x27我是取出的第二个数据\x27\x3c\/span\x3e;\n    }   \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $str;\n}\n$var2 = getTwoData();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染第二块儿\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/normal2.html.php\x27\x3c\/span\x3e);\nob_flush();\nflush();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取地三块儿数据也较快\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetThreeData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    $str = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e; \n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e ($i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; $i \x26lt; \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e; $i\x2b\x2b) {\n        $str .= \x3cspan class=\x22hljs-string\x22\x3e\x27我是取出的第三个数据\x27\x3c\/span\x3e;\n    }   \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $str;\n}\n$var3 = getThreeData();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染第三块儿\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/normal3.html.php\x27\x3c\/span\x3e);\nob_flush();\nflush();\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVzh4w\x22 src=\x22https:\/\/static.alili.tech\/img\/bVzh4w\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图2.1.1\x3c\/p\x3e\n\x3cp\x3e上述例子，在本文后github中的bigpipprepare文件夹中。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e2.2 解决分段传输顺序的问题\x3c\/h3\x3e\n\x3cp\x3e看完上述描述，读者们肯定在想，如果能把最慢的部分放置于底部传过来就好了。于是有了一种加载思路，便是使用js回填的方式，先将左边最慢的部分架空，然后在底部写上js回填。这样不就可以先渲染相对较快的右侧两块儿了么。如图2.2.1\x3cbr\x3e后端可以先渲染快的模板，然后再渲染最慢的模板。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c?php\n\/\/ 渲染第一块儿的架子，还未获取内容\ninclude(\x27.\/normal1.html.php\x27);\nob_flush();\nflush();\n\n\/\/ 获取第二块儿数据较快\nfunction getTwoData() {\n    $str = \x27\x27; \n    for ($i = 0; $i \x3c 50; $i\x2b\x2b) {\n        $str .= \x27我是取出的第二个数据\x27;\n    }   \n    return $str;\n}\n$var2 = getTwoData();\n\n\/\/ 渲染第二块儿\ninclude(\x27.\/normal2.html.php\x27);\nob_flush();\nflush();\n\n\/\/ 获取地三块儿数据也较快\nfunction getThreeData() {\n    $str = \x27\x27; \n    for ($i = 0; $i \x3c 70; $i\x2b\x2b) {\n        $str .= \x27我是取出的第三个数据\x27;\n    }   \n    return $str;\n}\n$var3 = getThreeData();\n\/\/ 渲染第三块儿\ninclude(\x27.\/normal3.html.php\x27);\nob_flush();\nflush();\n\n\/\/ 获取第一块儿数据最慢\nfunction getOneData() {\n    usleep(2000000);\n    $str = \x27\x27; \n    for ($i = 0; $i \x3c 50; $i\x2b\x2b) {\n        $str .= \x27我是取出的第一个数据\x27;\n    }   \n    return $str;\n}\n$var1 = getOneData();\n\/\/ 渲染回填第一块儿\ninclude(\x27.\/normal4.html.php\x27);\nob_flush();\nflush();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染第一块儿的架子，还未获取内容\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/normal1.html.php\x27\x3c\/span\x3e);\nob_flush();\nflush();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取第二块儿数据较快\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetTwoData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    $str = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e; \n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e ($i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; $i \x26lt; \x3cspan class=\x22hljs-number\x22\x3e50\x3c\/span\x3e; $i\x2b\x2b) {\n        $str .= \x3cspan class=\x22hljs-string\x22\x3e\x27我是取出的第二个数据\x27\x3c\/span\x3e;\n    }   \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $str;\n}\n$var2 = getTwoData();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染第二块儿\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/normal2.html.php\x27\x3c\/span\x3e);\nob_flush();\nflush();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取地三块儿数据也较快\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetThreeData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    $str = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e; \n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e ($i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; $i \x26lt; \x3cspan class=\x22hljs-number\x22\x3e70\x3c\/span\x3e; $i\x2b\x2b) {\n        $str .= \x3cspan class=\x22hljs-string\x22\x3e\x27我是取出的第三个数据\x27\x3c\/span\x3e;\n    }   \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $str;\n}\n$var3 = getThreeData();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染第三块儿\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/normal3.html.php\x27\x3c\/span\x3e);\nob_flush();\nflush();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取第一块儿数据最慢\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetOneData\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    usleep(\x3cspan class=\x22hljs-number\x22\x3e2000000\x3c\/span\x3e);\n    $str = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e; \n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e ($i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; $i \x26lt; \x3cspan class=\x22hljs-number\x22\x3e50\x3c\/span\x3e; $i\x2b\x2b) {\n        $str .= \x3cspan class=\x22hljs-string\x22\x3e\x27我是取出的第一个数据\x27\x3c\/span\x3e;\n    }   \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $str;\n}\n$var1 = getOneData();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 渲染回填第一块儿\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/normal4.html.php\x27\x3c\/span\x3e);\nob_flush();\nflush();\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3enormal1.html.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE HTML\x3e\n\x3chtml\x3e\n    \x3chead\x3e\n        \x3cmeta charset=\x26quot;utf-8\x26quot; \/\x3e\n        \x3cstyle\x3e\n            html, body {\n                margin: 0;\n            }   \n            .part1 {\n                vertical-align: top;\n                display: inline-block;\n                width: 200px;\n                background: #0f0;\n                outline: 1px solid #000;\n            }   \n            .part2 {\n                vertical-align: top;\n                display: inline-block;\n                width: 200px;\n                background: #f00;\n                outline: 1px solid #000;\n            }   \n            .part3 {\n                vertical-align: top;\n                display: inline-block;\n                width: 200px;\n                background: #00f;\n                outline: 1px solid #000;\n            }   \n        \x3c\/style\x3e\n    \x3c\/head\x3e\n    \x3cbody\x3e\n        \x3cdiv class=\x26quot;part1\x26quot;\x3e\n        \x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE HTML\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n            \x3cspan class=\x22hljs-selector-tag\x22\x3ehtml\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-tag\x22\x3ebody\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n            }   \n            \x3cspan class=\x22hljs-selector-class\x22\x3e.part1\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-attribute\x22\x3evertical-align\x3c\/span\x3e: top;\n                \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: inline-block;\n                \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e200px\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e#0f0\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3eoutline\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1px\x3c\/span\x3e solid \x3cspan class=\x22hljs-number\x22\x3e#000\x3c\/span\x3e;\n            }   \n            \x3cspan class=\x22hljs-selector-class\x22\x3e.part2\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-attribute\x22\x3evertical-align\x3c\/span\x3e: top;\n                \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: inline-block;\n                \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e200px\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e#f00\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3eoutline\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1px\x3c\/span\x3e solid \x3cspan class=\x22hljs-number\x22\x3e#000\x3c\/span\x3e;\n            }   \n            \x3cspan class=\x22hljs-selector-class\x22\x3e.part3\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-attribute\x22\x3evertical-align\x3c\/span\x3e: top;\n                \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: inline-block;\n                \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e200px\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e#00f\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3eoutline\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1px\x3c\/span\x3e solid \x3cspan class=\x22hljs-number\x22\x3e#000\x3c\/span\x3e;\n            }   \n        \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22part1\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3enormal2.html.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv class=\x26quot;part2\x26quot;\x3e2. \x3c?php echo $var2;?\x3e\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22part2\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e2. \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e $var2;\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3enormal3.html.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv class=\x26quot;part3\x26quot;\x3e3. \x3c?php echo $var3;?\x3e\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22part3\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e3. \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e $var3;\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3enormal4.html.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22        \x3cscript\x3e\n            \/\/ 把最慢且顶在前面的部分用js回填回去\n            document.querySelector(\x27.part1\x27).innerHTML = \x26quot;\x3c?php echo $var1?\x3e\x26quot;;\n        \x3c\/script\x3e\n    \x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22handlebars\x22\x3e\x3cspan class=\x22xml\x22\x3e\n            \/\/ 把最慢且顶在前面的部分用js回填回去\n            document.querySelector(\x27.part1\x27).innerHTML = \x22\x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e $var1\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x22;\n        \x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVzh46\x22 src=\x22https:\/\/static.alili.tech\/img\/bVzh46\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图2.2.1\x3cbr\x3e如上图，可以看到49ms的时候，就已经渲染出来了右侧两块儿，2S的时候，左侧也渲染出来了。\x3c\/p\x3e\n\x3cp\x3e上述例子，在本文后github中的bigpipe文件夹中。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e2.3 回填思路的扩展与并行化\x3c\/h3\x3e\n\x3cp\x3e我们刚刚做了一个实验，是将耗时最慢的块儿放在底部。然而，事实情况是，如果你也不知道哪块儿慢了呢？或者是，你的几块儿数据区块儿是并行的呢？出于刚刚的经验，我们可以把页面上所有的块儿都架空，然后并行渲染，谁快谁就先渲染回填js。这样就可以达到并行且先到先渲染的目的了。我这里做了个php并行取并回填的实验，如图2.3.1，可以看到，中间红色的虽然被阻塞，但是框架先行渲染出来了所有的内容均是空的。绿色最快，先行回填渲染了出来，蓝色稍慢，也跟着渲染了出来，最后红色完毕，回填渲染结束了。\x3cbr\x3e并行渲染的PHP(normal.php)\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c?php\nfunction asyncRequest($host, $url, $port=8082, $conn_timeout=30, $rw_timeout=86400) {\n    $errno = \x27\x27; \n    $errstr = \x27\x27; \n    $fp = fsockopen($host, $port, $errno, $errstr, $conn_timeout);\n    if (!$fp) {\n       echo \x26quot;Server error:$errstr($errno)\x26quot;;\n       return false;\n    }   \n    stream_set_timeout($fp, $rw_timeout);\n    stream_set_blocking($fp, false);\n\n    $rq = \x26quot;GET $url HTTP\/1.0\\r\\n\x26quot;;\n    $rq .= \x26quot;Host: $host\\r\\n\x26quot;;\n    $rq .= \x26quot;Connect: close\\r\\n\\r\\n\x26quot;;\n    fwrite($fp, $rq);\n    return $fp;\n}\n\nfunction asyncFetch(\x26amp;$fp) {\n   if ($fp === false) return false;\n\n   if (feof($fp)) {\n      fclose($fp);\n      $fp = false;\n      return false;\n   }   \n   return fread($fp, 10000);\n}\n\n$fp1 = asyncRequest(\x27localhost\x27, \x27\/bigpipeparal\/data1.php\x27);\n$fp2 = asyncRequest(\x27localhost\x27, \x27\/bigpipeparal\/data2.php\x27);\n$fp3 = asyncRequest(\x27localhost\x27, \x27\/bigpipeparal\/data3.php\x27);\n\ninclude(\x27normal_frame.html.php\x27);\nob_flush();\nflush();\nwhile (true) {\n    sleep(1);\n    $r1 = asyncFetch($fp1);\n    $r2 = asyncFetch($fp2);\n    $r3 = asyncFetch($fp3);\n    \/\/谁快谁先渲染并flush刷出\n    if ($r1 != false) {\n        preg_match(\x27\/\\|(.\x2b)\\|\/i\x27, $r1, $res);\n        $var1 = $res[1];\n        include(\x27normal1.html.php\x27);\n    }\n\n    if ($r2 != false) {\n        preg_match(\x27\/\\|(.\x2b)\\|\/i\x27, $r2, $res);\n        $var2 = $res[1];\n        include(\x27normal2.html.php\x27);\n    }\n\n    if ($r3 != false) {\n        preg_match(\x27\/\\|(.\x2b)\\|\/i\x27, $r3, $res);\n        $var3 = $res[1];\n        include(\x27normal3.html.php\x27);\n    }\n\n    if ($r1 == false \x26amp;\x26amp; $r2 == false \x26amp;\x26amp; $r3 == false) {\n        break;\n    }\n  \n    ob_flush();\n    flush();\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3easyncRequest\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e($host, $url, $port=\x3cspan class=\x22hljs-number\x22\x3e8082\x3c\/span\x3e, $conn_timeout=\x3cspan class=\x22hljs-number\x22\x3e30\x3c\/span\x3e, $rw_timeout=\x3cspan class=\x22hljs-number\x22\x3e86400\x3c\/span\x3e)\x3c\/span\x3e \x3c\/span\x3e{\n    $errno = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e; \n    $errstr = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e; \n    $fp = fsockopen($host, $port, $errno, $errstr, $conn_timeout);\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!$fp) {\n       \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22Server error:$errstr($errno)\x22\x3c\/span\x3e;\n       \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e;\n    }   \n    stream_set_timeout($fp, $rw_timeout);\n    stream_set_blocking($fp, \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e);\n\n    $rq = \x3cspan class=\x22hljs-string\x22\x3e\x22GET $url HTTP\/1.0\\r\\n\x22\x3c\/span\x3e;\n    $rq .= \x3cspan class=\x22hljs-string\x22\x3e\x22Host: $host\\r\\n\x22\x3c\/span\x3e;\n    $rq .= \x3cspan class=\x22hljs-string\x22\x3e\x22Connect: close\\r\\n\\r\\n\x22\x3c\/span\x3e;\n    fwrite($fp, $rq);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e $fp;\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3easyncFetch\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x26amp;$fp)\x3c\/span\x3e \x3c\/span\x3e{\n   \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($fp === \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e;\n\n   \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (feof($fp)) {\n      fclose($fp);\n      $fp = \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e;\n   }   \n   \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fread($fp, \x3cspan class=\x22hljs-number\x22\x3e10000\x3c\/span\x3e);\n}\n\n$fp1 = asyncRequest(\x3cspan class=\x22hljs-string\x22\x3e\x27localhost\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\/bigpipeparal\/data1.php\x27\x3c\/span\x3e);\n$fp2 = asyncRequest(\x3cspan class=\x22hljs-string\x22\x3e\x27localhost\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\/bigpipeparal\/data2.php\x27\x3c\/span\x3e);\n$fp3 = asyncRequest(\x3cspan class=\x22hljs-string\x22\x3e\x27localhost\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\/bigpipeparal\/data3.php\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27normal_frame.html.php\x27\x3c\/span\x3e);\nob_flush();\nflush();\n\x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e) {\n    sleep(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n    $r1 = asyncFetch($fp1);\n    $r2 = asyncFetch($fp2);\n    $r3 = asyncFetch($fp3);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/谁快谁先渲染并flush刷出\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($r1 != \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e) {\n        preg_match(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\\|(.\x2b)\\|\/i\x27\x3c\/span\x3e, $r1, $res);\n        $var1 = $res[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27normal1.html.php\x27\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($r2 != \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e) {\n        preg_match(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\\|(.\x2b)\\|\/i\x27\x3c\/span\x3e, $r2, $res);\n        $var2 = $res[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27normal2.html.php\x27\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($r3 != \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e) {\n        preg_match(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\\|(.\x2b)\\|\/i\x27\x3c\/span\x3e, $r3, $res);\n        $var3 = $res[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27normal3.html.php\x27\x3c\/span\x3e);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($r1 == \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e \x26amp;\x26amp; $r2 == \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e \x26amp;\x26amp; $r3 == \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n    }\n  \n    ob_flush();\n    flush();\n}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e主框架的模板，架空，等待回填。normal_frame.html.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE HTML\x3e\n\x3chtml\x3e\n    \x3chead\x3e\n        \x3cmeta charset=\x26quot;utf-8\x26quot; \/\x3e\n        \x3cstyle\x3e\n            html, body {\n                margin: 0;\n            }   \n            .part1 {\n                vertical-align: top;\n                display: inline-block;\n                width: 200px;\n                background: #0f0;\n                outline: 1px solid #000;\n            }   \n            .part2 {\n                vertical-align: top;\n                display: inline-block;\n                width: 200px;\n                background: #f00;\n                outline: 1px solid #000;\n            }   \n            .part3 {\n                vertical-align: top;\n                display: inline-block;\n                width: 200px;\n                background: #00f;\n                outline: 1px solid #000;\n            }   \n        \x3c\/style\x3e\n    \x3c\/head\x3e\n    \x3cbody\x3e\n        \x3c!--三块儿全部架空，等待回填--\x3e \n        \x3cdiv class=\x26quot;part1\x26quot;\x3e\x3c\/div\x3e\n        \x3cdiv class=\x26quot;part2\x26quot;\x3e\x3c\/div\x3e\n        \x3cdiv class=\x26quot;part3\x26quot;\x3e\x3c\/div\x3e\n    \x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE HTML\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n            \x3cspan class=\x22hljs-selector-tag\x22\x3ehtml\x3c\/span\x3e, \x3cspan class=\x22hljs-selector-tag\x22\x3ebody\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-attribute\x22\x3emargin\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n            }   \n            \x3cspan class=\x22hljs-selector-class\x22\x3e.part1\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-attribute\x22\x3evertical-align\x3c\/span\x3e: top;\n                \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: inline-block;\n                \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e200px\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e#0f0\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3eoutline\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1px\x3c\/span\x3e solid \x3cspan class=\x22hljs-number\x22\x3e#000\x3c\/span\x3e;\n            }   \n            \x3cspan class=\x22hljs-selector-class\x22\x3e.part2\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-attribute\x22\x3evertical-align\x3c\/span\x3e: top;\n                \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: inline-block;\n                \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e200px\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e#f00\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3eoutline\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1px\x3c\/span\x3e solid \x3cspan class=\x22hljs-number\x22\x3e#000\x3c\/span\x3e;\n            }   \n            \x3cspan class=\x22hljs-selector-class\x22\x3e.part3\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-attribute\x22\x3evertical-align\x3c\/span\x3e: top;\n                \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: inline-block;\n                \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e200px\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e#00f\x3c\/span\x3e;\n                \x3cspan class=\x22hljs-attribute\x22\x3eoutline\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1px\x3c\/span\x3e solid \x3cspan class=\x22hljs-number\x22\x3e#000\x3c\/span\x3e;\n            }   \n        \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!--三块儿全部架空，等待回填--\x26gt;\x3c\/span\x3e \n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22part1\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22part2\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22part3\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e具体回填模板，normal1.html.php\/normal2.html.php\/normal3.html.php\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript\x3e\n    document.querySelector(\x27.part1\x27).innerHTML = \x26quot;第一块儿回填！其值如下：\x3c?php echo $var1?\x3e\x26quot;;\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22handlebars\x22\x3e\x3cspan class=\x22xml\x22\x3e\n    document.querySelector(\x27.part1\x27).innerHTML = \x22第一块儿回填！其值如下：\x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e $var1\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x22;\n\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVzifr\x22 src=\x22https:\/\/static.alili.tech\/img\/bVzifr\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图2.3.1\x3c\/p\x3e\n\x3cp\x3e上述例子，在本文后github中的bigpipeparal文件夹中。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e2.4 为什么不用ajax？\x3c\/h3\x3e\n\x3cp\x3e相信读着在此处会有疑问，为什么慢的数据，不用ajax去请求呢？这样模板框架也能尽早的渲染出来。ajax毕竟是请求。相信很多读着也有这样的经历，后端处理如果遇到了瓶颈，那么有的时候我们会选择同步页面渲染完之后，再发个请求去获取后端数据。但是笔者认为，这样做有一定弊端：\x3cbr\x3e1、ajax毕竟是个请求，请求就要有连接，要有解析等过程。\x3cbr\x3e2、服务端和客户端都会有闲的时候，发送ajax之前服务端闲，发送ajax出去之后，浏览器又闲着了。\x3cbr\x3e所以，我们使用bigpipe的方式还是比多发送一个ajax有优势的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e3 分段传输与bigpipe适用场景\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e3.1 分段传输的适用场景\x3c\/h3\x3e\n\x3cp\x3e笔者总结了一些使用分块儿传输比较合适的场景\x3cbr\x3e\x3cstrong\x3e1 前端需要尽早传输head中的一些css\/js外联文件的情况下(可以先flush给客户端head前面的html内容，让浏览器尽早的去请求)\x3c\/strong\x3e\x3cbr\x3e\x3cstrong\x3e2 后端处理渲染的数据，上方较快，下方较慢的情况(可以先行渲染上方较快的部分)\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e3.2 使用bigpipe的场景\x3c\/h3\x3e\n\x3cp\x3e对于更为复杂一点的bigpipe方式，如果上面的情况就适用于你的网站了的话，则最好采用简单的分块传输，否则如下情况，需要回填，则采用bigpipe方式渲染页面。毕竟，使用js回填还是有性能损耗的。\x3cbr\x3e\x3cstrong\x3e1 后端有较慢的数据处理，阻塞住了页面的情况下，且最慢的部分不是在网页的最后。(可以把最慢的部分变为回填)\x3c\/strong\x3e\x3cbr\x3e\x3cstrong\x3e2 后端有多块儿数据要并行处理的情况下(你也不知道哪块儿先回来了，所以先渲染一个架子。对于并行的请求，先回来的先flush回填)\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e3.3 国内的应用\x3c\/h3\x3e\n\x3cp\x3e据笔者观察，新浪微博正是采用了bigpipe的方式进行渲染，如图3.3.1，我们看到新浪微博的左侧导航栏与中间feed流区块儿都是架空的：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVzh9n\x22 src=\x22https:\/\/static.alili.tech\/img\/bVzh9n\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.3.1\x3cbr\x3e在下方，有对左侧导航栏和中间feed流部分的回填，如图3.3.2\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVzh9r\x22 src=\x22https:\/\/static.alili.tech\/img\/bVzh9r\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.3.2\x3c\/p\x3e\n\x3cp\x3e所以，整个网页的渲染效果如下(如图3.3.3\/图3.3.4\/图3.3.5)\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVzh9D\x22 src=\x22https:\/\/static.alili.tech\/img\/bVzh9D\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.3.3\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVzh9H\x22 src=\x22https:\/\/static.alili.tech\/img\/bVzh9H\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.3.4\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVzh93\x22 src=\x22https:\/\/static.alili.tech\/img\/bVzh93\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.3.5\x3cbr\x3e笔者猜测，可能微博是并行渲染这几块儿的数据，所以采用了bigpipe的方式。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e4 课后作业\x3c\/h2\x3e\n\x3cp\x3e请读者们回想一下，自己的网站到底适不适合使用分块儿传输，能否使用上面的技术，使自己的网站更快一些呢？如果使用的话，是适合使用普通的chuned提速呢？还是使用bigpipe进行提速呢？\x3c\/p\x3e\n\x3cp\x3e如有说明不周的地方欢迎回复详询\x3c\/p\x3e\n\x3cp\x3e本文中所有的例子，均在我的github上可以找到：\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/houyu01\/chunkedsample\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/houyu01\/ch...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e接下来的一篇文章，我将会和读者们一起聊聊HTTPS那些事儿，不要走开，请关注我.....\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000006199237\x22\x3ehttps:\/\/segmentfault.com\/a\/11...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e如果喜欢本文请点击下方的推荐哦，你的推荐会变为我继续更文的动力。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e以上内容仅代表笔者个人观点，如有意见笔者愿意学习参考各读者的建议。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>[聊一聊系列]聊一聊网页的分段传输与渲染那些事儿</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005989601">https://segmentfault.com/a/1190000005989601</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/pvnblupgzo8/" target="_blank">https://alili.tech/archive/pvnblupgzo8/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>