<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="一言不合造轮子--撸一个ReactTimePicker"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>一言不合造轮子--撸一个ReactTimePicker | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/5jj87x62wfr/",
				"appid": "1613049289050283", 
				"title": "一言不合造轮子--撸一个ReactTimePicker | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-04T02:30:57"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/qj0n94ckw6a/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/qdf59yc97zp/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f5jj87x62wfr%2f&text=%e4%b8%80%e8%a8%80%e4%b8%8d%e5%90%88%e9%80%a0%e8%bd%ae%e5%ad%90--%e6%92%b8%e4%b8%80%e4%b8%aaReactTimePicker"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f5jj87x62wfr%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f5jj87x62wfr%2f&text=%e4%b8%80%e8%a8%80%e4%b8%8d%e5%90%88%e9%80%a0%e8%bd%ae%e5%ad%90--%e6%92%b8%e4%b8%80%e4%b8%aaReactTimePicker"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f5jj87x62wfr%2f&title=%e4%b8%80%e8%a8%80%e4%b8%8d%e5%90%88%e9%80%a0%e8%bd%ae%e5%ad%90--%e6%92%b8%e4%b8%80%e4%b8%aaReactTimePicker"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f5jj87x62wfr%2f&is_video=false&description=%e4%b8%80%e8%a8%80%e4%b8%8d%e5%90%88%e9%80%a0%e8%bd%ae%e5%ad%90--%e6%92%b8%e4%b8%80%e4%b8%aaReactTimePicker"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%b8%80%e8%a8%80%e4%b8%8d%e5%90%88%e9%80%a0%e8%bd%ae%e5%ad%90--%e6%92%b8%e4%b8%80%e4%b8%aaReactTimePicker&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f5jj87x62wfr%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f5jj87x62wfr%2f&title=%e4%b8%80%e8%a8%80%e4%b8%8d%e5%90%88%e9%80%a0%e8%bd%ae%e5%ad%90--%e6%92%b8%e4%b8%80%e4%b8%aaReactTimePicker"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5jj87x62wfr%2f&title=%e4%b8%80%e8%a8%80%e4%b8%8d%e5%90%88%e9%80%a0%e8%bd%ae%e5%ad%90--%e6%92%b8%e4%b8%80%e4%b8%aaReactTimePicker"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5jj87x62wfr%2f&title=%e4%b8%80%e8%a8%80%e4%b8%8d%e5%90%88%e9%80%a0%e8%bd%ae%e5%ad%90--%e6%92%b8%e4%b8%80%e4%b8%aaReactTimePicker"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5jj87x62wfr%2f&title=%e4%b8%80%e8%a8%80%e4%b8%8d%e5%90%88%e9%80%a0%e8%bd%ae%e5%ad%90--%e6%92%b8%e4%b8%80%e4%b8%aaReactTimePicker"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">一言不合造轮子--撸一个ReactTimePicker</h1><div class="meta"><div class="postdate"><time datetime="2019-02-04" itemprop="datePublished">2019-02-04</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\n\x3cp\x3e本文的源码全部位于github项目仓库\x3ca href=\x22https:\/\/github.com\/ecmadao\/react-times\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3ereact-times\x3c\/code\x3e\x3c\/a\x3e，如果有差异请以github为准。最终线上DEMO可见\x3ca href=\x22https:\/\/ecmadao.github.io\/react-times\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereact-times github page\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e文章记录了一次创建独立React组件并做成NPM包的过程，将会涉及到React开发、单页测试、Webpack等内容。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e先看下最终的效果~\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC2K6?w=480\x26amp;h=407\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC2K6?w=480\x26amp;h=407\x22 alt=\x22react-times\x22 title=\x22react-times\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e起因\x3c\/h3\x3e\n\x3cp\x3e因为我司的业务需求，需要有一个日期和时间的选择器。最开始我们使用的是\x3ca href=\x22http:\/\/amsul.ca\/pickadate.js\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3epickadate\x3c\/code\x3e\x3c\/a\x3e，一个基于jQuery的比较老牌的时间日期选择器。在页面上大致长这样：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC2Ln?w=696\x26amp;h=132\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC2Ln?w=696\x26amp;h=132\x22 alt=\x22pickadata\x22 title=\x22pickadata\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这样：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC2Lu?w=700\x26amp;h=634\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC2Lu?w=700\x26amp;h=634\x22 alt=\x22pickadata\x22 title=\x22pickadata\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e还有这样：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006883183?w=660\x26amp;h=736\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006883183?w=660\x26amp;h=736\x22 alt=\x22pickadata\x22 title=\x22pickadata\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e大体上看着还OK吧？但是后来随着我们业务的增长和代码重构，前端webpack成为标配，同时越来越多的页面使用React进行重构，pickadata经常出现一些莫名的bug，再加上它本身的API不够\x3ccode\x3eReact Style\x3c\/code\x3e --- 在和React中使用的时候，pickadate组件的初始化还不得不按照老式的jQuery组件那样，调用API，在DOM里插入pickadate。而且，为了获取date\/time变动时的值，往往需要通过jQuery选择器来拿到value，因而pickadate组件选择器的初始化和一些事件都较多的依赖于React Component的生命周期。这。。用久了就感觉越来越蛋疼了。\x3c\/p\x3e\n\x3cp\x3e后来又一次偶尔发现了Airbnb（业界良心）开源的React组件--\x3ca href=\x22https:\/\/github.com\/airbnb\/react-dates\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3ereact-dates\x3c\/code\x3e\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ereact-dates\x3c\/code\x3e是一个基于\x3ccode\x3emoment\x3c\/code\x3e和\x3ccode\x3eReact\x3c\/code\x3e的日期选择器，其插件本身就是一个ReactComponent，有NPM，有足够的测试，有良好的API。于是当即下定决心要趁此干掉pickadate。可真正用到项目中才发现它居然不支持时间选择！！！（或许因为Airbnb本身的业务就是更看重日期的？）因此才有了自己撸一个的想法。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e设计与架构\x3c\/h3\x3e\n\x3ch4\x3eUI设计\x3c\/h4\x3e\n\x3cp\x3eUI方面没得说，我是妥妥的\x3ccode\x3eMaterial Design\x3c\/code\x3e党。这次也是着急动手撸代码，所以直接就参考Android6.0\x2b系统上闹钟里的时间选择好了，之后再完善并增加UI主题：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC2L1?w=1080\x26amp;h=1920\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC2L1?w=1080\x26amp;h=1920\x22 alt=\x22UI\x22 title=\x22UI\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e目标差不多就长这个样子，再增加一个选择时间的按钮和黑白配色的选择。\x3c\/p\x3e\n\x3ch4\x3e需求整理\x3c\/h4\x3e\n\x3cp\x3e搭配我们的“UI稿”和线框稿一起食用：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC2L4?w=552\x26amp;h=770\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC2L4?w=552\x26amp;h=770\x22 alt=\x22线框稿\x22 title=\x22线框稿\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可以看到，除去上方选择时间并展示的按钮之外，我们把真正的时间表盘放在了下面的modal里。而modal表盘里的设计，则会模仿上图的Android时间选择器，是一个MD风格的拟时钟样式的选择器。初步整理出一些需求：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e点击按钮弹出表盘modal，再点击其他区域关闭modal\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e表盘modal里有一个圆形的时间选择器，时间的数字围绕圆形环绕\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e表盘里有一个指针，可以以表盘为中心旋转\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e点击代表时间的数字，应该改变外层按钮里对应的小时\/分钟，同时指针改变旋转角度，指向点击的时间\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e拖拽指针，可以环绕中心旋转。当放开指针时，它应该自动指向距离最近的小时或者分钟\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e拖拽指针并松开，指针停止之后，当前选择的时间和外层按钮上显示的时间应该被改变\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e拖拽指针到两个整数数字之间并放开时，指针应该自动旋转到距离最近的时间上\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e代码设计\x3c\/h4\x3e\n\x3cp\x3e有了上面的初步需求整理，我们就可以来构思组件的代码设计了。既然是个React组件，那么就应该按照逻辑和UI，把整体尽可能的拆分成足够小的模块。\x3c\/p\x3e\n\x3cp\x3e有几点代码层面的架构需要考虑：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e考虑到“点击按钮弹出表盘modal，再点击其他区域关闭modal”这个需求，或许我们应该在分离出一个\x3ccode\x3eOutsideClickHandler\x3c\/code\x3e，专门用来处理用户点击了表盘以外其他区域时的modal关闭事件。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eAndroid时间选择的表盘其实有两个，一个是小时的选择，另一个则是分钟的选择。用户可以点击modal里圆形表盘上的小时\/分钟，来切换不同的表盘。那么这意味着或许会有大量的代码可供我们复用。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e那么就先按照这个思路进行拆分：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\n\x3cp\x3e\x3ccode\x3eTimePicker\x3c\/code\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e按钮\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e处理外层点击事件的组件（\x3ccode\x3eOutsideClickHandler\x3c\/code\x3e）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e表盘modal\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3emodal \x2b 表盘（\x3ccode\x3eTimePickerModal\x3c\/code\x3e）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e环绕的数字（\x3ccode\x3ePickerPoint\x3c\/code\x3e）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e指针（\x3ccode\x3ePickerDargHandler\x3c\/code\x3e）\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e在这样的结构下，\x3ccode\x3eTimePicker.jsx\x3c\/code\x3e文件将是我们最后\x3ccode\x3eexport\x3c\/code\x3e出去的组件。在\x3ccode\x3eTimePicker,jsx\x3c\/code\x3e中，包含了按钮组件和Modal组件。而Modal组件的各个组成部分被拆分成粒度更小的组件，以便组合和复用。\x3c\/p\x3e\n\x3cp\x3e这样有哪些好处呢？举个栗子：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e我们在做组件的时候，先做了小时的选择，然后做分钟的选择。但两个picker的UI不同点主要集中在数字在表盘的布局上，以及一些选择的代码逻辑。这样的话我们就可以保持大体框架不变，只改变表盘中心渲染的数字布局即可。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e假设下图是小时选择器：（请原谅我可怜的绘图）\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC2L6?w=530\x26amp;h=728\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC2L6?w=530\x26amp;h=728\x22 alt=\x22小时选择器\x22 title=\x22小时选择器\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e假设下图是分钟选择器：（请原谅我可怜的绘图）\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC2Md?w=534\x26amp;h=726\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC2Md?w=534\x26amp;h=726\x22 alt=\x22分钟选择器\x22 title=\x22分钟选择器\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e而我们按照这样的架构撸完代码之后，如果想额外做一些其他的东西，比如支持12小时制，那么小时和分钟的选择则应该集中在一个表盘modal上（也就是长得和正常是时钟一样）。在这样的需求下，我们需要在一个表盘里同时渲染小时和分钟的数字布局，而其他的东西，比如说modal啊，指针啊依旧保持原样（一样的指针组件，只不过渲染了两个）。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e下图是24小时制，点击modal上的小时\/分钟来切换不同表盘：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC2Mf?w=644\x26amp;h=912\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC2Mf?w=644\x26amp;h=912\x22 alt=\x2224小时制\x22 title=\x2224小时制\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e下图是12小时制，在同一个表盘上显示小时和分钟：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC2Mg?w=670\x26amp;h=928\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC2Mg?w=670\x26amp;h=928\x22 alt=\x2212小时制\x22 title=\x2212小时制\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3e文件结构\x3c\/h4\x3e\n\x3cp\x3eSo, 目前这样的结构设计应该可以满足我们的简单的需求。接下来就开始卷起袖子撸代码喽。\x3c\/p\x3e\n\x3cp\x3e新建项目，文件结构如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22# react-times\n- src\/\n    - components\/\n        TimePicker.jsx\n        OutsideClickHandler.jsx\n        TimePickerModal.jsx\n        PickerPoint.jsx\n        PickerDargHandler.jsx\n    - utils.js\n    - ConstValue.js\n\x2b css\/\n\x2b test\/\n\x2b lib\/\nindex.js\npackage.json\nwebpack.config.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e# react-times\x3c\/span\x3e\n- src\/\n    - components\/\n        TimePicker.jsx\n        OutsideClickHandler.jsx\n        TimePickerModal.jsx\n        PickerPoint.jsx\n        PickerDargHandler.jsx\n    - utils.js\n    - ConstValue.js\n\x2b css\/\n\x2b \x3cspan class=\x22hljs-built_in\x22\x3etest\x3c\/span\x3e\/\n\x2b lib\/\nindex.js\npackage.json\nwebpack.config.js\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中，\x3ccode\x3esrc\x3c\/code\x3e文件夹下是我们的源码，而\x3ccode\x3elib\x3c\/code\x3e则是编译过后的代码。而\x3ccode\x3eindex.js\x3c\/code\x3e则是整个包最终的出口，我们在这里将做好的组件暴露出去：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var TimePicker = require(\x27.\/lib\/components\/TimePicker\x27).default;\n\nmodule.exports = TimePicker;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e TimePicker = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/lib\/components\/TimePicker\x27\x3c\/span\x3e).default;\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = TimePicker;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e环境搭建\x3c\/h3\x3e\n\x3cp\x3e既然是写一个独立的React组件，那它的开发则和我们项目的开发相互独立。\x3c\/p\x3e\n\x3cp\x3e那么问题来了：该如何搭建开发和测试环境呢？这个组件我想使用\x3ccode\x3eReact\x3c\/code\x3e和\x3ccode\x3eES6\x3c\/code\x3e的语法，而单元测试则使用\x3ccode\x3emocha\x3c\/code\x3e\x2b\x3ccode\x3echai\x3c\/code\x3e和Airbnb的\x3ccode\x3eenzyme\x3c\/code\x3e（再次感谢业界良心）。那么在发布之前，应该使用构建工具将其初步打包，针对于这点我选用了\x3ccode\x3ewebpack\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e而在开发过程中，需要能够启动一个server，以便能在网页上渲染出组件，进行调试。因此，可以使用\x3ca href=\x22https:\/\/github.com\/kadirahq\/react-storybook\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3ereact-storybook\x3c\/code\x3e\x3c\/a\x3e这个库，它允许我们启动一个server，把自己的组件渲染在页面上，并支持webpack进行编译。具体的使用大家可以去看\x3ca href=\x22https:\/\/getstorybook.io\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3estorybook文档\x3c\/a\x3e，非常简单易懂，便于配置。\x3c\/p\x3e\n\x3cp\x3e那么进入正题，组件的编写。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e组件编写\x3c\/h3\x3e\n\x3ch4\x3e\x3ccode\x3eTimePicker\x3c\/code\x3e\x3c\/h4\x3e\n\x3cp\x3e对于传入组件的\x3ccode\x3eprops\x3c\/code\x3e：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3edefaultTime\x3c\/code\x3e：默认初始化时间。默认为当前时间\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3efocused\x3c\/code\x3e：初始化时modal是否打开。默认为\x3ccode\x3efalse\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eonFocusChange\x3c\/code\x3e：modal开\/关状态变化时的回调\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eonHourChange\x3c\/code\x3e：选择的小时变化时的回调，以小时作为参数\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eonMinuteChange\x3c\/code\x3e：选择的分钟变化时的回调，以分钟作为参数\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eonTimeChange\x3c\/code\x3e：任意时间变化时的回调，以\x3ccode\x3ehour:minute\x3c\/code\x3e作为参数，参数类型是String\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ src\/components\/TimePicker.jsx\n\/\/ 省略了一些方法的具体内容和组件属性的传递\nimport React, {PropTypes} from \x27react\x27;\nimport moment from \x27moment\x27;\n\nimport OutsideClickHandler from \x27.\/OutsideClickHandler\x27;\nimport TimePickerModal from \x27.\/TimePickerModal\x27;\n\n\/\/ 组件开发要养成良好的习惯：检查传入的属性，并设定默认属性值\nconst propTypes = {\n  defaultTime: PropTypes.string,\n  focused: PropTypes.bool,\n  onFocusChange: PropTypes.func,\n  onHourChange: PropTypes.func,\n  onMinuteChange: PropTypes.func,\n  onTimeChange: PropTypes.func\n};\n\nconst defaultProps = {\n  defaultTime: moment().format(\x26quot;HH:mm\x26quot;),\n  focused: false,\n  onFocusChange: () =\x3e {},\n  onHourChange: () =\x3e {},\n  onMinuteChange: () =\x3e {},\n  onTimeChange: () =\x3e {}\n};\n\nexport default class TimePicker extends React.Component {\n  constructor(props) {\n    super(props);\n    let {defaultTime, focused} = props;\n    let [hour, minute] = initialTime(defaultTime);\n    this.state = {\n      hour,\n      minute,\n      focused\n    }\n    this.onFocus = this.onFocus.bind(this);\n    this.onClearFocus = this.onClearFocus.bind(this);\n    this.handleHourChange = this.handleHourChange.bind(this);\n    this.handleMinuteChange = this.handleMinuteChange.bind(this);\n  }\n\n  \/\/ 改变state，并触发onFocusChange callback\n  onFocus() {}\n  onClearFocus() {}\n  handleHourChange() {}\n  handleMinuteChange() {}\n\n  renderTimePickerModal() {\n    let {hour, minute, focused} = this.state;\n    \/\/ 给组件传入小时\/分钟，以及handleHourChange,handleMinuteChange\n    return (\n      \x3cTimePickerModal \/\x3e\n    )\n  }\n\n  render() {\n    let {hour, minute, focused} = this.state;\n    let times = `${hour} : ${minute}`;\n    return (\n      \x3cdiv className=\x26quot;time_picker_container\x26quot;\x3e\n        \x3cdiv onClick={this.onFocus} className=\x26quot;time_picker_preview\x26quot;\x3e\n          \x3cdiv className={previewContainerClass}\x3e\n            {times}\n          \x3c\/div\x3e\n        \x3c\/div\x3e\n        {\/*OutsideClickHandler 就是上面说到了，专门用于处理modal外点击事件，来关闭modal的组件*\/}\n        \x3cOutsideClickHandler onOutsideClick={this.onClearFocus}\x3e\n          {this.renderTimePickerModal()}\n        \x3c\/OutsideClickHandler\x3e\n      \x3c\/div\x3e\n    )\n  }\n}\n\nTimePicker.propTypes = propTypes;\nTimePicker.defaultProps = defaultProps;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ src\/components\/TimePicker.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 省略了一些方法的具体内容和组件属性的传递\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React, {PropTypes} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e moment \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27moment\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e OutsideClickHandler \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/OutsideClickHandler\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e TimePickerModal \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/TimePickerModal\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 组件开发要养成良好的习惯：检查传入的属性，并设定默认属性值\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e propTypes = {\n  \x3cspan class=\x22hljs-attr\x22\x3edefaultTime\x3c\/span\x3e: PropTypes.string,\n  \x3cspan class=\x22hljs-attr\x22\x3efocused\x3c\/span\x3e: PropTypes.bool,\n  \x3cspan class=\x22hljs-attr\x22\x3eonFocusChange\x3c\/span\x3e: PropTypes.func,\n  \x3cspan class=\x22hljs-attr\x22\x3eonHourChange\x3c\/span\x3e: PropTypes.func,\n  \x3cspan class=\x22hljs-attr\x22\x3eonMinuteChange\x3c\/span\x3e: PropTypes.func,\n  \x3cspan class=\x22hljs-attr\x22\x3eonTimeChange\x3c\/span\x3e: PropTypes.func\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e defaultProps = {\n  \x3cspan class=\x22hljs-attr\x22\x3edefaultTime\x3c\/span\x3e: moment().format(\x3cspan class=\x22hljs-string\x22\x3e\x22HH:mm\x22\x3c\/span\x3e),\n  \x3cspan class=\x22hljs-attr\x22\x3efocused\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eonFocusChange\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {},\n  \x3cspan class=\x22hljs-attr\x22\x3eonHourChange\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {},\n  \x3cspan class=\x22hljs-attr\x22\x3eonMinuteChange\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {},\n  \x3cspan class=\x22hljs-attr\x22\x3eonTimeChange\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {}\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTimePicker\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(props) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {defaultTime, focused} = props;\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e [hour, minute] = initialTime(defaultTime);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = {\n      hour,\n      minute,\n      focused\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onFocus = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onFocus.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onClearFocus = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onClearFocus.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleHourChange = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleHourChange.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleMinuteChange = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleMinuteChange.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e);\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 改变state，并触发onFocusChange callback\x3c\/span\x3e\n  onFocus() {}\n  onClearFocus() {}\n  handleHourChange() {}\n  handleMinuteChange() {}\n\n  renderTimePickerModal() {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {hour, minute, focused} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 给组件传入小时\/分钟，以及handleHourChange,handleMinuteChange\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eTimePickerModal\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n    )\n  }\n\n  render() {\n    let {hour, minute, focused} = this.state;\n    let times = `${hour} : ${minute}`;\n    return (\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22time_picker_container\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonClick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{this.onFocus}\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22time_picker_preview\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{previewContainerClass}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            {times}\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        {\/*OutsideClickHandler 就是上面说到了，专门用于处理modal外点击事件，来关闭modal的组件*\/}\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eOutsideClickHandler\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonOutsideClick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{this.onClearFocus}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          {this.renderTimePickerModal()}\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eOutsideClickHandler\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    )\n  }\n}\n\nTimePicker.propTypes = propTypes;\nTimePicker.defaultProps = defaultProps;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以看到，\x3ccode\x3eOutsideClickHandler\x3c\/code\x3e包裹着\x3ccode\x3eTimePickerModal\x3c\/code\x3e，而在\x3ccode\x3eOutsideClickHandler\x3c\/code\x3e中，我们进行modal外点击事件的处理，关闭modal\x3c\/p\x3e\n\x3ch4\x3e\x3ccode\x3eOutsideClickHandler\x3c\/code\x3e\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ src\/components\/OutsideClickHandler.jsx\n\n\/\/ ...\n\nconst propTypes = {\n  children: PropTypes.node,\n  onOutsideClick: PropTypes.func,\n};\n\nconst defaultProps = {\n  children: \x3cspan \/\x3e,\n  onOutsideClick: () =\x3e {},\n};\n\nexport default class OutsideClickHandler extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onOutsideClick = this.onOutsideClick.bind(this);\n  }\n\n  componentDidMount() {\n    \/\/ 组件didMount之后，直接在document上绑定点击事件监听\n    if (document.addEventListener) {\n      document.addEventListener(\x27click\x27, this.onOutsideClick, true);\n    } else {\n      document.attachEvent(\x27onclick\x27, this.onOutsideClick);\n    }\n  }\n\n  componentWillUnmount() {\n    if (document.removeEventListener) {\n      document.removeEventListener(\x27click\x27, this.onOutsideClick, true);\n    } else {\n      document.detachEvent(\x27onclick\x27, this.onOutsideClick);\n    }\n  }\n\n  onOutsideClick(e) {\n    \/\/ 如果点击区域不在该组件内部，则调用关闭modal的方法\n    \/\/ 通过ReactDOM.findDOMNode来拿到原生的DOM，避免额外的jQuery依赖\n    const isDescendantOfRoot = ReactDOM.findDOMNode(this.childNode).contains(e.target);\n    if (!isDescendantOfRoot) {\n      let {onOutsideClick} = this.props;\n      onOutsideClick \x26amp;\x26amp; onOutsideClick(e);\n    }\n  }\n\n  render() {\n    return (\n      \x3cdiv ref={(c) =\x3e this.childNode = c}\x3e\n        {this.props.children}\n      \x3c\/div\x3e\n    )\n  }\n}\n\nOutsideClickHandler.propTypes = propTypes;\nOutsideClickHandler.defaultProps = defaultProps;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ src\/components\/OutsideClickHandler.jsx\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e propTypes = {\n  \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: PropTypes.node,\n  \x3cspan class=\x22hljs-attr\x22\x3eonOutsideClick\x3c\/span\x3e: PropTypes.func,\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e defaultProps = {\n  \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e,\n  onOutsideClick: () =\x26gt; {},\n};\n\nexport default class OutsideClickHandler extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onOutsideClick = this.onOutsideClick.bind(this);\n  }\n\n  componentDidMount() {\n    \/\/ 组件didMount之后，直接在document上绑定点击事件监听\n    if (document.addEventListener) {\n      document.addEventListener(\x27click\x27, this.onOutsideClick, true);\n    } else {\n      document.attachEvent(\x27onclick\x27, this.onOutsideClick);\n    }\n  }\n\n  componentWillUnmount() {\n    if (document.removeEventListener) {\n      document.removeEventListener(\x27click\x27, this.onOutsideClick, true);\n    } else {\n      document.detachEvent(\x27onclick\x27, this.onOutsideClick);\n    }\n  }\n\n  onOutsideClick(e) {\n    \/\/ 如果点击区域不在该组件内部，则调用关闭modal的方法\n    \/\/ 通过ReactDOM.findDOMNode来拿到原生的DOM，避免额外的jQuery依赖\n    const isDescendantOfRoot = ReactDOM.findDOMNode(this.childNode).contains(e.target);\n    if (!isDescendantOfRoot) {\n      let {onOutsideClick} = this.props;\n      onOutsideClick \x26amp;\x26amp; onOutsideClick(e);\n    }\n  }\n\n  render() {\n    return (\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{(c)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e this.childNode = c}\x26gt;\n        {this.props.children}\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    )\n  }\n}\n\nOutsideClickHandler.propTypes = propTypes;\nOutsideClickHandler.defaultProps = defaultProps;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e\x3ccode\x3eTimePickerModal\x3c\/code\x3e\x3c\/h4\x3e\n\x3cp\x3e而\x3ccode\x3eTimePickerModal\x3c\/code\x3e主要用来渲染\x3ccode\x3ePickerDargHandler\x3c\/code\x3e和\x3ccode\x3ePickerPoint\x3c\/code\x3e组件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ src\/components\/TimePickerModal.jsx\n\/\/ ...\n\/\/ 为了简便我们在文章中忽略引入的React和一些参数类型检查\n\nclass TimePickerModal extends React.Component {\n  constructor(props) {\n    super(props);\n    \/*\n    - 获取初始化时的旋转角度\n    - 以step 0代表hour的选择，1代表minute的选择\n    *\/\n    let pointerRotate = this.resetHourDegree();\n    this.state = {\n      step: 0,\n      pointerRotate\n    }\n  }\n\n  handleStepChange(step) {}\n\n  handleTimePointerClick(time, pointerRotate) {\n    \/*\n    - 当表盘上某一个数字被点击时\n    - 或者拖拽完指针并放下时，所调用的回调\n    - 参数是该数字或指针所代表的时间和旋转角度\n    *\/\n  }\n\n  \/\/ 在切换step的时候，根据当前的hour\/minute来重新改变旋转角度\n  resetHourDegree() {}\n  resetMinuteDegree() {}\n\n  \/*\n  \x2b 两个方法会return PickerPoint组件\n  \x2b 之所以分两个是因为小时\/分钟表盘在UI上有较多不同，因而传入的props需要不同的计算\n  \x2b 但在PickerPoint组件内部的逻辑是一样的\n  *\/\n  renderMinutePointes() {}\n  renderHourPointes() {}\n\n  render() {\n    let {step, pointerRotate} = this.state;\n    return (\n      \x3cdiv className=\x26quot;time_picker_modal_container\x26quot;\x3e\n        \x3cdiv className=\x26quot;time_picker_modal_header\x26quot;\x3e\n          \x3cspan onClick={this.handleStepChange.bind(this, 0)}\x3e\n            {hour}\n          \x3c\/span\x3e\n          \x26amp;nbsp;:\x26amp;nbsp;\n          \x3cspan onClick={this.handleStepChange.bind(this, 1)}\x3e\n            {minute}\n          \x3c\/span\x3e\n        \x3c\/div\x3e\n        \x3cdiv className=\x26quot;picker_container\x26quot;\x3e\n          {step === 0 ? this.renderHourPointes() : this.renderMinutePointes()}\n          \x3cPickerDargHandler\n              pointerRotate={pointerRotate}\n              time={step === 0 ? parseInt(hour) : parseInt(minute)}\n              handleTimePointerClick={this.handleTimePointerClick} \/\x3e\n        \x3c\/div\x3e\n      \x3c\/div\x3e\n    )\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ src\/components\/TimePickerModal.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 为了简便我们在文章中忽略引入的React和一些参数类型检查\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTimePickerModal\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(props) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/*\n    - 获取初始化时的旋转角度\n    - 以step 0代表hour的选择，1代表minute的选择\n    *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e pointerRotate = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.resetHourDegree();\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = {\n      \x3cspan class=\x22hljs-attr\x22\x3estep\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n      pointerRotate\n    }\n  }\n\n  handleStepChange(step) {}\n\n  handleTimePointerClick(time, pointerRotate) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/*\n    - 当表盘上某一个数字被点击时\n    - 或者拖拽完指针并放下时，所调用的回调\n    - 参数是该数字或指针所代表的时间和旋转角度\n    *\/\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在切换step的时候，根据当前的hour\/minute来重新改变旋转角度\x3c\/span\x3e\n  resetHourDegree() {}\n  resetMinuteDegree() {}\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/*\n  \x2b 两个方法会return PickerPoint组件\n  \x2b 之所以分两个是因为小时\/分钟表盘在UI上有较多不同，因而传入的props需要不同的计算\n  \x2b 但在PickerPoint组件内部的逻辑是一样的\n  *\/\x3c\/span\x3e\n  renderMinutePointes() {}\n  renderHourPointes() {}\n\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {step, pointerRotate} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22time_picker_modal_container\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22time_picker_modal_header\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonClick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{this.handleStepChange.bind(this,\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e0\x3c\/span\x3e)}\x26gt;\x3c\/span\x3e\n            {hour}\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          \x26amp;nbsp;:\x26amp;nbsp;\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonClick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{this.handleStepChange.bind(this,\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e1\x3c\/span\x3e)}\x26gt;\x3c\/span\x3e\n            {minute}\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22picker_container\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          {step === 0 ? this.renderHourPointes() : this.renderMinutePointes()}\n          \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ePickerDargHandler\x3c\/span\x3e\n              \x3cspan class=\x22hljs-attr\x22\x3epointerRotate\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{pointerRotate}\x3c\/span\x3e\n              \x3cspan class=\x22hljs-attr\x22\x3etime\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{step\x3c\/span\x3e === \x3cspan class=\x22hljs-string\x22\x3e0\x3c\/span\x3e ? \x3cspan class=\x22hljs-attr\x22\x3eparseInt\x3c\/span\x3e(\x3cspan class=\x22hljs-attr\x22\x3ehour\x3c\/span\x3e) \x3cspan class=\x22hljs-attr\x22\x3e:\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eparseInt\x3c\/span\x3e(\x3cspan class=\x22hljs-attr\x22\x3eminute\x3c\/span\x3e)}\n              \x3cspan class=\x22hljs-attr\x22\x3ehandleTimePointerClick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{this.handleTimePointerClick}\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    )\n  }\n}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面这样，就基本完成了\x3ccode\x3eTimePickerModal\x3c\/code\x3e组件的编写。但还不够好。为什么呢？\x3c\/p\x3e\n\x3cp\x3e按照我们的逻辑，这个时间选择器应该根据\x3ccode\x3estep\x3c\/code\x3e来切换表盘上表示小时\/分钟的数字。也就是说，第一步选择小时，第二部选择分钟 -- 它是一个24小时制的时间选择器。那么，如果是要变成12小时制呢？让小时和分钟在同一个表盘上渲染，而\x3ccode\x3estep\x3c\/code\x3e只改变AM\/PM呢？\x3c\/p\x3e\n\x3cp\x3e那么考虑12小时制的情况：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e一个表盘上要同时有小时和分钟两种数字\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e一个表盘上要有小时和分钟的两个指针\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e切换\x3ccode\x3estep\x3c\/code\x3e改变的是AM\/PM\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e鉴于我们不应该在\x3ccode\x3eTimePickerModal\x3c\/code\x3e中放入太多的逻辑判断，那么还是针对12小时制专门创建一个组件\x3ccode\x3eTwelveHoursModal\x3c\/code\x3e比较好，但也会提取出\x3ccode\x3eTimePickerModal\x3c\/code\x3e组件中可以独立的方法，作为专门渲染PickerPoint的中间层，\x3ccode\x3ePickerPointGenerator.jsx\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch4\x3e\x3ccode\x3ePickerPointGenerator\x3c\/code\x3e\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3ePickerPointGenerator\x3c\/code\x3e其实算是一个中间层组件。在它内部会进行一些逻辑判断，最终渲染出我们想要的表盘数字。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ src\/components\/PickerPointGenerator.jsx\n\/\/ ...\nimport {\n  MINUTES,\n  HOURS,\n  TWELVE_HOURS\n} from \x27..\/ConstValue.js\x27;\nimport PickerPoint from \x27.\/PickerPoint\x27;\n\nconst pickerPointGenerator = (type = \x27hour\x27, mode = 24) =\x3e {\n  return class PickerPointGenerator extends React.Component {\n    constructor(props) {\n      super(props);\n      this.handleTimePointerClick = props.handleTimePointerClick.bind(this);\n    }\n    \/\/ 返回PickerPoint\n    renderMinutePointes() {}\n    renderHourPointes() {}\n\n    render() {\n      return (\n        \x3cdiv\n          ref={ref =\x3e this.pickerPointerContainer = ref}\n          id=\x26quot;picker_pointer_container\x26quot;\x3e\n          {type === \x27hour\x27 ? this.renderHourPointes() : this.renderMinutePointes()}\n        \x3c\/div\x3e\n      )\n    }\n  }\n};\n\nexport default pickerPointGenerator;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ src\/components\/PickerPointGenerator.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {\n  MINUTES,\n  HOURS,\n  TWELVE_HOURS\n} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/ConstValue.js\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e PickerPoint \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/PickerPoint\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e pickerPointGenerator = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3etype = \x3cspan class=\x22hljs-string\x22\x3e\x27hour\x27\x3c\/span\x3e, mode = \x3cspan class=\x22hljs-number\x22\x3e24\x3c\/span\x3e\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ePickerPointGenerator\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(props) {\n      \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleTimePointerClick = props.handleTimePointerClick.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e);\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 返回PickerPoint\x3c\/span\x3e\n    renderMinutePointes() {}\n    renderHourPointes() {}\n\n    render() {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n        \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\n          \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{ref\x3c\/span\x3e =\x26gt;\x3c\/span\x3e this.pickerPointerContainer = ref}\n          id=\x22picker_pointer_container\x22\x26gt;\n          {type === \x27hour\x27 ? this.renderHourPointes() : this.renderMinutePointes()}\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n      )\n    }\n  }\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e pickerPointGenerator;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e有了它之后，我们之前的\x3ccode\x3eTimePickerModal\x3c\/code\x3e可以这么写：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ src\/components\/TimePickerModal.jsx\n\/\/ ...\nclass TimePickerModal extends React.Component {\n  render() {\n    const {step} = this.state;\n    const type = step === 0 ? \x27hour\x27 : \x27minute\x27;\n    const PickerPointGenerator = pickerPointGenerator(type);\n\n    return (\n      ...\n      \x3cPickerPointGenerator\n        handleTimePointerClick={this.handleTimePointerClick}\n      \/\x3e\n      ...\n    )\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ src\/components\/TimePickerModal.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTimePickerModal\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {step} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state;\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e type = step === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x27hour\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x27minute\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e PickerPointGenerator = pickerPointGenerator(type);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      ...\n      \x26lt;PickerPointGenerator\n        handleTimePointerClick={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleTimePointerClick}\n      \/\x26gt;\n      ...\n    )\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而如果是12小时制呢：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ src\/components\/TwelveHoursModal.jsx\n\/\/ ...\nclass TwelveHoursModal extends React.Component {\n  render() {\n    const HourPickerPointGenerator = pickerPointGenerator(\x27hour\x27, 12);\n    const MinutePickerPointGenerator = pickerPointGenerator(\x27minute\x27, 12);\n    return (\n      ...\n      \x3cHourPickerPointGenerator\n        handleTimePointerClick={this.handleHourPointerClick}\n      \/\x3e\n      \x3cMinutePickerPointGenerator\n        handleTimePointerClick={this.handleMinutePointerClick}\n      \/\x3e\n      ...\n    )\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ src\/components\/TwelveHoursModal.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTwelveHoursModal\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e HourPickerPointGenerator = pickerPointGenerator(\x3cspan class=\x22hljs-string\x22\x3e\x27hour\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e MinutePickerPointGenerator = pickerPointGenerator(\x3cspan class=\x22hljs-string\x22\x3e\x27minute\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      ...\n      \x26lt;HourPickerPointGenerator\n        handleTimePointerClick={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleHourPointerClick}\n      \/\x26gt;\n      \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eMinutePickerPointGenerator\x3c\/span\x3e\n        \x3cspan class=\x22hljs-attr\x22\x3ehandleTimePointerClick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{this.handleMinutePointerClick}\x3c\/span\x3e\n      \/\x26gt;\x3c\/span\x3e\n      ...\n    )\n  }\n}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e\x3ccode\x3ePickerPoint\x3c\/code\x3e\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3ePickerPoint\x3c\/code\x3e内的逻辑很简单，就是渲染数字，并处理点击事件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ src\/components\/PickerPoint.jsx\n\/\/ ...\n\nconst propTypes = {\n  index: PropTypes.number,\n  angle: PropTypes.number,\n  handleTimeChange: PropTypes.func\n};\n\nclass PickerPoint extends React.Component {\n  render() {\n    let {index, handleTimeChange, angle} = this.props;\n    let inlineStyle = getInlineRotateStyle(angle);\n    let wrapperStyle = getRotateStyle(-angle);\n\n    return (\n      \x3cdiv\n        style={inlineStyle}\n        onClick={() =\x3e {\n          handleTimeChange(index, angle)\n        \x22}}\x22\n        onMouseDown={disableMouseDown}\x3e\n        \x3cdiv className=\x26quot;point_wrapper\x26quot; style={wrapperStyle}\x3e\n          {index}\n        \x3c\/div\x3e\n      \x3c\/div\x3e\n    )\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ src\/components\/PickerPoint.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e propTypes = {\n  \x3cspan class=\x22hljs-attr\x22\x3eindex\x3c\/span\x3e: PropTypes.number,\n  \x3cspan class=\x22hljs-attr\x22\x3eangle\x3c\/span\x3e: PropTypes.number,\n  \x3cspan class=\x22hljs-attr\x22\x3ehandleTimeChange\x3c\/span\x3e: PropTypes.func\n};\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ePickerPoint\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {index, handleTimeChange, angle} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e inlineStyle = getInlineRotateStyle(angle);\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e wrapperStyle = getRotateStyle(-angle);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\n        \x3cspan class=\x22hljs-attr\x22\x3estyle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{inlineStyle}\x3c\/span\x3e\n        \x3cspan class=\x22hljs-attr\x22\x3eonClick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n          handleTimeChange(index, angle)\n        \x22}}\x22\n        onMouseDown={disableMouseDown}\x26gt;\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22point_wrapper\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estyle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{wrapperStyle}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n          {index}\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n    )\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e\x3ccode\x3ePickerDargHandler\x3c\/code\x3e\x3c\/h4\x3e\n\x3cp\x3e在\x3ccode\x3ePickerDargHandler\x3c\/code\x3e组件里，我们主要处理指针的拖拽事件，并将处理好的结果通过callback向上传递。\x3c\/p\x3e\n\x3cp\x3e在这个组件里，它拥有自己的state：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.state = {\n  pointerRotate: this.props.pointerRotate,\n  draging: false\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = {\n  \x3cspan class=\x22hljs-attr\x22\x3epointerRotate\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.pointerRotate,\n  \x3cspan class=\x22hljs-attr\x22\x3edraging\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中，\x3ccode\x3epointerRotate\x3c\/code\x3e是从父层传入，用来给组件初始化时定位指针的位置。而\x3ccode\x3edraging\x3c\/code\x3e则用于处理拖拽事件，标记着当前是否处于被拖拽状态。\x3c\/p\x3e\n\x3cp\x3e对于拖拽事件的处理，大致思路如下：\x3c\/p\x3e\n\x3cp\x3e先写一个获取坐标位置的util：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export const mousePosition = (e) =\x3e {\n  let xPos, yPos;\n  e = e || window.event;\n  if (e.pageX) {\n    xPos = e.pageX;\n    yPos = e.pageY;\n  } else {\n    xPos = e.clientX \x2b document.body.scrollLeft - document.body.clientLeft;\n    yPos = e.clientY \x2b document.body.scrollTop - document.body.clientTop;\n  }\n  return {\n    x: xPos,\n    y: yPos\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e mousePosition = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e xPos, yPos;\n  e = e || \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.event;\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (e.pageX) {\n    xPos = e.pageX;\n    yPos = e.pageY;\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    xPos = e.clientX \x2b \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.scrollLeft - \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.clientLeft;\n    yPos = e.clientY \x2b \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.scrollTop - \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.clientTop;\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attr\x22\x3ex\x3c\/span\x3e: xPos,\n    \x3cspan class=\x22hljs-attr\x22\x3ey\x3c\/span\x3e: yPos\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后需要明确的是，我们在处理拖拽事件过程中，需要记录的数据有：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ethis.originX\x3c\/code\x3e\/\x3ccode\x3ethis.originY\x3c\/code\x3e 旋转所环绕的中心坐标。在\x3ccode\x3ecomponentDidMount\x3c\/code\x3e事件中记录并保存\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ethis.startX\x3c\/code\x3e\/\x3ccode\x3ethis.startY\x3c\/code\x3e 每次拖拽事件开始时的坐标。在\x3ccode\x3eonMouseDown\x3c\/code\x3e事件中记录并保存\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3edragX\x3c\/code\x3e\/\x3ccode\x3edragY\x3c\/code\x3e 移动过程中的坐标，随着移动而不断改变。在\x3ccode\x3eonMouseMove\x3c\/code\x3e事件中记录并保存\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eendX\x3c\/code\x3e\/\x3ccode\x3eendY\x3c\/code\x3e 移动结束时的坐标。在\x3ccode\x3eonMouseUp\x3c\/code\x3e事件中进行处理，并获取最后的角度degree，算出指针停止时对准的时间time，并将time和degree通过callback向父层组件传递。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 处理onMouseDown\nhandleMouseDown(e) {\n  let event = e || window.event;\n  event.preventDefault();\n  event.stopPropagation();\n  \/\/ 在鼠标按下的时候，将draging state标记为true，以便在移动时对坐标进行记录\n  this.setState({\n    draging: true\n  });\n\n  \/\/ 获取此时的坐标位置，作为这次拖拽的开始位置保存下来\n  let pos = mousePosition(event);\n  this.startX = pos.x;\n  this.startY = pos.y;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 处理onMouseDown\x3c\/span\x3e\nhandleMouseDown(e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e event = e || \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.event;\n  event.preventDefault();\n  event.stopPropagation();\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在鼠标按下的时候，将draging state标记为true，以便在移动时对坐标进行记录\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n    \x3cspan class=\x22hljs-attr\x22\x3edraging\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n  });\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取此时的坐标位置，作为这次拖拽的开始位置保存下来\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e pos = mousePosition(event);\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.startX = pos.x;\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.startY = pos.y;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 处理onMouseMove\nhandleMouseMove(e) {\n  if (this.state.draging) {\n    \/\/ 实时获取更新当前坐标，用于计算旋转角度，来更新state中的pointerRotate，而pointerRotate用来改变渲染的视图\n    let pos = mousePosition(e);\n    let dragX = pos.x;\n    let dragY = pos.y;\n\n    if (this.originX !== dragX \x26amp;\x26amp; this.originY !== dragY) {\n      \/\/ 获取旋转的弧度。getRadian方法在下面讲解\n      let sRad = this.getRadian(dragX, dragY);\n      \/\/ 将弧度转为角度\n      let pointerRotate = sRad * (360 \/ (2 * Math.PI));\n      this.setState({\n        \/\/ 记录下来的state会改变渲染出来的指针角度\n        pointerRotate\n      });\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 处理onMouseMove\x3c\/span\x3e\nhandleMouseMove(e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.draging) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 实时获取更新当前坐标，用于计算旋转角度，来更新state中的pointerRotate，而pointerRotate用来改变渲染的视图\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e pos = mousePosition(e);\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e dragX = pos.x;\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e dragY = pos.y;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.originX !== dragX \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.originY !== dragY) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取旋转的弧度。getRadian方法在下面讲解\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e sRad = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getRadian(dragX, dragY);\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将弧度转为角度\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e pointerRotate = sRad * (\x3cspan class=\x22hljs-number\x22\x3e360\x3c\/span\x3e \/ (\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI));\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 记录下来的state会改变渲染出来的指针角度\x3c\/span\x3e\n        pointerRotate\n      });\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在\x3ccode\x3egetRadian\x3c\/code\x3e方法中，通过起始点和中心点的坐标来计算旋转结束后的弧度：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22getRadian(x, y) {\n  let sRad = Math.atan2(y - this.originY, x - this.originX);\n  sRad -= Math.atan2(this.startY - this.originY, this.startX - this.originX);\n  sRad \x2b= degree2Radian(this.props.rotateState.pointerRotate);\n  return sRad;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3egetRadian(x, y) {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e sRad = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.atan2(y - \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.originY, x - \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.originX);\n  sRad -= \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.atan2(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.startY - \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.originY, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.startX - \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.originX);\n  sRad \x2b= degree2Radian(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.rotateState.pointerRotate);\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e sRad;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eMath.atan2(y, x)\x3c\/code\x3e方法返回从x轴到点(x, y)的弧度，介于 -PI\/2 与 PI\/2 之间。\x3c\/p\x3e\n\x3cp\x3e因此这个计算方法直接上图表示，清晰明了：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVC2Mz?w=1632\x26amp;h=1362\x22 src=\x22https:\/\/static.alili.tech\/img\/bVC2Mz?w=1632\x26amp;h=1362\x22 alt=\x22getRadian\x22 title=\x22getRadian\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 处理onMouseUp\nhandleMouseUp(e) {\n  if (this.state.draging) {\n    this.setState({\n      draging: false\n    });\n\n    \/\/ 获取结束时的坐标\n    let pos = mousePosition(e);\n    let endX = pos.x;\n    let endY = pos.y;\n\n    let sRad = this.getRadian(endX, endY);\n    let degree = sRad * (360 \/ (2 * Math.PI));\n\n    \/\/ 在停止拖拽时，要求指针要对准表盘的刻度。因此，除了要对角度的正负进行处理以外，还对其四舍五入。最终获取的pointerRotate是对准了刻度的角度。\n    if (degree \x3c 0) {\n      degree = 360 \x2b degree;\n    }\n    \/\/ roundSeg是四舍五入之后的对准的表盘上的时间数字\n    let roundSeg = Math.round(degree \/ (360 \/ 12));\n    let pointerRotate = roundSeg * (360 \/ 12);\n\n    \/\/ 分钟表盘的每一格都是小时表盘的5倍\n    let time = step === 0 ? time : time * 5;\n    \/\/ 将结果回调给父组件\n    let {handleTimePointerClick} = this.props;\n    handleTimePointerClick \x26amp;\x26amp; handleTimePointerClick(time, pointerRotate);\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 处理onMouseUp\x3c\/span\x3e\nhandleMouseUp(e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.draging) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n      \x3cspan class=\x22hljs-attr\x22\x3edraging\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n    });\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取结束时的坐标\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e pos = mousePosition(e);\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e endX = pos.x;\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e endY = pos.y;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e sRad = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getRadian(endX, endY);\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e degree = sRad * (\x3cspan class=\x22hljs-number\x22\x3e360\x3c\/span\x3e \/ (\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI));\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在停止拖拽时，要求指针要对准表盘的刻度。因此，除了要对角度的正负进行处理以外，还对其四舍五入。最终获取的pointerRotate是对准了刻度的角度。\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (degree \x26lt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n      degree = \x3cspan class=\x22hljs-number\x22\x3e360\x3c\/span\x3e \x2b degree;\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ roundSeg是四舍五入之后的对准的表盘上的时间数字\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e roundSeg = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.round(degree \/ (\x3cspan class=\x22hljs-number\x22\x3e360\x3c\/span\x3e \/ \x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e));\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e pointerRotate = roundSeg * (\x3cspan class=\x22hljs-number\x22\x3e360\x3c\/span\x3e \/ \x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e);\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 分钟表盘的每一格都是小时表盘的5倍\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e time = step === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ? time : time * \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将结果回调给父组件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {handleTimePointerClick} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n    handleTimePointerClick \x26amp;\x26amp; handleTimePointerClick(time, pointerRotate);\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e你可能注意到只有在\x3ccode\x3eonMouseUp\x3c\/code\x3e的最后，我们才把计算得到的角度回调到父组件里，，改变父组件的state。而在\x3ccode\x3ehandleMouseMove\x3c\/code\x3e方法里，我们只把角度存在当前state里。那是因为在每次移动过程中，都需要知道每次开始移动时的角度偏移量。这个数值我们是从父组件state里拿到的，因此只有在放手时才会更新它。而\x3ccode\x3ePickerDargHandler\x3c\/code\x3e组件内部存的state，只是用来在拖拽的过程中改变，以便渲染指针UI的旋转角度：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22componentDidUpdate(prevProps) {\n  let {step, time, pointerRotate} = this.props;\n  let prevStep = prevProps.step;\n  let prevTime = prevProps.time;\n  let PrevRotateState = prevProps.pointerRotate\n  if (step !== prevStep || time !== prevTime || pointerRotate !== PrevRotateState) {\n    this.resetState();\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ecomponentDidUpdate(prevProps) {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {step, time, pointerRotate} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e prevStep = prevProps.step;\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e prevTime = prevProps.time;\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e PrevRotateState = prevProps.pointerRotate\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (step !== prevStep || time !== prevTime || pointerRotate !== PrevRotateState) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.resetState();\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而这些方法，会在组件初始化时绑定，在卸载时取消绑定：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22componentDidMount() {\n  \/\/ 记录中心坐标\n  if (!this.originX) {\n    let centerPoint = ReactDOM.findDOMNode(this.refs.pickerCenter);\n    let centerPointPos = centerPoint.getBoundingClientRect();\n    this.originX = centerPointPos.left;\n    this.originY = centerPointPos.top;\n  }\n  \/\/ 把handleMouseMove和handleMouseUp绑定在document，这样即使鼠标移动时不在指针或者modal上，也能够继续响应移动事件\n  if (document.addEventListener) {\n    document.addEventListener(\x27mousemove\x27, this.handleMouseMove, true);\n    document.addEventListener(\x27mouseup\x27, this.handleMouseUp, true);\n  } else {\n    document.attachEvent(\x27onmousemove\x27, this.handleMouseMove);\n    document.attachEvent(\x27onmouseup\x27, this.handleMouseUp);\n  }\n}\n\ncomponentWillUnmount() {\n  if (document.removeEventListener) {\n    document.removeEventListener(\x27mousemove\x27, this.handleMouseMove, true);\n    document.removeEventListener(\x27mouseup\x27, this.handleMouseUp, true);\n  } else {\n    document.detachEvent(\x27onmousemove\x27, this.handleMouseMove);\n    document.detachEvent(\x27onmouseup\x27, this.handleMouseUp);\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ecomponentDidMount() {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 记录中心坐标\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.originX) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e centerPoint = ReactDOM.findDOMNode(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.refs.pickerCenter);\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e centerPointPos = centerPoint.getBoundingClientRect();\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.originX = centerPointPos.left;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.originY = centerPointPos.top;\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 把handleMouseMove和handleMouseUp绑定在document，这样即使鼠标移动时不在指针或者modal上，也能够继续响应移动事件\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.addEventListener) {\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27mousemove\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleMouseMove, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27mouseup\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleMouseUp, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.attachEvent(\x3cspan class=\x22hljs-string\x22\x3e\x27onmousemove\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleMouseMove);\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.attachEvent(\x3cspan class=\x22hljs-string\x22\x3e\x27onmouseup\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleMouseUp);\n  }\n}\n\ncomponentWillUnmount() {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.removeEventListener) {\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.removeEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27mousemove\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleMouseMove, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.removeEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27mouseup\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleMouseUp, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.detachEvent(\x3cspan class=\x22hljs-string\x22\x3e\x27onmousemove\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleMouseMove);\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.detachEvent(\x3cspan class=\x22hljs-string\x22\x3e\x27onmouseup\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleMouseUp);\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后看一眼render方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22render() {\n  let {time} = this.props;\n  let {draging, height, top, pointerRotate} = this.state;\n  let pickerPointerClass = draging ? \x26quot;picker_pointer\x26quot; : \x26quot;picker_pointer animation\x26quot;;\n\n  \/\/ handleMouseDown事件绑定在了“.pointer_drag”上，它位于指针最顶端的位置\n  return (\n    \x3cdiv className=\x26quot;picker_handler\x26quot;\x3e\n      \x3cdiv\n        ref={(d) =\x3e this.dragPointer = d}\n        className={pickerPointerClass}\n        style={getInitialPointerStyle(height, top, pointerRotate)}\x3e\n        \x3cdiv\n          className=\x26quot;pointer_drag\x26quot;\n          style={getRotateStyle(-pointerRotate)}\n          onMouseDown={this.handleMouseDown}\x3e{time}\x3c\/div\x3e\n      \x3c\/div\x3e\n      \x3cdiv\n        className=\x26quot;picker_center\x26quot;\n        ref={(p) =\x3e this.pickerCenter = p}\x3e\x3c\/div\x3e\n    \x3c\/div\x3e\n  )\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3erender() {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {time} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {draging, height, top, pointerRotate} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state;\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e pickerPointerClass = draging ? \x3cspan class=\x22hljs-string\x22\x3e\x22picker_pointer\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22picker_pointer animation\x22\x3c\/span\x3e;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ handleMouseDown事件绑定在了“.pointer_drag”上，它位于指针最顶端的位置\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n    \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22picker_handler\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\n        \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{(d)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e this.dragPointer = d}\n        className={pickerPointerClass}\n        style={getInitialPointerStyle(height, top, pointerRotate)}\x26gt;\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\n          \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22pointer_drag\x22\x3c\/span\x3e\n          \x3cspan class=\x22hljs-attr\x22\x3estyle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{getRotateStyle(-pointerRotate)}\x3c\/span\x3e\n          \x3cspan class=\x22hljs-attr\x22\x3eonMouseDown\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{this.handleMouseDown}\x3c\/span\x3e\x26gt;\x3c\/span\x3e{time}\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\n        \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22picker_center\x22\x3c\/span\x3e\n        \x3cspan class=\x22hljs-attr\x22\x3eref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{(p)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e this.pickerCenter = p}\x26gt;\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n  )\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e至此，我们的工作就已经完成了（才没有）。其实除了控制旋转角度以外，还有指针的坐标、长度等需要进行计算和控制。但即便完成这些，离一个合格的NPM包还有一段距离。除了基本的代码编写，我们还需要有单元测试，需要对包进行编译和发布。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e测试\x3c\/h3\x3e\n\x3cblockquote\x3e\n\x3cp\x3e关于更多的React测试介绍，可以戳这两篇文章入个门：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/voice.kadira.io\/ui-testing-in-react-74fd90a5d58b\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eUI Testing in React\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/medium.freecodecamp.com\/react-unit-testing-with-mocha-and-enzyme-77d18b6875cb\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReact Unit Testing with Mocha and Enzyme\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e使用\x3ccode\x3emocha\x3c\/code\x3e\x2b\x3ccode\x3echai\x3c\/code\x3e和\x3ccode\x3eenzyme\x3c\/code\x3e来进行React组件的单元测试：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ npm i mocha --save-dev\n$ npm i chai --save-dev\n$ npm i enzyme --save-dev\n$ npm i react-addons-test-utils --save-dev\n\n# 除此之外，为了模拟React中的事件，还需要安装：\n$ npm i sinon --save-dev\n$ npm i sinon-sandbox --save-dev\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e$ npm i mocha --save-dev\n$ npm i chai --save-dev\n$ npm i enzyme --save-dev\n$ npm i react-addons-test-utils --save-dev\n\n\x3cspan class=\x22hljs-comment\x22\x3e# 除此之外，为了模拟React中的事件，还需要安装：\x3c\/span\x3e\n$ npm i sinon --save-dev\n$ npm i sinon-sandbox --save-dev\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后配置\x3ccode\x3epackage.json\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x26quot;scripts\x26quot;: {\n  \x26quot;mocha\x26quot;: \x26quot;.\/node_modules\/mocha\/bin\/mocha --compilers js:babel-register,jsx:babel-register\x26quot;,\n  \x26quot;test\x26quot;: \x26quot;npm run mocha test\x26quot;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22mocha\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22.\/node_modules\/mocha\/bin\/mocha --compilers js:babel-register,jsx:babel-register\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22test\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22npm run mocha test\x22\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e请注意，为了能够检查ES6和React，确保自己安装了需要的babel插件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ npm i babel-register --save-dev\n$ npm i babel-preset-react --save-dev\n$ npm i babel-preset-es2015 --save-dev\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22bash hljs\x22\x3e\x3ccode class=\x22bash\x22\x3e$ npm i babel-register --save-dev\n$ npm i babel-preset-react --save-dev\n$ npm i babel-preset-es2015 --save-dev\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e并在项目根目录下配置了\x3ccode\x3e.babelrc\x3c\/code\x3e文件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;presets\x26quot;: [\x26quot;react\x26quot;, \x26quot;es2015\x26quot;]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs json\x22\x3e\x3ccode\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22presets\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22react\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22es2015\x22\x3c\/span\x3e]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后在项目根目录下新建\x3ccode\x3etest\x3c\/code\x3e文件夹，开始编写测试。\x3c\/p\x3e\n\x3cp\x3e编写\x3ccode\x3eTimePicker\x3c\/code\x3e组件的测试：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ test\/TimePicker_init_spec.jsx\n\nimport React from \x27react\x27;\nimport {expect} from \x27chai\x27;\nimport {shallow} from \x27enzyme\x27;\nimport moment from \x27moment\x27;\n\nimport OutsideClickHandler from \x27..\/..\/src\/components\/OutsideClickHandler\x27;\nimport TimePickerModal from \x27..\/..\/src\/components\/TimePickerModal\x27;\n\ndescribe(\x27TimePicker initial\x27, () =\x3e {\n  it(\x27should be wrappered by div.time_picker_container\x27, () =\x3e {\n    \/\/ 检查组件是否被正确的渲染。期待检测到组件最外层div的class\n    const wrapper = shallow(\x3cTimePicker \/\x3e);\n    expect(wrapper.is(\x27.time_picker_container\x27)).to.equal(true);\n  });\n\n  it(\x27renders an OutsideClickHandler\x27, () =\x3e {\n    \/\/ 期待渲染出来的组件中含有OutsideClickHandler组件\n    const wrapper = shallow(\x3cTimePicker \/\x3e);\n    expect(wrapper.find(OutsideClickHandler)).to.have.lengthOf(1);\n  });\n\n  it(\x27should rendered with default time in child props\x27, () =\x3e {\n    \/\/ 提供默认time，期待TimePickerModal能够获取正确的hour和minute\n    const wrapper = shallow(\x3cTimePicker defaultTime=\x26quot;22:23\x26quot; \/\x3e);\n    expect(wrapper.find(TimePickerModal).props().hour).to.equal(\x26quot;22\x26quot;);\n    expect(wrapper.find(TimePickerModal).props().minute).to.equal(\x26quot;23\x26quot;);\n  });\n\n  it(\x27should rendered with current time in child props\x27, () =\x3e {\n    \/\/ 在没有默认时间的情况下，期待TimePickerModal获取的hour和minute与当前的小时和分钟相同\n    const wrapper = shallow(\x3cTimePicker \/\x3e);\n    const [hour, minute] = moment().format(\x26quot;HH:mm\x26quot;).split(\x27:\x27);\n    expect(wrapper.find(TimePickerModal).props().hour).to.equal(hour);\n    expect(wrapper.find(TimePickerModal).props().minute).to.equal(minute);\n  });\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ test\/TimePicker_init_spec.jsx\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {expect} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27chai\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {shallow} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27enzyme\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e moment \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27moment\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e OutsideClickHandler \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/..\/src\/components\/OutsideClickHandler\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e TimePickerModal \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/..\/src\/components\/TimePickerModal\x27\x3c\/span\x3e;\n\ndescribe(\x3cspan class=\x22hljs-string\x22\x3e\x27TimePicker initial\x27\x3c\/span\x3e, () =\x26gt; {\n  it(\x3cspan class=\x22hljs-string\x22\x3e\x27should be wrappered by div.time_picker_container\x27\x3c\/span\x3e, () =\x26gt; {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 检查组件是否被正确的渲染。期待检测到组件最外层div的class\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e wrapper = shallow(\x26lt;TimePicker \/\x26gt;);\n    expect(wrapper.is(\x27.time_picker_container\x27)).to.equal(true);\n  });\n\n  it(\x27renders an OutsideClickHandler\x27, () =\x26gt; {\n    \/\/ 期待渲染出来的组件中含有OutsideClickHandler组件\n    const wrapper = shallow(\x26lt;TimePicker \/\x26gt;);\n    expect(wrapper.find(OutsideClickHandler)).to.have.lengthOf(1);\n  });\n\n  it(\x27should rendered with default time in child props\x27, () =\x26gt; {\n    \/\/ 提供默认time，期待TimePickerModal能够获取正确的hour和minute\n    const wrapper = shallow(\x26lt;TimePicker defaultTime=\x2222:23\x22 \/\x26gt;);\n    expect(wrapper.find(TimePickerModal).props().hour).to.equal(\x2222\x22);\n    expect(wrapper.find(TimePickerModal).props().minute).to.equal(\x2223\x22);\n  });\n\n  it(\x27should rendered with current time in child props\x27, () =\x26gt; {\n    \/\/ 在没有默认时间的情况下，期待TimePickerModal获取的hour和minute与当前的小时和分钟相同\n    const wrapper = shallow(\x26lt;TimePicker \/\x26gt;);\n    const [hour, minute] = moment().format(\x22HH:mm\x22).split(\x27:\x27);\n    expect(wrapper.find(TimePickerModal).props().hour).to.equal(hour);\n    expect(wrapper.find(TimePickerModal).props().minute).to.equal(minute);\n  });\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ test\/TimePicker_func_spec.jsx\nimport React from \x27react\x27;\nimport {expect} from \x27chai\x27;\nimport {shallow} from \x27enzyme\x27;\nimport sinon from \x27sinon-sandbox\x27;\nimport TimePicker from \x27..\/..\/src\/components\/TimePicker\x27;\n\ndescribe(\x27handle focus change func\x27, () =\x3e {\n  it(\x27should focus\x27, () =\x3e {\n    const wrapper = shallow(\x3cTimePicker \/\x3e);\n    \/\/ 通过wrapper.instance()获取组件实例\n    \/\/ 并调用了它的方法onFocus，并期待该方法能够改变组件的focused状态\n    wrapper.instance().onFocus();\n    expect(wrapper.state().focused).to.equal(true);\n  });\n\n  it(\x27should change callback when hour change\x27, () =\x3e {\n    \/\/ 给组件传入onHourChangeStub方法作为onHourChange时的回调\n    \/\/ 之后手动调用onHourChange方法，并期待onHourChangeStub方法被调用了一次\n    const onHourChangeStub = sinon.stub();\n    const wrapper = shallow(\x3cTimePicker onHourChange={onHourChangeStub}\/ \/\x3e);\n    wrapper.instance().handleHourChange(1);\n    expect(onHourChangeStub.callCount).to.equal(1);\n  });\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ test\/TimePicker_func_spec.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {expect} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27chai\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {shallow} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27enzyme\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e sinon \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27sinon-sandbox\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e TimePicker \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/..\/src\/components\/TimePicker\x27\x3c\/span\x3e;\n\ndescribe(\x3cspan class=\x22hljs-string\x22\x3e\x27handle focus change func\x27\x3c\/span\x3e, () =\x26gt; {\n  it(\x3cspan class=\x22hljs-string\x22\x3e\x27should focus\x27\x3c\/span\x3e, () =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e wrapper = shallow(\x26lt;TimePicker \/\x26gt;);\n    \/\/ 通过wrapper.instance()获取组件实例\n    \/\/ 并调用了它的方法onFocus，并期待该方法能够改变组件的focused状态\n    wrapper.instance().onFocus();\n    expect(wrapper.state().focused).to.equal(true);\n  });\n\n  it(\x27should change callback when hour change\x27, () =\x26gt; {\n    \/\/ 给组件传入onHourChangeStub方法作为onHourChange时的回调\n    \/\/ 之后手动调用onHourChange方法，并期待onHourChangeStub方法被调用了一次\n    const onHourChangeStub = sinon.stub();\n    const wrapper = shallow(\x26lt;TimePicker onHourChange={onHourChangeStub}\/ \/\x26gt;);\n    wrapper.instance().handleHourChange(1);\n    expect(onHourChangeStub.callCount).to.equal(1);\n  });\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e编译\x3c\/h3\x3e\n\x3cp\x3e如同上面所说，我最后选用的是当今最火的\x3ccode\x3ewebpack\x3c\/code\x3e同学来编译我们的代码。相信\x3ccode\x3eReact\x3c\/code\x3e加\x3ccode\x3eES6\x3c\/code\x3e的webpack编译配置大家已经配烦了，其基本的loader也就是\x3ccode\x3ebabel-loader\x3c\/code\x3e了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const webpack = require(\x27webpack\x27);\n\n\/\/ 通过node的方法遍历src文件夹，来组成所有的webpack entry\nconst path = require(\x27path\x27);\nconst fs = require(\x27fs\x27);\nconst srcFolder = path.join(__dirname, \x27src\x27, \x27components\x27);\n\/\/ 读取.\/src\/components\/文件夹下的所有文件\nconst components = fs.readdirSync(srcFolder);\n\n\/\/ 把文件存在entries中，作为webpack编译的入口\nconst files = [];\nconst entries = {};\ncomponents.forEach(component =\x3e {\n  const name = component.split(\x27.\x27)[0];\n  if (name) {\n    const file = `.\/src\/components\/${name}`;\n    files.push(file);\n    entries[name] = file;\n  }\n});\n\nmodule.exports = {\n  entry: entries,\n  output: {\n    filename: \x27[name].js\x27,\n    path: \x27.\/lib\/components\/\x27,\n    \/\/ 模块化风格为commonjs2\n    libraryTarget: \x27commonjs2\x27,\n  },\n  module: {\n    loaders: [\n      {\n        test: \/\\.jsx?$\/,\n        exclude: \/(node_modules)\/,\n        include: path.join(__dirname, \x27src\x27),\n        loader: [\x26quot;babel-loader\x26quot;],\n        query: {\n          presets: [\x26quot;react\x26quot;, \x26quot;es2015\x26quot;]\n        }\n      }\n    ],\n  },\n  resolve: {\n    extensions: [\x27\x27, \x27.js\x27, \x27.jsx\x27],\n  },\n  plugins: [\n    new webpack.optimize.UglifyJsPlugin({\n      compress: {\n          warnings: false\n      }\n    }),\n    new webpack.optimize.OccurenceOrderPlugin(),\n    new webpack.DefinePlugin({\n      \x27process.env.NODE_ENV\x27: \x27\x26quot;production\x26quot;\x27\n    }),\n    new webpack.NoErrorsPlugin()\n  ]\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e webpack = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过node的方法遍历src文件夹，来组成所有的webpack entry\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e path = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27path\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27fs\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e srcFolder = path.join(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x27src\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27components\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 读取.\/src\/components\/文件夹下的所有文件\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e components = fs.readdirSync(srcFolder);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 把文件存在entries中，作为webpack编译的入口\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e files = [];\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e entries = {};\ncomponents.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ecomponent\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e name = component.split(\x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (name) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e file = \x3cspan class=\x22hljs-string\x22\x3e`.\/src\/components\/\x3cspan class=\x22hljs-subst\x22\x3e${name}\x3c\/span\x3e`\x3c\/span\x3e;\n    files.push(file);\n    entries[name] = file;\n  }\n});\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n  \x3cspan class=\x22hljs-attr\x22\x3eentry\x3c\/span\x3e: entries,\n  \x3cspan class=\x22hljs-attr\x22\x3eoutput\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3efilename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27[name].js\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/lib\/components\/\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 模块化风格为commonjs2\x3c\/span\x3e\n    libraryTarget: \x3cspan class=\x22hljs-string\x22\x3e\x27commonjs2\x27\x3c\/span\x3e,\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3emodule\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3eloaders\x3c\/span\x3e: [\n      {\n        \x3cspan class=\x22hljs-attr\x22\x3etest\x3c\/span\x3e: \x3cspan class=\x22hljs-regexp\x22\x3e\/\\.jsx?$\/\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eexclude\x3c\/span\x3e: \x3cspan class=\x22hljs-regexp\x22\x3e\/(node_modules)\/\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3einclude\x3c\/span\x3e: path.join(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x27src\x27\x3c\/span\x3e),\n        \x3cspan class=\x22hljs-attr\x22\x3eloader\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22babel-loader\x22\x3c\/span\x3e],\n        \x3cspan class=\x22hljs-attr\x22\x3equery\x3c\/span\x3e: {\n          \x3cspan class=\x22hljs-attr\x22\x3epresets\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22react\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22es2015\x22\x3c\/span\x3e]\n        }\n      }\n    ],\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eresolve\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3eextensions\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27.js\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27.jsx\x27\x3c\/span\x3e],\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eplugins\x3c\/span\x3e: [\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.optimize.UglifyJsPlugin({\n      \x3cspan class=\x22hljs-attr\x22\x3ecompress\x3c\/span\x3e: {\n          \x3cspan class=\x22hljs-attr\x22\x3ewarnings\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n      }\n    }),\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.optimize.OccurenceOrderPlugin(),\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.DefinePlugin({\n      \x3cspan class=\x22hljs-string\x22\x3e\x27process.env.NODE_ENV\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x22production\x22\x27\x3c\/span\x3e\n    }),\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.NoErrorsPlugin()\n  ]\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但有一个很重要很重要的问题需要说明一下：\x3c\/p\x3e\n\x3cp\x3e编译过React组件的人都应该知道，React打包进代码里是比较大的（即便在Production\x2bUglifyJsPlugin的情况下），更何况，我们这个组件作为独立的\x3ccode\x3enode_module\x3c\/code\x3e包，不应该把React打包进去，因为：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e打包React之后会让组件文件体积增大数倍\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e打包React之后，安装这个组件的用户会出现“重复安装React”的严重bug\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e因此，我们在打包的时候应该将第三方依赖独立出去，这就需要配置\x3ccode\x3ewebpack\x3c\/code\x3e的\x3ccode\x3eexternals\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22externals(context, request, callback) {\n  if (files.indexOf(request) \x3e -1) {\n    return callback(null, false);\n  }\n  return callback(null, true);\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eexternals(context, request, callback) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (files.indexOf(request) \x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e什么意思呢？你可以看\x3ca href=\x22https:\/\/webpack.github.io\/docs\/configuration.html#externals\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack externals官方文档\x3c\/a\x3e。鉴于\x3ccode\x3ewebpack\x3c\/code\x3e文档一般都很烂，我来大致解释一下：\x3c\/p\x3e\n\x3cp\x3e在配置\x3ccode\x3eexternals\x3c\/code\x3e的时候，可以把它作为一个要复写的function：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e官方栗子\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ request是webpack在打包过程中要处理了某一个依赖，无论是自己写的文件之间的相互引用，还是对第三方包的引用，都会将这次引用作为request参数，走这个方法\n\/\/ callback接收两个参数，error和result\n\/\/ 当result返回true或者一个String的时候，webpack就不会把这个request依赖编译到文件里去。而返回false则会正常编译\n\/\/ 因此，我们在每次依赖调用的时候，通过这个方法来判断，某些依赖是否应该编译进文件里\nfunction(context, request, callback) {\n  \/\/ Every module prefixed with \x26quot;global-\x26quot; becomes external\n  \/\/ \x26quot;global-abc\x26quot; -\x3e abc\n  if(\/^global-\/.test(request))\n      return callback(null, \x26quot;var \x26quot; \x2b request.substr(7));\n  callback();\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ request是webpack在打包过程中要处理了某一个依赖，无论是自己写的文件之间的相互引用，还是对第三方包的引用，都会将这次引用作为request参数，走这个方法\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ callback接收两个参数，error和result\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当result返回true或者一个String的时候，webpack就不会把这个request依赖编译到文件里去。而返回false则会正常编译\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 因此，我们在每次依赖调用的时候，通过这个方法来判断，某些依赖是否应该编译进文件里\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3econtext, request, callback\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Every module prefixed with \x22global-\x22 becomes external\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x22global-abc\x22 -\x26gt; abc\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-regexp\x22\x3e\/^global-\/\x3c\/span\x3e.test(request))\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22var \x22\x3c\/span\x3e \x2b request.substr(\x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e));\n  callback();\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e所以，就可以解释一下我们自己在webpack配置中的\x3ccode\x3eexternals\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22externals(context, request, callback) {\n  \/\/ 如果这个依赖存在于files中，也就是在.\/src\/components\/文件夹下，说明这是我们自己编写的文件，妥妥的要打包\n  if (files.indexOf(request) \x3e -1) {\n    return callback(null, false);\n  }\n  \/\/ 否则他就是第三方依赖，独立出去不打包，而是期待使用了该组件的用户自己去打包React\n  return callback(null, true);\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eexternals(context, request, callback) {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果这个依赖存在于files中，也就是在.\/src\/components\/文件夹下，说明这是我们自己编写的文件，妥妥的要打包\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (files.indexOf(request) \x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 否则他就是第三方依赖，独立出去不打包，而是期待使用了该组件的用户自己去打包React\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e callback(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e至此，这个组件的编写可以告一段落了。之后要做的就是NPM包发布的事情。本来想一次性把这个也说了的，但是鉴于有更详细的文章在，大家可以参考\x3ca href=\x22https:\/\/www.awesomes.cn\/source\/12\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e前端扫盲-之打造一个Node命令行工具\x3c\/a\x3e来学习Node包创建和发布的过程。\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e本文的源码全部位于github项目仓库\x3ca href=\x22https:\/\/github.com\/ecmadao\/react-times\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3ereact-times\x3c\/code\x3e\x3c\/a\x3e，如果有差异请以github为准。最终线上DEMO可见\x3ca href=\x22https:\/\/ecmadao.github.io\/react-times\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereact-times github page\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e转载请注明来源：\x3c\/p\x3e\n\x3cp\x3eecmadao，\x3ca href=\x22https:\/\/github.com\/ecmadao\/Coding-Guide\/blob\/master\/Notes\/React\/ReactJS\/Write%20a%20React%20Timepicker%20Component%20hand%20by%20hand.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/ecmadao\/Co...\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>一言不合造轮子&ndash;撸一个ReactTimePicker</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006883180">https://segmentfault.com/a/1190000006883180</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/5jj87x62wfr/" target="_blank">https://alili.tech/archive/5jj87x62wfr/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>