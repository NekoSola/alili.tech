<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="JavaScript函数式编程（二）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>JavaScript函数式编程（二） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ivyjj3xoxs/",
				"appid": "1613049289050283", 
				"title": "JavaScript函数式编程（二） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-06T02:30:08"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/7g4njgiu96h/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/7fkqbme5y3/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fivyjj3xoxs%2f&text=JavaScript%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fivyjj3xoxs%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fivyjj3xoxs%2f&text=JavaScript%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fivyjj3xoxs%2f&title=JavaScript%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fivyjj3xoxs%2f&is_video=false&description=JavaScript%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=JavaScript%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b%ef%bc%88%e4%ba%8c%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fivyjj3xoxs%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fivyjj3xoxs%2f&title=JavaScript%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fivyjj3xoxs%2f&title=JavaScript%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fivyjj3xoxs%2f&title=JavaScript%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fivyjj3xoxs%2f&title=JavaScript%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b%ef%bc%88%e4%ba%8c%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">JavaScript函数式编程（二）</h1><div class="meta"><div class="postdate"><time datetime="2019-02-06" itemprop="datePublished">2019-02-06</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3eJavaScript函数式编程（二）\x3c\/h2\x3e\n\x3cp\x3e拖延症了好久，第二篇终于写出来了。\x3c\/p\x3e\n\x3cp\x3e上一篇在这里：\x3ca href=\x22https:\/\/zhuanlan.zhihu.com\/p\/21714695\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eJavaScript函数式编程（一）\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e上一篇文章里我们提到了纯函数的概念，所谓的纯函数就是，\x3cstrong\x3e对于相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用，也不依赖外部环境的状态\x3c\/strong\x3e（我偷懒复制过来的）。\x3c\/p\x3e\n\x3cp\x3e但是实际的编程中，特别是前端的编程范畴里，“不依赖外部环境”这个条件是根本不可能的，我们总是不可避免地接触到 DOM、AJAX 这些状态随时都在变化的东西。所以我们需要用更强大的技术来干这些脏活。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e一、容器、Functor\x3c\/h2\x3e\n\x3cp\x3e如果你熟悉 jQuery 的话，应该还记得，\x3ccode\x3e$(...)\x3c\/code\x3e 返回的对象并不是一个原生的 DOM 对象，而是对于原生对象的一种封装：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var foo = $(\x27#foo\x27); \n\nfoo == document.getElementById(\x27foo\x27); \n\/\/=\x3e false\n\nfoo[0] == document.getElementById(\x27foo\x27); \n\/\/=\x3e true\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e foo = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#foo\x27\x3c\/span\x3e); \n\nfoo == \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27foo\x27\x3c\/span\x3e); \n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; false\x3c\/span\x3e\n\nfoo[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e] == \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27foo\x27\x3c\/span\x3e); \n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; true\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这在某种意义上就是一个“容器”（但它并不函数式）。\x3c\/p\x3e\n\x3cp\x3e接下类我们会看到，容器为函数式编程里普通的变量、对象、函数提供了一层极其强大的外衣，赋予了它们一些很惊艳的特性，就好像 Tony Stark 的钢铁外衣，Dva 的机甲，明日香的2号机一样。\x3c\/p\x3e\n\x3cp\x3e下面我们就来写一个最简单的容器吧：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var Container = function(x) {\n  this.__value = x;\n}\nContainer.of = x =\x3e new Container(x);\n\n\/\/试试看\nContainer.of(1);\n\/\/=\x3e Container(1)\n\nContainer.of(\x27abcd\x27);\n\/\/=\x3e Container(\x27abcd\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Container = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ex\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__value = x;\n}\nContainer.of = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ex\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Container(x);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/试试看\x3c\/span\x3e\nContainer.of(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; Container(1)\x3c\/span\x3e\n\nContainer.of(\x3cspan class=\x22hljs-string\x22\x3e\x27abcd\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; Container(\x27abcd\x27)\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们调用 \x3ccode\x3eContainer.of\x3c\/code\x3e 把东西装进容器里之后，由于这一层外壳的阻挡，普通的函数就对他们不再起作用了，所以我们需要加一个接口来让外部的函数也能作用到容器里面的值：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Container.prototype.map = function(f){\n  return Container.of(f(this.__value))\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eContainer.prototype.map = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ef\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Container.of(f(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__value))\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们可以这样使用它：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Container.of(3)\n    .map(x =\x3e x \x2b 1)                 \/\/=\x3e Container(4)\n    .map(x =\x3e \x27Result is \x27 \x2b x);    \/\/=\x3e Container(\x27Result is 4\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eContainer.of(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e)\n    .map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ex\x3c\/span\x3e =\x26gt;\x3c\/span\x3e x \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)                 \x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; Container(4)\x3c\/span\x3e\n    .map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ex\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Result is \x27\x3c\/span\x3e \x2b x);    \x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; Container(\x27Result is 4\x27)\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e没错！我们仅花了 7 行代码就实现了很炫的\x3cstrong\x3e链式调用\x3c\/strong\x3e，这也是我们的第一个 \x3cstrong\x3eFunctor\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eFunctor（函子）是实现了 map 并遵守一些特定规则的容器类型。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e也就是说，如果我们要将普通函数应用到一个被容器包裹的值，那么我们首先需要定义一个叫 \x3cstrong\x3eFunctor\x3c\/strong\x3e 的数据类型，在这个数据类型中需要定义如何使用 \x3ccode\x3emap\x3c\/code\x3e 来应用这个普通函数。\x3c\/p\x3e\n\x3cp\x3e把东西装进一个容器，只留出一个接口 \x3ccode\x3emap\x3c\/code\x3e 给容器外的函数，这么做有什么好处呢？\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e本质上，Functor 是一个对于函数调用的抽象，我们赋予容器自己去调用函数的能力。当 \x3ccode\x3emap\x3c\/code\x3e 一个函数时，我们让容器自己来运行这个函数，这样容器就可以自由地选择何时何地如何操作这个函数，以致于拥有惰性求值、错误处理、异步调用等等非常牛掰的特性。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e举个例子，我们现在为 \x3ccode\x3emap\x3c\/code\x3e 函数添加一个检查空值的特性，这个新的容器我们称之为 \x3ccode\x3eMaybe\x3c\/code\x3e（原型来自于Haskell）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var Maybe = function(x) {\n  this.__value = x;\n}\n\nMaybe.of = function(x) {\n  return new Maybe(x);\n}\n\nMaybe.prototype.map = function(f) {\n  return this.isNothing() ? Maybe.of(null) : Maybe.of(f(this.__value));\n}\n\nMaybe.prototype.isNothing = function() {\n  return (this.__value === null || this.__value === undefined);\n}\n\n\/\/试试看\nimport _ from \x27lodash\x27;\nvar add = _.curry(_.add);\n\nMaybe.of({name: \x26quot;Stark\x26quot;})\n    .map(_.prop(\x26quot;age\x26quot;))\n    .map(add(10));\n\/\/=\x3e Maybe(null)\n\nMaybe.of({name: \x26quot;Stark\x26quot;, age: 21})\n    .map(_.prop(\x26quot;age\x26quot;))\n    .map(add(10));\n\/\/=\x3e Maybe(31)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Maybe = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ex\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__value = x;\n}\n\nMaybe.of = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ex\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Maybe(x);\n}\n\nMaybe.prototype.map = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ef\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.isNothing() ? Maybe.of(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e) : Maybe.of(f(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__value));\n}\n\nMaybe.prototype.isNothing = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__value === \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e || \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__value === \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e);\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/试试看\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e _ \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27lodash\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e add = _.curry(_.add);\n\nMaybe.of({\x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Stark\x22\x3c\/span\x3e})\n    .map(_.prop(\x3cspan class=\x22hljs-string\x22\x3e\x22age\x22\x3c\/span\x3e))\n    .map(add(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e));\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; Maybe(null)\x3c\/span\x3e\n\nMaybe.of({\x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Stark\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e21\x3c\/span\x3e})\n    .map(_.prop(\x3cspan class=\x22hljs-string\x22\x3e\x22age\x22\x3c\/span\x3e))\n    .map(add(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e));\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; Maybe(31)\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e看了这些代码，觉得链式调用总是要输入一堆 \x3ccode\x3e.map(...)\x3c\/code\x3e 很烦对吧？这个问题很好解决，还记得我们上一篇文章里介绍的\x3cstrong\x3e柯里化\x3c\/strong\x3e吗？\x3c\/p\x3e\n\x3cp\x3e有了柯里化这个强大的工具，我们可以这样写：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import _ from \x27lodash\x27;\nvar compose = _.flowRight;\nvar add = _.curry(_.add);\n\n\/\/ 创造一个柯里化的 map\nvar map = _.curry((f, functor) =\x3e functor.map(f));\n\nvar doEverything = map(compose(add(10), _.property(\x26quot;age\x26quot;)));\n\nvar functor = Maybe.of({name: \x26quot;Stark\x26quot;, age: 21});\ndoEverything(functor);\n\/\/=\x3e Maybe(31)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e _ \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27lodash\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e compose = _.flowRight;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e add = _.curry(_.add);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创造一个柯里化的 map\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e map = _.curry(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ef, functor\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e functor.map(f));\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e doEverything = map(compose(add(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e), _.property(\x3cspan class=\x22hljs-string\x22\x3e\x22age\x22\x3c\/span\x3e)));\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e functor = Maybe.of({\x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Stark\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e21\x3c\/span\x3e});\ndoEverything(functor);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; Maybe(31)\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e二、错误处理、Either\x3c\/h2\x3e\n\x3cp\x3e现在我们的容器能做的事情太少了，它甚至连做简单的错误处理都做不到，现在我们只能类似这样处理错误：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22try{\n    doSomething();\n}catch(e){\n    \/\/ 错误处理\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e{\n    doSomething();\n}\x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(e){\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 错误处理\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3etry\/catch\/throw\x3c\/code\x3e 并不是“纯”的，因为它从外部接管了我们的函数，并且在这个函数出错时抛弃了它的返回值。这不是我们期望的函数式的行为。\x3c\/p\x3e\n\x3cp\x3e如果你对 \x3ccode\x3ePromise\x3c\/code\x3e 熟悉的话应该还记得，\x3ccode\x3ePromise\x3c\/code\x3e 是可以调用 \x3ccode\x3ecatch\x3c\/code\x3e 来集中处理错误的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22doSomething()\n    .then(async1)\n    .then(async2)\n    .catch(e =\x3e console.log(e));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3edoSomething()\n    .then(async1)\n    .then(async2)\n    .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于函数式编程我们也可以做同样的操作，如果运行正确，那么就返回正确的结果；如果错误，就返回一个用于描述错误的结果。这个概念在 Haskell 中称之为 \x3ccode\x3eEither\x3c\/code\x3e 类，\x3ccode\x3eLeft\x3c\/code\x3e 和 \x3ccode\x3eRight\x3c\/code\x3e 是它的两个子类。我们用 JS 来实现一下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 这里是一样的=。=\nvar Left = function(x) {\n  this.__value = x;\n}\nvar Right = function(x) {\n  this.__value = x;\n}\n\n\/\/ 这里也是一样的=。=\nLeft.of = function(x) {\n  return new Left(x);\n}\nRight.of = function(x) {\n  return new Right(x);\n}\n\n\/\/ 这里不同！！！\nLeft.prototype.map = function(f) {\n  return this;\n}\nRight.prototype.map = function(f) {\n  return Right.of(f(this.__value));\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里是一样的=。=\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Left = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ex\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__value = x;\n}\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Right = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ex\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__value = x;\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里也是一样的=。=\x3c\/span\x3e\nLeft.of = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ex\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Left(x);\n}\nRight.of = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ex\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Right(x);\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里不同！！！\x3c\/span\x3e\nLeft.prototype.map = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ef\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n}\nRight.prototype.map = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ef\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Right.of(f(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__value));\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e下面来看看 \x3ccode\x3eLeft\x3c\/code\x3e 和 \x3ccode\x3eRight\x3c\/code\x3e 的区别吧：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Right.of(\x26quot;Hello\x26quot;).map(str =\x3e str \x2b \x26quot; World!\x26quot;);\n\/\/ Right(\x26quot;Hello World!\x26quot;)\n\nLeft.of(\x26quot;Hello\x26quot;).map(str =\x3e str \x2b \x26quot; World!\x26quot;);\n\/\/ Left(\x26quot;Hello\x26quot;)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eRight.of(\x3cspan class=\x22hljs-string\x22\x3e\x22Hello\x22\x3c\/span\x3e).map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e str \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22 World!\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Right(\x22Hello World!\x22)\x3c\/span\x3e\n\nLeft.of(\x3cspan class=\x22hljs-string\x22\x3e\x22Hello\x22\x3c\/span\x3e).map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e str \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22 World!\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Left(\x22Hello\x22)\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eLeft\x3c\/code\x3e 和 \x3ccode\x3eRight\x3c\/code\x3e 唯一的区别就在于 \x3ccode\x3emap\x3c\/code\x3e 方法的实现，\x3ccode\x3eRight.map\x3c\/code\x3e 的行为和我们之前提到的 \x3ccode\x3emap\x3c\/code\x3e 函数一样。但是 \x3ccode\x3eLeft.map\x3c\/code\x3e 就很不同了：\x3cstrong\x3e它不会对容器做任何事情，只是很简单地把这个容器拿进来又扔出去。这个特性意味着，\x3ccode\x3eLeft\x3c\/code\x3e 可以用来传递一个错误消息。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var getAge = user =\x3e user.age ? Right.of(user.age) : Left.of(\x26quot;ERROR!\x26quot;);\n\n\/\/试试\ngetAge({name: \x27stark\x27, age: \x2721\x27}).map(age =\x3e \x27Age is \x27 \x2b age);\n\/\/=\x3e Right(\x27Age is 21\x27)\n\ngetAge({name: \x27stark\x27}).map(age =\x3e \x27Age is \x27 \x2b age);\n\/\/=\x3e Left(\x27ERROR!\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e getAge = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3euser\x3c\/span\x3e =\x26gt;\x3c\/span\x3e user.age ? Right.of(user.age) : Left.of(\x3cspan class=\x22hljs-string\x22\x3e\x22ERROR!\x22\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/试试\x3c\/span\x3e\ngetAge({\x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27stark\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x2721\x27\x3c\/span\x3e}).map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eage\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Age is \x27\x3c\/span\x3e \x2b age);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; Right(\x27Age is 21\x27)\x3c\/span\x3e\n\ngetAge({\x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27stark\x27\x3c\/span\x3e}).map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eage\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Age is \x27\x3c\/span\x3e \x2b age);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; Left(\x27ERROR!\x27)\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e是的，\x3ccode\x3eLeft\x3c\/code\x3e 可以让调用链中任意一环的错误立刻返回到调用链的尾部，这给我们错误处理带来了很大的方便，再也不用一层又一层的 \x3ccode\x3etry\/catch\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eLeft\x3c\/code\x3e 和 \x3ccode\x3eRight\x3c\/code\x3e 是 \x3ccode\x3eEither\x3c\/code\x3e 类的两个子类，事实上 \x3ccode\x3eEither\x3c\/code\x3e 并不只是用来做错误处理的，它表示了逻辑或，范畴学里的 \x3cstrong\x3ecoproduct\x3c\/strong\x3e。但这些超出了我们的讨论范围。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e三、IO\x3c\/h2\x3e\n\x3cp\x3e下面我们的程序要走出象牙塔，去接触外面“肮脏”的世界了，在这个世界里，很多事情都是有副作用的或者依赖于外部环境的，比如下面这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function readLocalStorage(){\n    return window.localStorage;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereadLocalStorage\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个函数显然不是纯函数，因为它强依赖外部的 \x3ccode\x3ewindow.localStorage\x3c\/code\x3e 这个对象，它的返回值会随着环境的变化而变化。为了让它“纯”起来，我们可以把它包裹在一个函数内部，延迟执行它：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function readLocalStorage(){\n    return function(){\n        return window.localStorage;   \n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereadLocalStorage\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage;   \n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样 \x3ccode\x3ereadLocalStorage\x3c\/code\x3e 就变成了一个真正的纯函数！ OvO为机智的程序员鼓掌！\x3c\/p\x3e\n\x3cp\x3e额……好吧……好像确实没什么卵用……我们只是（像大多数拖延症晚期患者那样）把讨厌做的事情暂时搁置了而已。为了能彻底解决这些讨厌的事情，我们需要一个叫 \x3ccode\x3eIO\x3c\/code\x3e 的新的 Functor：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import _ from \x27lodash\x27;\nvar compose = _.flowRight;\n\nvar IO = function(f) {\n    this.__value = f;\n}\n\nIO.of = x =\x3e new IO(_ =\x3e x);\n\nIO.prototype.map = function(f) {\n    return new IO(compose(f, this.__value))\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e _ \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27lodash\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e compose = _.flowRight;\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e IO = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ef\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__value = f;\n}\n\nIO.of = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ex\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e IO(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e_\x3c\/span\x3e =\x26gt;\x3c\/span\x3e x);\n\nIO.prototype.map = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ef\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e IO(compose(f, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__value))\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eIO\x3c\/code\x3e 跟前面那几个 functor 不同的地方在于，它的 \x3ccode\x3e__value\x3c\/code\x3e 是一个函数。它把不纯的操作（比如 IO、网络请求、DOM）包裹到一个函数内，从而延迟这个操作的执行。所以我们认为，\x3cstrong\x3eIO 包含的是被包裹的操作的返回值\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var io_document = new IO(_ =\x3e window.document);\n\nio_document.map(function(doc){ return doc.title });\n\/\/=\x3e IO(document.title)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e io_document = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e IO(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e_\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.document);\n\nio_document.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edoc\x3c\/span\x3e)\x3c\/span\x3e{ \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e doc.title });\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; IO(document.title)\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意我们这里虽然感觉上返回了一个实际的值 \x3ccode\x3eIO(document.title)\x3c\/code\x3e，但事实上只是一个对象：\x3ccode\x3e{ __value: [Function] }\x3c\/code\x3e，它并没有执行，而是简单地把我们想要的操作存了起来，只有当我们在真的需要这个值得时候，IO 才会真的开始求值，这个特性我们称之为 \x3cstrong\x3e惰性求值\x3c\/strong\x3e。（培提尔其乌斯：“这是怠惰啊！”）\x3c\/p\x3e\n\x3cp\x3e是的，我们依然需要某种方法让 IO 开始求值，并且把它返回给我们。它可能因为 \x3ccode\x3emap\x3c\/code\x3e 的调用链积累了很多很多不纯的操作，一旦开始求值，就可能会把本来很干净的程序给“弄脏”。但是去直接执行这些“脏”操作不同，我们把这些不纯的操作带来的复杂性和不可维护性推到了 IO 的调用者身上（嗯就是这么不负责任）。\x3c\/p\x3e\n\x3cp\x3e下面我们来做稍微复杂点的事情，编写一个函数，从当前 url 中解析出对应的参数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import _ from \x27lodash\x27;\n\n\/\/ 先来几个基础函数：\n\/\/ 字符串\nvar split = _.curry((char, str) =\x3e str.split(char));\n\/\/ 数组\nvar first = arr =\x3e arr[0];\nvar last = arr =\x3e arr[arr.length - 1];\nvar filter = _.curry((f, arr) =\x3e arr.filter(f));\n\/\/注意这里的 x 既可以是数组，也可以是 functor\nvar map = _.curry((f, x) =\x3e x.map(f)); \n\/\/ 判断\nvar eq = _.curry((x, y) =\x3e x == y);\n\/\/ 结合\nvar compose = _.flowRight;\n\n\nvar toPairs = compose(map(split(\x27=\x27)), split(\x27\x26amp;\x27));\n\/\/ toPairs(\x27a=1\x26amp;b=2\x27)\n\/\/=\x3e [[\x27a\x27, \x271\x27], [\x27b\x27, \x272\x27]]\n\nvar params = compose(toPairs, last, split(\x27?\x27));\n\/\/ params(\x27http:\/\/xxx.com?a=1\x26amp;b=2\x27)\n\/\/=\x3e [[\x27a\x27, \x271\x27], [\x27b\x27, \x272\x27]]\n\n\/\/ 这里会有些难懂=。= 慢慢看\n\/\/ 1.首先我们先对 url 调用 params 函数，得到类似[[\x27a\x27, \x271\x27], [\x27b\x27, \x272\x27]]\n\/\/   这样的数组；\n\/\/ 2.然后调用 filter(compose(eq(key), first))，这是一个过滤器，过滤的\n\/\/   条件是 compose(eq(key), first) 为真，它的意思就是只留下首项为 key\n\/\/   的数组；\n\/\/ 3.最后调用 Maybe.of，把它包装起来。\n\/\/ 4.这一系列的调用是针对 IO 的，所以我们用 map 把这些调用封装起来。\nvar getParam = key =\x3e map(compose(Maybe.of, filter(compose(eq(key), first)), params));\n\n\/\/ 创建充满了洪荒之力的 IO！！！\nvar url = new IO(_ =\x3e window.location.href);\n\/\/ 最终的调用函数！！！\nvar findParam = getParam(url);\n\n\/\/ 上面的代码都是很干净的纯函数，下面我们来对它求值，求值的过程是非纯的。\n\/\/ 假设现在的 url 是 http:\/\/xxx.com?a=1\x26amp;b=2\n\/\/ 调用 __value() 来运行它！\nfindParam(\x26quot;a\x26quot;).__value();\n\/\/=\x3e Maybe([\x27a\x27, \x271\x27])\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e _ \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27lodash\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 先来几个基础函数：\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 字符串\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e split = _.curry(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3echar, str\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e str.split(char));\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数组\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e first = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3earr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e arr[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e last = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3earr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e arr[arr.length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e filter = _.curry(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ef, arr\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e arr.filter(f));\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/注意这里的 x 既可以是数组，也可以是 functor\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e map = _.curry(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ef, x\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e x.map(f)); \n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e eq = _.curry(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ex, y\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e x == y);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 结合\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e compose = _.flowRight;\n\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e toPairs = compose(map(split(\x3cspan class=\x22hljs-string\x22\x3e\x27=\x27\x3c\/span\x3e)), split(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;\x27\x3c\/span\x3e));\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ toPairs(\x27a=1\x26amp;b=2\x27)\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; [[\x27a\x27, \x271\x27], [\x27b\x27, \x272\x27]]\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e params = compose(toPairs, last, split(\x3cspan class=\x22hljs-string\x22\x3e\x27?\x27\x3c\/span\x3e));\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ params(\x27http:\/\/xxx.com?a=1\x26amp;b=2\x27)\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; [[\x27a\x27, \x271\x27], [\x27b\x27, \x272\x27]]\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里会有些难懂=。= 慢慢看\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1.首先我们先对 url 调用 params 函数，得到类似[[\x27a\x27, \x271\x27], [\x27b\x27, \x272\x27]]\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/   这样的数组；\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 2.然后调用 filter(compose(eq(key), first))，这是一个过滤器，过滤的\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/   条件是 compose(eq(key), first) 为真，它的意思就是只留下首项为 key\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/   的数组；\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 3.最后调用 Maybe.of，把它包装起来。\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 4.这一系列的调用是针对 IO 的，所以我们用 map 把这些调用封装起来。\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e getParam = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ekey\x3c\/span\x3e =\x26gt;\x3c\/span\x3e map(compose(Maybe.of, filter(compose(eq(key), first)), params));\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建充满了洪荒之力的 IO！！！\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e IO(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e_\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 最终的调用函数！！！\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e findParam = getParam(url);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 上面的代码都是很干净的纯函数，下面我们来对它求值，求值的过程是非纯的。\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 假设现在的 url 是 http:\/\/xxx.com?a=1\x26amp;b=2\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用 __value() 来运行它！\x3c\/span\x3e\nfindParam(\x3cspan class=\x22hljs-string\x22\x3e\x22a\x22\x3c\/span\x3e).__value();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/=\x26gt; Maybe([\x27a\x27, \x271\x27])\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e四、总结\x3c\/h2\x3e\n\x3cp\x3e如果你还能坚持看到这里的话，不管看没看懂，已经是勇士了。在这篇文章里，我们先后提到了 \x3ccode\x3eMaybe\x3c\/code\x3e、\x3ccode\x3eEither\x3c\/code\x3e、\x3ccode\x3eIO\x3c\/code\x3e 这三种强大的 functor，在链式调用、惰性求值、错误捕获、输入输出中都发挥着巨大的作用。事实上 functor 远不止这三种，但由于篇幅的问题就不再继续介绍了（哼才不告诉你其实是因为我还没看懂其它 functor 的原理）\x3c\/p\x3e\n\x3cp\x3e但依然有问题困扰着我们：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e如何处理嵌套的 functor 呢？（比如 \x3ccode\x3eMaybe(IO(42))\x3c\/code\x3e）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如何处理一个由非纯的或者异步的操作序列呢？\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e在这个充满了容器和 functor 的世界里，我们手上的工具还不够多，函数式编程的学习还远远没有结束，在下一篇文章里会讲到 Monad 这个神奇的东西（然而我也不知道啥时候写下一篇，估计等到实习考核后吧OvO）。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>JavaScript函数式编程（二）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006219749">https://segmentfault.com/a/1190000006219749</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/ivyjj3xoxs/" target="_blank">https://alili.tech/archive/ivyjj3xoxs/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>