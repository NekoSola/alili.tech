<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="浅谈script标签的defer和async"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>浅谈script标签的defer和async | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/bpxej7bl41l/",
				"appid": "1613049289050283", 
				"title": "浅谈script标签的defer和async | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-04T02:30:58"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/4s42teg7fwd/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/zfcaxswuv0l/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fbpxej7bl41l%2f&text=%e6%b5%85%e8%b0%88script%e6%a0%87%e7%ad%be%e7%9a%84defer%e5%92%8casync"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fbpxej7bl41l%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fbpxej7bl41l%2f&text=%e6%b5%85%e8%b0%88script%e6%a0%87%e7%ad%be%e7%9a%84defer%e5%92%8casync"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fbpxej7bl41l%2f&title=%e6%b5%85%e8%b0%88script%e6%a0%87%e7%ad%be%e7%9a%84defer%e5%92%8casync"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fbpxej7bl41l%2f&is_video=false&description=%e6%b5%85%e8%b0%88script%e6%a0%87%e7%ad%be%e7%9a%84defer%e5%92%8casync"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%b5%85%e8%b0%88script%e6%a0%87%e7%ad%be%e7%9a%84defer%e5%92%8casync&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fbpxej7bl41l%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fbpxej7bl41l%2f&title=%e6%b5%85%e8%b0%88script%e6%a0%87%e7%ad%be%e7%9a%84defer%e5%92%8casync"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbpxej7bl41l%2f&title=%e6%b5%85%e8%b0%88script%e6%a0%87%e7%ad%be%e7%9a%84defer%e5%92%8casync"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbpxej7bl41l%2f&title=%e6%b5%85%e8%b0%88script%e6%a0%87%e7%ad%be%e7%9a%84defer%e5%92%8casync"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbpxej7bl41l%2f&title=%e6%b5%85%e8%b0%88script%e6%a0%87%e7%ad%be%e7%9a%84defer%e5%92%8casync"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">浅谈script标签的defer和async</h1><div class="meta"><div class="postdate"><time datetime="2019-02-04" itemprop="datePublished">2019-02-04</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e1. 什么鬼\x3c\/h2\x3e\n\x3cp\x3e今天在做一个小需的时候，忽然看到前辈一句吊炸天的代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \x3cscript src=\x26quot;#link(\x26quot;xxxx\/xx\/home\/home.js\x26quot;)\x26quot; type=\x26quot;text\/javascript\x26quot; async defer\x3e\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22#link(\x22\x3c\/span\x3e\x3cspan class=\x22hljs-attr\x22\x3exxxx\x3c\/span\x3e\/\x3cspan class=\x22hljs-attr\x22\x3exx\x3c\/span\x3e\/\x3cspan class=\x22hljs-attr\x22\x3ehome\x3c\/span\x3e\/\x3cspan class=\x22hljs-attr\x22\x3ehome.js\x3c\/span\x3e\x22)\x22 \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\/javascript\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edefer\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e卧槽，竟然同时有\x3ccode\x3easync\x3c\/code\x3e和\x3ccode\x3edefer\x3c\/code\x3e属性，心想着肯定是前辈老司机的什么黑科技，两个一块儿肯定会发生什么神奇化学反应，于是赶紧怀着一颗崇敬的心去翻书翻文档，先复习一下各自的定义。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e2. 调查一番\x3c\/h2\x3e\n\x3cp\x3e先看看\x3ccode\x3easync\x3c\/code\x3e和\x3ccode\x3edefer\x3c\/code\x3e各自的定义吧，翻开红宝书望远镜，是这么介绍的\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e2.1 defer\x3c\/h3\x3e\n\x3cblockquote\x3e\n\x3cp\x3e这个属性的用途是表明脚本在执行时不会影响页面的构造。也就是说，脚本会被延迟到整个页面都解析完毕后再运行。因此，在\x3ccode\x3e\x26lt;script\x26gt;\x3c\/code\x3e元素中设置\x3ccode\x3edefer\x3c\/code\x3e属性，相当于告诉浏览器立即下载，但延迟执行。\x3c\/p\x3e\n\x3cp\x3eHTML5规范要求脚本按照它们出现的先后顺序执行，因此第一个延迟脚本会先于第二个延迟脚本执行，而这两个脚本会先于\x3ccode\x3eDOMContentLoaded\x3c\/code\x3e事件执行。\x3cstrong\x3e在现实当中\x3c\/strong\x3e，延迟脚本并不一定会按照顺序执行，也不一定会在\x3ccode\x3eDOMContentLoad\x3c\/code\x3e时间触发前执行，因此最好只包含一个延迟脚本。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e2.2 async\x3c\/h3\x3e\n\x3cblockquote\x3e\n\x3cp\x3e这个属性与\x3ccode\x3edefer\x3c\/code\x3e类似，都用于改变处理脚本的行为。同样与\x3ccode\x3edefer\x3c\/code\x3e类似，\x3ccode\x3easync\x3c\/code\x3e只适用于外部脚本文件，并告诉浏览器立即下载文件。但与\x3ccode\x3edefer\x3c\/code\x3e不同的是，标记为\x3ccode\x3easync\x3c\/code\x3e的脚本并不保证按照它们的先后顺序执行。\x3c\/p\x3e\n\x3cp\x3e第二个脚本文件可能会在第一个脚本文件之前执行。因此确保两者之间互不依赖非常重要。指定\x3ccode\x3easync\x3c\/code\x3e属性的目的是不让页面等待两个脚本下载和执行，从而异步加载页面其他内容。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e概括来讲，就是这两个属性都会使script标签异步加载，然而执行的时机是不一样的。引用\x3ca href=\x22https:\/\/segmentfault.com\/q\/1010000000640869\x22\x3esegmentfault\x3c\/a\x3e上的一个回答中的一张图\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVCBBR\x22 src=\x22https:\/\/static.alili.tech\/img\/bVCBBR\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e蓝色线代表网络读取，红色线代表执行时间，这俩都是针对脚本的；绿色线代表 HTML 解析。\x3c\/p\x3e\n\x3cp\x3e也就是说\x3ccode\x3easync\x3c\/code\x3e是乱序的，而\x3ccode\x3edefer\x3c\/code\x3e是顺序执行，这也就决定了\x3ccode\x3easync\x3c\/code\x3e比较适用于百度分析或者谷歌分析这类不依赖其他脚本的库。从图中可以看到一个普通的\x3ccode\x3e\x26lt;script\x26gt;\x3c\/code\x3e标签的加载和解析都是同步的，会阻塞DOM的渲染，这也就是我们经常会把\x3ccode\x3e\x26lt;script\x26gt;\x3c\/code\x3e写在\x3ccode\x3e\x26lt;body\x26gt;\x3c\/code\x3e底部的原因之一，为了防止加载资源而导致的长时间的白屏，另一个原因是js可能会进行DOM操作，所以要在DOM全部渲染完后再执行。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e2.3 really？\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e然而\x3c\/strong\x3e，这张图（几乎是百度搜到的唯一答案）是不严谨的，这只是规范的情况，大多数浏览器在实现的时候会作出优化。\x3c\/p\x3e\n\x3cp\x3e来看看chrome是怎么做的\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e《WebKit技术内幕》：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e当用户输入网页URL的时候，WebKit调用其资源加载器加载该URL对应的网页。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e加载器依赖网络模块建立连接，发送请求并接受答复。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eWebKit接收到各种网页或者资源的数据，其中某些资源可能是同步或异步获取的。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e网页被交给HTML解释器转变成一系列的词语（Token）。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e解释器根据词语构建节点（Node），形成DOM树。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果节点是JavaScript代码的话，调用JavaScript引擎解释并执行。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eJavaScript代码可能会修改DOM树的结构。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果节点需要依赖其他资源，例如图片、CSS、视频等，调用资源加载器来加载他们，但是他们是异步的，不会阻碍当前DOM树的继续创建；如果是JavaScript资源URL（没有标记异步方式），则需要停止当前DOM树的创建，直到JavaScript的资源加载并被JavaScript引擎执行后才继续DOM树的创建。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3e所以\x3c\/strong\x3e，通俗来讲，chrome浏览器首先会请求HTML文档，然后对其中的各种资源调用相应的资源加载器进行异步网络请求，同时进行DOM渲染，直到遇到\x3ccode\x3e\x26lt;script\x26gt;\x3c\/code\x3e标签的时候，主进程才会停止渲染等待此资源加载完毕然后调用V8引擎对js解析，继而继续进行DOM解析。我的理解如果加了\x3ccode\x3easync\x3c\/code\x3e属性就相当于单独开了一个进程去独立加载和执行，而\x3ccode\x3edefer\x3c\/code\x3e是和将\x3ccode\x3e\x26lt;script\x26gt;\x3c\/code\x3e放到\x3ccode\x3e\x26lt;body\x26gt;\x3c\/code\x3e底部一样的效果。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e3. 实验一发\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e3.1 demo\x3c\/h3\x3e\n\x3cp\x3e为了验证上面的结论我们来测试一下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \x3c!DOCTYPE html\x3e\n    \x3chtml lang=\x26quot;en\x26quot;\x3e\n    \x3chead\x3e\n        \x3cmeta charset=\x26quot;UTF-8\x26quot;\x3e\n        \x3ctitle\x3eDocument\x3c\/title\x3e\n        \x3clink href=\x26quot;http:\/\/libs.baidu.com\/bootstrap\/3.0.3\/css\/bootstrap.css\x26quot; rel=\x26quot;stylesheet\x26quot;\x3e\n        \x3clink href=\x26quot;http:\/\/cdn.staticfile.org\/foundation\/6.0.1\/css\/foundation.css\x26quot; rel=\x26quot;stylesheet\x26quot;\x3e\n        \x3cscript src=\x26quot;http:\/\/lib.sinaapp.com\/js\/angular.js\/angular-1.2.19\/angular.js\x26quot;\x3e\x3c\/script\x3e\n        \x3cscript src=\x26quot;http:\/\/libs.baidu.com\/backbone\/0.9.2\/backbone.js\x26quot;\x3e\x3c\/script\x3e\n        \x3cscript src=\x26quot;http:\/\/libs.baidu.com\/jquery\/2.0.0\/jquery.js\x26quot;\x3e\x3c\/script\x3e\n    \x3c\/head\x3e\n    \x3cbody\x3e\n        ul\x3eli{这是第$个节点}*1000\n    \x3c\/body\x3e\n    \x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dust\x22\x3e\x3ccode\x3e\x3cspan class=\x22xml\x22\x3e    \x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elang\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22en\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22UTF-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3eDocument\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/libs.baidu.com\/bootstrap\/3.0.3\/css\/bootstrap.css\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/cdn.staticfile.org\/foundation\/6.0.1\/css\/foundation.css\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/lib.sinaapp.com\/js\/angular.js\/angular-1.2.19\/angular.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/libs.baidu.com\/backbone\/0.9.2\/backbone.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/libs.baidu.com\/jquery\/2.0.0\/jquery.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        ul\x26gt;li\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e{这是第$个节点}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e*1000\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e一个简单的demo，从各个CDN上引用了2个CSS3个JS，在body里面创建了1000个li。通过调整外部引用资源的位置和加入相关的属性利用chrome的Timeline进行验证。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e3.2 放置在\x3ccode\x3e\x26lt;head\x26gt;\x3c\/code\x3e内\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVCBBV\x22 src=\x22https:\/\/static.alili.tech\/img\/bVCBBV\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e异步加载资源，但会阻塞\x3ccode\x3e\x26lt;body\x26gt;\x3c\/code\x3e的渲染会出现白屏，按照顺序立即执行脚本\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e3.3 放置在\x3ccode\x3e\x26lt;body\x26gt;\x3c\/code\x3e底部\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVCBBW\x22 src=\x22https:\/\/static.alili.tech\/img\/bVCBBW\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e异步加载资源，等\x3ccode\x3e\x26lt;body\x26gt;\x3c\/code\x3e中的内容渲染完毕后且加载完按顺序执行JS\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e3.3 放置在\x3ccode\x3e\x26lt;head\x26gt;\x3c\/code\x3e头部并使用\x3ccode\x3easync\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVCBB4\x22 src=\x22https:\/\/static.alili.tech\/img\/bVCBB4\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e异步加载资源，且加载完JS资源立即执行，并不会按顺序，谁快谁先上\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e3.4 放置在\x3ccode\x3e\x26lt;head\x26gt;\x3c\/code\x3e头部并使用\x3ccode\x3edefer\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVCBB6\x22 src=\x22https:\/\/static.alili.tech\/img\/bVCBB6\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e异步加载资源，在DOM渲染后之后再按顺序执行JS\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e3.5 放置在\x3ccode\x3e\x26lt;head\x26gt;\x3c\/code\x3e头部并同时使用\x3ccode\x3easync\x3c\/code\x3e和\x3ccode\x3edefer\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVCBB9\x22 src=\x22https:\/\/static.alili.tech\/img\/bVCBB9\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e表现和\x3ccode\x3easync\x3c\/code\x3e一致，开了个脑洞，把这两个属性交换一下位置，看会不会有覆盖效果，结果发现是一致的 = =、\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e综上\x3c\/strong\x3e，在webkit引擎下，建议的方式仍然是把\x3ccode\x3e\x26lt;script\x26gt;\x3c\/code\x3e写在\x3ccode\x3e\x26lt;body\x26gt;\x3c\/code\x3e底部，如果需要使用百度谷歌分析或者不蒜子等独立库时可以使用\x3ccode\x3easync\x3c\/code\x3e属性，若你的\x3ccode\x3e\x26lt;script\x26gt;\x3c\/code\x3e标签必须写在\x3ccode\x3e\x26lt;head\x26gt;\x3c\/code\x3e头部内可以使用\x3ccode\x3edefer\x3c\/code\x3e属性\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e4. 兼容性\x3c\/h2\x3e\n\x3cp\x3e那么，揣摩一下前辈的心理，同时写上的原因是什么呢，兼容性?\x3c\/p\x3e\n\x3cp\x3e上caniuse，\x3ca href=\x22http:\/\/caniuse.com\/#search=async\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3easync\x3c\/a\x3e在IE\x26lt;=9时不支持，其他浏览器OK；\x3ca href=\x22http:\/\/caniuse.com\/#search=defer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edefer\x3c\/a\x3e在IE\x26lt;=9时支持但会有bug，其他浏览器OK；现象在这个\x3ca href=\x22https:\/\/github.com\/h5bp\/lazyweb-requests\/issues\/42\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eissue\x3c\/a\x3e里有描述，这也就是“望远镜”里建议只有一个\x3ccode\x3edefer\x3c\/code\x3e的原因。所以两个属性都指定是为了在\x3ccode\x3easync\x3c\/code\x3e不支持的时候启用\x3ccode\x3edefer\x3c\/code\x3e，但\x3ccode\x3edefer\x3c\/code\x3e在某些情况下还是有bug。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eThe defer attribute may be specified even if the async attribute is specified, to cause legacy Web browsers that only support defer (and not async) to fall back to the defer behavior instead of the synchronous blocking behavior that is the default.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e5. 结论\x3c\/h2\x3e\n\x3cp\x3e其实这么讲来，最稳妥的办法还是把\x3ccode\x3e\x26lt;script\x26gt;\x3c\/code\x3e写在\x3ccode\x3e\x26lt;body\x26gt;\x3c\/code\x3e底部，没有兼容性问题，没有白屏问题，没有执行顺序问题，高枕无忧，不要搞什么\x3ccode\x3edefer\x3c\/code\x3e和\x3ccode\x3easync\x3c\/code\x3e的花啦~\x3c\/p\x3e\n\x3cp\x3e目前只研究了chrome的webkit的渲染机制，Firefox和IE的有待继续研究，图片和CSS以及其他外部资源的渲染有待研究。\x3c\/p\x3e\n\x3cp\x3e更多信息在 \x3ca href=\x22http:\/\/ifibercc.com\/2016\/08\/31\/%E6%B5%85%E8%B0%88script%E6%A0%87%E7%AD%BE%E7%9A%84defer%E5%92%8Casync\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader14\x22\x3e参考\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/book.douban.com\/subject\/10546125\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eJavaScript高级程序设计\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/book.douban.com\/subject\/25910556\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebKit技术内幕\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/q\/1010000000640869\x22\x3edefer和async的区别\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/www.w3.org\/TR\/html5\/scripting-1.html#attr-script-async\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewww.w3.org\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>浅谈script标签的defer和async</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006778717">https://segmentfault.com/a/1190000006778717</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/bpxej7bl41l/" target="_blank">https://alili.tech/archive/bpxej7bl41l/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>