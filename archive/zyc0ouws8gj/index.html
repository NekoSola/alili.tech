<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="build your promise step by step"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>build your promise step by step | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/zyc0ouws8gj/",
				"appid": "1613049289050283", 
				"title": "build your promise step by step | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-12T02:30:12"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ypbgt0n59j/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/j2a8l3mpk3/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fzyc0ouws8gj%2f&text=build%20your%20promise%20step%20by%20step"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fzyc0ouws8gj%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fzyc0ouws8gj%2f&text=build%20your%20promise%20step%20by%20step"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fzyc0ouws8gj%2f&title=build%20your%20promise%20step%20by%20step"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fzyc0ouws8gj%2f&is_video=false&description=build%20your%20promise%20step%20by%20step"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=build%20your%20promise%20step%20by%20step&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fzyc0ouws8gj%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fzyc0ouws8gj%2f&title=build%20your%20promise%20step%20by%20step"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzyc0ouws8gj%2f&title=build%20your%20promise%20step%20by%20step"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzyc0ouws8gj%2f&title=build%20your%20promise%20step%20by%20step"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzyc0ouws8gj%2f&title=build%20your%20promise%20step%20by%20step"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">build your promise step by step</h1><div class="meta"><div class="postdate"><time datetime="2019-02-12" itemprop="datePublished">2019-02-12</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e最近看了一篇关于\x3ccode\x3ePromise\x3c\/code\x3e内部实现原理的文章\x3ca href=\x22http:\/\/www.mattgreer.org\/articles\/promises-in-wicked-detail\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eJavascript in wicked detail\x3c\/a\x3e。作者从简明的例子入手，一步一步的构建健壮的\x3ccode\x3ePromise\x3c\/code\x3e实现。我就拿作者文中的代码实例梳理下文章的核心内容。\x3c\/p\x3e\n\x3cp\x3e大家一定看到过嵌套很深回调函数，那么如何在保证代码流程才能将这些纵向嵌套的代码变成横向偏平的呢？\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    doSomething(function(value) {\n        console.log(\x27Got a value:\x27 \x2b value);\n    })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    doSomething(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Got a value:\x27\x3c\/span\x3e \x2b value);\n    })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eto this\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    doSomething().then(function(value) {\n        console.log(\x27Got a value:\x27 \x2b value);\n    })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    doSomething().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Got a value:\x27\x3c\/span\x3e \x2b value);\n    })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么我们就应该在定义\x3ccode\x3edoSomething\x3c\/code\x3e函数的时候做出相应的变化\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function doSomething(callback) {\n        var value = 42;\n        callback(value);\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edoSomething\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e value = \x3cspan class=\x22hljs-number\x22\x3e42\x3c\/span\x3e;\n        callback(value);\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eto this\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function doSomething() {\n        return {\n            then: function(callback) {\n                var value = 42;\n                callback(42);\n            }\n        }\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edoSomething\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-attr\x22\x3ethen\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e value = \x3cspan class=\x22hljs-number\x22\x3e42\x3c\/span\x3e;\n                callback(\x3cspan class=\x22hljs-number\x22\x3e42\x3c\/span\x3e);\n            }\n        }\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3eDefining the Promise type\x3c\/h2\x3e\n\x3cp\x3e首先来看一段定义简单\x3ccode\x3ePromise\x3c\/code\x3e构造函数的代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function Promise(fn) {\n        var callback = null;\n        this.then = function(cb) {\n            callback = cb;\n        }\n        \n        function resolve(value) {\n            callback(value)\n        }\n        \n        fn(resolve);\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e callback = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.then = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n            callback = cb;\n        }\n        \n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolve\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n            callback(value)\n        }\n        \n        fn(resolve);\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后重写\x3ccode\x3edoSomething()\x3c\/code\x3e函数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function doSomething() {\n        return new Promise(function(resolve) {\n            var value = 42;\n            resolve(value);\n        })\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edoSomething\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e value = \x3cspan class=\x22hljs-number\x22\x3e42\x3c\/span\x3e;\n            resolve(value);\n        })\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e重新定义后的\x3ccode\x3edoSomething()\x3c\/code\x3e函数执行后返回得到一个\x3ccode\x3epromise实例\x3c\/code\x3e，实例上有\x3ccode\x3ethen()\x3c\/code\x3e方法，可以接受回调函数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    doSomething().then(function(value) {\n        console.log(value);\n    })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    doSomething().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value);\n    })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但是上面的代码会报错\x3ccode\x3e(callback is undefined)\x3c\/code\x3e，是因为：\x3cstrong\x3eresolve中的callback要早于then()方法中的callback的赋值操作\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e那么对\x3ccode\x3ePromise\x3c\/code\x3e构造函数稍微处理下，把同步的代码使用\x3ccode\x3esetTimeout\x3c\/code\x3e来hack下，改变代码的执行顺序，使得\x3ccode\x3eresolve\x3c\/code\x3e函数中的\x3ccode\x3ecallback\x3c\/code\x3e对\x3ccode\x3evalue\x3c\/code\x3e进行处理前被赋值了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function Promise(fn) {\n        var callback = null;\n        this.then = function(cb) {\n            callback = cb;\n        }\n        \n        function resolve(value) {\n            setTimeout(function() {\n                callback(value);\n            }, 1)\n        }\n        fn(resolve);\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e callback = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.then = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n            callback = cb;\n        }\n        \n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolve\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n            setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n                callback(value);\n            }, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\n        }\n        fn(resolve);\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里通过\x3ccode\x3esetTimeout\x3c\/code\x3e异步函数改变了代码执行的顺序，确保\x3ccode\x3ecallback\x3c\/code\x3e被调用前已经被赋值成\x3ccode\x3ecb\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e重新调用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    doSomething().then(function(value) {\n        console.log(value);\n    })\n    \/\/ 42\n    \/\/正常执行。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    doSomething().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value);\n    })\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 42\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/正常执行。\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但是定义\x3ccode\x3ePromise\x3c\/code\x3e构造函数的代码还是有问题的，因为如果仅仅是调用\x3ccode\x3ethen()\x3c\/code\x3e方法而注入回调的话，内部的\x3ccode\x3ecallback\x3c\/code\x3e仍然是\x3ccode\x3enull\x3c\/code\x3e。同样不能正常的执行。\x3c\/p\x3e\n\x3cp\x3e别急，慢慢来。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3ePromises have state\x3c\/h2\x3e\n\x3cp\x3e事实上\x3ccode\x3ePromise\x3c\/code\x3e是有状态的:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3epending\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eresolved\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3erejected\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3ccode\x3epending =\x26gt; resolved\x3c\/code\x3e 或者 \x3ccode\x3epending =\x26gt; rejected\x3c\/code\x3e。状态一旦发生改变，不可逆。接下来，让我们在\x3ccode\x3ePromise\x3c\/code\x3e的构造函数里面加入\x3ccode\x3estate\x3c\/code\x3e，使用\x3ccode\x3estate\x3c\/code\x3e来控制整个代码流程。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function Promise(fn) {\n        var state = \x27pending\x27, \n            value, \n            deferred;\n        \n        function resolve(newValue) {\n            state = \x27resolved\x27;\n            value = newValue;\n            \n            if(deferred) {\n                handle(deferred);\n            }\n        }\n        \n        function handle(onResolved) {\n            if(state === \x27pending\x27) {\n                deferred = onResolved;\n                return ;\n            }\n            \n            onResolved(value);\n        }\n        \n        this.then = function(onResolved) {\n            handle(onResolved);\n        }\n        \n        fn(resolve);\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e state = \x3cspan class=\x22hljs-string\x22\x3e\x27pending\x27\x3c\/span\x3e, \n            value, \n            deferred;\n        \n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolve\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enewValue\x3c\/span\x3e) \x3c\/span\x3e{\n            state = \x3cspan class=\x22hljs-string\x22\x3e\x27resolved\x27\x3c\/span\x3e;\n            value = newValue;\n            \n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(deferred) {\n                handle(deferred);\n            }\n        }\n        \n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehandle\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eonResolved\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(state === \x3cspan class=\x22hljs-string\x22\x3e\x27pending\x27\x3c\/span\x3e) {\n                deferred = onResolved;\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e ;\n            }\n            \n            onResolved(value);\n        }\n        \n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.then = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eonResolved\x3c\/span\x3e) \x3c\/span\x3e{\n            handle(onResolved);\n        }\n        \n        fn(resolve);\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e代码变的比之前更加复杂。但是现在使用\x3ccode\x3estate\x3c\/code\x3e来控制代码的流程。\x3ccode\x3ethen()方法\x3c\/code\x3e和\x3ccode\x3eresolve()方法\x3c\/code\x3e将控制权交给了新的方法\x3ccode\x3ehandle()\x3c\/code\x3e，由\x3ccode\x3ehandle()\x3c\/code\x3e方法来根据\x3ccode\x3estate\x3c\/code\x3e的值进行流程操作:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e如果\x3ccode\x3estate\x3c\/code\x3e为\x3ccode\x3epending\x3c\/code\x3e状态，即在\x3ccode\x3eresolve()\x3c\/code\x3e之前调用了\x3ccode\x3ethen()\x3c\/code\x3e方法，那么会将\x3ccode\x3eonResolved\x3c\/code\x3e回调赋值给一个\x3ccode\x3edeferred延迟对象\x3c\/code\x3e，\x3ccode\x3edeferred对象\x3c\/code\x3e将这个回调保存起来，稍后当\x3ccode\x3eresolve()\x3c\/code\x3e调用时,\x3ccode\x3epending\x3c\/code\x3e状态变为\x3ccode\x3eresolved\x3c\/code\x3e,并调用\x3ccode\x3edeferred对象\x3c\/code\x3e。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果在\x3ccode\x3ethen()\x3c\/code\x3e方法前调用\x3ccode\x3eresolve()\x3c\/code\x3e方法，\x3ccode\x3epending\x3c\/code\x3e状态变为\x3ccode\x3eresolved\x3c\/code\x3e，然后调用\x3ccode\x3ethen()\x3c\/code\x3e里面注入的回调\x3ccode\x3eonResolved\x3c\/code\x3e.\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e通过以上的代码，\x3ccode\x3epromise\x3c\/code\x3e可以任意次数的调用\x3ccode\x3ethen()\x3c\/code\x3e方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    var promise = doSomething();\n    \n    promise.then(function(value) {\n        console.log(\x27Got a value:\x27, value);\n    });\n    \/\/ 42\n    \n    promise.then(function(value) {\n        console.log(\x27Got the some value again:\x27, value); \n    });\n    \/\/42\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = doSomething();\n    \n    promise.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Got a value:\x27\x3c\/span\x3e, value);\n    });\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 42\x3c\/span\x3e\n    \n    promise.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Got the some value again:\x27\x3c\/span\x3e, value); \n    });\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/42\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但是这样的\x3ccode\x3ePromis\x3c\/code\x3ee构造函数还是有问题的，大家可以想象下，在调用\x3ccode\x3eresolve()\x3c\/code\x3e方法前，调用了很多次的\x3ccode\x3ethen()\x3c\/code\x3e方法，那么只有最后一个\x3ccode\x3ethen()\x3c\/code\x3e方法里面注入的\x3ccode\x3ecallback\x3c\/code\x3e才会有用。解决这个问题的方法就是维持一个\x3ccode\x3edeferreds队列\x3c\/code\x3e，去保存每次\x3ccode\x3ethen()\x3c\/code\x3e方法注入的回调函数。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3eChaining Promises\x3c\/h2\x3e\n\x3cp\x3e下面的代码是最普通不过的promise链式调用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    getSomeData()\n    .then(filterTheData)\n    .then(processTheData)\n    .then(displayTheData)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    getSomeData()\n    .then(filterTheData)\n    .then(processTheData)\n    .then(displayTheData)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3egetSomeData()\x3c\/code\x3e方法调用后会返回一个\x3ccode\x3epromise对象\x3c\/code\x3e，这样便可以调用\x3ccode\x3ethen()\x3c\/code\x3e方法，同样这第一个\x3ccode\x3ethen()\x3c\/code\x3e方法调用后也会返回一个\x3ccode\x3epromise\x3c\/code\x3e对象。这样才能继续调用\x3ccode\x3ethen()\x3c\/code\x3e方法。\x3c\/p\x3e\n\x3cp\x3ethen()方法总是返回一个promise。\x3c\/p\x3e\n\x3cp\x3e接下来在代码中加以实现：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function Promise(fn) {\n        var state = \x27pending\x27,\n            value,\n            deferred = null;\n            \n        function resolve(newValue) {\n            state = \x27resolved\x27;\n            value = newValue;\n            \n            if(deferred) {\n                handle(deferred);\n            }\n        }\n        \n        function handle(handler) {\n            if(state == \x27pending\x27) {\n                deferred = handler;\n                return;\n            }\n            \n            if(!handler.onResolved) {\n                handler.resolve(value);\n                return;\n            }\n            \n            var ret = handler.onResolved(value);\n            handler.resolve(ret);\n        }\n        \n        this.then = function(onResolved) {\n            return new Promise(function(resolve) {\n                handle({\n                    onResolved: onResolved,\n                    resolve: resolve\n                });\n            });\n        };\n        \n        fn(resolve);\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e state = \x3cspan class=\x22hljs-string\x22\x3e\x27pending\x27\x3c\/span\x3e,\n            value,\n            deferred = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n            \n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolve\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enewValue\x3c\/span\x3e) \x3c\/span\x3e{\n            state = \x3cspan class=\x22hljs-string\x22\x3e\x27resolved\x27\x3c\/span\x3e;\n            value = newValue;\n            \n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(deferred) {\n                handle(deferred);\n            }\n        }\n        \n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehandle\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ehandler\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(state == \x3cspan class=\x22hljs-string\x22\x3e\x27pending\x27\x3c\/span\x3e) {\n                deferred = handler;\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n            }\n            \n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!handler.onResolved) {\n                handler.resolve(value);\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n            }\n            \n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ret = handler.onResolved(value);\n            handler.resolve(ret);\n        }\n        \n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.then = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eonResolved\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) \x3c\/span\x3e{\n                handle({\n                    \x3cspan class=\x22hljs-attr\x22\x3eonResolved\x3c\/span\x3e: onResolved,\n                    \x3cspan class=\x22hljs-attr\x22\x3eresolve\x3c\/span\x3e: resolve\n                });\n            });\n        };\n        \n        fn(resolve);\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这次的代码中，调用\x3ccode\x3ethen()\x3c\/code\x3e方法后会返回一个新的生成的\x3ccode\x3epromise对象\x3c\/code\x3e。它具有\x3ccode\x3ethen()\x3c\/code\x3e方法，可以继续调用\x3ccode\x3ethen()\x3c\/code\x3e，并返回一个新生成的\x3ccode\x3epromise\x3c\/code\x3e对象。如此继续进行下去。这就实现了\x3ccode\x3ePromise\x3c\/code\x3e链式调用。\x3c\/p\x3e\n\x3cp\x3e再来看看具体的代码实现：\x3cbr\x3e\x3ccode\x3eresolve()\x3c\/code\x3e方法没什么变化，但是\x3ccode\x3ehandle()\x3c\/code\x3e方法接收一个\x3ccode\x3ehandler\x3c\/code\x3e对象。\x3ccode\x3ehandler\x3c\/code\x3e对象有2个属性，一个为\x3ccode\x3eonResolved\x3c\/code\x3e，\x3ccode\x3ethen()\x3c\/code\x3e方法里面注入的回调函数，用来对传入的上一个\x3ccode\x3epromise\x3c\/code\x3e传递过来的值进行处理；另一个为\x3ccode\x3eresolve\x3c\/code\x3e，\x3ccode\x3ePromise\x3c\/code\x3e构造函数内部定义的\x3ccode\x3eresolve()\x3c\/code\x3e方法，用来改变\x3ccode\x3ePromise\x3c\/code\x3e状态以及\x3ccode\x3evalue\x3c\/code\x3e值。\x3c\/p\x3e\n\x3cp\x3e具体分析下\x3ccode\x3ehandle()\x3c\/code\x3e函数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function handle(handler) {\n        if(state === \x27pending\x27) {\n            deferred = handler;\n            return;\n        }\n        \n        if(!handler.onResolved) {\n            handler.resolve(value);\n            return;\n        }\n        \n        var ret = handler.onResolved(value);\n        handler.resolve(ret);\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehandle\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ehandler\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(state === \x3cspan class=\x22hljs-string\x22\x3e\x27pending\x27\x3c\/span\x3e) {\n            deferred = handler;\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\n        \n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!handler.onResolved) {\n            handler.resolve(value);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\n        \n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ret = handler.onResolved(value);\n        handler.resolve(ret);\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e每次调用\x3ccode\x3ethen()\x3c\/code\x3e方法新建一个\x3ccode\x3epromise\x3c\/code\x3e对象过程当中，\x3ccode\x3ehandle({onResolved: onResolved, resolve: resolve})\x3c\/code\x3e中\x3ccode\x3eresolve\x3c\/code\x3e属性始终是获得的定义过程中对外部\x3ccode\x3eresolve\x3c\/code\x3e方法的引用。即上一次的\x3ccode\x3epromise\x3c\/code\x3e中定义的\x3ccode\x3eresolve\x3c\/code\x3e.\x3c\/p\x3e\n\x3cp\x3e当then()方法里面注入回调函数时，调用onResolved方法并获得返回值ret，传入resolve方法，改变state的值以及更改promise中需要继续传递下去的值。如果onResolved方法中会返回处理过的值，那么下一个promise能拿到这个值，如果onResolved没有返回，传入下一个promise的为undefined**\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    doSomething().then(function(result) {\n        console.log(\x27First result\x27, result);\n        return 88;\n    }).then(function(secondResult) {\n        console.log(\x27second result\x27, secondResult);\n    })\n    \n    \/\/the output is \n    \/\/\n    \/\/First result 42\n    \/\/Second result 88\n    \n    doSomething().then(function(result) {\n        console.log(\x27First result\x27, result);\n    }).then(function(secondResult) {\n        console.log(\x27Second result\x27, secondResult);\n    })\n    \n    \/\/now the output is\n    \n    \/\/First result 42\n    \/\/Second result undefined\n    \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    doSomething().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27First result\x27\x3c\/span\x3e, result);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e88\x3c\/span\x3e;\n    }).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esecondResult\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27second result\x27\x3c\/span\x3e, secondResult);\n    })\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/the output is \x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/First result 42\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/Second result 88\x3c\/span\x3e\n    \n    doSomething().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27First result\x27\x3c\/span\x3e, result);\n    }).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esecondResult\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Second result\x27\x3c\/span\x3e, secondResult);\n    })\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/now the output is\x3c\/span\x3e\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/First result 42\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/Second result undefined\x3c\/span\x3e\n    \x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22当then()没有注入回调函数时，仍然会调用resolve方法，改变state的值，以及获取上一个promise传递过来的值，并将值传递给下一个promise。\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3e当then()没有注入回调函数时，仍然会调用resolve方法，改变\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e的值，以及获取上一个promise传递过来的值，并将值传递给下一个promise。\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    doSomething().then().then(function(result) {\n        console.log(\x27Got a result\x27, result);\n    });\n    \n    \/\/the output is \n    \/\/\n    \/\/Got a result 42\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    doSomething().then().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Got a result\x27\x3c\/span\x3e, result);\n    });\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/the output is \x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/Got a result 42\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e主要是得益于\x3ccode\x3ehandle()\x3c\/code\x3e方法中,调用\x3ccode\x3eresolve\x3c\/code\x3e方法获取从上一个\x3ccode\x3epromise\x3c\/code\x3e得到的\x3ccode\x3evalue\x3c\/code\x3e以及作为传入下一个\x3ccode\x3epromise\x3c\/code\x3e的\x3ccode\x3evalue\x3c\/code\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    if(!handler.onResolved) {\n        handler.resolve(value);\n        return;\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!handler.onResolved) {\n        handler.resolve(value);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22再每次调用then()方法的过程都会新建一个pending状态的promise，并通过resolve方法改变状态，如果then()方法中注入了回调函数，并返回了值，那么这个值会一直传递下去，如果没有注入回调函数，resolve方法会获取上一个promise传递过来的值，并作为传入下一个promise的值。即then()方法注入的回调函数是可选的。\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mercury\x22\x3e\x3ccode\x3e再每次调用\x3cspan class=\x22hljs-built_in\x22\x3ethen\x3c\/span\x3e()方法的过程都会新建一个pending状态的\x3cspan class=\x22hljs-keyword\x22\x3epromise\x3c\/span\x3e，并通过resolve方法改变状态，如果\x3cspan class=\x22hljs-built_in\x22\x3ethen\x3c\/span\x3e()方法中注入了回调函数，并返回了值，那么这个值会一直传递下去，如果没有注入回调函数，resolve方法会获取上一个\x3cspan class=\x22hljs-keyword\x22\x3epromise\x3c\/span\x3e传递过来的值，并作为传入下一个\x3cspan class=\x22hljs-keyword\x22\x3epromise\x3c\/span\x3e的值。即\x3cspan class=\x22hljs-built_in\x22\x3ethen\x3c\/span\x3e()方法注入的回调函数是可选的。\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过再次对\x3ccode\x3ePromise构造函数\x3c\/code\x3e的加强，完成了\x3ccode\x3epromise链式调用\x3c\/code\x3e的功能。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e对于reject的部分过2天加上。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>build your promise step by step</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000004908829">https://segmentfault.com/a/1190000004908829</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/zyc0ouws8gj/" target="_blank">https://alili.tech/archive/zyc0ouws8gj/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>