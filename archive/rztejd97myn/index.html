<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="浏览器中唤起native app || 跳转到应用商城下载"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>浏览器中唤起native app || 跳转到应用商城下载 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/rztejd97myn/",
				"appid": "1613049289050283", 
				"title": "浏览器中唤起native app || 跳转到应用商城下载 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-08T02:30:40"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/2xlooytsq1s/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/zhwd6opdyi/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2frztejd97myn%2f&text=%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%94%a4%e8%b5%b7native%20app%20%7c%7c%20%e8%b7%b3%e8%bd%ac%e5%88%b0%e5%ba%94%e7%94%a8%e5%95%86%e5%9f%8e%e4%b8%8b%e8%bd%bd"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2frztejd97myn%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2frztejd97myn%2f&text=%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%94%a4%e8%b5%b7native%20app%20%7c%7c%20%e8%b7%b3%e8%bd%ac%e5%88%b0%e5%ba%94%e7%94%a8%e5%95%86%e5%9f%8e%e4%b8%8b%e8%bd%bd"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2frztejd97myn%2f&title=%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%94%a4%e8%b5%b7native%20app%20%7c%7c%20%e8%b7%b3%e8%bd%ac%e5%88%b0%e5%ba%94%e7%94%a8%e5%95%86%e5%9f%8e%e4%b8%8b%e8%bd%bd"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2frztejd97myn%2f&is_video=false&description=%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%94%a4%e8%b5%b7native%20app%20%7c%7c%20%e8%b7%b3%e8%bd%ac%e5%88%b0%e5%ba%94%e7%94%a8%e5%95%86%e5%9f%8e%e4%b8%8b%e8%bd%bd"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%94%a4%e8%b5%b7native%20app%20%7c%7c%20%e8%b7%b3%e8%bd%ac%e5%88%b0%e5%ba%94%e7%94%a8%e5%95%86%e5%9f%8e%e4%b8%8b%e8%bd%bd&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2frztejd97myn%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2frztejd97myn%2f&title=%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%94%a4%e8%b5%b7native%20app%20%7c%7c%20%e8%b7%b3%e8%bd%ac%e5%88%b0%e5%ba%94%e7%94%a8%e5%95%86%e5%9f%8e%e4%b8%8b%e8%bd%bd"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frztejd97myn%2f&title=%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%94%a4%e8%b5%b7native%20app%20%7c%7c%20%e8%b7%b3%e8%bd%ac%e5%88%b0%e5%ba%94%e7%94%a8%e5%95%86%e5%9f%8e%e4%b8%8b%e8%bd%bd"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frztejd97myn%2f&title=%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%94%a4%e8%b5%b7native%20app%20%7c%7c%20%e8%b7%b3%e8%bd%ac%e5%88%b0%e5%ba%94%e7%94%a8%e5%95%86%e5%9f%8e%e4%b8%8b%e8%bd%bd"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frztejd97myn%2f&title=%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%94%a4%e8%b5%b7native%20app%20%7c%7c%20%e8%b7%b3%e8%bd%ac%e5%88%b0%e5%ba%94%e7%94%a8%e5%95%86%e5%9f%8e%e4%b8%8b%e8%bd%bd"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">浏览器中唤起native app || 跳转到应用商城下载</h1><div class="meta"><div class="postdate"><time datetime="2019-02-08" itemprop="datePublished">2019-02-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e前段时间遇到一个小需求：要求在分享出来的h5页面中，有一个立即打开的按钮，如果本地安装了我们的app，那么点击就直接唤起本地app，如果没有安装，则跳转到下载。\x3c\/p\x3e\n\x3cp\x3e因为从来没有做过这个需求，因此这注定是一个苦逼的调研过程。\x3c\/p\x3e\n\x3cp\x3e我们最开始就面临2个问题：一是如何唤起本地app，二是如何判断浏览器是否安装了对应app。\x3c\/p\x3e\n\x3ch5\x3e如何唤起本地app\x3c\/h5\x3e\n\x3cp\x3e首先，想要实现这个需求，肯定是必须要客户端同学的配合才行，因此我们不用知道所有的实现细节，我们从前端角度思考看这个问题，需要知道的一点是，ios与Android都支持一种叫做schema协议的链接。比如网易新闻客户端的协议为\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22newsapp:\/\/xxxxx\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3esapp\x3c\/span\x3e:\x3cspan class=\x22hljs-comment\x22\x3e\/\/xxxxx\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当然，这个协议不需要我们前端去实现，我们只需要将协议放在a标签的href属性里，或者使用location.href与iframe来实现激活这个链接。而location.href与iframe是解决这个需求的关键。\x3c\/p\x3e\n\x3cp\x3e在ios中，还支持通过\x3ccode\x3esmart app banner\x3c\/code\x3e来唤起app，即通过一个meta标签，在标签里带上app的信息，和打开后的行为，代码形如\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cmeta name=\x26quot;apple-itunes-app\x26quot; content=\x26quot;app-id=1023600494, app-argument=tigerbrokersusstock:\/\/com.tigerbrokers.usstock\/post?postId=7125\x26quot; \/\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22apple-itunes-app\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22app-id=1023600494, app-argument=tigerbrokersusstock:\/\/com.tigerbrokers.usstock\/post?postId=7125\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们还需要知道的一点是，微信里屏蔽了schema协议。除非你是微信的合作伙伴之类的，他们专门给你配置进白名单。否则我们就没办法通过这个协议在微信中直接唤起app。\x3c\/p\x3e\n\x3cp\x3e因此我们会判断页面场景是否在微信中，如果在微信中，则会提示用户在浏览器中打开。\x3c\/p\x3e\n\x3ch5\x3e如何判断本地是否安装了app\x3c\/h5\x3e\n\x3cp\x3e很无奈的是，在浏览器中无法明确的判断本地是否安装了app。因此我们必须采取一些取巧的思路来解决这个问题。\x3c\/p\x3e\n\x3cp\x3e我们能够很容易想到，采用设置一个延迟定时器setTimeout的方式，第一时间尝试唤起app，如果200ms没有唤起成功，则默认本地没有安装app，200ms以后，将会触发下载行为。\x3c\/p\x3e\n\x3cp\x3e结合这个思路，我们来全局考虑一下这个需求应该采用什么样的方案来实现它。\x3c\/p\x3e\n\x3cp\x3e使用location.href的同学可能会面临一个担忧，在有的浏览器中，当我们尝试激活schema link的时候，若本地没有安装app，则会跳转到一个浏览器默认的错误页面去了。因此大多数人采用的解决方案都是使用iframe\x3c\/p\x3e\n\x3cblockquote\x3e测试了很多浏览器，没有发现过这种情况\x3c\/blockquote\x3e\n\x3cp\x3e后来观察了网易新闻，今日头条，YY等的实现方案，发现大家都采用的是iframe来实现。好吧，面对这种情况，只能屈服。\x3c\/p\x3e\n\x3cp\x3e整理一下目前的思路，得到下面的解决方案\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var url = {\n  open: \x27app:\/\/xxxxx\x27,\n  down: \x27xxxxxxxx\x27\n};\nvar iframe = document.createElement(\x27iframe\x27);\nvar body = document.body;\niframe.style.cssText=\x27display:none;width=0;height=0\x27;\nvar timer = null;\n\n\/\/ 立即打开的按钮\nvar openapp = document.getElementById(\x27openapp\x27);\nopenapp.addEventListener(\x27click\x27, function() {\n  if(\/MicroMessenger\/gi.test(navigator.userAgent) {\n    \/\/ 引导用户在浏览器中打开\n  }) else{\n    body.appendChild(iframe);\n    iframe.src = url.open;\n    timer = setTimeout(function() {\n      wondow.location.href = url.down;\n    }, 500);\n  }\n}, false)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = {\n  \x3cspan class=\x22hljs-attr\x22\x3eopen\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27app:\/\/xxxxx\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3edown\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27xxxxxxxx\x27\x3c\/span\x3e\n};\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e iframe = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27iframe\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e body = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body;\niframe.style.cssText=\x3cspan class=\x22hljs-string\x22\x3e\x27display:none;width=0;height=0\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e timer = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 立即打开的按钮\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e openapp = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27openapp\x27\x3c\/span\x3e);\nopenapp.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-regexp\x22\x3e\/MicroMessenger\/gi\x3c\/span\x3e.test(navigator.userAgent) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 引导用户在浏览器中打开\x3c\/span\x3e\n  }) \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n    body.appendChild(iframe);\n    iframe.src = url.open;\n    timer = setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      wondow.location.href = url.down;\n    }, \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e);\n  }\n}, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e想法很美好，现实很残酷。一测试，就发现简单的这样实现有许多的问题。\x3c\/p\x3e\n\x3cp\x3e第一个问题在于，当页面成功唤起app之后，我们再切换回来浏览器，发现跳转到了下载页面。\x3c\/p\x3e\n\x3cp\x3e为了解决这个问题，发现各个公司都进行了不同方式的尝试。\x3c\/p\x3e\n\x3cp\x3e也是历经的很多折磨，发现了几个比较有用的事件。\x3c\/p\x3e\n\x3cp\x3epageshow： 页面显示时触发，在load事件之后触发。需要将该事件绑定到window上才会触发\x3c\/p\x3e\n\x3cp\x3epagehide: 页面隐藏时触发\x3c\/p\x3e\n\x3cp\x3evisibilitychange： 页面隐藏没有在当前显示时触发，比如切换tab，也会触发该事件\x3c\/p\x3e\n\x3cp\x3edocument.hidden 当页面隐藏时，该值为true，显示时为false\x3c\/p\x3e\n\x3cp\x3e由于各个浏览器的支持情况不同，我们需要将这些事件都给绑定上，即使这样，也不一定能够保证所有的浏览器都能够解决掉这个小问题，实在没办法的事情就不管了。\x3c\/p\x3e\n\x3cp\x3e因此需要扩充一下上面的方案，当本地app被唤起，则页面会隐藏掉，就会触发pagehide与visibilitychange事件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$(document).on(\x27visibilitychange webkitvisibilitychange\x27, function() {\n    var tag = document.hidden || document.webkitHidden;\n    if (tag) {\n        clearTimeout(timer);\n    }\n})\n\n$(window).on(\x27pagehide\x27, function() {\n    clearTimeout(timer);\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e$(\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e).on(\x3cspan class=\x22hljs-string\x22\x3e\x27visibilitychange webkitvisibilitychange\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tag = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.hidden || \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.webkitHidden;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (tag) {\n        clearTimeout(timer);\n    }\n})\n\n$(\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e).on(\x3cspan class=\x22hljs-string\x22\x3e\x27pagehide\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    clearTimeout(timer);\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而另外一个问题就是IOS9\x2b下面的问题了。ios9的Safari，根本不支持通过iframe跳转到其他页面去。也就是说，在safari下，我的整体方案被全盘否决！\x3c\/p\x3e\n\x3cp\x3e于是我就只能尝试使用location.href的方式，这个方式能够唤起app，但是有一个坑爹的问题，使用schema协议唤起app会有弹窗而不会直接跳转去app！甚至当本地没有app时，会被判断为链接无效，然后还有一个弹窗。\x3c\/p\x3e\n\x3cp\x3e这个弹窗会造成什么问题呢？如果用户不点确认按钮，根据上面的逻辑，这个时候就会发现页面会自动跳转到下载去了。而且无效的弹窗提示在用户体验上是不允许出现的。\x3c\/p\x3e\n\x3cp\x3e好吧，继续扒别人的代码，看看别人是如何实现的。然后我又去观摩了其他公司的实现结果，发现网易新闻，今日头条都可以在ios直接从微信中唤起app。真是神奇了，可是今日头条在Android版微信上也没办法直接唤起的，他们在Android上都是直接到腾讯应用宝的下载里去。所以按道理来说这不是添加了白名单。\x3c\/p\x3e\n\x3cp\x3e为了找到这个问题的解决方案，我在网易新闻的页面中扒出了他们的代码，并整理如下，添加了部分注释\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nwindow.NRUM = window.NRUM || {};\nwindow.NRUM.config = {\n    key:\x2727e86c0843344caca7ba9ea652d7948d\x27,\n    clientStart: \x2bnew Date()\n};\n(function() {\n    var n = document.getElementsByTagName(\x27script\x27)[0],\n        s = document.createElement(\x27script\x27);\n\n    s.type = \x27text\/javascript\x27;\n    s.async = true;\n    s.src = \x27\/\/nos.netease.com\/apmsdk\/napm-web-min-1.1.3.js\x27;\n    n.parentNode.insertBefore(s, n);\n})();\n\n\n;\n(function(window,doc){\n\n    \/\/ http:\/\/apm.netease.com\/manual?api=web\n    NRUM.mark \x26amp;\x26amp; NRUM.mark(\x27pageload\x27, true)\n\n    var list = []\n    var config = null\n\n    \/\/ jsonp\n    function jsonp(a, b, c) {\n        var d;\n        d = document.createElement(\x27script\x27);\n        d.src = a;\n        c \x26amp;\x26amp; (d.charset = c);\n        d.onload = function() {\n            this.onload = this.onerror = null;\n            this.parentNode.removeChild(this);\n            b \x26amp;\x26amp; b(!0);\n        };\n        d.onerror = function() {\n            this.onload = this.onerror = null;\n            this.parentNode.removeChild(this);\n            b \x26amp;\x26amp; b(!1);\n        };\n        document.head.appendChild(d);\n    };\n\n\n    function localParam(search,hash){\n        search = search || window.location.search;\n        hash = hash || window.location.hash;\n        var fn = function(str,reg){\n            if(str){\n                var data = {};\n                str.replace(reg,function( $0, $1, $2, $3 ){\n                    data[ $1 ] = $3;\n                });\n                return data;\n            }\n        }\n        return {search: fn(search,new RegExp( \x26quot;([^?=\x26amp;]\x2b)(=([^\x26amp;]*))?\x26quot;, \x26quot;g\x26quot; ))||{},hash: fn(hash,new RegExp( \x26quot;([^#=\x26amp;]\x2b)(=([^\x26amp;]*))?\x26quot;, \x26quot;g\x26quot; ))||{\x22}}\x22;\n    }\n\n    jsonp(\x27http:\/\/active.163.com\/service\/form\/v1\/5847\/view\/1047.jsonp\x27)\n\n    window.search = localParam().search\n    window._callback = function(data) {\n        window._callback = null\n        list = data.list\n        if(search.s \x26amp;\x26amp; !!search.s.match(\/^wap\/i)) {\n            config = list.filter(function(item){\n                return item.type === \x27wap\x27\n            })[0]\n            return\n        }\n        config = list.filter(function(item){\n            return item.type === search.s\n        })[0]\n    }\n\n    var isAndroid = !!navigator.userAgent.match(\/android\/ig),\n        isIos = !!navigator.userAgent.match(\/iphone|ipod\/ig),\n        isIpad = !!navigator.userAgent.match(\/ipad\/ig),\n        isIos9 = !!navigator.userAgent.match(\/OS 9\/ig),\n        isYx = !!navigator.userAgent.match(\/MailMaster_Android\/i),\n        isNewsapp = !!navigator.userAgent.match(\/newsapp\/i),\n        isWeixin = (\/MicroMessenger\/ig).test(navigator.userAgent),\n        isYixin = (\/yixin\/ig).test(navigator.userAgent),\n        isQQ = (\/qq\/ig).test(navigator.userAgent),\n        params = localParam().search,\n        url = \x27newsapp:\/\/\x27,\n        iframe = document.getElementById(\x27iframe\x27);\n\n    var isIDevicePhone = (\/iphone|ipod\/gi).test(navigator.platform);\n    var isIDeviceIpad = !isIDevicePhone \x26amp;\x26amp; (\/ipad\/gi).test(navigator.platform);\n    var isIDevice = isIDevicePhone || isIDeviceIpad;\n    var isandroid2_x = !isIDevice \x26amp;\x26amp; (\/android\\s?2\\.\/gi).test(navigator.userAgent);\n    var isIEMobile = !isIDevice \x26amp;\x26amp; !isAndroid \x26amp;\x26amp; (\/MSIE\/gi).test(navigator.userAgent);\n    var android_url = (!isandroid2_x) ? \x26quot;http:\/\/3g.163.com\/links\/4304\x26quot; : \x26quot;http:\/\/3g.163.com\/links\/6264\x26quot;;\n    var ios_url = \x26quot;http:\/\/3g.163.com\/links\/3615\x26quot;;\n    var wphone_url = \x26quot;http:\/\/3g.163.com\/links\/3614\x26quot;;\n    var channel = params.s || \x27newsapp\x27\n\n    \/\/ 判断在不同环境下app的url\n    if(params.docid){\n        if(params[\x27boardid\x27] \x26amp;\x26amp; params[\x27title\x27]){\n            url = url \x2b \x27comment\/\x27 \x2b params.boardid \x2b \x27\/\x27 \x2b params.docid \x2b \x27\/\x27 \x2b params.title\n        }else{\n            url = url \x2b \x27doc\/\x27 \x2b params.docid\n        }\n    }else if(params.sid){\n        url = url \x2b \x27topic\/\x27 \x2b params.sid\n    }else if(params.pid){\n        var pid = params.pid.split(\x27_\x27)\n        url = url \x2b \x27photo\/\x27 \x2b pid[0] \x2b \x27\/\x27 \x2b pid[1]\n    }else if(params.vid){\n        url = url \x2b \x27video\/\x27 \x2b params.vid\n    }else if(params.liveRoomid){\n        url = url \x2b \x27live\/\x27 \x2b params.liveRoomid\n    }else if(params.url){\n        url = url \x2b \x27web\/\x27 \x2b decodeURIComponent(params.url)\n    }else if(params.expertid){\n        url = url \x2b \x27expert\/\x27 \x2b params.expertid\n    }else if(params.subjectid){\n        url = url \x2b \x27subject\/\x27 \x2b params.subjectid\n    }else if(params.readerid){\n        url = url \x2b \x27reader\/\x27 \x2b params.readerid\n    }else{\n        url \x2b= \x27startup\x27\n    }\n    if(url.indexOf(\x27?\x27) \x3e= 0){\n        url \x2b= \x27\x26amp;s=\x27 \x2b (params.s || \x27sps\x27)\n    }else{\n        url \x2b= \x27?s=\x27 \x2b (params.s || \x27sps\x27)\n    }\n\n    \/\/ ios \x26amp;\x26amp; 易信  用iframe 打开\n    if((isIos||isIpad) \x26amp;\x26amp; navigator.userAgent.match(\/yixin\/i)) {\n        document.getElementById(\x27iframe\x27).src = url;\n    }\n\n    var height = document.documentElement.clientHeight;\n\n    \/\/ 通常情况下先尝试使用iframe打开\n    document.getElementById(\x27iframe\x27).src = url;\n\n    \/\/ 移动端浏览器中，将下载页面显示出来\n    if(!isWeixin \x26amp;\x26amp; !isQQ \x26amp;\x26amp; !isYixin \x26amp;\x26amp; !isYx){\n        document.querySelector(\x27.main-body\x27).style.display = \x27block\x27\n        if(isIos9){\n            document.querySelector(\x27.main-body\x27).classList.add(\x27showtip\x27)\n        }\n\n        setTimeout(function(){\n            document.body.scrollTop = 0\n        },200)\n    }else{\n        document.getElementById(\x27guide\x27).style.display = \x27block\x27\n    }\n\n    \/\/ Forward To Redirect Url\n    \/\/ Add by zhanzhixiang 12\/28\/2015\n    if (params.redirect) {\n        var redirectUrl = decodeURIComponent(params.redirect);\n        if ( typeof(URL) === \x27function\x27 \x26amp;\x26amp; new URL(redirectUrl).hostname.search(\x26quot;163.com\x26quot;) !== -1) {\n            window.location.href = redirectUrl;\n        } else if (redirectUrl.search(\x26quot;163.com\x26quot;) !== -1){\n            window.location.href = redirectUrl;\n        };\n    }\n\n    \/\/ Forward To Redirect Url End\n    if ((isWeixin || isQQ) \x26amp;\x26amp; isAndroid) {\n        window.location.href = \x27http:\/\/a.app.qq.com\/o\/simple.jsp?pkgname=com.netease.newsreader.activity\x26amp;ckey=CK1331205846719\x26amp;android_schema=\x27 \x2b　url.match(\/(.*)\\?\/)[1]\n    }\n\n    if(isIos||isIpad){\n        document.getElementById(\x26quot;guide\x26quot;).classList.add(\x27iosguideopen\x27)\n    }else if (isAndroid){\n        document.getElementById(\x26quot;guide\x26quot;).classList.add(\x27androidguideopen\x27)\n    }else{\n        \/\/ window.location.href = \x27http:\/\/www.163.com\/newsapp\x27\n    }\n\n    document.getElementById(\x27link\x27).addEventListener(\x27click\x27, function(){\n\n        \/\/ 统计\n        neteaseTracker \x26amp;\x26amp; neteaseTracker(false,\x27http:\/\/sps.163.com\/func\/?func=downloadapp\x26amp;modelid=\x27\x2bmodelid\x2b\x27\x26amp;spst=\x27\x2bspst\x2b\x27\x26amp;spsf\x26amp;spss=\x27 \x2b channel,\x27\x27, \x27sps\x27 )\n\n        if (config) {\n            android_url = config.android\n        }\n        if (config \x26amp;\x26amp; config.iOS) {\n            ios_url = config.iOS\n        }\n        if(isWeixin || isQQ){\n            return\n        }\n        var msg = isIDeviceIpad ? \x26quot;检测到您正在使用iPad, 是否直接前往AppStore下载?\x26quot; : \x26quot;检测到您正在使用iPhone, 是否直接前往AppStore下载?\x26quot;;\n        if (isIDevice){\n            window.location = ios_url;\n            return;\n        }else if(isAndroid){\n            \/\/ uc浏览器用iframe唤醒\n            if(navigator.userAgent.match(\/ucbrowser|yixin|MailMaster\/i)){\n                document.getElementById(\x27iframe\x27).src = url;\n            } else {\n                window.location.href = url;\n            }\n            setTimeout(function(){\n                if(document.webkitHidden) {\n                    return\n                }\n                if (confirm(\x26quot;检测到您正在使用Android 手机，是否直接下载程序安装包？\x26quot;)) {\n                    neteaseTracker \x26amp;\x26amp; neteaseTracker(false,\x27http:\/\/sps.163.com\/func\/?func=downloadapp_pass\x26amp;modelid=\x27\x2bmodelid\x2b\x27\x26amp;spst=\x27\x2bspst\x2b\x27\x26amp;spsf\x26amp;spss=\x27 \x2b channel,\x27\x27, \x27sps\x27 )\n                    window.location.href = android_url;\n                } else {\n                    neteaseTracker \x26amp;\x26amp; neteaseTracker(false,\x27http:\/\/sps.163.com\/func\/?func=downloadapp_cancel\x26amp;modelid=\x27\x2bmodelid\x2b\x27\x26amp;spst=\x27\x2bspst\x2b\x27\x26amp;spsf\x26amp;spss=\x27 \x2b channel,\x27\x27, \x27sps\x27 )\n                }\n            },200)\n            return;\n        }else if(isIEMobile){\n            window.location = wphone_url;\n            return;\n        }else{\n            window.open(\x27http:\/\/www.163.com\/special\/00774IQ6\/newsapp_download.html\x27);\n            return;\n        }\n    }, false)\n\n    setTimeout(function(){\n        if(isIDevice \x26amp;\x26amp; params.notdownload != 1 \x26amp;\x26amp; !isNewsapp \x26amp;\x26amp; !isIos9){\n            document.getElementById(\x27link\x27).click()\n        }\n    }, 1000)\n\n})(window,document);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.NRUM = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.NRUM || {};\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.NRUM.config = {\n    \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x2727e86c0843344caca7ba9ea652d7948d\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eclientStart\x3c\/span\x3e: \x2b\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e()\n};\n(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e n = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementsByTagName(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e],\n        s = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e);\n\n    s.type = \x3cspan class=\x22hljs-string\x22\x3e\x27text\/javascript\x27\x3c\/span\x3e;\n    s.async = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    s.src = \x3cspan class=\x22hljs-string\x22\x3e\x27\/\/nos.netease.com\/apmsdk\/napm-web-min-1.1.3.js\x27\x3c\/span\x3e;\n    n.parentNode.insertBefore(s, n);\n})();\n\n\n;\n(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ewindow,doc\x3c\/span\x3e)\x3c\/span\x3e{\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ http:\/\/apm.netease.com\/manual?api=web\x3c\/span\x3e\n    NRUM.mark \x26amp;\x26amp; NRUM.mark(\x3cspan class=\x22hljs-string\x22\x3e\x27pageload\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e)\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e list = []\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e config = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ jsonp\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ejsonp\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ea, b, c\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e d;\n        d = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e);\n        d.src = a;\n        c \x26amp;\x26amp; (d.charset = c);\n        d.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onload = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onerror = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.parentNode.removeChild(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e);\n            b \x26amp;\x26amp; b(!\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n        };\n        d.onerror = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onload = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onerror = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.parentNode.removeChild(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e);\n            b \x26amp;\x26amp; b(!\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n        };\n        \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.head.appendChild(d);\n    };\n\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3elocalParam\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esearch,hash\x3c\/span\x3e)\x3c\/span\x3e{\n        search = search || \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.search;\n        hash = hash || \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.hash;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fn = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr,reg\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(str){\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e data = {};\n                str.replace(reg,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e $\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, $\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, $\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, $\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e \x3c\/span\x3e)\x3c\/span\x3e{\n                    data[ $\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e ] = $\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e;\n                });\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e data;\n            }\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\x3cspan class=\x22hljs-attr\x22\x3esearch\x3c\/span\x3e: fn(search,\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eRegExp\x3c\/span\x3e( \x3cspan class=\x22hljs-string\x22\x3e\x22([^?=\x26amp;]\x2b)(=([^\x26amp;]*))?\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22g\x22\x3c\/span\x3e ))||{},\x3cspan class=\x22hljs-attr\x22\x3ehash\x3c\/span\x3e: fn(hash,\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eRegExp\x3c\/span\x3e( \x3cspan class=\x22hljs-string\x22\x3e\x22([^#=\x26amp;]\x2b)(=([^\x26amp;]*))?\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22g\x22\x3c\/span\x3e ))||{\x22}}\x22;\n    }\n\n    jsonp(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/active.163.com\/service\/form\/v1\/5847\/view\/1047.jsonp\x27\x3c\/span\x3e)\n\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.search = localParam().search\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e._callback = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e._callback = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n        list = data.list\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(search.s \x26amp;\x26amp; !!search.s.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/^wap\/i\x3c\/span\x3e)) {\n            config = list.filter(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e)\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e item.type === \x3cspan class=\x22hljs-string\x22\x3e\x27wap\x27\x3c\/span\x3e\n            })[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n        }\n        config = list.filter(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e item.type === search.s\n        })[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isAndroid = !!navigator.userAgent.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/android\/ig\x3c\/span\x3e),\n        isIos = !!navigator.userAgent.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/iphone|ipod\/ig\x3c\/span\x3e),\n        isIpad = !!navigator.userAgent.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/ipad\/ig\x3c\/span\x3e),\n        isIos9 = !!navigator.userAgent.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/OS 9\/ig\x3c\/span\x3e),\n        isYx = !!navigator.userAgent.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/MailMaster_Android\/i\x3c\/span\x3e),\n        isNewsapp = !!navigator.userAgent.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/newsapp\/i\x3c\/span\x3e),\n        isWeixin = (\x3cspan class=\x22hljs-regexp\x22\x3e\/MicroMessenger\/ig\x3c\/span\x3e).test(navigator.userAgent),\n        isYixin = (\x3cspan class=\x22hljs-regexp\x22\x3e\/yixin\/ig\x3c\/span\x3e).test(navigator.userAgent),\n        isQQ = (\x3cspan class=\x22hljs-regexp\x22\x3e\/qq\/ig\x3c\/span\x3e).test(navigator.userAgent),\n        params = localParam().search,\n        url = \x3cspan class=\x22hljs-string\x22\x3e\x27newsapp:\/\/\x27\x3c\/span\x3e,\n        iframe = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27iframe\x27\x3c\/span\x3e);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isIDevicePhone = (\x3cspan class=\x22hljs-regexp\x22\x3e\/iphone|ipod\/gi\x3c\/span\x3e).test(navigator.platform);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isIDeviceIpad = !isIDevicePhone \x26amp;\x26amp; (\x3cspan class=\x22hljs-regexp\x22\x3e\/ipad\/gi\x3c\/span\x3e).test(navigator.platform);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isIDevice = isIDevicePhone || isIDeviceIpad;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isandroid2_x = !isIDevice \x26amp;\x26amp; (\x3cspan class=\x22hljs-regexp\x22\x3e\/android\\s?2\\.\/gi\x3c\/span\x3e).test(navigator.userAgent);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isIEMobile = !isIDevice \x26amp;\x26amp; !isAndroid \x26amp;\x26amp; (\x3cspan class=\x22hljs-regexp\x22\x3e\/MSIE\/gi\x3c\/span\x3e).test(navigator.userAgent);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e android_url = (!isandroid2_x) ? \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/3g.163.com\/links\/4304\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/3g.163.com\/links\/6264\x22\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ios_url = \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/3g.163.com\/links\/3615\x22\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e wphone_url = \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/3g.163.com\/links\/3614\x22\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e channel = params.s || \x3cspan class=\x22hljs-string\x22\x3e\x27newsapp\x27\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断在不同环境下app的url\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(params.docid){\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(params[\x3cspan class=\x22hljs-string\x22\x3e\x27boardid\x27\x3c\/span\x3e] \x26amp;\x26amp; params[\x3cspan class=\x22hljs-string\x22\x3e\x27title\x27\x3c\/span\x3e]){\n            url = url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27comment\/\x27\x3c\/span\x3e \x2b params.boardid \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x2b params.docid \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x2b params.title\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            url = url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27doc\/\x27\x3c\/span\x3e \x2b params.docid\n        }\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(params.sid){\n        url = url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27topic\/\x27\x3c\/span\x3e \x2b params.sid\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(params.pid){\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e pid = params.pid.split(\x3cspan class=\x22hljs-string\x22\x3e\x27_\x27\x3c\/span\x3e)\n        url = url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27photo\/\x27\x3c\/span\x3e \x2b pid[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e] \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x2b pid[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(params.vid){\n        url = url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27video\/\x27\x3c\/span\x3e \x2b params.vid\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(params.liveRoomid){\n        url = url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27live\/\x27\x3c\/span\x3e \x2b params.liveRoomid\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(params.url){\n        url = url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27web\/\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-built_in\x22\x3edecodeURIComponent\x3c\/span\x3e(params.url)\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(params.expertid){\n        url = url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27expert\/\x27\x3c\/span\x3e \x2b params.expertid\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(params.subjectid){\n        url = url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27subject\/\x27\x3c\/span\x3e \x2b params.subjectid\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(params.readerid){\n        url = url \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27reader\/\x27\x3c\/span\x3e \x2b params.readerid\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n        url \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x27startup\x27\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(url.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27?\x27\x3c\/span\x3e) \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e){\n        url \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;s=\x27\x3c\/span\x3e \x2b (params.s || \x3cspan class=\x22hljs-string\x22\x3e\x27sps\x27\x3c\/span\x3e)\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n        url \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x27?s=\x27\x3c\/span\x3e \x2b (params.s || \x3cspan class=\x22hljs-string\x22\x3e\x27sps\x27\x3c\/span\x3e)\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ios \x26amp;\x26amp; 易信  用iframe 打开\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e((isIos||isIpad) \x26amp;\x26amp; navigator.userAgent.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/yixin\/i\x3c\/span\x3e)) {\n        \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27iframe\x27\x3c\/span\x3e).src = url;\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e height = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.documentElement.clientHeight;\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通常情况下先尝试使用iframe打开\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27iframe\x27\x3c\/span\x3e).src = url;\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 移动端浏览器中，将下载页面显示出来\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!isWeixin \x26amp;\x26amp; !isQQ \x26amp;\x26amp; !isYixin \x26amp;\x26amp; !isYx){\n        \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.main-body\x27\x3c\/span\x3e).style.display = \x3cspan class=\x22hljs-string\x22\x3e\x27block\x27\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(isIos9){\n            \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.main-body\x27\x3c\/span\x3e).classList.add(\x3cspan class=\x22hljs-string\x22\x3e\x27showtip\x27\x3c\/span\x3e)\n        }\n\n        setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.scrollTop = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n        },\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e)\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27guide\x27\x3c\/span\x3e).style.display = \x3cspan class=\x22hljs-string\x22\x3e\x27block\x27\x3c\/span\x3e\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Forward To Redirect Url\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Add by zhanzhixiang 12\/28\/2015\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (params.redirect) {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e redirectUrl = \x3cspan class=\x22hljs-built_in\x22\x3edecodeURIComponent\x3c\/span\x3e(params.redirect);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e(URL) === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e URL(redirectUrl).hostname.search(\x3cspan class=\x22hljs-string\x22\x3e\x22163.com\x22\x3c\/span\x3e) !== \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = redirectUrl;\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (redirectUrl.search(\x3cspan class=\x22hljs-string\x22\x3e\x22163.com\x22\x3c\/span\x3e) !== \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = redirectUrl;\n        };\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Forward To Redirect Url End\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ((isWeixin || isQQ) \x26amp;\x26amp; isAndroid) {\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/a.app.qq.com\/o\/simple.jsp?pkgname=com.netease.newsreader.activity\x26amp;ckey=CK1331205846719\x26amp;android_schema=\x27\x3c\/span\x3e \x2b　url.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/(.*)\\?\/\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(isIos||isIpad){\n        \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22guide\x22\x3c\/span\x3e).classList.add(\x3cspan class=\x22hljs-string\x22\x3e\x27iosguideopen\x27\x3c\/span\x3e)\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isAndroid){\n        \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22guide\x22\x3c\/span\x3e).classList.add(\x3cspan class=\x22hljs-string\x22\x3e\x27androidguideopen\x27\x3c\/span\x3e)\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ window.location.href = \x27http:\/\/www.163.com\/newsapp\x27\x3c\/span\x3e\n    }\n\n    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27link\x27\x3c\/span\x3e).addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 统计\x3c\/span\x3e\n        neteaseTracker \x26amp;\x26amp; neteaseTracker(\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/sps.163.com\/func\/?func=downloadapp\x26amp;modelid=\x27\x3c\/span\x3e\x2bmodelid\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;spst=\x27\x3c\/span\x3e\x2bspst\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;spsf\x26amp;spss=\x27\x3c\/span\x3e \x2b channel,\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27sps\x27\x3c\/span\x3e )\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (config) {\n            android_url = config.android\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (config \x26amp;\x26amp; config.iOS) {\n            ios_url = config.iOS\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(isWeixin || isQQ){\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e msg = isIDeviceIpad ? \x3cspan class=\x22hljs-string\x22\x3e\x22检测到您正在使用iPad, 是否直接前往AppStore下载?\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22检测到您正在使用iPhone, 是否直接前往AppStore下载?\x22\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isIDevice){\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location = ios_url;\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(isAndroid){\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ uc浏览器用iframe唤醒\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(navigator.userAgent.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/ucbrowser|yixin|MailMaster\/i\x3c\/span\x3e)){\n                \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27iframe\x27\x3c\/span\x3e).src = url;\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = url;\n            }\n            setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.webkitHidden) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n                }\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (confirm(\x3cspan class=\x22hljs-string\x22\x3e\x22检测到您正在使用Android 手机，是否直接下载程序安装包？\x22\x3c\/span\x3e)) {\n                    neteaseTracker \x26amp;\x26amp; neteaseTracker(\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/sps.163.com\/func\/?func=downloadapp_pass\x26amp;modelid=\x27\x3c\/span\x3e\x2bmodelid\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;spst=\x27\x3c\/span\x3e\x2bspst\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;spsf\x26amp;spss=\x27\x3c\/span\x3e \x2b channel,\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27sps\x27\x3c\/span\x3e )\n                    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = android_url;\n                } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                    neteaseTracker \x26amp;\x26amp; neteaseTracker(\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/sps.163.com\/func\/?func=downloadapp_cancel\x26amp;modelid=\x27\x3c\/span\x3e\x2bmodelid\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;spst=\x27\x3c\/span\x3e\x2bspst\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;spsf\x26amp;spss=\x27\x3c\/span\x3e \x2b channel,\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27sps\x27\x3c\/span\x3e )\n                }\n            },\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e)\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(isIEMobile){\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location = wphone_url;\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.open(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/www.163.com\/special\/00774IQ6\/newsapp_download.html\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\n    }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(isIDevice \x26amp;\x26amp; params.notdownload != \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x26amp;\x26amp; !isNewsapp \x26amp;\x26amp; !isIos9){\n            \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27link\x27\x3c\/span\x3e).click()\n        }\n    }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n\n})(\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e虽然有一些外部的引用，和一些搞不懂是干什么用的方法和变量，但是基本逻辑还是能够看明白。好像也没有什么特别的地方。研究了许久，看到了一个jsonp请求很奇特。这是来干嘛用的？\x3c\/p\x3e\n\x3cp\x3e于是费尽千辛万苦，搜索了很多文章，最终锁定了一个关键的名词 \x3cstrong\x3eUniversal links\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e如果我早知道这个名词，那么问题就不会变的那么束手无策。所以这个东西是什么呢？\x3c\/p\x3e\n\x3cblockquote\x3eApple为iOS 9发布了一个所谓的通用链接的深层链接特性，即Universal links。虽然它并不完美，但是这一发布，让数以千计的应用开发人员突然意识到自己的应用体验被打破。\x3cp\x3eUniversal links，一种能够方便的通过传统的HTTP\/HTTPS 链接来启动App，使用相同的网址打开网站和App。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e关于这个问题的提问与universal links的介绍 \x3ca href=\x22http:\/\/stackoverflow.com\/questions\/31891777\/ios-9-safari-iframe-src-with-custom-url-scheme-not-working\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e点击这里查看\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3eios9推行的一个新的协议！ \x3c\/p\x3e\n\x3cp\x3e关于本文的这个问题，国内的论坛有许许多多的文章来解决，但是提到universal links的文章少之又少，而我想吐槽的是，我们的ios开发也尼玛不知道这个名词，搞什么鬼。他改变了用户体验的关键在于，微信没有屏蔽这个协议。因此如果我们的app注册了这个协议，那么我们就能够从微信中直接唤起app。\x3c\/p\x3e\n\x3cp\x3e这个时候我就发现，上面贴的网易新闻代码中的jsonp请求的内容，就是这个协议必须的一个叫做\x3ccode\x3eapple-app-site-association\x3c\/code\x3e的JSON文件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n   \x26quot;applinks\x26quot;: {\n       \x26quot;apps\x26quot;: [ ],\n       \x26quot;details\x26quot;: {\n           \x26quot;TEAM-IDENTIFIER.YOUR.BUNDLE.IDENTIFIER\x26quot;: {\n               \x26quot;paths\x26quot;: [\n                   \x26quot;*\x26quot;\n               ]\n           }\n       }\n   }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e{\n   \x3cspan class=\x22hljs-string\x22\x3e\x22applinks\x22\x3c\/span\x3e: {\n       \x3cspan class=\x22hljs-string\x22\x3e\x22apps\x22\x3c\/span\x3e: [ ],\n       \x3cspan class=\x22hljs-string\x22\x3e\x22details\x22\x3c\/span\x3e: {\n           \x3cspan class=\x22hljs-string\x22\x3e\x22TEAM-IDENTIFIER.YOUR.BUNDLE.IDENTIFIER\x22\x3c\/span\x3e: {\n               \x3cspan class=\x22hljs-string\x22\x3e\x22paths\x22\x3c\/span\x3e: [\n                   \x3cspan class=\x22hljs-string\x22\x3e\x22*\x22\x3c\/span\x3e\n               ]\n           }\n       }\n   }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e大家可以直接访问这个链接，查看里面的内容\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/active.163.com\/service\/form\/v1\/5847\/view\/1047.jsonp\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/active.163.com\/service...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e至于universal links具体如何实现，让ios的同学去搞定吧，这里提供两个参考文章\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/www.cocoachina.com\/bbs\/read.php?tid-1486368.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.cocoachina.com\/bbs...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/blog.branch.io\/how-to-setup-universal-links-to-deep-link-on-apple-ios-9\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/blog.branch.io\/how-to...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e支持了这个协议之后，我们又可以通过iframe来唤起app了，因此基本逻辑就是这样了。\x3c\/p\x3e\n\x3cp\x3e但是！并不是就没有坑了。\x3c\/p\x3e\n\x3cp\x3euniversal links还有一个大坑，就是如果想要通过universal links只在在微信中打开app，同一个页面我们还得使用不同的两个域名。\x3c\/p\x3e\n\x3cp\x3e这个特性虽然有点坑，但是通过这个特性却能够完美判断本地是否安装了你们的app。\x3c\/p\x3e\n\x3cp\x3e比如我们正常访问当前页面的域名为A，对应的页面url为A\x2b，而当我们点击按钮，需要打开app用到的域名为B，，对应的页面url为B\x2b。\x3c\/p\x3e\n\x3cp\x3eA与B都被注册成为了对应app的universal links，A\x2b 与 B\x2b 都指向同一个页面。 \x3c\/p\x3e\n\x3cp\x3e我们通过js判断，如果是通过B\x2b访问的该页面，则直接跳去下载app。这样，当我们从A\x2b通过点击访问B\x2b时，如果universal links生效并且本地安装了对应的app，app会直接被打开。如果本地没有安装App，则会直接执行刚才B\x2b中跳去下载的设定。\x3c\/p\x3e\n\x3cp\x3eOK，这个问题，几乎所有的坑我都在上面说到了，如果想要做好兼容，就是一个针对每个坑做最优选择了，这是一个工作量的问题。\x3c\/p\x3e\n\x3cp\x3e不过最终的调研结果是\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e没有完美的解决方案\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e就算是网易新闻，这个按钮在使用过程中也会有一些小bug，无法做到完美的状态。\x3c\/p\x3e\n\x3cp\x3e因为我们面临许多没办法解决的问题，比如无法真正意义上的判断本地是否安装了app，pageshow，pagehide并不是所有的浏览器都支持等。很多其他博客里面，什么计算时间差等方案，我花了很久的时间去研究这个方案，结果是，根！本！没！有！用！\x3c\/p\x3e\n\x3cp\x3e老实说，从微信中跳转到外部浏览器，并不是一个好的解决方案，这样会导致很多用户流失，因此大家都在ios上实现了universal links。\x3c\/p\x3e\n\x3cp\x3e网易新闻的逻辑是，点击打开会跳转到一个下载页面，这个下载页面一加载完成就尝试打开app，如果打开了就直接跑到app里面去了，如果没有就在页面上有一个立即下载的按钮，按钮行只有下载处理。\x3c\/p\x3e\n\x3cp\x3e这个问题就总结到这里，如果大家有更好的方案，欢迎与我沟通。\x3c\/p\x3e\n\x3cblockquote\x3e不用折腾universal link了，微信已经禁用 ~   2018-01-08\x3c\/blockquote\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bV0emY?w=800\x26amp;h=300\x22 src=\x22https:\/\/static.alili.tech\/img\/bV0emY?w=800\x26amp;h=300\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>浏览器中唤起native app || 跳转到应用商城下载</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005848133">https://segmentfault.com/a/1190000005848133</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/rztejd97myn/" target="_blank">https://alili.tech/archive/rztejd97myn/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>