<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="业务开发情境之：实现一个@功能"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>业务开发情境之：实现一个@功能 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/gdeoudy81t5/",
				"appid": "1613049289050283", 
				"title": "业务开发情境之：实现一个@功能 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-08T02:30:41"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ixpx703one9/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/tk1e5biq2bq/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fgdeoudy81t5%2f&text=%e4%b8%9a%e5%8a%a1%e5%bc%80%e5%8f%91%e6%83%85%e5%a2%83%e4%b9%8b%ef%bc%9a%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%40%e5%8a%9f%e8%83%bd"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fgdeoudy81t5%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fgdeoudy81t5%2f&text=%e4%b8%9a%e5%8a%a1%e5%bc%80%e5%8f%91%e6%83%85%e5%a2%83%e4%b9%8b%ef%bc%9a%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%40%e5%8a%9f%e8%83%bd"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fgdeoudy81t5%2f&title=%e4%b8%9a%e5%8a%a1%e5%bc%80%e5%8f%91%e6%83%85%e5%a2%83%e4%b9%8b%ef%bc%9a%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%40%e5%8a%9f%e8%83%bd"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fgdeoudy81t5%2f&is_video=false&description=%e4%b8%9a%e5%8a%a1%e5%bc%80%e5%8f%91%e6%83%85%e5%a2%83%e4%b9%8b%ef%bc%9a%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%40%e5%8a%9f%e8%83%bd"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%b8%9a%e5%8a%a1%e5%bc%80%e5%8f%91%e6%83%85%e5%a2%83%e4%b9%8b%ef%bc%9a%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%40%e5%8a%9f%e8%83%bd&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fgdeoudy81t5%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fgdeoudy81t5%2f&title=%e4%b8%9a%e5%8a%a1%e5%bc%80%e5%8f%91%e6%83%85%e5%a2%83%e4%b9%8b%ef%bc%9a%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%40%e5%8a%9f%e8%83%bd"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgdeoudy81t5%2f&title=%e4%b8%9a%e5%8a%a1%e5%bc%80%e5%8f%91%e6%83%85%e5%a2%83%e4%b9%8b%ef%bc%9a%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%40%e5%8a%9f%e8%83%bd"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgdeoudy81t5%2f&title=%e4%b8%9a%e5%8a%a1%e5%bc%80%e5%8f%91%e6%83%85%e5%a2%83%e4%b9%8b%ef%bc%9a%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%40%e5%8a%9f%e8%83%bd"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgdeoudy81t5%2f&title=%e4%b8%9a%e5%8a%a1%e5%bc%80%e5%8f%91%e6%83%85%e5%a2%83%e4%b9%8b%ef%bc%9a%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%40%e5%8a%9f%e8%83%bd"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">业务开发情境之：实现一个@功能</h1><div class="meta"><div class="postdate"><time datetime="2019-02-08" itemprop="datePublished">2019-02-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e最近接到了一个业务需求，让用户能够通过网页聊天框的方式在线完成交易，一个用户可能有多个业务群，其中一个功能就是要@人，@这个功能在现实的应用中经常可以遇到，比如微博、QQ都有@功能，今天我们就以前端的方式谈谈怎么一步步实现一个@功能。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e@功能涉及到的原生API\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eobj.selectionStart获取光标位置\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eobj.setSelectionRange(n, n)设置光标位置\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ekeyup事件和keydown事件\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e1.搭建我们的html文件\x3c\/h3\x3e\n\x3cp\x3e几个地方特别说明下：实际操作中，我们出现了@选框要实时更新列表数据，在这个dome中我们先用静态列表代替，效果是一样的。然后这个pre是用来定位@选框用的，注意pre大小，字体要和输入框一样，并将pre绝对定位到页面的左上角，并设置不可见。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!-- 文本输入框 --\x3e\n\x3ctextarea id=\x26quot;app\x26quot; class=\x26quot;con\x26quot; contenteditable=\x26quot;true\x26quot;\x3e\x3c\/textarea\x3e\n\x3c!-- 提交按钮 --\x3e\n\x3cinput type=\x26quot;button\x26quot; class=\x26quot;submit\x26quot; id=\x26quot;submit\x26quot; value=\x26quot;提交\x26quot;\x3e\n\x3c!-- @选框 --\x3e\n\x3cdiv id=\x26quot;selectuser\x26quot; class=\x26quot;selectbox\x26quot; style=\x26quot;display:none;\x26quot;\x3e\n    \x3ch2\x3e@用户\x3c\/h2\x3e\n    \x3cul id=\x26quot;selectlist\x26quot;\x3e\n        \x3cli uid=\x26quot;1\x26quot;\x3e陆小凤\x3c\/li\x3e\n        \x3cli uid=\x26quot;2\x26quot;\x3e西门吹雪\x3c\/li\x3e\n        \x3cli uid=\x26quot;3\x26quot;\x3e百晓生\x3c\/li\x3e\n        \x3cli uid=\x26quot;4\x26quot;\x3e张无忌\x3c\/li\x3e\n        \x3cli uid=\x26quot;5\x26quot;\x3e赵敏\x3c\/li\x3e\n        \x3cli uid=\x26quot;6\x26quot;\x3e段誉\x3c\/li\x3e\n        \x3cli uid=\x26quot;7\x26quot;\x3e虚竹\x3c\/li\x3e\n        \x3cli uid=\x26quot;8\x26quot;\x3e段德\x3c\/li\x3e\n        \x3cli uid=\x26quot;9\x26quot;\x3e周杰伦\x3c\/li\x3e\n        \x3cli uid=\x26quot;10\x26quot;\x3e张学友\x3c\/li\x3e\n    \x3c\/ul\x3e\n\x3c\/div\x3e\n\x3c!-- 暂存输入框数据 --\x3e\n\x3cpre id=\x26quot;pre_text\x26quot;\x3e\x3c\/pre\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- 文本输入框 --\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etextarea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22app\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22con\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3econtenteditable\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22true\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etextarea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- 提交按钮 --\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22button\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22submit\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22submit\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22提交\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- @选框 --\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22selectuser\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22selectbox\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estyle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22display:none;\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eh2\x3c\/span\x3e\x26gt;\x3c\/span\x3e@用户\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eh2\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22selectlist\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x221\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e陆小凤\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x222\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e西门吹雪\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x223\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e百晓生\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x224\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e张无忌\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x225\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e赵敏\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x226\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e段誉\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x227\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e虚竹\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x228\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e段德\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x229\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e周杰伦\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x2210\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e张学友\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- 暂存输入框数据 --\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3epre\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22pre_text\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3epre\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e2、实现@选框出现，并将@选框定位到当前光标右下角\x3c\/h3\x3e\n\x3cp\x3e具体实现思路：检测键盘的左边是否是@字符，如果有的话，将输入框光标前面的内容复制一份到pre，并在pre后面增加一个span，这个sapn用来协助定位@选框的。我们算出这个span相对于页面左上角的left和top，就是等下@选框相对于文本框的left和top的距离，因为我们@选框是绝对定位相对于body，所以在加上文本框相对于body的offsetLeft和offsetTop就是我们@选框所要定位的left和top了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/全局定义一个变量为光标位置\nvar cursor;\n\/\/文本框绑定keyup事件，检测输入\ntextapp.addEventListener(\x27keyup\x27, function(e){\n    \/\/获取光标\n    cursor = textapp.selectionStart;\n    \/\/ 当前光标所在位置的前一位为@字符，出现@选框\n    if(textapp.value.substring(0,cursor).charAt(cursor-1) === \x27@\x27){\n        \/\/ 判断最后一个字符是否为@\n        pre_text.innerHTML = textapp.value.substring(0,cursor);\n        pre_text.innerHTML \x2b= \x27\x3cspan id=\x26quot;proxy\x26quot; style=\x26quot;display:inline-block; width: 100px;\x26quot;\x3e\x3c\/span\x3e\x27;\n        var span = document.getElementById(\x27proxy\x27);\n        var conX = textapp.offsetLeft;\n        var conY = textapp.offsetTop;\n        var spanX = span.offsetLeft \x2b conX;\n        var spanY = span.offsetTop \x2b conY;\n        selectuser.style.left = spanX \x2b \x27px\x27;\n        selectuser.style.top = spanY \x2b \x27px\x27;\n        selectuser.style.display = \x27block\x27;\n        \/\/设置@选框的默认样式\n        listSet();\n    }else{\n        selectuser.style.display = \x27none\x27;\n    }    \n})\n\/\/ @框默认设置\nfunction listSet() {\n    var list = $(\x27#selectlist\x27);\n    list.focus();\n    $(\x27#selectlist\x27).find(\x27li\x27).eq(0).addClass(\x27hover\x27).siblings(\x27li\x27).removeClass(\x27hover\x27);\n    $(\x27#selectuser\x27).scrollTop(0);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/全局定义一个变量为光标位置\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cursor;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/文本框绑定keyup事件，检测输入\x3c\/span\x3e\ntextapp.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27keyup\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/获取光标\x3c\/span\x3e\n    cursor = textapp.selectionStart;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当前光标所在位置的前一位为@字符，出现@选框\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(textapp.value.substring(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,cursor).charAt(cursor\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) === \x3cspan class=\x22hljs-string\x22\x3e\x27@\x27\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断最后一个字符是否为@\x3c\/span\x3e\n        pre_text.innerHTML = textapp.value.substring(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,cursor);\n        pre_text.innerHTML \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;span id=\x22proxy\x22 style=\x22display:inline-block; width: 100px;\x22\x26gt;\x26lt;\/span\x26gt;\x27\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e span = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27proxy\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e conX = textapp.offsetLeft;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e conY = textapp.offsetTop;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e spanX = span.offsetLeft \x2b conX;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e spanY = span.offsetTop \x2b conY;\n        selectuser.style.left = spanX \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n        selectuser.style.top = spanY \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px\x27\x3c\/span\x3e;\n        selectuser.style.display = \x3cspan class=\x22hljs-string\x22\x3e\x27block\x27\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置@选框的默认样式\x3c\/span\x3e\n        listSet();\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n        selectuser.style.display = \x3cspan class=\x22hljs-string\x22\x3e\x27none\x27\x3c\/span\x3e;\n    }    \n})\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ @框默认设置\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3elistSet\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e list = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectlist\x27\x3c\/span\x3e);\n    list.focus();\n    $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectlist\x27\x3c\/span\x3e).find(\x3cspan class=\x22hljs-string\x22\x3e\x27li\x27\x3c\/span\x3e).eq(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e).addClass(\x3cspan class=\x22hljs-string\x22\x3e\x27hover\x27\x3c\/span\x3e).siblings(\x3cspan class=\x22hljs-string\x22\x3e\x27li\x27\x3c\/span\x3e).removeClass(\x3cspan class=\x22hljs-string\x22\x3e\x27hover\x27\x3c\/span\x3e);\n    $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectuser\x27\x3c\/span\x3e).scrollTop(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e3.键盘直接操作@选框\x3c\/h3\x3e\n\x3cp\x3e当我们的@选框出现了，并且定位好了，出现在我们想要的位置了，我们直接用键盘上下去选择所要@的人了（鼠标点击选中情况等下介绍）。这里我们要考虑的点有两个：1.当我们光标在输入框最后，我们按上下左右光标就会变化位置。2.选择之后光标位置的变化。\x3c\/p\x3e\n\x3cp\x3e1的解决办法是：我们光标位置的变化是在keydown的时候执行的，keydown是先于我们的keyup之前执行的，所以我们就要在keydown的时候就阻止默认，防止光标移动\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22textapp.addEventListener(\x27keydown\x27, function(e){\n    \/\/建立在@选框出现的情况下\n    if(selectuser.style.display == \x27block\x27){\n        var code = e.keyCode;\n        \/\/左右回车时阻止默认，防止光标移动\n        if(code == 38 || code == 40 || code == 13){\n            e.preventDefault();\n        }\n    }\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3etextapp.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27keydown\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(e)\x3c\/span\x3e\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/建立在@选框出现的情况下\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(selectuser.style.display == \x3cspan class=\x22hljs-string\x22\x3e\x27block\x27\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e code = e.keyCode;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/左右回车时阻止默认，防止光标移动\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(code == \x3cspan class=\x22hljs-number\x22\x3e38\x3c\/span\x3e || code == \x3cspan class=\x22hljs-number\x22\x3e40\x3c\/span\x3e || code == \x3cspan class=\x22hljs-number\x22\x3e13\x3c\/span\x3e){\n            e.preventDefault();\n        }\n    }\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e2.选中@人后，我们用setSelectionRange来设置光标的位置，将下面这段代码输入框keyup绑定事件里面，放在最前面\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ 当@选框存在时，判断键盘上移，下移，以及回车选中事件\n    if(selectuser.style.display == \x27block\x27){\n        var code = e.keyCode;\n        if(code == 38){\n            \/\/ 上移\n            preCode();\n            return;\n        }else if (code == 40){\n            \/\/ 下移\n            nextCode();\n            return;\n        }else if(code == 13){\n            \/\/回车选中@人\n            var textname = \x27\x27;\n            $(\x27#selectlist\x27).find(\x27li\x27).each(function(){\n                if($(this).hasClass(\x27hover\x27)){\n                    textname = $(this).html();\n                }\n            });\n            \/\/@完后文本框显示内容\n            $(\x27#app\x27).val(getText($(\x27#app\x27).val(), cursor, textname));\n            \/\/添加后光标的位置\n            var n = textname.length \x2b 1 \x2b cursor;\n            \/\/设置光标的位置\n            textapp.setSelectionRange(n, n);\n            \/\/选中后隐藏@选框\n            $(\x27#selectuser\x27).hide();\n            return;\n        }\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当@选框存在时，判断键盘上移，下移，以及回车选中事件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(selectuser.style.display == \x3cspan class=\x22hljs-string\x22\x3e\x27block\x27\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e code = e.keyCode;\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(code == \x3cspan class=\x22hljs-number\x22\x3e38\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 上移\x3c\/span\x3e\n            preCode();\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (code == \x3cspan class=\x22hljs-number\x22\x3e40\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 下移\x3c\/span\x3e\n            nextCode();\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(code == \x3cspan class=\x22hljs-number\x22\x3e13\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/回车选中@人\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e textname = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n            $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectlist\x27\x3c\/span\x3e).find(\x3cspan class=\x22hljs-string\x22\x3e\x27li\x27\x3c\/span\x3e).each(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e($(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e).hasClass(\x3cspan class=\x22hljs-string\x22\x3e\x27hover\x27\x3c\/span\x3e)){\n                    textname = $(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e).html();\n                }\n            });\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/@完后文本框显示内容\x3c\/span\x3e\n            $(\x3cspan class=\x22hljs-string\x22\x3e\x27#app\x27\x3c\/span\x3e).val(getText($(\x3cspan class=\x22hljs-string\x22\x3e\x27#app\x27\x3c\/span\x3e).val(), cursor, textname));\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/添加后光标的位置\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e n = textname.length \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x2b cursor;\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/设置光标的位置\x3c\/span\x3e\n            textapp.setSelectionRange(n, n);\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/选中后隐藏@选框\x3c\/span\x3e\n            $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectuser\x27\x3c\/span\x3e).hide();\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面这段代码我们用到了三个函数\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ 键盘上移\n    function preCode() {\n        var index = $(\x27#selectlist\x27).find(\x27.hover\x27).index();\n        if(index == 0){\n            return;\n        }else{\n            index--;\n            $(\x27#selectuser\x27).scrollTop(index * 26);\n            $(\x27#selectlist\x27).find(\x27li\x27).eq(index).addClass(\x27hover\x27).siblings(\x27li\x27).removeClass(\x27hover\x27);\n        }\n    }\n    \/\/ 键盘下移\n    function nextCode() {\n        var len = $(\x27#selectlist\x27).find(\x27li\x27).length;\n        var index = $(\x27#selectlist\x27).find(\x27.hover\x27).index();\n        if(index == len-1){\n            return;\n        }else{\n            index\x2b\x2b;\n            $(\x27#selectuser\x27).scrollTop(index * 26);\n            $(\x27#selectlist\x27).find(\x27li\x27).eq(index).addClass(\x27hover\x27).siblings(\x27li\x27).removeClass(\x27hover\x27);\n        }\n    }\n    \/\/@人的文本格式，为后面加一个空格，后面用到 \n    function getText(app, cursor, textname) {\n        var text1 = app.substring(0, cursor);\n        var text2 = app.substring(cursor);\n        return text1 \x2b textname \x2b \x27 \x27 \x2b text2;\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 键盘上移\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epreCode\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e index = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectlist\x27\x3c\/span\x3e).find(\x3cspan class=\x22hljs-string\x22\x3e\x27.hover\x27\x3c\/span\x3e).index();\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(index == \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            index--;\n            $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectuser\x27\x3c\/span\x3e).scrollTop(index * \x3cspan class=\x22hljs-number\x22\x3e26\x3c\/span\x3e);\n            $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectlist\x27\x3c\/span\x3e).find(\x3cspan class=\x22hljs-string\x22\x3e\x27li\x27\x3c\/span\x3e).eq(index).addClass(\x3cspan class=\x22hljs-string\x22\x3e\x27hover\x27\x3c\/span\x3e).siblings(\x3cspan class=\x22hljs-string\x22\x3e\x27li\x27\x3c\/span\x3e).removeClass(\x3cspan class=\x22hljs-string\x22\x3e\x27hover\x27\x3c\/span\x3e);\n        }\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 键盘下移\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enextCode\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e len = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectlist\x27\x3c\/span\x3e).find(\x3cspan class=\x22hljs-string\x22\x3e\x27li\x27\x3c\/span\x3e).length;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e index = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectlist\x27\x3c\/span\x3e).find(\x3cspan class=\x22hljs-string\x22\x3e\x27.hover\x27\x3c\/span\x3e).index();\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(index == len\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            index\x2b\x2b;\n            $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectuser\x27\x3c\/span\x3e).scrollTop(index * \x3cspan class=\x22hljs-number\x22\x3e26\x3c\/span\x3e);\n            $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectlist\x27\x3c\/span\x3e).find(\x3cspan class=\x22hljs-string\x22\x3e\x27li\x27\x3c\/span\x3e).eq(index).addClass(\x3cspan class=\x22hljs-string\x22\x3e\x27hover\x27\x3c\/span\x3e).siblings(\x3cspan class=\x22hljs-string\x22\x3e\x27li\x27\x3c\/span\x3e).removeClass(\x3cspan class=\x22hljs-string\x22\x3e\x27hover\x27\x3c\/span\x3e);\n        }\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/@人的文本格式，为后面加一个空格，后面用到 \x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetText\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eapp, cursor, textname\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e text1 = app.substring(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, cursor);\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e text2 = app.substring(cursor);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e text1 \x2b textname \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e \x2b text2;\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e4.提交操作时，取出有效的@人\x3c\/h3\x3e\n\x3cp\x3e当我们消息输入完成后，点击发送（我们这里用个提交按钮）。我们要检测这个消息中是否有@人，并把当前这条消息有效的@人取出来，这里注意并不是说我们之前选中了@某个人后就有效了，可能在这个人的名字中我又输入了其他的字符。所以我们要在发送消息的时候做一次检查，把有效的@人提取出来，并且以后台规定的数据格式。（我们暂且规定为数组吧）。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ 提交\n    $(\x27#submit\x27).on(\x27click\x27, function() {\n        var msg = $(\x27#app\x27).val();\n        \/\/检测输入框是否为空\n        if(msg === \x27\x27){\n            alert(\x27内容不能为空！\x27);\n            return;\n        }\n        \/\/返回有效@人列表\n        var arr = handleMsg(msg);\n    });\n    \/\/操作信息提取有效@人\n    function handleMsg(msg) {\n        \/\/存放有效@人id的数组\n        var At = [];\n        \/\/正则验证吧以@开头空格结束的选出来已数组的形式\n        var arrAt = msg.match(\/@{1}([\\u4e00-\\u9fa5]|\\w)\x2b\\s{1}\/g);\n        \/\/说明没有@人，直接韩慧\n        if(arrAt === null){\n            console.log(\x27没有选中@的人！\x27);\n            return At;\n        }\n        \/\/ 对arrAt数组即当前信息@人的列表进行遍历\n        for (var i = 0; i \x3c arrAt.length; i\x2b\x2b) {\n            var username = arrAt[i].replace(\x27@\x27, \x27\x27).trim();\n            \/\/ 对比当前群组人选\n            var grounpuser = $(\x27#selectlist\x27).find(\x27li\x27);\n            for (var j = 0; j \x3c grounpuser.length; j\x2b\x2b) {\n                \/\/如果名字相同，则把id放进数组内容\n                if(username == grounpuser.eq(j).html()){\n                    var uid = grounpuser.eq(j).attr(\x27uid\x27);\n                    At.push(uid);\n                    break;\n                }\n            };\n        };\n        return At;\n    }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 提交\x3c\/span\x3e\n    $(\x3cspan class=\x22hljs-string\x22\x3e\x27#submit\x27\x3c\/span\x3e).on(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e msg = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#app\x27\x3c\/span\x3e).val();\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/检测输入框是否为空\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(msg === \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e){\n            alert(\x3cspan class=\x22hljs-string\x22\x3e\x27内容不能为空！\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/返回有效@人列表\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e arr = handleMsg(msg);\n    });\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/操作信息提取有效@人\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehandleMsg\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/存放有效@人id的数组\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e At = [];\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/正则验证吧以@开头空格结束的选出来已数组的形式\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e arrAt = msg.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/@{1}([\\u4e00-\\u9fa5]|\\w)\x2b\\s{1}\/g\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/说明没有@人，直接韩慧\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(arrAt === \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27没有选中@的人！\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e At;\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对arrAt数组即当前信息@人的列表进行遍历\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; arrAt.length; i\x2b\x2b) {\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e username = arrAt[i].replace(\x3cspan class=\x22hljs-string\x22\x3e\x27@\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e).trim();\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对比当前群组人选\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e grounpuser = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#selectlist\x27\x3c\/span\x3e).find(\x3cspan class=\x22hljs-string\x22\x3e\x27li\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e j = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; j \x26lt; grounpuser.length; j\x2b\x2b) {\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果名字相同，则把id放进数组内容\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(username == grounpuser.eq(j).html()){\n                    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e uid = grounpuser.eq(j).attr(\x3cspan class=\x22hljs-string\x22\x3e\x27uid\x27\x3c\/span\x3e);\n                    At.push(uid);\n                    \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                }\n            };\n        };\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e At;\n    }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e完结\x3c\/h3\x3e\n\x3cp\x3e好了，一个@的功能已经基本实现了，剩下的就是通过ajax与后台的交互了。如果你觉得本篇文章对你有收获请赞下，也可以关注下我，分享工作，学习的前端个人感悟分享。\x3ca href=\x22https:\/\/github.com\/cwsjoker\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egithub\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>业务开发情境之：实现一个@功能</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005797788">https://segmentfault.com/a/1190000005797788</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/gdeoudy81t5/" target="_blank">https://alili.tech/archive/gdeoudy81t5/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>