<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="使用 Chrome Timeline 来优化页面性能"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>使用 Chrome Timeline 来优化页面性能 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/y2zembbxyip/",
				"appid": "1613049289050283", 
				"title": "使用 Chrome Timeline 来优化页面性能 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-06T02:30:08"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/6isktatw3je/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/kbdxwju2xom/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fy2zembbxyip%2f&text=%e4%bd%bf%e7%94%a8%20Chrome%20Timeline%20%e6%9d%a5%e4%bc%98%e5%8c%96%e9%a1%b5%e9%9d%a2%e6%80%a7%e8%83%bd"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fy2zembbxyip%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fy2zembbxyip%2f&text=%e4%bd%bf%e7%94%a8%20Chrome%20Timeline%20%e6%9d%a5%e4%bc%98%e5%8c%96%e9%a1%b5%e9%9d%a2%e6%80%a7%e8%83%bd"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fy2zembbxyip%2f&title=%e4%bd%bf%e7%94%a8%20Chrome%20Timeline%20%e6%9d%a5%e4%bc%98%e5%8c%96%e9%a1%b5%e9%9d%a2%e6%80%a7%e8%83%bd"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fy2zembbxyip%2f&is_video=false&description=%e4%bd%bf%e7%94%a8%20Chrome%20Timeline%20%e6%9d%a5%e4%bc%98%e5%8c%96%e9%a1%b5%e9%9d%a2%e6%80%a7%e8%83%bd"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%bd%bf%e7%94%a8%20Chrome%20Timeline%20%e6%9d%a5%e4%bc%98%e5%8c%96%e9%a1%b5%e9%9d%a2%e6%80%a7%e8%83%bd&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fy2zembbxyip%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fy2zembbxyip%2f&title=%e4%bd%bf%e7%94%a8%20Chrome%20Timeline%20%e6%9d%a5%e4%bc%98%e5%8c%96%e9%a1%b5%e9%9d%a2%e6%80%a7%e8%83%bd"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fy2zembbxyip%2f&title=%e4%bd%bf%e7%94%a8%20Chrome%20Timeline%20%e6%9d%a5%e4%bc%98%e5%8c%96%e9%a1%b5%e9%9d%a2%e6%80%a7%e8%83%bd"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fy2zembbxyip%2f&title=%e4%bd%bf%e7%94%a8%20Chrome%20Timeline%20%e6%9d%a5%e4%bc%98%e5%8c%96%e9%a1%b5%e9%9d%a2%e6%80%a7%e8%83%bd"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fy2zembbxyip%2f&title=%e4%bd%bf%e7%94%a8%20Chrome%20Timeline%20%e6%9d%a5%e4%bc%98%e5%8c%96%e9%a1%b5%e9%9d%a2%e6%80%a7%e8%83%bd"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">使用 Chrome Timeline 来优化页面性能</h1><div class="meta"><div class="postdate"><time datetime="2019-02-06" itemprop="datePublished">2019-02-06</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e有时候，我们就是会不由自主地写出一些低效的代码，严重影响页面运行的效率。或者我们接手的项目中，前人写出来的代码千奇百怪，比如为了一个 Canvas 特效需要同时绘制 600 个三角形，又比如 \x3ca href=\x22https:\/\/coding.net\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCoding.net\x3c\/a\x3e 的任务中心需要同时 watch 上万个变量的变化等等。那么，如果我们遇到了一个比较低效的页面，应该如何去优化它呢？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e优化前的准备：知己知彼\x3c\/h3\x3e\n\x3cp\x3e在一切开始之前，我们先打开 F12 面板，熟悉一下我们接下来要用到的工具：Timeline：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/2.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/2.png\x22 alt=\x222\x22 title=\x222\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e嗯没错就是它。下面逐一介绍一下吧。区域 1 是一个缩略图，可以看到除了时间轴以外被上下分成了四块，分别代表 FPS、CPU 时间、网络通信时间、堆栈占用；这个缩略图可以横向缩放，白色区域是下面可以看到的时间段（灰色当然是不可见的啦）。区域 2 可以看一些交互事件，例如你滚动了一下页面，那么这里会出现一个 scroll 的线段，线段覆盖的范围就是滚动经过的时间。区域 3 则是具体的事件列表了。\x3c\/p\x3e\n\x3cp\x3e一开始没有记录的时候，所有的区域都是空的。开始统计和结束统计都很简单，左上角那坨黑色的圆圈就是。它右边那个长得像“禁止通行”的按钮是用来清除现有记录的。当有数据的时候，我们把鼠标滚轮向上滚，可以看到区域被放大了：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/3.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/3.png\x22 alt=\x223\x22 title=\x223\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e短短的时间里，浏览器做了这么多事情。对于一般的屏幕，原则上来说一秒要往屏幕上绘制 60 帧，所以理论上讲我们一帧内的计算时间不能超过 16 毫秒，然而浏览器除了执行我们的代码以外，还要干点别的（例如计算 CSS，播放音频……），所以其实我们能用的只有 10~12 毫秒左右。\x3c\/p\x3e\n\x3cp\x3e差不多熟悉操作了，那么就来一下实战吧！假如有一天，你接手了这样一段代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!-- 一段小动画：点击按钮之后会有一个爆炸的粒子效果 --\x3e\n\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n\x3chead\x3e\n    \x3cmeta charset=\x26quot;utf-8\x26quot;\x3e\n    \x3ctitle\x3eTest\x3c\/title\x3e\n    \x3cstyle\x3e\n        .main {\n            position: relative;\n            width: 500px;\n            height: 500px;\n            background: #000;\n            overflow: hidden;\n        }\n        .circle {\n            position: absolute;\n            border-radius: 50%;\n            border: 1px solid #FFF;\n            width: 8px;\n            height: 8px;\n        }\n    \x3c\/style\x3e\n\x3c\/head\x3e\n\x3cbody\x3e\n    \x3cdiv class=\x26quot;main\x26quot;\x3e\x3c\/div\x3e\n    \x3chr\x3e\n    \x3cbutton onclick=\x26quot;showAnimation()\x26quot;\x3e点我\x3c\/button\x3e\n    \x3cscript src=\x26quot;jquery.min.js\x26quot;\x3e\x3c\/script\x3e\n    \x3cscript src=\x26quot;animation.js\x26quot;\x3e\x3c\/script\x3e\n\x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- 一段小动画：点击按钮之后会有一个爆炸的粒子效果 --\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3eTest\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n        \x3cspan class=\x22hljs-selector-class\x22\x3e.main\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: relative;\n            \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e500px\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e500px\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-attribute\x22\x3ebackground\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e#000\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-attribute\x22\x3eoverflow\x3c\/span\x3e: hidden;\n        }\n        \x3cspan class=\x22hljs-selector-class\x22\x3e.circle\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-attribute\x22\x3eposition\x3c\/span\x3e: absolute;\n            \x3cspan class=\x22hljs-attribute\x22\x3eborder-radius\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e50%\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-attribute\x22\x3eborder\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1px\x3c\/span\x3e solid \x3cspan class=\x22hljs-number\x22\x3e#FFF\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-attribute\x22\x3ewidth\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e8px\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-attribute\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e8px\x3c\/span\x3e;\n        }\n    \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22main\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehr\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eonclick\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22showAnimation()\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e点我\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22jquery.min.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22animation.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ animation.js\n\n\/\/ 粒子总数\nvar COUNT = 500;\n\/\/ 重力\nvar G = -0.1;\n\/\/ 摩擦力\nvar F = -0.04;\n\nfunction init() {\n    for (var i = 0; i \x3c COUNT; i\x2b\x2b) {\n        var d = Math.random() * 2 * Math.PI;\n        var v = Math.random() * 5;\n        var circle = $(\x27\x3cdiv id=\x26quot;circle-\x27 \x2b i \x2b \x27\x26quot; class=\x26quot;circle\x26quot; data-x=\x26quot;250\x26quot; data-y=\x26quot;250\x26quot; data-d=\x26quot;\x27 \x2b d \x2b \x27\x26quot; data-v=\x26quot;\x27 \x2b v \x2b \x27\x26quot;\x3e\x3c\/div\x3e\x27);\n        circle.appendTo($(\x27.main\x27));\n    }\n}\n\nfunction updateCircle() {\n    for (var i = 0; i \x3c COUNT; i\x2b\x2b) {\n        var x = parseFloat($(\x27#circle-\x27 \x2b i).attr(\x27data-x\x27));\n        var y = parseFloat($(\x27#circle-\x27 \x2b i).attr(\x27data-y\x27));\n        var d = parseFloat($(\x27#circle-\x27 \x2b i).attr(\x27data-d\x27));\n        var v = parseFloat($(\x27#circle-\x27 \x2b i).attr(\x27data-v\x27));\n        var vx = v * Math.cos(d);\n        var vy = v * Math.sin(d);\n        if (Math.abs(vx) \x3c 1e-9) vx = 0;\n        \/\/ 速度分量改变\n        vx \x2b= F * Math.cos(d);\n        vy \x2b= F * Math.sin(d) \x2b G;\n        \/\/ 计算新速度\n        v = Math.sqrt(vx * vx \x2b vy * vy);\n        if (vy \x3e 0) d = Math.acos(vx \/ v);\n        else d = -Math.acos(vx \/ v);\n        \/\/ 位移分量改变\n        x \x2b= vx;\n        y \x2b= vy;\n        $(\x27#circle-\x27 \x2b i).attr(\x27data-x\x27, x);\n        $(\x27#circle-\x27 \x2b i).attr(\x27data-y\x27, y);\n        $(\x27#circle-\x27 \x2b i).attr(\x27data-d\x27, d);\n        $(\x27#circle-\x27 \x2b i).attr(\x27data-v\x27, v);\n        $(\x27#circle-\x27 \x2b i).css({\x27top\x27: 400 - y, \x27left\x27: x});\n    }\n}\n\nvar interval = null;\n\nfunction showAnimation() {\n    if (interval) clearInterval(interval);\n    $(\x27.main\x27).html(\x27\x27);\n    init();\n    interval = setInterval(updateCircle, 1000 \/ 60);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ animation.js\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 粒子总数\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e COUNT = \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重力\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e G = \x3cspan class=\x22hljs-number\x22\x3e-0.1\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 摩擦力\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e F = \x3cspan class=\x22hljs-number\x22\x3e-0.04\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einit\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; COUNT; i\x2b\x2b) {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e d = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e v = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e circle = $(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;div id=\x22circle-\x27\x3c\/span\x3e \x2b i \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22 class=\x22circle\x22 data-x=\x22250\x22 data-y=\x22250\x22 data-d=\x22\x27\x3c\/span\x3e \x2b d \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22 data-v=\x22\x27\x3c\/span\x3e \x2b v \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22\x26gt;\x26lt;\/div\x26gt;\x27\x3c\/span\x3e);\n        circle.appendTo($(\x3cspan class=\x22hljs-string\x22\x3e\x27.main\x27\x3c\/span\x3e));\n    }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eupdateCircle\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; COUNT; i\x2b\x2b) {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e x = \x3cspan class=\x22hljs-built_in\x22\x3eparseFloat\x3c\/span\x3e($(\x3cspan class=\x22hljs-string\x22\x3e\x27#circle-\x27\x3c\/span\x3e \x2b i).attr(\x3cspan class=\x22hljs-string\x22\x3e\x27data-x\x27\x3c\/span\x3e));\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e y = \x3cspan class=\x22hljs-built_in\x22\x3eparseFloat\x3c\/span\x3e($(\x3cspan class=\x22hljs-string\x22\x3e\x27#circle-\x27\x3c\/span\x3e \x2b i).attr(\x3cspan class=\x22hljs-string\x22\x3e\x27data-y\x27\x3c\/span\x3e));\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e d = \x3cspan class=\x22hljs-built_in\x22\x3eparseFloat\x3c\/span\x3e($(\x3cspan class=\x22hljs-string\x22\x3e\x27#circle-\x27\x3c\/span\x3e \x2b i).attr(\x3cspan class=\x22hljs-string\x22\x3e\x27data-d\x27\x3c\/span\x3e));\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e v = \x3cspan class=\x22hljs-built_in\x22\x3eparseFloat\x3c\/span\x3e($(\x3cspan class=\x22hljs-string\x22\x3e\x27#circle-\x27\x3c\/span\x3e \x2b i).attr(\x3cspan class=\x22hljs-string\x22\x3e\x27data-v\x27\x3c\/span\x3e));\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e vx = v * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.cos(d);\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e vy = v * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.sin(d);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.abs(vx) \x26lt; \x3cspan class=\x22hljs-number\x22\x3e1e-9\x3c\/span\x3e) vx = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 速度分量改变\x3c\/span\x3e\n        vx \x2b= F * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.cos(d);\n        vy \x2b= F * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.sin(d) \x2b G;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 计算新速度\x3c\/span\x3e\n        v = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.sqrt(vx * vx \x2b vy * vy);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (vy \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) d = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.acos(vx \/ v);\n        \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e d = -\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.acos(vx \/ v);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 位移分量改变\x3c\/span\x3e\n        x \x2b= vx;\n        y \x2b= vy;\n        $(\x3cspan class=\x22hljs-string\x22\x3e\x27#circle-\x27\x3c\/span\x3e \x2b i).attr(\x3cspan class=\x22hljs-string\x22\x3e\x27data-x\x27\x3c\/span\x3e, x);\n        $(\x3cspan class=\x22hljs-string\x22\x3e\x27#circle-\x27\x3c\/span\x3e \x2b i).attr(\x3cspan class=\x22hljs-string\x22\x3e\x27data-y\x27\x3c\/span\x3e, y);\n        $(\x3cspan class=\x22hljs-string\x22\x3e\x27#circle-\x27\x3c\/span\x3e \x2b i).attr(\x3cspan class=\x22hljs-string\x22\x3e\x27data-d\x27\x3c\/span\x3e, d);\n        $(\x3cspan class=\x22hljs-string\x22\x3e\x27#circle-\x27\x3c\/span\x3e \x2b i).attr(\x3cspan class=\x22hljs-string\x22\x3e\x27data-v\x27\x3c\/span\x3e, v);\n        $(\x3cspan class=\x22hljs-string\x22\x3e\x27#circle-\x27\x3c\/span\x3e \x2b i).css({\x3cspan class=\x22hljs-string\x22\x3e\x27top\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e - y, \x3cspan class=\x22hljs-string\x22\x3e\x27left\x27\x3c\/span\x3e: x});\n    }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e interval = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eshowAnimation\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (interval) clearInterval(interval);\n    $(\x3cspan class=\x22hljs-string\x22\x3e\x27.main\x27\x3c\/span\x3e).html(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e);\n    init();\n    interval = setInterval(updateCircle, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e \/ \x3cspan class=\x22hljs-number\x22\x3e60\x3c\/span\x3e);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e效果如下（右上角的 FPS 计数器是 Chrome 调试工具自带的）：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/1.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/1.png\x22 alt=\x221\x22 title=\x221\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e只有 10 FPS……10 FPS……坑爹呢这是！\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/4.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/4.png\x22 alt=\x224\x22 title=\x224\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e好吧，打开 Timeline，按下记录按钮，点一下页面中的“点我”，稍微过一会儿停止记录，就会得到一些数据。放大一些，对 jQuery 比较熟悉的同学可以看出来，这些大部分是 jQuery 的函数。我们点一下那个 \x3ccode\x3eupdateCircle\x3c\/code\x3e 的区块，然后看下面：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/5.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/5.png\x22 alt=\x225\x22 title=\x225\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这里告诉我们，这个函数运行了多久、函数代码在哪儿。我们点一下那个链接，于是就跳到了 Source 页：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/6.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/6.png\x22 alt=\x226\x22 title=\x226\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e是不是很震撼，之前这个页面只是用来 Debug 的，没想到现在居然带了精确到行的运行时间统计。当然，这个时间是当前这一行在“刚才我们点击的区块对应的执行时间段”中运行的时间。所以我们就拿最慢的几句话来下手吧！\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e优化一：减少 DOM 操作\x3c\/h3\x3e\n\x3cp\x3e看到这几行代码，第一反应是：mdzz。本来 DOM 操作就慢，还要在字符串和 float 之间转来转去。果断改掉！于是用一个单独的数组来存 \x3ccode\x3ex\x3c\/code\x3e、\x3ccode\x3ey\x3c\/code\x3e、\x3ccode\x3ed\x3c\/code\x3e、\x3ccode\x3ev\x3c\/code\x3e 这些属性。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var objects = [];\n\/\/ 在 init 函数中\nobjects.push({\n    x: 250,\n    y: 250,\n    d: d,\n    v: v\n});\n\/\/ 在 updateCircle 函数中\nvar x = objects[i].x;\nvar y = objects[i].y;\nvar d = objects[i].d;\nvar v = objects[i].v;\n\/\/ ….\nobjects[i].x = x;\nobjects[i].y = y;\nobjects[i].d = d;\nobjects[i].v = v;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e objects = [];\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在 init 函数中\x3c\/span\x3e\nobjects.push({\n    \x3cspan class=\x22hljs-attr\x22\x3ex\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e250\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ey\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e250\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ed\x3c\/span\x3e: d,\n    \x3cspan class=\x22hljs-attr\x22\x3ev\x3c\/span\x3e: v\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在 updateCircle 函数中\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e x = objects[i].x;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e y = objects[i].y;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e d = objects[i].d;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e v = objects[i].v;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ….\x3c\/span\x3e\nobjects[i].x = x;\nobjects[i].y = y;\nobjects[i].d = d;\nobjects[i].v = v;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/7.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/7.png\x22 alt=\x227\x22 title=\x227\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e效果显著！我们再来看一下精确到行的数据：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/8.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/8.png\x22 alt=\x228\x22 title=\x228\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e优化二：减少不必要的运算\x3c\/h3\x3e\n\x3cp\x3e所以最耗时的那句话已经变成了计算 \x3ccode\x3evx\x3c\/code\x3e 和 \x3ccode\x3evy\x3c\/code\x3e，毕竟三角函数算法比较复杂嘛，可以理解。至于后面的三角函数为什么那么快，我猜可能是 Chrome 的 V8 引擎将其缓存了（这句话不保证正确性）。然而不知道大家有没有发现，其实计算 \x3ccode\x3ed\x3c\/code\x3e 完全没必要！我们只需要存 \x3ccode\x3evx\x3c\/code\x3e 和 \x3ccode\x3evy\x3c\/code\x3e 即可，不需要存 \x3ccode\x3ev\x3c\/code\x3e 和 \x3ccode\x3ed\x3c\/code\x3e！\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ init\nvar vx = v * Math.cos(d);\nvar vy = v * Math.sin(d);\nobjects.push({\n    x: 250,\n    y: 250,\n    vx: vx,\n    vy: vy\n});\n\/\/ updateCircle\nvar vx = objects[i].vx;\nvar vy = objects[i].vy;\n\/\/ 计算新速度\nvar v = Math.sqrt(vx * vx \x2b vy * vy);\nif (Math.abs(vx) \x3c 1e-9) vx = 0;\n\/\/ 速度分量改变\nvx \x2b= F * vx \/ v;\nvy \x2b= F * vy \/ v \x2b G;\n\/\/ ….\nobjects[i].vx = vx;\nobjects[i].vy = vy;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ init\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e vx = v * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.cos(d);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e vy = v * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.sin(d);\nobjects.push({\n    \x3cspan class=\x22hljs-attr\x22\x3ex\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e250\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ey\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e250\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3evx\x3c\/span\x3e: vx,\n    \x3cspan class=\x22hljs-attr\x22\x3evy\x3c\/span\x3e: vy\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ updateCircle\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e vx = objects[i].vx;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e vy = objects[i].vy;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 计算新速度\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e v = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.sqrt(vx * vx \x2b vy * vy);\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.abs(vx) \x26lt; \x3cspan class=\x22hljs-number\x22\x3e1e-9\x3c\/span\x3e) vx = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 速度分量改变\x3c\/span\x3e\nvx \x2b= F * vx \/ v;\nvy \x2b= F * vy \/ v \x2b G;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ….\x3c\/span\x3e\nobjects[i].vx = vx;\nobjects[i].vy = vy;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/9.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/9.png\x22 alt=\x229\x22 title=\x229\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e只有加减乘除和开平方运算，每次比原来的时间又少了两毫秒。从流畅的角度来说其实已经可以满帧运行了，然而为什么我还是觉得偶尔会有点卡呢？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e优化三：替换 setInterval\x3c\/h3\x3e\n\x3cp\x3e既然偶尔会掉帧，那么就看看是怎么掉的呗~原则上来说，在每一次浏览器进行绘制之前，Timeline 里面应该有一个叫 Paint 的事件，就像这样：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/10.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/10.png\x22 alt=\x2210\x22 title=\x2210\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e看到这些绿色的东西了没？就是它们！看上面的时间轴，虽然代码中 setInterval 的长度是 1000\/16 毫秒，但是其实根本不能保证！所以我们需要使用 \x3ccode\x3erequestAnimationFrame\x3c\/code\x3e 来代替它。这是浏览器自带的专门为动画服务的函数，浏览器会自动优化这个函数的调用时机。并且如果页面被隐藏，浏览器还会自动暂停调用，有效地减少了 CPU 的开销。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 在 updateCircle 最后加一句\nrequestAnimationFrame(updateCircle);\n\/\/ 去掉全部跟 setInterval 有关的句子，把 showAnimation 最后一句直接改成这个\nupdateCircle();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在 updateCircle 最后加一句\x3c\/span\x3e\nrequestAnimationFrame(updateCircle);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 去掉全部跟 setInterval 有关的句子，把 showAnimation 最后一句直接改成这个\x3c\/span\x3e\nupdateCircle();\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们至少可以保证，我们每算一次，屏幕上就会显示一次，因此不会掉帧（前提是每计算一次的时间小于 12ms）。但是虽然计算时间少了，浏览器重计算样式、绘制图像的时间可是一点都没变。能不能再做优化呢？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e优化四：使用硬件加速、避免反复查找元素\x3c\/h3\x3e\n\x3cp\x3e如果我们用 \x3ccode\x3etransform\x3c\/code\x3e 来代替 \x3ccode\x3eleft\x3c\/code\x3e 和 \x3ccode\x3etop\x3c\/code\x3e 来对元素进行定位，那么浏览器会为这个元素单独创立一个合成层，专门使用 GPU 进行渲染，这样可以把重计算的代价降到最低。有兴趣的同学可以研究一下“CSS 硬件加速”的机制。同时，我们可以缓存一下 jQuery 的元素（或者 DOM 元素），这样不用每次都重新查找，也能稍微提高一点效率。如果把元素缓存在 \x3ccode\x3eobjects\x3c\/code\x3e 数组中，那么连 id 都不用写了！\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ init\nvar circle = $(\x27\x3cdiv class=\x26quot;circle\x26quot;\x3e\x3c\/div\x3e\x27);\nobjects.push({\n    x: 250,\n    y: 250,\n    vx: vx,\n    vy: vy,\n    \/\/ 其实可以只存 DOM，不存 jQuery 对象\n    circle: circle[0]\n});\n\/\/ updateCircle 里面 for 循环的最后一句话替换掉\nobjects[i].circle.style.transform = \x27translate(\x27 \x2b x \x2b \x27px, \x27 \x2b (400 - y) \x2b \x27px)\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ init\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e circle = $(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;div class=\x22circle\x22\x26gt;\x26lt;\/div\x26gt;\x27\x3c\/span\x3e);\nobjects.push({\n    \x3cspan class=\x22hljs-attr\x22\x3ex\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e250\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ey\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e250\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3evx\x3c\/span\x3e: vx,\n    \x3cspan class=\x22hljs-attr\x22\x3evy\x3c\/span\x3e: vy,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 其实可以只存 DOM，不存 jQuery 对象\x3c\/span\x3e\n    circle: circle[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ updateCircle 里面 for 循环的最后一句话替换掉\x3c\/span\x3e\nobjects[i].circle.style.transform = \x3cspan class=\x22hljs-string\x22\x3e\x27translate(\x27\x3c\/span\x3e \x2b x \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px, \x27\x3c\/span\x3e \x2b (\x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e - y) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27px)\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/11.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/dn-rexskz.qbox.me\/blog\/article\/timeline\/11.png\x22 alt=\x2211\x22 title=\x2211\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e看起来是不是很爽了？\x3c\/p\x3e\n\x3cp\x3e其实，优化是无止境的，例如我在 \x3ccode\x3einit\x3c\/code\x3e 函数中完全可以不用 jQuery，改用 \x3ccode\x3ecreateDocumentFragment\x3c\/code\x3e 来拼接元素，这样初始化的时间就可以急剧缩短；调换 \x3ccode\x3eupdateCircle\x3c\/code\x3e 中的几个语句的顺序，在 V8 引擎下效率可能会有一定的提升；甚至还可以结合 Profile 面板来分析内存占用，查看浏览器绘图的细节……然而个人感觉并用不到这么极限的优化。对于一个项目来说，如果单纯为了优化而写一些奇怪的代码，是很不合算的。\x3c\/p\x3e\n\x3cp\x3e—\x3c\/p\x3e\n\x3cp\x3eP.S. 全部的代码在这里，欢迎吐槽：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/www.rexskz.info\/demos\/animation\/animation.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e未优化版\x3c\/a\x3e | \x3ca href=\x22http:\/\/www.rexskz.info\/demos\/animation\/optimize.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e优化版\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>使用 Chrome Timeline 来优化页面性能</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006224653">https://segmentfault.com/a/1190000006224653</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/y2zembbxyip/" target="_blank">https://alili.tech/archive/y2zembbxyip/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>