<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="那些年我们踩过的乱码坑"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>那些年我们踩过的乱码坑 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/8oumfi5boo/",
				"appid": "1613049289050283", 
				"title": "那些年我们踩过的乱码坑 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-09T02:30:59"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/23ackmd55ay/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/v8tqaky8zd/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f8oumfi5boo%2f&text=%e9%82%a3%e4%ba%9b%e5%b9%b4%e6%88%91%e4%bb%ac%e8%b8%a9%e8%bf%87%e7%9a%84%e4%b9%b1%e7%a0%81%e5%9d%91"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f8oumfi5boo%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f8oumfi5boo%2f&text=%e9%82%a3%e4%ba%9b%e5%b9%b4%e6%88%91%e4%bb%ac%e8%b8%a9%e8%bf%87%e7%9a%84%e4%b9%b1%e7%a0%81%e5%9d%91"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f8oumfi5boo%2f&title=%e9%82%a3%e4%ba%9b%e5%b9%b4%e6%88%91%e4%bb%ac%e8%b8%a9%e8%bf%87%e7%9a%84%e4%b9%b1%e7%a0%81%e5%9d%91"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f8oumfi5boo%2f&is_video=false&description=%e9%82%a3%e4%ba%9b%e5%b9%b4%e6%88%91%e4%bb%ac%e8%b8%a9%e8%bf%87%e7%9a%84%e4%b9%b1%e7%a0%81%e5%9d%91"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e9%82%a3%e4%ba%9b%e5%b9%b4%e6%88%91%e4%bb%ac%e8%b8%a9%e8%bf%87%e7%9a%84%e4%b9%b1%e7%a0%81%e5%9d%91&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f8oumfi5boo%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f8oumfi5boo%2f&title=%e9%82%a3%e4%ba%9b%e5%b9%b4%e6%88%91%e4%bb%ac%e8%b8%a9%e8%bf%87%e7%9a%84%e4%b9%b1%e7%a0%81%e5%9d%91"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f8oumfi5boo%2f&title=%e9%82%a3%e4%ba%9b%e5%b9%b4%e6%88%91%e4%bb%ac%e8%b8%a9%e8%bf%87%e7%9a%84%e4%b9%b1%e7%a0%81%e5%9d%91"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f8oumfi5boo%2f&title=%e9%82%a3%e4%ba%9b%e5%b9%b4%e6%88%91%e4%bb%ac%e8%b8%a9%e8%bf%87%e7%9a%84%e4%b9%b1%e7%a0%81%e5%9d%91"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f8oumfi5boo%2f&title=%e9%82%a3%e4%ba%9b%e5%b9%b4%e6%88%91%e4%bb%ac%e8%b8%a9%e8%bf%87%e7%9a%84%e4%b9%b1%e7%a0%81%e5%9d%91"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">那些年我们踩过的乱码坑</h1><div class="meta"><div class="postdate"><time datetime="2019-02-09" itemprop="datePublished">2019-02-09</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e欢迎关注个人网站：\x3ca href=\x22http:\/\/www.iamaddy.net\/2016\/07\/emoji-unicode-parser\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.iamaddy.net\/2016\/07\/emoji-unicode-parser\/\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e这是一个由乱码引发的故事。抱歉我暂时找不到更加惨烈的图，请相信我，还有更目不忍视的画面。请看下图那些框框，那都是些什么鬼！这是要害死强迫症吗？如果同时看到几十个框，简直让人崩溃。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBau\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBau\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e问题来了，这究竟是些什么鬼？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e计算机编码\x3c\/h2\x3e\n\x3cp\x3e既然是乱码，当然要看编码，那什么是编码呢？我们都知道，计算机本质上不就是\x3ccode\x3e01\x3c\/code\x3e组成的一坨东西在运作着么？\x3ccode\x3e01\x3c\/code\x3e这叫二进制，也就是最基本最底层的编码。\x3c\/p\x3e\n\x3cp\x3e那么大家平常看到的网页也好，APP也好，上面的这些文字符号是怎么表现出来的？当然是根据标记打印出来的，但计算机只能是二进制的存储，并不能真正存ABCD呀，那就要把字母映射为相应的二进制。\x3c\/p\x3e\n\x3cp\x3e上个世纪60年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为ASCII码，一直沿用至今。\x3c\/p\x3e\n\x3cp\x3eASCII码一共规定了128个字符的编码，比如大写的字母A是65（二进制01000001）。这128个符号（包括32个不能打印出来的控制符号），只占用了一个字节的后面7位，最前面的1位统一规定为0。但你美国英文字母少啊，我中文怎么办呢？全世界其他国家的字母其他语言怎么办呢，那就多加一些字节来表示咯。\x3c\/p\x3e\n\x3cp\x3e如果有一种编码，将世界上所有的符号都纳入其中。每一个符号都给予一个独一无二的编码，那么乱码问题就会消失了，这就是Unicode。Unicode规定了每个符号都有自己的二进制码。标准虽是标准，但各平台实现标准的进度不一啊，有的各自为政，这就有问题了，就像各大浏览器产商，没给我们前端少带来麻烦啊。简单点说，虽然你苹果实现了这个标准可以显示这个符号，但我Android没有，也不知道这个符号表达成啥，所以暂时给个框吧。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e因此导致乱码的真正原因：就是各平台间对Unicode标准实现不一致（包括实现的时间先后不同，以及Unicode所代表含义不同）。\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e编码分析\x3c\/h2\x3e\n\x3cp\x3e那框框的Unicode编码到底是什么呢？\x3ccode\x3echarCodeAt() \x3c\/code\x3e（这个方法有局限性，后面说）方法可返回指定位置的字符的 Unicode 编码。这个返回值是 0 - 65535 之间的整数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x26quot; 追求简單的小生活\x26quot;.charCodeAt(0)\n\/\/ 57614\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gcode\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22 追求简單的小生活\x22\x3c\/span\x3e.charCodeAt\x3cspan class=\x22hljs-comment\x22\x3e(0)\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 57614\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e57614是个十进制数，对应16进制为E10E，Unicode也可以表示为U\x2bE10E。通过这个\x3ca href=\x22https:\/\/codepoints.net\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e网站\x3c\/a\x3e查询得知结果如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBaC\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBaC\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e一头雾水，PRIVATE USE CODEPOINT这是个什么意思呢？幸好下面有wiki的解释：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eIn Unicode, the Private Use Areas (PUA) are three ranges of code points (U\x2bE000–U\x2bF8FF in the BMP, and in planes 15 and 16) that, by definition, will not be assigned characters by the Unicode Consortium. The code points in these areas can not be considered as standardized characters in Unicode itself. They are intentionally left undefined so that third parties may define their own characters without conflicting with Unicode Consortium assignments. Under the Unicode Stability Policy, the Private Use Areas will remain allocated for that purpose in all future Unicode versions.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e咳咳，由于英文水平问题，但我还是勉强翻译下。大意就是：位于BMP的\x3ccode\x3eU\x2bE000–U\x2bF8FF\x3c\/code\x3e编码，和第15以及16平面的区域的编码，Unicode协会表示不会对该区域的编码指定符号，且这些区域编码不是标准符号，\x3cstrong\x3e故意留下未定义的区域是让第三方自己去玩\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e那什么又是BMP，第一个平面称为基本多语言平面（Basic Multilingual Plane, BMP），或称第零平面（Plane 0）。其他平面称为辅助平面（Supplementary Planes）。最前面的65536个字符位，都在BMP中。\x3c\/p\x3e\n\x3cp\x3e好了，回到前面看，U\x2bE10E这个Unicode刚好落到了（U\x2bE000–U\x2bF8FF）区间内。所以这个字符是因为第三方自定义的。\x3c\/p\x3e\n\x3cp\x3e网上找到了一份表，\x3ca href=\x22http:\/\/www.easyapns.com\/iphone-emoji-alerts\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.easyapns.com\/iphone-emoji-alerts\x3c\/a\x3e 。\x3ccode\x3eU\x2bE10E\x3c\/code\x3e对应符号如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBaK\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBaK\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e那框真的是这个皇冠emoji吗？因为是用户昵称，查一下就知道了\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBaL\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBaL\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e事实证明，确实没错。那么既然是emoji表情，为什么iphone（9.3.1）都不能正常解析？这编码又是怎么被用户输入进去的？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3eemoji表情\x3c\/h2\x3e\n\x3cp\x3e说到emoji，那我们先来扒一扒emoji的历史故事。\x3c\/p\x3e\n\x3cp\x3eemoji表情源于日本，叫做绘（e=图）文字（moji=字符）。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eEmoji were initially used by Japanese mobile operators, NTT DoCoMo, au, and SoftBank Mobile (formerly Vodafone).\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e日本几家公司各自定义了一套标准，用两个字节表示符号，Shift-JIS（日本电脑系统的一种编码）编码是从F89F到F9FC。当然这已经是上世纪的事情了，其中被广泛采用的是SoftBank标准，也称之为SB （SoftBank，这里不是ShaBi的缩写，咳咳）emoji表情。\x3c\/p\x3e\n\x3cp\x3e发展到今天，Unicode协会把emoji表情纳入标准中，但编码范围重新划分了。前面说了，Private Use Areas 是留给第三方用的，不能瞎占用。\x3c\/p\x3e\n\x3cp\x3e在这个\x3ca href=\x22http:\/\/www.iemoji.com\/view\/emoji\/418\/people\/crown\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e网站\x3c\/a\x3e查到\x3ccode\x3eE10E\x3c\/code\x3e如下信息：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBaN\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBaN\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可以初步怀疑是SoftBank的emoji表情。\x3c\/p\x3e\n\x3cp\x3e恰好手中有台旧的华为手机，有一个系统自带的华为输入法，输入法里面有一些跟苹果emoji一样的表情，只不过数量没这么多。下面四个是华为输入法键盘上的表情：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBaP\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBaP\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这四个表情在Unicode中的标准编码是：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBaY\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBaY\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e注意，如果使用charCodeAt方法来获取Unicode编码的时候要注意了，前面我们提到了该方法有缺陷\x3c\/strong\x3e。简单的原因就是JavaScript使用的编码与utf-8不一样导致，这里不展开讲，有兴趣可以看这篇\x3ca href=\x22https:\/\/mathiasbynens.be\/notes\/javascript-unicode\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e文章\x3c\/a\x3e。ES6提供了新的接口来获取码点，\x3ccode\x3ecodePointAt\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBa1\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBa1\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e输入的结果展示如下：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eiphone6sp 显示框框\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBa2\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBa2\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ehuawei 显示空白\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBa3\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBa3\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e虽然在两台机器的表现形式不一样，但都是无法正确显示，那我们看下这到底是什么编码。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBa5\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBa5\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e上面四个编码落入的区域也是在（U\x2bE000–U\x2bF8FF）内，然后根据上面的网站查询，可以确认是来自SoftBank标准的emoji表情了。\x3c\/p\x3e\n\x3cp\x3e所以只要替换这些编码就好了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e解决方案\x3c\/h2\x3e\n\x3cp\x3e也就是说\x3cstrong\x3eSoftBank emoji表情现在的系统基本不支持\x3c\/strong\x3e，因为已经过时了。\x3c\/p\x3e\n\x3cp\x3e但为什么用户还能够输入这些SoftBank emoji呢？原因就在于有些手机输入法（相对古老了）厂商对emoji的实现还是参照SoftBank的标准。\x3c\/p\x3e\n\x3cp\x3e因此把SoftBank emoji编码转换为Unicode标准的就是解决之道。在\x3ca href=\x22https:\/\/github.com\/node-modules\/emoji\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egithub\x3c\/a\x3e上找到了SoftBank与标准emoji Unicode的对应关系。\x3c\/p\x3e\n\x3cp\x3e有两种解决方案：\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e1、转换为html实体编码\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\\uE10E -\x3e \\u1F451 -\x3e \x26amp;#x1F451;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs livescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-string\x22\x3e\\uE10E\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e-\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\\u1F451\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e-\x26gt;\x3c\/span\x3e \x26amp;\x3cspan class=\x22hljs-comment\x22\x3e#x1F451;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e优点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e高清，依赖系统编码；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e不需要加载css和emoji图片，省流量。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e缺点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e所有平台表情不统一，各系统自定义的图标，风格不同，但表达意思基本一样\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBbb\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBbb\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e部分平台不支持emoji\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eios:\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBbc\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBbc\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eandroid:\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBbf\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBbf\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e2、转换为html标签\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3ecode 对应emoji图标的classID，用雪碧图。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ci class=\x26quot;emoji emoji\x27\x2bcode\x2b\x27\x26quot; text=\x26quot;\x26quot;\x3e\x3c\/i\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x26lt;i \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22emoji emoji\x27\x2bcode\x2b\x27\x22\x3c\/span\x3e text=\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e\x26gt;\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ei\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e优点：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e所有平台表情统一（如果统一算优点的话，有争议，毕竟Android用户看习惯了Android表情）。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e缺点：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e需要加载额外的css和emoji图标；如果要高清（暂时无法找到，图片会模糊），则图标会很大。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e综上，结合方案一二，在Android版本小于4.4的时候采用方案二，其他采用方案一。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e结果\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBbl\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBbl\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e（左边为处理前，右边为处理后）\x3c\/p\x3e\n\x3cp\x3e不同系统的处理结果\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBbm\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBbm\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwBbn\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwBbn\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e问题来了，如果遇到了其他编码标准（google， DoCoMo，KDDI 等等）的表情该怎么办？如果没有Unicode的与符号的映射关系真是白搭，你丝毫没有办法。就像你不学习英文单词，你还想看懂英文文章？\x3c\/p\x3e\n\x3cp\x3eemoji表情不断在丰富，这也给前端（各种终端）工作者带来麻烦，只能尽可能的补上已知的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e参考资料\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/codepoints.net\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/codepoints.net\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.unicode.org\/faq\/private_use.html#pua1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.unicode.org\/faq\/private_use.html#pua1\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2007\/10\/ascii_unicode_and_utf-8.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.ruanyifeng.com\/blog\/2007\/10\/ascii_unicode_and_utf-8.html\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/blog.csdn.net\/binjly\/article\/details\/47321043\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/blog.csdn.net\/binjly\/article\/details\/47321043\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/computerism.ru\/emoji-smiles.htm\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/computerism.ru\/emoji-smiles.htm\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2014\/12\/unicode.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.ruanyifeng.com\/blog\/2014\/12\/unicode.html\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/blog.csdn.net\/ugg\/article\/details\/44225723\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/blog.csdn.net\/ugg\/article\/details\/44225723\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/iamcal\/js-emoji\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/iamcal\/js-emoji\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/node-modules\/emoji\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/node-modules\/emoji\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.fileformat.info\/info\/emoji\/softbank.htm\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.fileformat.info\/info\/emoji\/softbank.htm\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/caniemoji.com\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/caniemoji.com\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.easyapns.com\/iphone-emoji-alerts\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.easyapns.com\/iphone-emoji-alerts\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/en.wikipedia.org\/wiki\/Emoji\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/en.wikipedia.org\/wiki\/Emoji\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/mathiasbynens.be\/notes\/javascript-unicode\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/mathiasbynens.be\/notes\/javascript-unicode\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>那些年我们踩过的乱码坑</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005347080">https://segmentfault.com/a/1190000005347080</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/8oumfi5boo/" target="_blank">https://alili.tech/archive/8oumfi5boo/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>