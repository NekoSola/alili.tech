<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="[聊一聊系列]聊一聊百度移动端首页前端速度那些事儿"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>[聊一聊系列]聊一聊百度移动端首页前端速度那些事儿 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/4q3y3f96tb/",
				"appid": "1613049289050283", 
				"title": "[聊一聊系列]聊一聊百度移动端首页前端速度那些事儿 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-07T02:30:16"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/vfb05wxw8ia/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/bnj4hbgqdl/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f4q3y3f96tb%2f&text=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%99%be%e5%ba%a6%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%a6%96%e9%a1%b5%e5%89%8d%e7%ab%af%e9%80%9f%e5%ba%a6%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f4q3y3f96tb%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f4q3y3f96tb%2f&text=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%99%be%e5%ba%a6%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%a6%96%e9%a1%b5%e5%89%8d%e7%ab%af%e9%80%9f%e5%ba%a6%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f4q3y3f96tb%2f&title=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%99%be%e5%ba%a6%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%a6%96%e9%a1%b5%e5%89%8d%e7%ab%af%e9%80%9f%e5%ba%a6%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f4q3y3f96tb%2f&is_video=false&description=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%99%be%e5%ba%a6%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%a6%96%e9%a1%b5%e5%89%8d%e7%ab%af%e9%80%9f%e5%ba%a6%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%99%be%e5%ba%a6%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%a6%96%e9%a1%b5%e5%89%8d%e7%ab%af%e9%80%9f%e5%ba%a6%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f4q3y3f96tb%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f4q3y3f96tb%2f&title=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%99%be%e5%ba%a6%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%a6%96%e9%a1%b5%e5%89%8d%e7%ab%af%e9%80%9f%e5%ba%a6%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4q3y3f96tb%2f&title=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%99%be%e5%ba%a6%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%a6%96%e9%a1%b5%e5%89%8d%e7%ab%af%e9%80%9f%e5%ba%a6%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4q3y3f96tb%2f&title=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%99%be%e5%ba%a6%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%a6%96%e9%a1%b5%e5%89%8d%e7%ab%af%e9%80%9f%e5%ba%a6%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4q3y3f96tb%2f&title=%5b%e8%81%8a%e4%b8%80%e8%81%8a%e7%b3%bb%e5%88%97%5d%e8%81%8a%e4%b8%80%e8%81%8a%e7%99%be%e5%ba%a6%e7%a7%bb%e5%8a%a8%e7%ab%af%e9%a6%96%e9%a1%b5%e5%89%8d%e7%ab%af%e9%80%9f%e5%ba%a6%e9%82%a3%e4%ba%9b%e4%ba%8b%e5%84%bf"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">[聊一聊系列]聊一聊百度移动端首页前端速度那些事儿</h1><div class="meta"><div class="postdate"><time datetime="2019-02-07" itemprop="datePublished">2019-02-07</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e欢迎大家收看聊一聊系列，这一套系列文章，可以帮助前端工程师们了解前端的方方面面（不仅仅是代码）：\x3ca href=\x22https:\/\/segmentfault.com\/blog\/frontenddriver\x22\x3ehttps:\/\/segmentfault.com\/blog\/frontenddriver\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e这一期，咱们一起聊一聊----百度移动端首页前端速度的那些事儿\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e1 长什么样？\x3c\/h2\x3e\n\x3cp\x3e我们的业务就是 \x3ca href=\x22https:\/\/m.baidu.com\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/m.baidu.com\x3c\/a\x3e\x3cbr\x3e别以为只有一个搜索框，我们还有下面丰富的卡片内容，可以提供各式各样的服务。如图1.1\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQon\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQon\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图1.1\x3cbr\x3e其实整个页面的逻辑相对是比较复杂的。\x3cbr\x3e还有各式各样的卡片，轻轻下拉，即可看到,如图1.2\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQos\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQos\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图1.2\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e2 面临的挑战\x3c\/h2\x3e\n\x3cp\x3e可能代码的量级没有很多webapp恐怖，可是“百度首页要秒开”却是一个共识，可以看到(如图2.1)，在利用上了缓存的情况下，我们的首页包大小gzip后只有11.1k左右。耗时也就是500多毫秒。大部分用户“秒开”不是事儿。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQoz\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQoz\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图2.1\x3c\/p\x3e\n\x3cp\x3e但是，我们的业务在不断的增长的同时，要维持这样的包大小，就是一门艺术了。\x3cbr\x3e要快，但是我们的服务也必须万无一失，（后续我会分享百度移动端首页的前端架构设计）那么这样的优化，是如何做到的呢，又如何兼顾稳定性，架构性，与速度呢？别急，让我们把这些优化一一道来。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e3 我们的业务与我们的优化\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e3.1 静态文件在哪里？\x3c\/h3\x3e\n\x3cp\x3e为了求快，首页是没有js和css外链的，这样会再发起多次请求，相信对于各位前端小能手来说，也是老生常谈的前端优化了。所以，整个首页渲染出来，只需要一次请求(除了iconfont)。其他的首屏所需要的js与css，全部在上线前，编译时，编译内联至HTML中，如图3.1.1。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQrt\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQrt\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.1.1\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e3.2 缓存！缓存！\x3c\/h3\x3e\n\x3cp\x3e然而，首页并不满足于此，首页的很多样式和脚本，需要在同步的时候就初始化，但是，如果每次都传输一些不变的静态文件或者html，实在是太浪费了，如果html\/css\/js一直不变，那直接缓存到客户端不就好了。\x3cbr\x3e于是首页的第二项优化，就展示了威力，localstorage，关于这个客户端存储，陌生的同学可以查一查。也可以直接阅读我接下来要写的聊一聊系列文章。\x3cbr\x3e我们把不变的js\/css\/html全部存储到localstorage中去，下次加载首页的时候。在特定的位置，不必再从服务端把特定位置的js\/css\/html传过来。只需要传一句话----\x22\x26lt;script\x26gt;readlocalstorage();\x26lt;\/script\x26gt;\x22就行。\x3cbr\x3e至于存储的方法，例子如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE HTML\x3e\n\x3chtml\x3e\n    \x3chead\x3e\n        \x3cmeta charset=\x26quot;utf-8\x26quot;\/\x3e\n    \x3c\/head\x3e\n    \x3cbody\x3e\n        \x3cdiv data-local=\x26quot;test1\x26quot;\x3e\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n        \x3c\/div\x3e\n        \x3cscript\x3e\n            function cacheOne(attrid) {\n                var content = document.querySelector(\x27[data-local=\x26quot;\x27 \x2b attrid \x2b \x27\x26quot;]\x27).outerHTML;\n                localStorage.setItem(attrid, content);\n            }\n            cacheOne(\x27test1\x27);\n        \x3c\/script\x3e\n    \x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE HTML\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edata-local\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22test1\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecacheOne\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eattrid\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e content = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27[data-local=\x22\x27\x3c\/span\x3e \x2b attrid \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22]\x27\x3c\/span\x3e).outerHTML;\n                localStorage.setItem(attrid, content);\n            }\n            cacheOne(\x3cspan class=\x22hljs-string\x22\x3e\x27test1\x27\x3c\/span\x3e);\n        \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们将html的内容存储到了localstorage中，如图3.2.1\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQuH\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQuH\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.2.1\x3cbr\x3e下次，再访问的时候，我们使用服务端把缓存起来的html不传送，而是只传送读取相关的js，如图3.2.2\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE HTML\x3e\n\x3chtml\x3e\n    \x3chead\x3e\n        \x3cmeta charset=\x26quot;utf-8\x26quot;\/\x3e\n    \x3c\/head\x3e\n    \x3cbody\x3e\n        \x3cscript type=\x26quot;text\/javascript\x26quot; data-local=\x26quot;test1\x26quot;\x3e\n            function readOne(attrid) {\n                var content = localStorage.getItem(attrid);\n                document.querySelector(\x27[data-local=\x26quot;\x27 \x2b attrid \x2b \x27\x26quot;]\x27).outerHTML = content;\n            }\n            readOne(\x27test1\x27);\n        \x3c\/script\x3e\n    \x3c\/body\x3e\n\x3c\/html\x3e\n\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE HTML\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\/javascript\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edata-local\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22test1\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereadOne\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eattrid\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e content = localStorage.getItem(attrid);\n                \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27[data-local=\x22\x27\x3c\/span\x3e \x2b attrid \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22]\x27\x3c\/span\x3e).outerHTML = content;\n            }\n            readOne(\x3cspan class=\x22hljs-string\x22\x3e\x27test1\x27\x3c\/span\x3e);\n        \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQuG\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQuG\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e图3.2.2\x3cbr\x3e我们看到，虽然展示内容相同，但是第二次传输的时候，页面的量明显减小。而且使用这种方式我们使用的地方越多，这种优势就越明显。\x3c\/p\x3e\n\x3cp\x3e百度移动端首页的很多css\/html\/js就是这样缓存在客户端的。\x3c\/p\x3e\n\x3cp\x3e有同学会说，那么如何知道什么时候该传读local，什么时候该传写local呢？\x3cbr\x3e很简单，我们在写入local的时候，同时在cookie中种下当前所有要缓存的内容的版本(MD5戳)就行。\x3cbr\x3e因为cookie是会在同步访问的时候，传送到服务端的，而local不会，所以，我们在服务端决定要传送内容，还是传送读取local代码。就靠我们种下的cookie了。我们在这里，使用php来做一个实验：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE HTML\x3e\n\x3chtml\x3e\n    \x3chead\x3e\n        \x3cmeta charset=\x26quot;utf-8\x26quot;\/\x3e\n    \x3c\/head\x3e\n    \x3cbody\x3e\n        \x3c?php $curversion=\x271\x27?\x3e\n        \x3c?php if ($_COOKIE[\x27localversion\x27] !== $curversion) {?\x3e \n        \x3cdiv data-local=\x26quot;test1\x26quot;\x3e\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n        \x3c\/div\x3e\n        \x3cscript\x3e\n            function cacheOne(attrid) {\n                var content = document.querySelector(\x27[data-local=\x26quot;\x27 \x2b attrid \x2b\x27\x26quot;]\x27).outerHTML\n;\n                localStorage.setItem(attrid, content);\n            }\n            cacheOne(\x27test1\x27);\n            document.cookie=\x26quot;localversion=\x3c?php echo $curversion?\x3e;\x26quot;;\n        \x3c\/script\x3e\n        \x3c?php } else {?\x3e\n            \x3cscript type=\x26quot;text\/javascript\x26quot; data-local=\x26quot;test1\x26quot;\x3e\n                function readOne(attrid) {\n                    var content = localStorage.getItem(attrid);\n                    document.querySelector(\x27[data-local=\x26quot;\x27 \x2b attrid \x2b \x27\x26quot;]\x27).outerHTML = content\n;\n                }\n                readOne(\x27test1\x27);\n            \x3c\/script\x3e\n        \x3c?php }?\x3e\n    \x3c\/body\x3e\n\x3c\/html\x3e\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE HTML\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e $curversion=\x3cspan class=\x22hljs-string\x22\x3e\x271\x27\x3c\/span\x3e\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n        \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ($_COOKIE[\x3cspan class=\x22hljs-string\x22\x3e\x27localversion\x27\x3c\/span\x3e] !== $curversion) {\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e \n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edata-local\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22test1\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n            这部分内容非常多将会缓存起来\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecacheOne\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eattrid\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e content = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27[data-local=\x22\x27\x3c\/span\x3e \x2b attrid \x2b\x3cspan class=\x22hljs-string\x22\x3e\x27\x22]\x27\x3c\/span\x3e).outerHTML\n;\n                localStorage.setItem(attrid, content);\n            }\n            cacheOne(\x3cspan class=\x22hljs-string\x22\x3e\x27test1\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.cookie=\x3cspan class=\x22hljs-string\x22\x3e\x22localversion=\x26lt;?php echo $curversion?\x26gt;;\x22\x3c\/span\x3e;\n        \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\/javascript\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edata-local\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22test1\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n                \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereadOne\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eattrid\x3c\/span\x3e) \x3c\/span\x3e{\n                    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e content = localStorage.getItem(attrid);\n                    \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27[data-local=\x22\x27\x3c\/span\x3e \x2b attrid \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22]\x27\x3c\/span\x3e).outerHTML = content\n;\n                }\n                readOne(\x3cspan class=\x22hljs-string\x22\x3e\x27test1\x27\x3c\/span\x3e);\n            \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22php\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;?php\x3c\/span\x3e }\x3cspan class=\x22hljs-meta\x22\x3e?\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们在php中判断，如果cookie中有version，证明种过cookie，写过local，所以，不用传内容了，直接传script就好了，如果没有就要传输并且写入。我们可以看到效果，同样的页面，第一次访问的时候，内容大小是1.6K，如图3.2.3\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQvz\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQvz\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.2.3\x3cbr\x3e再次刷新的时候，内容量已经减小到了474b，如图3.2.4。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQvL\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQvL\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.2.4\x3c\/p\x3e\n\x3cp\x3e如果用户的cookie和local不一致怎么办，如果用户不支持local怎么办？这些疑问其他读者自行思考一下(其实很简单)。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e3.3 外链！外链！\x3c\/h3\x3e\n\x3cp\x3e毕竟业务庞大，光首屏的那些css\/js\/html已经无法满足我们了。我们需要更多的脚本，更多的css。你可能会很轻松的想到，外链引入呗。但是，经过调研，我们发现移动端的文件缓存率非常的低(大约30%左右)。也就是说移动端的缓存环境是非常残酷的。所以，我们又开始了极限优化。我们将所有的js\/css等静态文件，通过一个接口全部返回。如图3.3.1\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQww\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQww\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.3.1\x3cbr\x3e这样可以达到合并外链请求的目的，我们又将这些静态文件，也一一缓存到localstorage中，如图3.3.2：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQwL\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQwL\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.3.2\x3cbr\x3e每个文件以自己文件内容生成的版本号为戳，标识自己的唯一性。每次服务端返回页面时，会把当前在服务器上的所有静态文件版本号，返给前端，如图3.3.3\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQxn\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQxn\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.3.3\x3cbr\x3e前端首屏加载完成后，会用这些版本号与local中进行一一对比，发现不一致的js\/css，会一起发送一个合并请求。如图3.3.1所示。这样可以保证每个文件的缓存与版本迭代。同时，也避免了过多的外链。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e3.4 DOM也缓存\x3c\/h3\x3e\n\x3cp\x3e我们的模板和数据，也会被缓存至localstorage中，，有同学可能会问，那什么东西不缓存？答案就是，变化的东西，如果有部分html与数据在刷新的时候会经常性的变动的话，这种缓存方式就失去了它的意义，\x3cstrong\x3e我们的宗旨是，不变的数据，缓存下来是可以带来信息量的不重复传输的\x3c\/strong\x3e。如图3.4.1\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQyd\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQyd\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.4.1\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e3.5 使用iconfont\x3c\/h3\x3e\n\x3cp\x3e由于我们的很多业务是不需要多彩色图的，所以这个时候，iconfont就派上了用场，在满足UE高清的需求下，可以节省大量的资源。如图3.5.1，这些icon就可以使用iconfont。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQHz\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQHz\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e图3.5.1\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e3.6 卡片的异步加载与缓存\x3c\/h3\x3e\n\x3cp\x3e随着我们的业务越来越多，我们的卡片也越来越多了，但是！！！依旧不能影响我们首页的速度。我们又开始了极限优化。首先，我们首屏也就需要2张卡片，按照市售手机的尺寸来看。我们两张卡片足够填充满首屏了。特殊情况，我们会有特殊处理（针对大屏幕手机），在用户下拉的时候，再去加载更多的卡片。这样可以节省用户流量，还能够提升首页速度。接下来，我们如法炮制，也将卡片内容(html\/css\/js)存储到了local中。异步拉取卡片的时候，如果卡片内容没有变。服务端就不要返回了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e3.7 不在首屏的就要异步化！\x3c\/h3\x3e\n\x3cp\x3e我们有很多用户功能，用户不一定每次都会用，如果上来就开始加载，必然会浪费速度与流量，于是，我们将一些“第二步操作”，只有在触发时才会进行加载。这样，保证了按需加载。\x3cbr\x3e如，我们的管理页面功能，是个点击才能进入的浮层，对于这种功能设计，就可以采用按需加载，而不是伴随首页一起加载，如图3.7.1\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyQAJ\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyQAJ\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.7.1\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e3.8 少量静态文件的域名\x3c\/h3\x3e\n\x3cp\x3e我们的logo与iconfont均是放在m.baidu.com域下的，这样节省了DNS的解析。虽然可能带来的问题是，发送图片请求的时候，会携带cookie。但是我们的cookie也是极少的。这点上性能还是有所提升的。如图3.8.1我们的logo就是在m.baidu.com域名下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyROQ\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyROQ\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.8.1\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e3.9 极小的图片base64化\x3c\/h3\x3e\n\x3cp\x3e对于小于1k的图片，我们将其变为base64编码，并融入到css中，一起换存到localstorage中去，这样即节省了网络请求，同时使图片也可以缓存到local中去了。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyRwE\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyRwE\x22 alt=\x22092041_sAB7_1177792.png\x22 title=\x22092041_sAB7_1177792.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3cbr\x3e图3.7.1\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e不要走开，请关注我。下一章，我们将继续聊聊web分辨率那些事儿。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000005884985\x22\x3ehttps:\/\/segmentfault.com\/a\/1190000005884985\x3c\/a\x3e\x3cbr\x3e原创文章，版权所有，转载请注明出处\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>[聊一聊系列]聊一聊百度移动端首页前端速度那些事儿</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005882953">https://segmentfault.com/a/1190000005882953</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/4q3y3f96tb/" target="_blank">https://alili.tech/archive/4q3y3f96tb/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>