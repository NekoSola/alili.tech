<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="精益 React 学习指南 （Lean React）- 3.4 掌控 redux 异步"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>精益 React 学习指南 （Lean React）- 3.4 掌控 redux 异步 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/h6dbr4yrxkl/",
				"appid": "1613049289050283", 
				"title": "精益 React 学习指南 （Lean React）- 3.4 掌控 redux 异步 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-08T02:30:41"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/mircczubcwc/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/5pjdwza5pc6/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fh6dbr4yrxkl%2f&text=%e7%b2%be%e7%9b%8a%20React%20%e5%ad%a6%e4%b9%a0%e6%8c%87%e5%8d%97%20%ef%bc%88Lean%20React%ef%bc%89-%203.4%20%e6%8e%8c%e6%8e%a7%20redux%20%e5%bc%82%e6%ad%a5"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fh6dbr4yrxkl%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fh6dbr4yrxkl%2f&text=%e7%b2%be%e7%9b%8a%20React%20%e5%ad%a6%e4%b9%a0%e6%8c%87%e5%8d%97%20%ef%bc%88Lean%20React%ef%bc%89-%203.4%20%e6%8e%8c%e6%8e%a7%20redux%20%e5%bc%82%e6%ad%a5"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fh6dbr4yrxkl%2f&title=%e7%b2%be%e7%9b%8a%20React%20%e5%ad%a6%e4%b9%a0%e6%8c%87%e5%8d%97%20%ef%bc%88Lean%20React%ef%bc%89-%203.4%20%e6%8e%8c%e6%8e%a7%20redux%20%e5%bc%82%e6%ad%a5"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fh6dbr4yrxkl%2f&is_video=false&description=%e7%b2%be%e7%9b%8a%20React%20%e5%ad%a6%e4%b9%a0%e6%8c%87%e5%8d%97%20%ef%bc%88Lean%20React%ef%bc%89-%203.4%20%e6%8e%8c%e6%8e%a7%20redux%20%e5%bc%82%e6%ad%a5"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%b2%be%e7%9b%8a%20React%20%e5%ad%a6%e4%b9%a0%e6%8c%87%e5%8d%97%20%ef%bc%88Lean%20React%ef%bc%89-%203.4%20%e6%8e%8c%e6%8e%a7%20redux%20%e5%bc%82%e6%ad%a5&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fh6dbr4yrxkl%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fh6dbr4yrxkl%2f&title=%e7%b2%be%e7%9b%8a%20React%20%e5%ad%a6%e4%b9%a0%e6%8c%87%e5%8d%97%20%ef%bc%88Lean%20React%ef%bc%89-%203.4%20%e6%8e%8c%e6%8e%a7%20redux%20%e5%bc%82%e6%ad%a5"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fh6dbr4yrxkl%2f&title=%e7%b2%be%e7%9b%8a%20React%20%e5%ad%a6%e4%b9%a0%e6%8c%87%e5%8d%97%20%ef%bc%88Lean%20React%ef%bc%89-%203.4%20%e6%8e%8c%e6%8e%a7%20redux%20%e5%bc%82%e6%ad%a5"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fh6dbr4yrxkl%2f&title=%e7%b2%be%e7%9b%8a%20React%20%e5%ad%a6%e4%b9%a0%e6%8c%87%e5%8d%97%20%ef%bc%88Lean%20React%ef%bc%89-%203.4%20%e6%8e%8c%e6%8e%a7%20redux%20%e5%bc%82%e6%ad%a5"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fh6dbr4yrxkl%2f&title=%e7%b2%be%e7%9b%8a%20React%20%e5%ad%a6%e4%b9%a0%e6%8c%87%e5%8d%97%20%ef%bc%88Lean%20React%ef%bc%89-%203.4%20%e6%8e%8c%e6%8e%a7%20redux%20%e5%bc%82%e6%ad%a5"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">精益 React 学习指南 （Lean React）- 3.4 掌控 redux 异步</h1><div class="meta"><div class="postdate"><time datetime="2019-02-08" itemprop="datePublished">2019-02-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000005136764\x22\x3e书籍完整目录\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3e3.4 redux 异步\x3c\/h1\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVyou8\x22 src=\x22https:\/\/static.alili.tech\/img\/bVyou8\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e在大多数的前端业务场景中，需要和后端产生异步交互，在本节中，将详细讲解 redux 中的异步方案以及一些异步第三方组件，内容有：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eredux 异步流\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eredux-thunk\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eredux-promise\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eredux-saga\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e3.4.1 redux 异步流\x3c\/h2\x3e\n\x3cp\x3e前面讲的 redux 中的数据流都是同步的，流程如下：\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eview -\x26gt; actionCreator -\x26gt; action -\x26gt; reducer -\x26gt; newState -\x26gt; container component\x3c\/code\x3e \x3cbr\x3e但同步数据不能满足真实业务开发，真实业务中异步才是主角，那如何将异步处理结合到上边的流程中呢？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e3.4.2 实现异步的方式\x3c\/h2\x3e\n\x3cp\x3e其实 redux 并未有和异步相关的概念，我们可以用任何原来实现异步的方式应用到 redux 数据流中，最简单的方式就是延迟 dispatch action，以 setTimeout 为例：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.dispatch({ type: \x27SYNC_SOME_ACTION\x27})\nwindow.setTimeout(() =\x3e {\n  this.dispatch({ type: \x27ASYNC_SOME_ACTION\x27 })\n}, 1000)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27SYNC_SOME_ACTION\x27\x3c\/span\x3e})\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27ASYNC_SOME_ACTION\x27\x3c\/span\x3e })\n}, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这种方式最简单直接，但是有如下问题：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e如果有多个类似的 action 触发场景，异步逻辑不能重用\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e异步处理代码不能统一处理，最简单的例子就是节流\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e解决上面两个问题的办法很简单，把异步的代码剥离出来：\x3c\/p\x3e\n\x3cp\x3esomeAction.js\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function dispatchSomeAction(dispatch, payload) {\n    \/\/ ..调用控制逻辑...\n    dispatch({ type: \x27SYNC_SOME_ACTION\x27})\n    window.setTimeout(() =\x3e {\n      dispatch({ type: \x27ASYNC_SOME_ACTION\x27 })\n    }, 1000)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edispatchSomeAction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch, payload\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ..调用控制逻辑...\x3c\/span\x3e\n    dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27SYNC_SOME_ACTION\x27\x3c\/span\x3e})\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27ASYNC_SOME_ACTION\x27\x3c\/span\x3e })\n    }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后组件只需要调用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import {dispatchSomeAction} from \x27someAction.js\x27\n\ndispatchSomeAction(dispatch, payload);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {dispatchSomeAction} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27someAction.js\x27\x3c\/span\x3e\n\ndispatchSomeAction(dispatch, payload);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e基于这种方式上面的流程就改为了：\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eview -\x26gt; asyncActionDispatcher -\x26gt; wait -\x26gt; action -\x26gt; reducer -\x26gt; newState -\x26gt; container component\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3easyncActionDispatcher 和 actionCreator 是十分类似的, 所以简单而言就可以把它理解为 asyncActionCreator , 所以新的流程为：\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eview -\x26gt; asyncActionCreator -\x26gt; wait -\x26gt; action -\x26gt; reducer -\x26gt; newState -\x26gt; container component\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e但是上面的方法有一些缺点\x3c\/p\x3e\n\x3cp\x3e同步调用和异步调用的方式不相同:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e同步的情况: \x3ccode\x3estore.dispatch(actionCreator(payload))\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e异步的情况: \x3ccode\x3easyncActionCreator(store.dispatch, payload)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e幸运的是在 redux 中通过 middleware 机制可以很容易的解决上面的问题\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e通过 middleware 实现异步\x3c\/h3\x3e\n\x3cp\x3e我们已经很清楚一个 middleware 的结构 ，其核心的部分为\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function(action) {\n    \/\/ 调用后面的 middleware\n    next(action)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用后面的 middleware\x3c\/span\x3e\n    next(action)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3emiddleware 完全掌控了 reducer 的触发时机， 也就是 action 到了这里完全由中间件控制，不乐意就不给其他中间件处理的机会，而且还可以控制调用其他中间件的时机。 \x3c\/p\x3e\n\x3cp\x3e举例来说一个异步的 ajax 请求场景，可以如下实现：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function (action) {\n    \/\/ async call \n    fetch(\x27....\x27)\n      .then(\n          function resolver(ret) {\n            newAction = createNewAction(ret, action)\n            next(newAction)\n          },\n          function rejector(err) {\n            rejectAction = createRejectAction(err, action)\n            next(rejectAction)\n          })\n    });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ async call \x3c\/span\x3e\n    fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27....\x27\x3c\/span\x3e)\n      .then(\n          \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolver\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eret\x3c\/span\x3e) \x3c\/span\x3e{\n            newAction = createNewAction(ret, action)\n            next(newAction)\n          },\n          \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erejector\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n            rejectAction = createRejectAction(err, action)\n            next(rejectAction)\n          })\n    });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e任何异步的 javascript 逻辑都可以，如： ajax callback, Promise, setTimeout 等等, 也可以使用 es7 的 async 和 await。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e第三方异步组件\x3c\/h3\x3e\n\x3cp\x3e上面的实现方案只是针对具体的场景设计的，那如果是如何解决通用场景下的问题呢，其实目前已经有很多第三方 redux 组件支持异步 action，其中如：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/gaearon\/redux-thunk\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-thunk\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/acdlite\/redux-promise\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-promise\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/yelouafi.github.io\/redux-saga\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-saga\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e这些组件都有很好的扩展性，完全能满足我们开发异步流程的场景，下面来一一介绍\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e3.4.3 redux-thunk\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eredux-thunk 介绍\x3c\/h3\x3e\n\x3cp\x3eredux-thunk 是 redux 官方文档中用到的异步组件，实质就是一个 redux 中间件，thunk 听起来是一个很陌生的词语，先来认识一下什么叫 thunk\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eA thunk is a function that wraps an expression to delay its evaluation.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e简单来说一个 thunk 就是一个封装表达式的函数，封装的目的是延迟执行表达式\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 1 \x2b 2 立即被计算 = 3\nlet x = 1 \x2b 2;\n\n\/\/ 1 \x2b 2 被封装在了 foo 函数内\n\/\/ foo 可以被延迟执行\n\/\/ foo 就是一个 thunk \nlet foo = () =\x3e 1 \x2b 2;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1 \x2b 2 立即被计算 = 3\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e x = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1 \x2b 2 被封装在了 foo 函数内\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ foo 可以被延迟执行\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ foo 就是一个 thunk \x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e foo = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eredux-thunk 是一个通用的解决方案，其核心思想是让 action 可以变为一个 thunk ，这样的话:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e同步情况：dispatch(action)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e异步情况：dispatch(thunk)\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e我们已经知道了 thunk 本质上就是一个函数，函数的参数为 dispatch, 所以一个简单的 thunk 异步代码就是如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.dispatch(function (dispatch){\n    setTimeout(() =\x3e {\n       dispatch({type: \x27THUNK_ACTION\x27}) \n    }, 1000)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dispatch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e)\x3c\/span\x3e{\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n       dispatch({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27THUNK_ACTION\x27\x3c\/span\x3e}) \n    }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e之前已经讲过，这样的设计会导致异步逻辑放在了组件中，解决办法为抽象出一个 asyncActionCreator, 这里也一样，我们就叫 thunkActionCreator 吧，上面的例子可以改为:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/actions\/someThunkAction.js\nexport function createThunkAction(payload) {\n    return function(dispatch) {\n        setTimeout(() =\x3e {\n           dispatch({type: \x27THUNK_ACTION\x27, payload: payload}) \n        }, 1000)\n    }\n}\n\n\/\/ someComponent.js\nthis.dispatch(createThunkAction(payload))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/actions\/someThunkAction.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateThunkAction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epayload\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) \x3c\/span\x3e{\n        setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n           dispatch({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27THUNK_ACTION\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: payload}) \n        }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ someComponent.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dispatch(createThunkAction(payload))\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e安装和使用\x3c\/h3\x3e\n\x3cp\x3e第一步：安装\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ npm install redux-thunk\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cmake\x22\x3e\x3ccode class=\x22shell\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e$ npm \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e redux-thunk\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第二步: 添加 thunk 中间件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { createStore, applyMiddleware } from \x27redux\x27;\nimport thunk from \x27redux-thunk\x27;\nimport rootReducer from \x27.\/reducers\/index\x27;\n\nconst store = createStore(\n  rootReducer,\n  applyMiddleware(thunk)\n);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { createStore, applyMiddleware } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e thunk \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-thunk\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e rootReducer \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/reducers\/index\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e store = createStore(\n  rootReducer,\n  applyMiddleware(thunk)\n);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第三步：实现一个 thunkActionCreator\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/actions\/someThunkAction.js\nexport function createThunkAction(payload) {\n    return function(dispatch) {\n        setTimeout(() =\x3e {\n           dispatch({type: \x27THUNK_ACTION\x27, payload: payload}) \n        }, 1000)\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/actions\/someThunkAction.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateThunkAction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epayload\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) \x3c\/span\x3e{\n        setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n           dispatch({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27THUNK_ACTION\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: payload}) \n        }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第三步：组件中 dispatch thunk\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.dispatch(createThunkAction(payload));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dispatch(createThunkAction(payload));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e拥有 dispatch 方法的组件为 redux 中的 container component\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3ethunk 源码\x3c\/h3\x3e\n\x3cp\x3e说了这么多，redux-thunk 是不是做了很多工作，实现起来很复杂，那我们来看看 thunk 中间件的实现\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function createThunkMiddleware(extraArgument) {\n  return ({ dispatch, getState }) =\x3e next =\x3e action =\x3e {\n    if (typeof action === \x27function\x27) {\n      return action(dispatch, getState, extraArgument);\n    }\n\n    return next(action);\n  };\n}\n\nconst thunk = createThunkMiddleware();\nthunk.withExtraArgument = createThunkMiddleware;\n\nexport default thunk;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateThunkMiddleware\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eextraArgument\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ dispatch, getState }\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e next =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e action === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e action(dispatch, getState, extraArgument);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(action);\n  };\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e thunk = createThunkMiddleware();\nthunk.withExtraArgument = createThunkMiddleware;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e thunk;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e就这么简单，只有 14 行源码，但是这简短的实现却能完成复杂的异步处理，怎么做到的，我们来分析一下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3cp\x3e判断如果 action 是 function 那么执行 action(dispatch, getState, ...)\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3eaction 也就是一个 thunk\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e执行 action 相当于执行了异步逻辑\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3eaction 中执行 dispatch\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e开始新的 redux 数据流，重新回到最开始的逻辑（thunk 可以嵌套的原因）\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e把执行的结果作为返回值直接返回\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e直接返回并没有调用其他中间件，也就意味着中间件的执行在这里停止了\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e可以对返回值做处理（后面会讲如果返回值是 Promise 的情况）\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果不是函数直接调用其他中间件并返回\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e理解了这个过后是不是对 redux-thunk 的使用思路变得清晰了\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3ethunk 的组合\x3c\/h3\x3e\n\x3cp\x3e根据 redux-thunk 的特性，可以做出很有意思的事情\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e可以递归的 dispatch(thunk) =\x26gt; 实现 thunk 的组合；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ethunk 运行结果会作为 dispatch返回值 =\x26gt; 利用返回值为 Promise 可以实现多个 thunk 的编排;\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3ethunk 组合例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function thunkC() {\n    return function(dispatch) {\n        dispatch(thunkB())\n    }\n}\nfunction thunkB() {\n    return function (dispatch) {\n        dispatch(thunkA())\n    }\n}\nfunction thunkA() {\n    return function (dispatch) {\n        dispatch({type: \x27THUNK_ACTION\x27})\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ethunkC\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) \x3c\/span\x3e{\n        dispatch(thunkB())\n    }\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ethunkB\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) \x3c\/span\x3e{\n        dispatch(thunkA())\n    }\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ethunkA\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) \x3c\/span\x3e{\n        dispatch({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27THUNK_ACTION\x27\x3c\/span\x3e})\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ePromise 例子\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function ajaxCall() {\n    return fetch(...);\n}\n\nfunction thunkC() {\n    return function(dispatch) {\n        dispatch(thunkB(...))\n        .then(\n            data =\x3e dispatch(thunkA(data)),\n            err  =\x3e dispatch(thunkA(err))\n        )\n    }\n}\nfunction thunkB() {\n    return function (dispatch) {\n        return ajaxCall(...)\n    }\n}\n\nfunction thunkA() {\n    return function (dispatch) {\n        dispatch({type: \x27THUNK_ACTION\x27})\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eajaxCall\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fetch(...);\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ethunkC\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) \x3c\/span\x3e{\n        dispatch(thunkB(...))\n        .then(\n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e dispatch(thunkA(data)),\n            err  =\x26gt; dispatch(thunkA(err))\n        )\n    }\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ethunkB\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e ajaxCall(...)\n    }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ethunkA\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) \x3c\/span\x3e{\n        dispatch({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27THUNK_ACTION\x27\x3c\/span\x3e})\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e3.4.4 redux-promise\x3c\/h2\x3e\n\x3cp\x3e另外一个 redux 文档中提到的异步组件为 redux-promise, 我们直接分析一下其源码吧\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { isFSA } from \x27flux-standard-action\x27;\n\nfunction isPromise(val) {\n  return val \x26amp;\x26amp; typeof val.then === \x27function\x27;\n}\n\nexport default function promiseMiddleware({ dispatch }) {\n  return next =\x3e action =\x3e {\n    if (!isFSA(action)) {\n      return isPromise(action)\n        ? action.then(dispatch)\n        : next(action);\n    }\n\n    return isPromise(action.payload)\n      ? action.payload.then(\n          result =\x3e dispatch({ ...action, payload: result }),\n          error =\x3e {\n            dispatch({ ...action, payload: error, error: true });\n            return Promise.reject(error);\n          }\n        )\n      : next(action);\n  };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { isFSA } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27flux-standard-action\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eisPromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eval\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e val \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e val.then === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epromiseMiddleware\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ dispatch }\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e =\x26gt;\x3c\/span\x3e action =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!isFSA(action)) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e isPromise(action)\n        ? action.then(dispatch)\n        : next(action);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e isPromise(action.payload)\n      ? action.payload.then(\n          \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e =\x26gt;\x3c\/span\x3e dispatch({ ...action, \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: result }),\n          error =\x26gt; {\n            dispatch({ ...action, \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: error, \x3cspan class=\x22hljs-attr\x22\x3eerror\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e });\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(error);\n          }\n        )\n      : next(action);\n  };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e大概的逻辑就是：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e如果不是标准的 flux action，那么判断是否是 promise, 是执行 action.then(dispatch)，否执行 next(action)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果是标准的 flux action, 判断 payload 是否是 promise，是的话 payload.then 获取数据，然后把数据作为 payload 重新 dispatch({ ...action, payload: result}) , 否执行 next(action)\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e结合 redux-promise 可以利用 es7 的 async 和 await 语法，简化异步的 promiseActionCreator 的设计， eg:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export default async (payload) =\x3e {\n  const result = await somePromise;\n  return {\n    type: \x26quot;PROMISE_ACTION\x26quot;,\n    payload: result.someValue;\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (payload) =\x26gt; {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e somePromise;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22PROMISE_ACTION\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: result.someValue;\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果对 es7 async 语法不是很熟悉可以看下面两个例子：\x3c\/p\x3e\n\x3col\x3e\x3cli\x3e\x3cp\x3easync 关键字可以总是返回一个 Promise 的 resolve 结果或者 reject 结果\x3c\/p\x3e\x3c\/li\x3e\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22async function foo() {\n    if(true)\n        return \x27Success!\x27;\n    else\n        throw \x27Failure!\x27;\n}\n\n\/\/ 等价于\n \nfunction foo() {\n    if(true)\n        return Promise.resolve(\x27Success!\x27);\n    else\n        return Promise.reject(\x27Failure!\x27);\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efoo\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Success!\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Failure!\x27\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 等价于\x3c\/span\x3e\n \n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efoo\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27Success!\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(\x3cspan class=\x22hljs-string\x22\x3e\x27Failure!\x27\x3c\/span\x3e);\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\x3cli\x3e\x3cp\x3e在 async 关键字中可以使用 await 关键字，其目的是 await 一个 promise， 等待 promise resolve 和 reject\x3c\/p\x3e\x3c\/li\x3e\x3c\/ol\x3e\n\x3cp\x3eeg：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22async function foo(aPromise) {\n    const a = await new Promise(function(resolve, reject) {\n            \/\/ This is only an example to create asynchronism\n            window.setTimeout(\n                function() {\n                    resolve({a: 12});\n                }, 1000);\n        })\n    console.log(a.a)\n    return  a.a\n}\n\n\/\/ in console\n\x3e foo() \n\x3e Promise {_c: Array[0], _a: undefined, _s: 0, _d: false, _v: undefined…}\n\x3e 12\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efoo\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaPromise\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e a = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ This is only an example to create asynchronism\x3c\/span\x3e\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.setTimeout(\n                \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n                    resolve({\x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e});\n                }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n        })\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(a.a)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e  a.a\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ in console\x3c\/span\x3e\n\x26gt; foo() \n\x26gt; \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e {\x3cspan class=\x22hljs-attr\x22\x3e_c\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e], \x3cspan class=\x22hljs-attr\x22\x3e_a\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3e_s\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3e_d\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3e_v\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e…}\n\x26gt; \x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以看到在控制台中，先返回了一个 promise，然后输出了 12\x3c\/p\x3e\n\x3cp\x3easync 关键字可以极大的简化异步流程的设计，避免 callback 和 thennable 的调用，看起来和同步代码一致。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e3.4.5 redux-saga\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3eredux-saga 介绍\x3c\/h3\x3e\n\x3cp\x3eredux-saga 也是解决 redux 异步 action 的一个中间件，不过和之前的设计有本质的不同\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3eredux-saga 完全基于 Es6 的 Generator Function\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e不使用 actionCreator 策略，而是通过监控 action, 然后在自动做处理\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e所有带副作用的操作（异步代码，不确定的代码）都被放到 saga 中\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e那到底什么是 saga\x3c\/h3\x3e\n\x3cp\x3eredux-saga 实际也没有解释什么叫 saga ，通过引用的参考：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eThe term saga is commonly used in discussions of CQRS to refer to a piece of code that coordinates and routes messages between bounded contexts and aggregates.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e这个定义的核心就是 \x3cstrong\x3eCQRS-查询与责任分离\x3c\/strong\x3e ，对应到 redux-sage 就是 action 与 处理函数的分离。 实际上在 redux-saga 中，一个 saga 就是一个 Generator 函数。\x3c\/p\x3e\n\x3cp\x3eeg:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { takeEvery, takeLatest } from \x27redux-saga\x27\nimport { call, put } from \x27redux-saga\/effects\x27\nimport Api from \x27...\x27\n\n\/*\n * 一个 saga 就是一个 Generator Function \n *\n * 每当 store.dispatch `USER_FETCH_REQUESTED` action 的时候都会调用 fetchUser.\n *\/\nfunction* mySaga() {\n  yield* takeEvery(\x26quot;USER_FETCH_REQUESTED\x26quot;, fetchUser);\n}\n\n\/**\n * worker saga： 真正处理 action 的 saga\n *  \n * USER_FETCH_REQUESTED action 触发时被调用\n * @param {[type]} action  [description]\n * @yield {[type]} [description]\n *\/\nfunction* fetchUser(action) {\n   try {\n      const user = yield call(Api.fetchUser, action.payload.userId);\n      yield put({type: \x26quot;USER_FETCH_SUCCEEDED\x26quot;, user: user});\n   } catch (e) {\n      yield put({type: \x26quot;USER_FETCH_FAILED\x26quot;, message: e.message});\n   }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { takeEvery, takeLatest } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { call, put } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\/effects\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Api \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/*\n * 一个 saga 就是一个 Generator Function \n *\n * 每当 store.dispatch `USER_FETCH_REQUESTED` action 的时候都会调用 fetchUser.\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3emySaga\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e* takeEvery(\x3cspan class=\x22hljs-string\x22\x3e\x22USER_FETCH_REQUESTED\x22\x3c\/span\x3e, fetchUser);\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * worker saga： 真正处理 action 的 saga\n *  \n * USER_FETCH_REQUESTED action 触发时被调用\n * @param {[type]} action  [description]\n * @yield {[type]} [description]\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3efetchUser\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n   \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e user = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(Api.fetchUser, action.payload.userId);\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22USER_FETCH_SUCCEEDED\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: user});\n   } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22USER_FETCH_FAILED\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: e.message});\n   }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e一些基本概念\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3ewatcher saga\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e负责编排和派发任务的 saga\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eworker saga\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e真正负责处理 action 的函数\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3esaga helper\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e如上面例子中的 takeEvery，简单理解就是用于监控 action 并派发 action 到 worker saga 的辅助函数 \x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eEffect\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3eredux-saga 完全基于 Generator 构建，saga 逻辑的表达是通过 yield javascript 对象来实现，这些对象就是Effects。\x3c\/p\x3e\n\x3cp\x3e这些对象相当于描述任务的规范化数据（任务如执行异步函数，dispatch action 到一个 store），这些数据被发送到 redux-saga 中间件中执行，如：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eput({type: \x22USER_FETCH_SUCCEEDED\x22, user: user})\x3c\/code\x3e 表示要执行 \x3ccode\x3edispatch(\x22{{\x22type: \x22USER_FETCH_SUCCEEDED\x22, user: user\x22}}\x22)\x3c\/code\x3e 任务\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ecall(fetch, url)\x3c\/code\x3e 表示要执行 \x3ccode\x3efetch(url)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e通过这种 effect 的抽象，可以避免 call 和 dispatch 的立即执行，而是描述要执行什么任务，这样的话就很容易对 saga 进行测试，saga 所做的事情就是将这些 effect 编排起来用于描述任务，真正的执行都会放在 middleware 中执行。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e安装和使用\x3c\/h3\x3e\n\x3cp\x3e第一步：安装\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ npm install --save redux-saga\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sql\x22\x3e\x3ccode class=\x22shell\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e$ npm \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e--save redux-saga\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第二步：添加 saga 中间件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { createStore, applyMiddleware } from \x27redux\x27\nimport createSagaMiddleware from \x27redux-saga\x27\n\nimport reducer from \x27.\/reducers\x27\nimport mySaga from \x27.\/sagas\x27\n\n\/\/ 创建 saga 中间件\nconst sagaMiddleware = createSagaMiddleware()\n\n\/\/ 添加到中间件中\nconst store = createStore(\n  reducer,\n  applyMiddleware(sagaMiddleware)\n)\n\n\/\/ 立即运行 saga ，让监控器开始监控\nsagaMiddleware.run(mySaga)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { createStore, applyMiddleware } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e createSagaMiddleware \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e reducer \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/reducers\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e mySaga \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/sagas\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建 saga 中间件\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e sagaMiddleware = createSagaMiddleware()\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加到中间件中\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e store = createStore(\n  reducer,\n  applyMiddleware(sagaMiddleware)\n)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 立即运行 saga ，让监控器开始监控\x3c\/span\x3e\nsagaMiddleware.run(mySaga)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第三步：定义 sagas\/index.js\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { takeEvery } from \x27redux-saga\x27\nimport { put } from \x27redux-saga\/effects\x27\n\nexport const delay = ms =\x3e new Promise(resolve =\x3e setTimeout(resolve, ms))\n\n\/\/ 将异步执行 increment 任务\nexport function* incrementAsync() {\n  yield delay(1000)\n  yield put({ type: \x27INCREMENT\x27 })\n}\n\n\/\/ 在每个 INCREMENT_ASYNC action 调用后，派生一个新的 incrementAsync 任务\nexport default function* watchIncrementAsync() {\n  yield* takeEvery(\x27INCREMENT_ASYNC\x27, incrementAsync)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { takeEvery } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { put } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\/effects\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e delay = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ems\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e setTimeout(resolve, ms))\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将异步执行 increment 任务\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3eincrementAsync\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e delay(\x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27INCREMENT\x27\x3c\/span\x3e })\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在每个 INCREMENT_ASYNC action 调用后，派生一个新的 incrementAsync 任务\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatchIncrementAsync\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e* takeEvery(\x3cspan class=\x22hljs-string\x22\x3e\x27INCREMENT_ASYNC\x27\x3c\/span\x3e, incrementAsync)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第四步：组件中调用\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.dispatch({type: \x27INCREMENT_ASYNC\x27})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dispatch({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27INCREMENT_ASYNC\x27\x3c\/span\x3e})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eredux-saga 基于 Generator 有很多高级的特性， 如：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e基于 take Effect 实现更自由的任务编排\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efork 和 cancel 实现非阻塞任务\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e并行任何和 race 任务\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3esaga 组合 ，yield* saga\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cblockquote\x3e\x3cp\x3e因篇幅有限，这部分内容在下一篇讲解\x3c\/p\x3e\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>精益 React 学习指南 （Lean React）- 3.4 掌控 redux 异步</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005773725">https://segmentfault.com/a/1190000005773725</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/h6dbr4yrxkl/" target="_blank">https://alili.tech/archive/h6dbr4yrxkl/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>