<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="【译】WebAssembly 初尝"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>【译】WebAssembly 初尝 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/r4i0ifpfql8/",
				"appid": "1613049289050283", 
				"title": "【译】WebAssembly 初尝 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-05T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/jr43973oj4d/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/bgmd1ickzwh/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fr4i0ifpfql8%2f&text=%e3%80%90%e8%af%91%e3%80%91WebAssembly%20%e5%88%9d%e5%b0%9d"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fr4i0ifpfql8%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fr4i0ifpfql8%2f&text=%e3%80%90%e8%af%91%e3%80%91WebAssembly%20%e5%88%9d%e5%b0%9d"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fr4i0ifpfql8%2f&title=%e3%80%90%e8%af%91%e3%80%91WebAssembly%20%e5%88%9d%e5%b0%9d"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fr4i0ifpfql8%2f&is_video=false&description=%e3%80%90%e8%af%91%e3%80%91WebAssembly%20%e5%88%9d%e5%b0%9d"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e3%80%90%e8%af%91%e3%80%91WebAssembly%20%e5%88%9d%e5%b0%9d&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fr4i0ifpfql8%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fr4i0ifpfql8%2f&title=%e3%80%90%e8%af%91%e3%80%91WebAssembly%20%e5%88%9d%e5%b0%9d"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fr4i0ifpfql8%2f&title=%e3%80%90%e8%af%91%e3%80%91WebAssembly%20%e5%88%9d%e5%b0%9d"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fr4i0ifpfql8%2f&title=%e3%80%90%e8%af%91%e3%80%91WebAssembly%20%e5%88%9d%e5%b0%9d"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fr4i0ifpfql8%2f&title=%e3%80%90%e8%af%91%e3%80%91WebAssembly%20%e5%88%9d%e5%b0%9d"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">【译】WebAssembly 初尝</h1><div class="meta"><div class="postdate"><time datetime="2019-02-05" itemprop="datePublished">2019-02-05</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e本文转载自：\x3ca href=\x22http:\/\/www.zcfy.cc\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e众成翻译\x3c\/a\x3e\x3cbr\x3e译者：\x3ca href=\x22http:\/\/www.zcfy.cc\/@wemlin\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e文蔺\x3c\/a\x3e\x3cbr\x3e链接：\x3ca href=\x22http:\/\/www.zcfy.cc\/article\/1031\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.zcfy.cc\/article\/1031\x3c\/a\x3e\x3cbr\x3e原文：\x3ca href=\x22http:\/\/cultureofdevelopment.com\/blog\/build-your-first-thing-with-web-assembly\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/cultureofdevelopment.com\/blog\/build-your-first-thing-with-web-assembly\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3e拖拖拉拉好久，终于把个人博客整出来了。鸣谢 \x3ca href=\x22http:\/\/pinggod.com\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e@pinggod\x3c\/a\x3e。厚着脸安利一下，地址是 \x3ca href=\x22http:\/\/www.wemlion.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.wemlion.com\/\x3c\/a\x3e。欢迎访问，欢迎收藏。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e头一次听说 \x3ca href=\x22https:\/\/webassembly.github.io\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebAssembly\x3c\/a\x3e 的时候就觉得很酷，然后就超兴奋地开始尝试。但从一开始尝试的过程就不顺利，越来越让人灰心。本文的目的就是解决问题，让你免受困扰。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006760513\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006760513\x22 alt=\x22beware of cliff\x22 title=\x22beware of cliff\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e读者须知\x3c\/h3\x3e\n\x3cp\x3e本文写作于 2016 年 6 月 24 日。WebAssembly 是一项很新的、不稳定的技术；随着其标准化过程发展，本文中的任何内容都可能是错误的。\x3c\/p\x3e\n\x3cp\x3e不过先不管了....\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3eWebAssembly 是什么\x3c\/h3\x3e\n\x3cp\x3e好吧，官网是这么描述的：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eWebAssembly，或者称作 wasm，是一项适用于 Web 编译的可移植的、体积与加载高效的格式。（WebAssembly or wasm is a new portable, size- and load-time-efficient format suitable for compilation to the web.）\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e嗯...什么鬼？什么格式？文本（Text）？二进制（Binary）？老实说，这个描述真糟糕。所以不管它，收起那些 binggo 游戏卡（buzzword bingo cards，一种填词游戏，这些词通常都是流行语，阅读\x3ca href=\x22https:\/\/en.wikipedia.org\/wiki\/Buzzword_bingo\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/en.wikipedia.org\/wiki\/Buzzword_bingo\x3c\/a\x3e了解更多 —— 译者注），根据我所有的经验来描述吧：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eWebAssembly\/wasm 是用来编写高性能的、浏览器无关的 Web 组件的一种字节码规范。（WebAssembly or wasm is a bytecode specification for writing performant, browser agnostic web components.）\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e有此妙语，听起来超棒，但仍然没 get 到点，接下来重点来了。WebAssembly 通过静态类型变量实现性能提升，运行时静态类型变量引用比动态类型变量更有效率。WebAssembly 由 \x3ca href=\x22https:\/\/www.w3.org\/community\/webassembly\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eW3C Community Group\x3c\/a\x3e 制定，最终将被所有规范兼容的浏览器支持。还有杀手锏，\x3cem\x3e最终\x3c\/em\x3e我们可以使用\x3cem\x3e任何\x3c\/em\x3e语言编写这些 Web 组件（web components）。\x3c\/p\x3e\n\x3cp\x3e听起来酷了很多，不是么？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e一起开始吧\x3c\/h3\x3e\n\x3cp\x3e学习新东西的时候，我通常会找尽可能最简单的例子来看它是如何工作的。不幸的是，对 WebAssembly 来说，这不太现实。在当前阶段，wasm 仅仅只是字节码规范。想象回到 1996 年，假如太阳公司（Sun Microsystems）的一些工程师们带来了 JVM，但却...没有 Java....若果真如此，我想当时的对话可能是这样的：\x3c\/p\x3e\n\x3cp\x3e—— “伙计们，快来看看我们做的这个执行字节码的虚拟机！”\x3cbr\x3e—— “真棒！但我们给它怎么写代码？”\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006760514\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006760514\x22 alt=\x22HelloWorld.class\x22 title=\x22HelloWorld.class\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3e图：字节码形式的 HelloWorld\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e—— “嗯..这问题提得好。等会儿我查查看。”\x3cbr\x3e—— “真棒，如果遇到了任何问题，告诉我们你的想法，在我们的 github page 上贴出来。”\x3cbr\x3e—— “你说对啦。我们现在先去看看其他项目。”\x3c\/p\x3e\n\x3cp\x3e这个例子有些糟糕，因为 JVM 是基于 Java 语言的；尽管如此，希望你还是 get 到点了。如果都没有将代码编译为字节码的工具，要起步就很困难了。那我们要怎么开始？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3eWebAssembly 之前有什么\x3c\/h3\x3e\n\x3cp\x3e多数技术都是创新的结果，特别是当合理的尝试成为正式规范时。wasm 也不例外，它实际上是 \x3ca href=\x22http:\/\/asmjs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3easm.js\x3c\/a\x3e 的工作的延续， asm.js 是一个编写 javascript 组件的的规范，可编译为静态类型。wasm 的规范拓展了这些创意，它接受任何语言编译而成的字节码，这些字节码作为二进制文件而非文本文件通过网络传输；规范由很多来自主流浏览器厂商的代表们一起制定，而非仅仅是 Mozilla。\x3c\/p\x3e\n\x3cp\x3easm.js 仅仅是一个使用 javascript 语言特征的最小子集编写 javascript 的规范。你可以手写一些简单的 asm.js 代码，如果你想弄脏你的手，这正是极好的方式。（等会儿最好将这放在单独的文件中，通常约定文件名格式为 \x3ccode\x3eyour-module-name.asm.js\x3c\/code\x3e。）)\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function MyMathModule(global) {\n    \x26quot;use asm\x26quot;;\n    var exp = global.Math.exp;\n    function doubleExp(value) {\n        value = \x2bvalue;\n        return \x2b(\x2bexp(\x2bvalue) * 2.0);\n    }\n    return { doubleExp: doubleExp };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eMyMathModule\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eglobal\x3c\/span\x3e) \x3c\/span\x3e{\n\x3cspan class=\x22hljs-meta\x22\x3e    \x22use asm\x22\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e exp = global.Math.exp;\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edoubleExp\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        value = \x2bvalue;\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x2b(\x2bexp(\x2bvalue) * \x3cspan class=\x22hljs-number\x22\x3e2.0\x3c\/span\x3e);\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3edoubleExp\x3c\/span\x3e: doubleExp };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这还不是一个特别有用的函数，但符合规范。如果你觉得这很二，别人也是这么觉得的，不过基本上每一个字符都是必须的。在这当中，一元运算符 \x3ccode\x3e\x2b\x3c\/code\x3e 的作用是类型注解，这样编译器会知道那些变量是 double 类型的，运行时就不必再次分辨它们是什么。它相当挑剔，如果你把什么地方弄得一团糟，火狐控制台会给你一些合理的错误信息。\x3c\/p\x3e\n\x3cp\x3e如果你想在浏览器中使用，像下面这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var myMath = new MyMathModule(window);\nfor(var i = 0; i \x3c 5; i\x2b\x2b) {\n    console.log(myMath.doubleExp(i));\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lisp\x22\x3e\x3ccode\x3evar myMath = new MyMathModule(\x3cspan class=\x22hljs-name\x22\x3ewindow\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\nfor(\x3cspan class=\x22hljs-name\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e; i \x26lt; 5; i\x2b\x2b) {\x3c\/span\x3e\n    console.log(\x3cspan class=\x22hljs-name\x22\x3emyMath\x3c\/span\x3e.doubleExp(\x3cspan class=\x22hljs-name\x22\x3ei\x3c\/span\x3e))\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e一切正常的话，结果大概像下图这样：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006760515\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006760515\x22 alt=\x22asm.js success\x22 title=\x22asm.js success\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e开始尝试 WebAssembly\x3c\/h3\x3e\n\x3cp\x3e现在我们已经有了一个可以工作的 asm.js 代码片段，可以使用 \x3ca href=\x22https:\/\/github.com\/WebAssembly\/binaryen\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebAssembly github page\x3c\/a\x3e 提供的工具将其编译为 wasm。自己克隆代码仓库构建工具吧。这最麻烦了。这些工具一直在不断发展，代码会时不时挂掉，特别是在 Windows 环境下。\x3c\/p\x3e\n\x3cp\x3e不管你是用 Windows 还是 Mac，电脑上必须要安装 make 和 cmake 命令行工具。如果你在使用 Windows，你还需要安装 Visual Studio 2015。Mac 用户按照\x3ca href=\x22https:\/\/github.com\/WebAssembly\/binaryen#building\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里的说明\x3c\/a\x3e 操作；Windows 用户按照\x3ca href=\x22https:\/\/github.com\/brakmic\/brakmic\/blob\/master\/webassembly\/COMPILING_WIN32.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这个说明\x3c\/a\x3e操作。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006579439\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006579439\x22 alt=\x22building binaryen\x22 title=\x22building binaryen\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3e图： Windows 下的工具构建\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e对 WebAssembly 团队来说，发布可以工作的二进制文件意味着朝着正确的方向前进了一大步。\x3c\/p\x3e\n\x3cp\x3e构建成功之后，binaryen 目录下会有一个 bin 文件夹，其中有一些用来将 asm.js 转换为 wasm 的工具。第一个工具是 \x3ccode\x3easm2wasm.exe\x3c\/code\x3e。它将 asm.js 代码转换为 \x3ccode\x3e.s\x3c\/code\x3e 格式的代码，这些代码是生成 wasm 所需的抽象语法树（AST）的文本表现形式。运行工具，最终会得到类似下面的东西：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22(module\n  (memory 256 256)\n  (export \x26quot;memory\x26quot; memory)\n  (type $FUNCSIG$dd (func (param f64) (result f64)))\n  (import $exp \x26quot;global.Math\x26quot; \x26quot;exp\x26quot; (param f64) (result f64))\n  (export \x26quot;doubleExp\x26quot; $doubleExp)\n  (func $doubleExp (param $0 f64) (result f64)\n    (f64.mul\n      (call_import $exp\n        (get_local $0)\n      )\n      (f64.const 2)\n    )\n  )\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clojure\x22\x3e\x3ccode\x3e(\x3cspan class=\x22hljs-name\x22\x3emodule\x3c\/span\x3e\n  (\x3cspan class=\x22hljs-name\x22\x3ememory\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e256\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e256\x3c\/span\x3e)\n  (\x3cspan class=\x22hljs-name\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22memory\x22\x3c\/span\x3e memory)\n  (\x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-builtin-name\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e $FUNCSIG$dd (\x3cspan class=\x22hljs-name\x22\x3efunc\x3c\/span\x3e (\x3cspan class=\x22hljs-name\x22\x3eparam\x3c\/span\x3e f64) (\x3cspan class=\x22hljs-name\x22\x3eresult\x3c\/span\x3e f64)))\n  (\x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-builtin-name\x22\x3eimport\x3c\/span\x3e\x3c\/span\x3e $exp \x3cspan class=\x22hljs-string\x22\x3e\x22global.Math\x22\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22exp\x22\x3c\/span\x3e (\x3cspan class=\x22hljs-name\x22\x3eparam\x3c\/span\x3e f64) (\x3cspan class=\x22hljs-name\x22\x3eresult\x3c\/span\x3e f64))\n  (\x3cspan class=\x22hljs-name\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22doubleExp\x22\x3c\/span\x3e $doubleExp)\n  (\x3cspan class=\x22hljs-name\x22\x3efunc\x3c\/span\x3e $doubleExp (\x3cspan class=\x22hljs-name\x22\x3eparam\x3c\/span\x3e $\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e f64) (\x3cspan class=\x22hljs-name\x22\x3eresult\x3c\/span\x3e f64)\n    (\x3cspan class=\x22hljs-name\x22\x3ef64.mul\x3c\/span\x3e\n      (\x3cspan class=\x22hljs-name\x22\x3ecall_import\x3c\/span\x3e $exp\n        (\x3cspan class=\x22hljs-name\x22\x3eget_local\x3c\/span\x3e $\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\n      )\n      (\x3cspan class=\x22hljs-name\x22\x3ef64.const\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)\n    )\n  )\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e以后我们可以逐行分析上面的代码，但现在我只想让你看下它的样子。我还得提醒你一点，因为 wasm 是二进制格式的，所以像你今天对 javascript 所做的那样右击、查看源码是行不通的。从头到尾都是二进制码。目前的计划是查看 wasm 模块源码时对二进制格式进行反汇编，让人能读懂。\x3c\/p\x3e\n\x3cp\x3e接下来要做的是使用 \x3ccode\x3ewasm-as.exe\x3c\/code\x3e 将 \x3ccode\x3e.s\x3c\/code\x3e 格式的代码转换为 wasm 二进制码。运行文件，最后就能得到浏览器需要的真正的 wasm 二进制码。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006760516\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006760516\x22 alt=\x22building wasm from asm.js\x22 title=\x22building wasm from asm.js\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3e图：将 asm.js 转换为 wasm 二进制码\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006579467\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006579467\x22 alt=\x22wasm bytecode\x22 title=\x22wasm bytecode\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3e图：wasm 二进制码\x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e紧接着，安装最新版的 \x3ca href=\x22https:\/\/www.mozilla.org\/en-US\/firefox\/new\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eFirefox\x3c\/a\x3e 或 \x3ca href=\x22https:\/\/www.google.com\/chrome\/browser\/canary.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eChrome Canary\x3c\/a\x3e，并启用 WebAssembly。\x3c\/p\x3e\n\x3cp\x3e如果你使用的是 Firefox，在地址栏中输入 \x3ccode\x3eabout:config\x3c\/code\x3e，点击“确认我会保证小心”。然后在搜索框中输入 \x3ccode\x3ewasm\x3c\/code\x3e，双击 \x3ccode\x3ejavascript.options.wasm\x3c\/code\x3e 将值设置为 true，然后重启浏览器。\x3c\/p\x3e\n\x3cp\x3e如果你使用的是 Chrome Canary，打开 \x3ccode\x3echrome:\/\/flags\x3c\/code\x3e，往下翻，找到 \x3ccode\x3eExperimental WebAssembly\x3c\/code\x3e，点击“启用”链接，再重启浏览器。\x3c\/p\x3e\n\x3cp\x3e最后一步就是让模块在浏览器中跑起来。初次尝试时，这又是一大痛点，完全不知道怎么做。在规范中使用 wasm 模块的 API 一点都没找到。最后我在 Canary 的控制台上输入 \x3ccode\x3eWebAsse\x3c\/code\x3e，并没有任何提示。接着输入 \x3ccode\x3eWas\x3c\/code\x3e 的时候，提示出来了！控制台上打印出的对象大概最简陋的文档了，不过这时候我突然想到，可以用一些其他工具 (emscripten) 将代码编译为 wasm。不过这是另外一篇博客的话题了。\x3c\/p\x3e\n\x3cp\x3e一段时间之后，鼠标落在了 WebAssembly 的设计文档仓库上。我看到了一个名为 \x3ca href=\x22https:\/\/github.com\/WebAssembly\/design\/blob\/master\/JS.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eJS.md\x3c\/a\x3e 的文件，点击之后，有一个 API 的说明。仔细看顶部斜体的文字。但最精彩的部分还是最底部的代码片段，演示了如何最低限度地加载模块。我所需要做的就是拆出相关部分进行尝试。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22fetch(\x26quot;my-math-module.wasm\x26quot;)\n    .then(function(response) {\n        return response.arrayBuffer();\n    })\n    .then(function(buffer) {\n        var dependencies = {\n            \x26quot;global\x26quot;: {},\n            \x26quot;env\x26quot;: {}\n        };\n        dependencies[\x26quot;global.Math\x26quot;] = window.Math;\n        var moduleBufferView = new Uint8Array(buffer);\n        var myMathModule = Wasm.instantiateModule(moduleBufferView, dependencies);\n        console.log(myMathModule.exports.doubleExp);\n        for(var i = 0; i \x3c 5; i\x2b\x2b) {\n            console.log(myMathModule.exports.doubleExp(i));\n        }\n    });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3efetch(\x3cspan class=\x22hljs-string\x22\x3e\x22my-math-module.wasm\x22\x3c\/span\x3e)\n    .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e response.arrayBuffer();\n    })\n    .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ebuffer\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dependencies = {\n            \x3cspan class=\x22hljs-string\x22\x3e\x22global\x22\x3c\/span\x3e: {},\n            \x3cspan class=\x22hljs-string\x22\x3e\x22env\x22\x3c\/span\x3e: {}\n        };\n        dependencies[\x3cspan class=\x22hljs-string\x22\x3e\x22global.Math\x22\x3c\/span\x3e] = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.Math;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e moduleBufferView = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eUint8Array\x3c\/span\x3e(buffer);\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e myMathModule = Wasm.instantiateModule(moduleBufferView, dependencies);\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(myMathModule.exports.doubleExp);\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e; i\x2b\x2b) {\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(myMathModule.exports.doubleExp(i));\n        }\n    });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e把代码放到 html 文件中，\x3ca href=\x22https:\/\/www.npmjs.com\/package\/local-web-server\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e启动本地文件服务器\x3c\/a\x3e，在浏览器中加载页面。下面是在浏览器中的结果：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006579497\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006579497\x22 alt=\x22wasm in a browser\x22 title=\x22wasm in a browser\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3e浏览器中运行的 wasm （至少尝试运行了） \x3c\/em\x3e\x3c\/p\x3e\n\x3cp\x3e我估计需要去提交一个 bug 报告了。记着，一切都是实验性的、不稳定的，所以当此类事情发生的时候，别灰心丧气。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006579513\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006579513\x22 alt=\x22keep calm and file bug reports\x22 title=\x22keep calm and file bug reports\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e恭喜你\x3c\/h3\x3e\n\x3cp\x3e你已经完成了第一个 WebAssembly 组件。接下来做些什么？目前我们碰到的还只是皮毛而已。在本例中手写 asm.js 很重要，但需要时间和耐心。使用 emscripten 将应用转换为 asm.js 要简单多了。关于这一点，我强烈建议你阅读 asm.js 规范，特别是内存模型的部分，因为其中的许多概念都被迁移到 WebAssembly 上了。另外一个怪异的事情是，目前还不能直接将数组作为函数参数。人们已经达成共识，这需要改变，但规范中尚未有关于这一点的。去看看指针逻辑吧。\x3c\/p\x3e\n\x3cp\x3e还有一点，在 wasm 中做一些工作的时候，你可能发展实际上 WebAssembly 还没普通的 javascript 运行得快。记住，现代的 javascript 引擎已经是高度优化的，wasm 要赶上这速度还需要时间。WebAssembly 还尚未进入准备生产的阶段。\x3c\/p\x3e\n\x3cp\x3e如果你有任何关于 wasm 或者本文中提到的工具的问题，在 \x3ca href=\x22http:\/\/stackoverflow.com\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eStack Overflow\x3c\/a\x3e 中提出来，记得标上恰当的 tag。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>【译】WebAssembly 初尝</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006575460">https://segmentfault.com/a/1190000006575460</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/r4i0ifpfql8/" target="_blank">https://alili.tech/archive/r4i0ifpfql8/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>