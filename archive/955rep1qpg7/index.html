<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React PureComponent 源码解析"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React PureComponent 源码解析 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/955rep1qpg7/",
				"appid": "1613049289050283", 
				"title": "React PureComponent 源码解析 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-04T02:30:58"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/hwwqrkrspyq/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/8fecd83u42n/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f955rep1qpg7%2f&text=React%20PureComponent%20%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f955rep1qpg7%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f955rep1qpg7%2f&text=React%20PureComponent%20%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f955rep1qpg7%2f&title=React%20PureComponent%20%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f955rep1qpg7%2f&is_video=false&description=React%20PureComponent%20%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%20PureComponent%20%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f955rep1qpg7%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f955rep1qpg7%2f&title=React%20PureComponent%20%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f955rep1qpg7%2f&title=React%20PureComponent%20%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f955rep1qpg7%2f&title=React%20PureComponent%20%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f955rep1qpg7%2f&title=React%20PureComponent%20%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React PureComponent 源码解析</h1><div class="meta"><div class="postdate"><time datetime="2019-02-04" itemprop="datePublished">2019-02-04</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3eTL;DR\x3c\/h2\x3e\n\x3cp\x3eReact 15.3.0 新增了一个 \x3ccode\x3ePureComponent\x3c\/code\x3e 类，以 ES2015 class 的方式方便地定义纯组件 (pure component)。这篇文章分析了一下源码实现，并衍生探讨了下 \x3ccode\x3eshallowCompare\x3c\/code\x3e 和 \x3ccode\x3ePureRenderMixin\x3c\/code\x3e。相关的 GitHub PR 在 \x3ca href=\x22https:\/\/github.com\/facebook\/react\/pull\/7195\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e 。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3ePureComponent 源码分析\x3c\/h2\x3e\n\x3cp\x3e这个类的用法很简单，如果你有些组件是纯组件，那么把继承类从 \x3ccode\x3eComponent\x3c\/code\x3e 换成 \x3ccode\x3ePureComponent\x3c\/code\x3e 即可。当组件更新时，如果组件的 \x3ccode\x3eprops\x3c\/code\x3e 和 \x3ccode\x3estate\x3c\/code\x3e 都没发生改变，render 方法就不会触发，省去 Virtual DOM 的生成和比对过程，达到提升性能的目的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React, { PureComponent } from \x27react\x27\n\nclass Example extends PureComponent {\n  render() {\n    \/\/ ...\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React, { PureComponent } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eExample\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ePureComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ePureComponent\x3c\/code\x3e 自身的源码也很简单，节选如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function ReactPureComponent(props, context, updater) {\n  \/\/ Duplicated from ReactComponent.\n  this.props = props;\n  this.context = context;\n  this.refs = emptyObject;\n  \/\/ We initialize the default updater but the real one gets injected by the\n  \/\/ renderer.\n  this.updater = updater || ReactNoopUpdateQueue;\n}\n\nfunction ComponentDummy() {}\nComponentDummy.prototype = ReactComponent.prototype;\nReactPureComponent.prototype = new ComponentDummy();\nReactPureComponent.prototype.constructor = ReactPureComponent;\n\/\/ Avoid an extra prototype jump for these methods.\nObject.assign(ReactPureComponent.prototype, ReactComponent.prototype);\nReactPureComponent.prototype.isPureReactComponent = true;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReactPureComponent\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eprops, context, updater\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Duplicated from ReactComponent.\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props = props;\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context = context;\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.refs = emptyObject;\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ We initialize the default updater but the real one gets injected by the\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ renderer.\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.updater = updater || ReactNoopUpdateQueue;\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponentDummy\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{}\nComponentDummy.prototype = ReactComponent.prototype;\nReactPureComponent.prototype = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ComponentDummy();\nReactPureComponent.prototype.constructor = ReactPureComponent;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Avoid an extra prototype jump for these methods.\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.assign(ReactPureComponent.prototype, ReactComponent.prototype);\nReactPureComponent.prototype.isPureReactComponent = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面的 \x3ccode\x3eReactPureComponent\x3c\/code\x3e 就是暴露给外部使用的 \x3ccode\x3ePureComponent\x3c\/code\x3e 。可以看到它只是继承了 \x3ccode\x3eReactComponent\x3c\/code\x3e 再设定了一下 \x3ccode\x3eisPureReactComponent\x3c\/code\x3e 属性。\x3ccode\x3eComponentDummy\x3c\/code\x3e 是典型的 JavaScript 原型模拟继承的做法，对此有疑惑的可以看 \x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000003798438#articleHeader2\x22\x3e我的另一篇文章\x3c\/a\x3e 。另外，为了避免原型链拉长导致方法查找的性能开销，还用 \x3ccode\x3eObject.assign\x3c\/code\x3e 把方法从 \x3ccode\x3eReactComponent\x3c\/code\x3e 拷贝过来了。\x3c\/p\x3e\n\x3cp\x3e跟 \x3ccode\x3ePureRenderMixin\x3c\/code\x3e 不一样的是，这里完全没有实现 \x3ccode\x3eshouldComponentUpdate\x3c\/code\x3e。那 \x3ccode\x3ePureComponent\x3c\/code\x3e 的 props\/state 比对是在哪里做的呢？答案是 \x3ccode\x3eReactCompositeComponent\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eReactCompositeComponent\x3c\/code\x3e 这个类的信息太少，我只能推测它是负责实际渲染并维护组件实例的对象。建议大家从高层次了解 React 对组件的更新机制即可。以下几篇官方文档看完就足够了。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/facebook.github.io\/react\/docs\/advanced-performance.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAdvanced Performance\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/facebook.github.io\/react\/docs\/reconciliation.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReconciliation\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/facebook.github.io\/react\/docs\/glossary.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReact (Virtual) DOM Terminology\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e这个类的代码改动很多，但关键就在 \x3ca href=\x22https:\/\/github.com\/facebook\/react\/pull\/7195\/files#diff-6363300a479c9057729248ca9dd3e7b6R873\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e 。下面是我简化后的代码片段：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 定义 CompositeTypes\nvar CompositeTypes = {\n  ImpureClass: 0,         \/\/ 继承自 Component 的组件\n  PureClass: 1,           \/\/ 继承自 PureComponent 的组件\n  StatelessFunctional: 2, \/\/ 函数组件\n};\n\n\/\/ 省略一堆代码，因为加入了 CompositeTypes 造成的调整\n\n\/\/ 这个变量用来控制组件是否需要更新\nvar shouldUpdate = true;\n\n\/\/ inst 是组件实例\nif (inst.shouldComponentUpdate) {\n  shouldUpdate = inst.shouldComponentUpdate(nextProps, nextState, nextContext);\n} else {\n  if (this._compositeType === CompositeType.PureClass) {\n    \/\/ 用 shallowEqual 对比 props 和 state 的改动\n    \/\/ 如果都没改变就不用更新\n    shouldUpdate =\n      !shallowEqual(prevProps, nextProps) ||\n      !shallowEqual(inst.state, nextState);\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 定义 CompositeTypes\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e CompositeTypes = {\n  \x3cspan class=\x22hljs-attr\x22\x3eImpureClass\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,         \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 继承自 Component 的组件\x3c\/span\x3e\n  PureClass: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,           \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 继承自 PureComponent 的组件\x3c\/span\x3e\n  StatelessFunctional: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 函数组件\x3c\/span\x3e\n};\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 省略一堆代码，因为加入了 CompositeTypes 造成的调整\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这个变量用来控制组件是否需要更新\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e shouldUpdate = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ inst 是组件实例\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (inst.shouldComponentUpdate) {\n  shouldUpdate = inst.shouldComponentUpdate(nextProps, nextState, nextContext);\n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._compositeType === CompositeType.PureClass) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用 shallowEqual 对比 props 和 state 的改动\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果都没改变就不用更新\x3c\/span\x3e\n    shouldUpdate =\n      !shallowEqual(prevProps, nextProps) ||\n      !shallowEqual(inst.state, nextState);\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e简而言之，\x3ccode\x3eReactCompositeComponent\x3c\/code\x3e 会在 mount 的时候判断各个组件的类型，设定 \x3ccode\x3e_compositeType\x3c\/code\x3e ，然后根据这个类型来判断是非需要更新组件。这个 PR 中大部分改动都是 因为加了 \x3ccode\x3eCompositeTypes\x3c\/code\x3e 而做的调整性工作，实际跟 \x3ccode\x3ePureComponent\x3c\/code\x3e 有关的就是 \x3ccode\x3eshallowEqual\x3c\/code\x3e 的那两行。\x3c\/p\x3e\n\x3cp\x3e关于 \x3ccode\x3ePureComponent\x3c\/code\x3e 的源码分析就到这里。其他的就都是细节和测试，有兴趣的可以自己看看 PR 。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3eshallowEqual, shallowCompare, PureRenderMixin 的联系\x3c\/h2\x3e\n\x3cp\x3e我们知道在 \x3ccode\x3ePureComponent\x3c\/code\x3e 出现之前，\x3ccode\x3eshallowCompare\x3c\/code\x3e 和 \x3ccode\x3ePureRenderMixin\x3c\/code\x3e 都可以做一样的事情。于是好奇看了一下后两者的代码。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eshallowCompare\x3c\/code\x3e 的源码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var shallowEqual = require(\x27shallowEqual\x27);\n\nfunction shallowCompare(instance, nextProps, nextState) {\n  return (\n    !shallowEqual(instance.props, nextProps) ||\n    !shallowEqual(instance.state, nextState)\n  );\n}\n\nmodule.exports = shallowCompare;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e shallowEqual = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27shallowEqual\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eshallowCompare\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3einstance, nextProps, nextState\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n    !shallowEqual(instance.props, nextProps) ||\n    !shallowEqual(instance.state, nextState)\n  );\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = shallowCompare;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ePureRenderMixin\x3c\/code\x3e 的源码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var shallowCompare = require(\x27shallowCompare\x27);\n\nvar ReactComponentWithPureRenderMixin = {\n  shouldComponentUpdate: function(nextProps, nextState) {\n    return shallowCompare(this, nextProps, nextState);\n  },\n};\n\nmodule.exports = ReactComponentWithPureRenderMixin;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e shallowCompare = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27shallowCompare\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ReactComponentWithPureRenderMixin = {\n  \x3cspan class=\x22hljs-attr\x22\x3eshouldComponentUpdate\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enextProps, nextState\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e shallowCompare(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, nextProps, nextState);\n  },\n};\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = ReactComponentWithPureRenderMixin;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以看到，\x3ccode\x3eshallowCompare\x3c\/code\x3e 依赖 \x3ccode\x3eshallowEqual\x3c\/code\x3e ，做的是跟刚才在 \x3ccode\x3eReactCompositeComponent\x3c\/code\x3e 里一样的事情 -- 对比 props 和 state 。这个工具函数一般配合组件的 \x3ccode\x3eshouldComponentUpdate\x3c\/code\x3e 一起使用，而这就是 \x3ccode\x3ePureRenderMixin\x3c\/code\x3e 做的事情。不过 \x3ccode\x3ePureRenderMixin\x3c\/code\x3e 是配合 \x3ccode\x3eReact.createClass\x3c\/code\x3e 这种老的组件定义方式使用的，在 ES2015 class 里用起来不是很方便，这也是 \x3ccode\x3ePureComponent\x3c\/code\x3e 诞生的原因之一。\x3c\/p\x3e\n\x3cp\x3e最后 \x3ccode\x3eshallowEqual\x3c\/code\x3e 这玩意定义在哪里呢？它其实不是 React 的一部分，而是 \x3ca href=\x22https:\/\/github.com\/facebook\/fbjs\/blob\/master\/packages\/fbjs\/src\/core\/shallowEqual.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3efbjs 的一部分\x3c\/a\x3e。这是 Facebook 内部使用的一个工具集。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e小结\x3c\/h2\x3e\n\x3cp\x3eReact 之前一直没有针对 ES2015 class 的纯组件写法，虽然自己实现起来并不麻烦，但这也算给出了一个官方的解决方案，可以不再依赖 addon 了。不过 \x3ccode\x3ePureComponent\x3c\/code\x3e 也不是万能的，特定情况下自己实现 \x3ccode\x3eshouldComponentUpdate\x3c\/code\x3e 可能更高效。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e参考资料\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/facebook\/react\/pull\/7195\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePureComponent PR\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/facebook\/fbjs\/blob\/master\/packages\/fbjs\/src\/core\/shallowEqual.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eshallowEqual\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/facebook.github.io\/react\/docs\/shallow-compare.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eShallow Compare\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/facebook.github.io\/react\/docs\/pure-render-mixin.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePureRenderMixin\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React PureComponent 源码解析</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006741060">https://segmentfault.com/a/1190000006741060</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/955rep1qpg7/" target="_blank">https://alili.tech/archive/955rep1qpg7/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>