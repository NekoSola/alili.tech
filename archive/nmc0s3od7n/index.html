<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="定时器在大型web项目中的应用和实现"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>定时器在大型web项目中的应用和实现 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/nmc0s3od7n/",
				"appid": "1613049289050283", 
				"title": "定时器在大型web项目中的应用和实现 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-12T02:30:12"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/a2cplwzfqb/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/899c5heqyxi/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fnmc0s3od7n%2f&text=%e5%ae%9a%e6%97%b6%e5%99%a8%e5%9c%a8%e5%a4%a7%e5%9e%8bweb%e9%a1%b9%e7%9b%ae%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e5%92%8c%e5%ae%9e%e7%8e%b0"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fnmc0s3od7n%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fnmc0s3od7n%2f&text=%e5%ae%9a%e6%97%b6%e5%99%a8%e5%9c%a8%e5%a4%a7%e5%9e%8bweb%e9%a1%b9%e7%9b%ae%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e5%92%8c%e5%ae%9e%e7%8e%b0"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fnmc0s3od7n%2f&title=%e5%ae%9a%e6%97%b6%e5%99%a8%e5%9c%a8%e5%a4%a7%e5%9e%8bweb%e9%a1%b9%e7%9b%ae%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e5%92%8c%e5%ae%9e%e7%8e%b0"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fnmc0s3od7n%2f&is_video=false&description=%e5%ae%9a%e6%97%b6%e5%99%a8%e5%9c%a8%e5%a4%a7%e5%9e%8bweb%e9%a1%b9%e7%9b%ae%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e5%92%8c%e5%ae%9e%e7%8e%b0"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%ae%9a%e6%97%b6%e5%99%a8%e5%9c%a8%e5%a4%a7%e5%9e%8bweb%e9%a1%b9%e7%9b%ae%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e5%92%8c%e5%ae%9e%e7%8e%b0&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fnmc0s3od7n%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fnmc0s3od7n%2f&title=%e5%ae%9a%e6%97%b6%e5%99%a8%e5%9c%a8%e5%a4%a7%e5%9e%8bweb%e9%a1%b9%e7%9b%ae%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e5%92%8c%e5%ae%9e%e7%8e%b0"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fnmc0s3od7n%2f&title=%e5%ae%9a%e6%97%b6%e5%99%a8%e5%9c%a8%e5%a4%a7%e5%9e%8bweb%e9%a1%b9%e7%9b%ae%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e5%92%8c%e5%ae%9e%e7%8e%b0"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fnmc0s3od7n%2f&title=%e5%ae%9a%e6%97%b6%e5%99%a8%e5%9c%a8%e5%a4%a7%e5%9e%8bweb%e9%a1%b9%e7%9b%ae%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e5%92%8c%e5%ae%9e%e7%8e%b0"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fnmc0s3od7n%2f&title=%e5%ae%9a%e6%97%b6%e5%99%a8%e5%9c%a8%e5%a4%a7%e5%9e%8bweb%e9%a1%b9%e7%9b%ae%e4%b8%ad%e7%9a%84%e5%ba%94%e7%94%a8%e5%92%8c%e5%ae%9e%e7%8e%b0"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">定时器在大型web项目中的应用和实现</h1><div class="meta"><div class="postdate"><time datetime="2019-02-12" itemprop="datePublished">2019-02-12</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e在大规模分布式系统中，每个业务都可能是集群，每个业务机都会产生定时任务，不同的业务会有不同的任务管理需求，统一的任务调度和管理变得非常有必要。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e定时如何准确，大量的定时被同时触发怎么办？\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e定时结束的时候，怎么通知业务机去处理呢？\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e某台业务机下线了怎么办？\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如何提供任务更新、删除功能？\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e基本模型如下图：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVt1UQ\x22 src=\x22https:\/\/static.alili.tech\/img\/bVt1UQ\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e定时器在社会中有着广泛的应用，比如每天叫你起床的闹钟。在软件项目中，定时器也被应用到了各方各面，本文将从 web 项目入手，讲述定时器，本文的例子都以 \x3ccode\x3enode\x3c\/code\x3e 为例。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e为什么要用定时器？\x3c\/h2\x3e\n\x3cp\x3e没有什么比机器更加准时！在我接触单片机的时候，已经开始感叹，为什么机器时间可以做到这么准！\x3c\/p\x3e\n\x3cp\x3e比如文章的定时发布、商品的准点开始抢购、活动定时上下架，肯定不会是一个又一个管理员在后台帮你点击按钮，完成操作！系统的准时可以定位到毫秒级，虽然每个用户可能和服务器的时间不一致，秒级的差别还是在可接受范围的，但是在某些领域也会有很多精细到毫秒级的定时任务需求，比如航空航天、定时炸弹等等。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e定时器总类\x3c\/h2\x3e\n\x3cp\x3e定时器有两种 \x3ccode\x3einterval\x3c\/code\x3e、\x3ccode\x3etimeout\x3c\/code\x3e, 对应重复任务和一次性任务。在我的理解里，interval 任务只是在 timeout 的时候再次注册了本任务。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 重复性任务\nvar timer = setInterval(function(){\n \/\/ do something\n}, milliseconds)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重复性任务\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e timer = setInterval(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e{\n \x3cspan class=\x22hljs-comment\x22\x3e\/\/ do something\x3c\/span\x3e\n}, milliseconds)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 一次性任务\nvar timer = setTimeout(function(){\n \/\/ do something\n}, milliseconds)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 一次性任务\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e timer = setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e{\n \x3cspan class=\x22hljs-comment\x22\x3e\/\/ do something\x3c\/span\x3e\n}, milliseconds)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3eunix crontab 能解决问题吗？\x3c\/h2\x3e\n\x3cp\x3ecrontab 并不能精确到秒，crontab 的最小粒度是分，即当第一位是「*\/1」时，即最小单位是每分钟执行，（不排除你们有奇淫技巧可以做到秒级控制的）。unix 本身支持强大的定时任务管理 crontab，定时的格式也是强大得令人惊叹。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22* * * * * *\n┬ ┬ ┬ ┬ ┬ ┬\n│ │ │ │ │ |\n│ │ │ │ │ └ day of week (0 - 7) (0 or 7 is Sun)\n│ │ │ │ └───── month (1 - 12)\n│ │ │ └────────── day of month (1 - 31)\n│ │ └─────────────── hour (0 - 23)\n│ └──────────────────── minute (0 - 59)\n└───────────────────────── second (0 - 59, optional)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3e* * * * * *\n┬ ┬ ┬ ┬ ┬ ┬\n│ │ │ │ │ |\n│ │ │ │ │ └ day of week (\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e - \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e) (\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e or \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e is Sun)\n│ │ │ │ └───── month (\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e - \x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e)\n│ │ │ └────────── day of month (\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e - \x3cspan class=\x22hljs-number\x22\x3e31\x3c\/span\x3e)\n│ │ └─────────────── hour (\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e - \x3cspan class=\x22hljs-number\x22\x3e23\x3c\/span\x3e)\n│ └──────────────────── minute (\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e - \x3cspan class=\x22hljs-number\x22\x3e59\x3c\/span\x3e)\n└───────────────────────── second (\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e - \x3cspan class=\x22hljs-number\x22\x3e59\x3c\/span\x3e, optional)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e1）Cron 表达式的格式：秒 分 时 日 月 周 年 (可选)。\x3c\/p\x3e\n\x3cp\x3e字段名 允许的值 允许的特殊字符 \x3cbr\x3e 秒 0-59 , - * \/ \x3cbr\x3e 分 0-59 , - * \/ \x3cbr\x3e 小时 0-23 , - * \/ \x3cbr\x3e 日 1-31 , - * ? \/ L W C \x3cbr\x3e 月 1-12 or JAN-DEC , - * \/ \x3cbr\x3e 周几 1-7 or SUN-SAT , - * ? \/ L C # \x3cbr\x3e 年 (可选字段) empty, 1970-2099 , - * \/\x3c\/p\x3e\n\x3cp\x3e「?」字符：表示不确定的值\x3c\/p\x3e\n\x3cp\x3e「,」字符：指定数个值\x3c\/p\x3e\n\x3cp\x3e「-」字符：指定一个值的范围\x3c\/p\x3e\n\x3cp\x3e「\/」字符：指定一个值的增加幅度。n\/m 表示从 n 开始，每次增加 m\x3c\/p\x3e\n\x3cp\x3e「L」字符：用在日表示一个月中的最后一天，用在周表示该月最后一个星期 X\x3c\/p\x3e\n\x3cp\x3e「W」字符：指定离给定日期最近的工作日 (周一到周五)\x3c\/p\x3e\n\x3cp\x3e「#」字符：表示该月第几个周 X。6#3 表示该月第 3 个周五\x3c\/p\x3e\n\x3ch4\x3eCron 表达式范例：\x3c\/h4\x3e\n\x3cp\x3e每隔 5 秒执行一次：\x3cem\x3e\/5 \x3c\/em\x3e \x3cem\x3e \x3c\/em\x3e * ?\x3c\/p\x3e\n\x3cp\x3e每隔 1 分钟执行一次：0 \x3cem\x3e\/1 \x3c\/em\x3e \x3cem\x3e \x3c\/em\x3e ?\x3c\/p\x3e\n\x3cp\x3e每天 23 点执行一次：0 0 23 \x3cem\x3e \x3c\/em\x3e ?\x3c\/p\x3e\n\x3cp\x3e每天凌晨 1 点执行一次：0 0 1 \x3cem\x3e \x3c\/em\x3e ?\x3c\/p\x3e\n\x3cp\x3e每月 1 号凌晨 1 点执行一次：0 0 1 1 * ?\x3c\/p\x3e\n\x3cp\x3e每月最后一天 23 点执行一次：0 0 23 L * ?\x3c\/p\x3e\n\x3cp\x3e每周星期天凌晨 1 点实行一次：0 0 1 ? * L\x3c\/p\x3e\n\x3cp\x3e在 26 分、29 分、33 分执行一次：0 26,29,33 \x3cem\x3e \x3c\/em\x3e * ?\x3c\/p\x3e\n\x3cp\x3e每天的 0 点、13 点、18 点、21 点都执行一次：0 0 0,13,18,21 \x3cem\x3e \x3c\/em\x3e ?\x3c\/p\x3e\n\x3cp\x3e每种开发语言都提供了 crontab 的相关封装，让开发者调用起来得心应手。以 \x3ccode\x3enode\x3c\/code\x3e 为例：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nrequire(\x27crontab\x27).load(function(err, crontab) {\n \/\/ create with string expression\n var job = crontab.create(\x27ls -la\x27, \x270 7 * * 1,2,3,4,5\x27);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lua\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27crontab\x27\x3c\/span\x3e).\x3cspan class=\x22hljs-built_in\x22\x3eload\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(err, crontab)\x3c\/span\x3e\x3c\/span\x3e {\n \/\/ \x3cspan class=\x22hljs-built_in\x22\x3ecreate\x3c\/span\x3e with string expression\n var job = crontab.\x3cspan class=\x22hljs-built_in\x22\x3ecreate\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27ls -la\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x270 7 * * 1,2,3,4,5\x27\x3c\/span\x3e);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e你在 github 搜索 \x3ca href=\x22https:\/\/github.com\/search?q=crontab\x26amp;type=Repositories\x26amp;utf8=%E2%9C%93\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecrontab\x3c\/a\x3e 能搜到主流语言的实现。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e有个问题，定时器不准时!\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3esetInterval 的回调函数并不是到时后立即执行，而是等系统计算资源空闲下来后才会执行。而下一次触发时间则是在 setInterval 回调函数执行完毕之后才开始计时，所以如果 setInterval 内执行的计算过于耗时，或者有其他耗时任务在执行,setInterval 的计时会越来越不准, 延迟很厉害。crontab 也是同样的原理。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var startTime = new Date().getTime();\nvar count = 0;\n\/\/耗时任务\nsetInterval(function(){\n var i = 0;\n while(i\x2b\x2b \x3c 100000000);\n}, 0);\nsetInterval(function(){\n count\x2b\x2b;\n console.log(new Date().getTime() - (startTime \x2b count * 1000));\n}, 1000);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e startTime = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().getTime();\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e count = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/耗时任务\x3c\/span\x3e\nsetInterval(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(i\x2b\x2b \x26lt; \x3cspan class=\x22hljs-number\x22\x3e100000000\x3c\/span\x3e);\n}, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\nsetInterval(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n count\x2b\x2b;\n \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().getTime() - (startTime \x2b count * \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e));\n}, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e结果\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22126\n176\n163\n112\n109\n107\n203\n189\n170\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-number\x22\x3e126\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e176\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e163\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e112\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e109\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e107\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e203\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e189\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e170\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当然，不排除你们有奇淫技巧可以做到秒级控制的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e成千上万定时任务时怎么管理？\x3c\/h2\x3e\n\x3cp\x3eCrontab 存在任务上限（其实我也不知道上限是多少，知道的麻烦告诉我），任务的同步、备份管理都比较麻烦，也会有比较多的并发问题需要处理。在分布式系统中，单独去部署一个定时任务机器也是可行的。不过任务调度、定时结束通知客户端也需要蛮多工作量的。\x3c\/p\x3e\n\x3cp\x3eunix 的 crontab 不再是我们的第一选择，每种编程可能都有定时任务管理的相关框架。比如 java 的 Quartz，Python 的 APScheduler。nodejs 的 node-schedule。但是这些东西是否能真的满足你的需求呢？\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eSo，我们需要一个定时任务管理平台。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e思路和实现\x3c\/h2\x3e\n\x3cp\x3e目标\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e业务方可以定义定时时间、时间结束的触发任务\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e业务方可以更新或者删除已经发布的定时任务\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e定时任务管理平台统一接收和调度任务\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e主要解决两个问题:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e设置准确的定时时间\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e时间结束触发客户端，不能重复消费\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3eredis 在 2.8.X 版本可以开启了键空间通知，更多相关请移步 \x3ca href=\x22http:\/\/redis.io\/topics\/notifications\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eRedis Keyspace Notifications\x3c\/a\x3e。（默认不开启,3.x 版本好像就失效了。），redis 支持的很多键空间事件，比如：\x3ccode\x3eDEL\x3c\/code\x3e,\x3ccode\x3eRENAME\x3c\/code\x3e,\x3ccode\x3eEXPIRE\x3c\/code\x3e等等，redis 本身可以定义某个键的过期时间，\x3ca href=\x22http:\/\/redis.io\/commands\/ttl\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ettl key\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e这个值正好用来设置为定时任务的时间。更多相关请移步 \x3ca href=\x22http:\/\/redis.io\/topics\/notifications\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eRedis Keyspace Notifications\x3c\/a\x3e。如果客户端订阅了某种规则的键通知，比如过期，那么在某个键过期的时候就会收到一个通知，这个事件就是定时结束，可以告诉业务机可以开启任务了。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e 可如果有多个 redis 客户端订阅了某个键的过期时间，那么任务还是会被触发很多次。\x3c\/strong\x3e 因为每个客户端\x3cbr\x3e都是平等的，你能订阅，我同样可以订阅。解决办法就是 \x3cstrong\x3e生产者和消费者模式\x3c\/strong\x3e。同一个过期消息只能被消费一次。\x3c\/p\x3e\n\x3ch4\x3e重点来了\x3c\/h4\x3e\n\x3cp\x3e把所有的定时任务按照定时开启的时间倒序排列，存入 sorted Sets , 把时间设置为 score。这样就会形成一个按照时间排好序的集合，可以按照时间先后依次取出所有的任务，需要新增和修改任务，也是可以通过 redis 的命令实现的。\x3c\/p\x3e\n\x3cp\x3e定时管理服务器每 1000ms 去取 sorted sets 顶部的数据，如果获取到的 task 离触发小于 1s，那么就可以执行 pop() 操作，表示这个任务开始被调度执行，因为 redis 的 pop() 是原子性的，同一个 task 永远只会被消费一次。这样就解决了 redis 键空间通知会被重复消费的问题。\x3c\/p\x3e\n\x3cp\x3e伪代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var taskSorts = new Sets(task1, task2, task3); \/\/ 在 redis 中建立按时间排序的集合\n\n\/\/ 每隔一秒执行一下操作，\nvar newOne = taskSorts.zrank(-1); \/\/ 获取到最快发生的任务\nif(newOne.time \x3c 1000){ \/\/ 如果满足消费条件\n newOne = taskSorts.pop(); \/\/ 消费该任务，重复此循环，继续消费下一个任务\n setTimeout(function(){\n \/\/ dosomething\n }, newOne.time)\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e taskSorts = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eSets\x3c\/span\x3e(task1, task2, task3); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在 redis 中建立按时间排序的集合\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 每隔一秒执行一下操作，\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eOne\x3c\/span\x3e = taskSorts.zrank(\x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取到最快发生的任务\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eOne\x3c\/span\x3e.time \x26lt; \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e){ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果满足消费条件\x3c\/span\x3e\n \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eOne\x3c\/span\x3e = taskSorts.pop(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 消费该任务，重复此循环，继续消费下一个任务\x3c\/span\x3e\n setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(){\n \x3cspan class=\x22hljs-comment\x22\x3e\/\/ dosomething\x3c\/span\x3e\n }, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eOne\x3c\/span\x3e.time)\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e任务触发\x3c\/h4\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e任务的提交和触发都应该在业务方完成。定时任务管理平台只是帮助管理和调度任务。在定义的任务里面定义好任务执行的回调参数和接口。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e客户端定义任务的时候，同时注册好定时结束的回调接口，或者应该在项目启动的时候，就注册好所有回调的接口。因为同一个业务的 A 机器提交了任务，触发的时候可能 A 机器下线了，只能定时任务平台只能去触发业务 A 的 B 机器了。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e引入跨服务远程调用。业务和定时任务管理平台可能不在同一个机器，可能分布在不同的 ip。听起来很复杂，实际上跨语言的调用调用方式有很多，比如 REST API、消息队列、RPC。我的团队选择了 Thrift（Facebook 开源的，跨语言的，现在共享给了 Apache 基金）。以上的方式都可以实现任务只被触发了一次，远程通知给客户端（任务注册方）。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch4\x3e成品 -- nodejs 的实现 cron-redis\x3c\/h4\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/MZMonster\/cron-redis\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/MZMonster\/cron-redis\x3c\/a\x3e\x3cbr\x3e主要依赖 bull 实现了任务队列的管理功能实现的定时任务管理工具。\x3c\/p\x3e\n\x3cp\x3edemo:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 就这样定义，3 秒钟之后，hello 函数将被执行。\nfunction hello (x, y){\n console.log(new Date());\n console.log(x \x2b \x27 \x2b \x27\x2b y \x2b\x27 = %s\x27, x\x2by);\n}\n\n\/\/ 我是一个任务\nvar task1 = {\n method: hello.name, \/\/ 任务回调的函数\n params: [2, 3], \/\/ 任务执行的参数\n rule: moment().add(3, \x27s\x27).toDate() \/\/ 任务执行间隔，支持 crontab 格式\n}\n\nqueue.register(hello)\nqueue.publish(task1);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 就这样定义，3 秒钟之后，hello 函数将被执行。\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehello\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ex, y\x3c\/span\x3e)\x3c\/span\x3e{\n \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e());\n \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(x \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 \x2b \x27\x3c\/span\x3e\x2b y \x2b\x3cspan class=\x22hljs-string\x22\x3e\x27 = %s\x27\x3c\/span\x3e, x\x2by);\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 我是一个任务\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e task1 = {\n \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: hello.name, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 任务回调的函数\x3c\/span\x3e\n params: [\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e], \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 任务执行的参数\x3c\/span\x3e\n rule: moment().add(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27s\x27\x3c\/span\x3e).toDate() \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 任务执行间隔，支持 crontab 格式\x3c\/span\x3e\n}\n\nqueue.register(hello)\nqueue.publish(task1);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果你要求不高，unix 自带的 crontab 也足够你折腾了。使用 redis 来实现定时也是一种极好的思路，\x3ca href=\x22https:\/\/github.com\/MZMonster\/cron-redis\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecron-redis\x3c\/a\x3e 值得你去试一试。\x3c\/p\x3e\n\x3cp\x3e该库只是一个定时任务的库，实际上可以通过以上的思路实现微服务————定时任务管理平台。通过 cron-redis 组合远程服务调用 thrift、服务的注册发现工具 zookeeper，定时任务管理平台分分钟就被搭建了（等我下一篇文章吧，分分钟搭建微服务）。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>定时器在大型web项目中的应用和实现</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000004736079">https://segmentfault.com/a/1190000004736079</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/nmc0s3od7n/" target="_blank">https://alili.tech/archive/nmc0s3od7n/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>