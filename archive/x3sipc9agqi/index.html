<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="在浏览器中快速探测IP端口是否开放"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>在浏览器中快速探测IP端口是否开放 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/x3sipc9agqi/",
				"appid": "1613049289050283", 
				"title": "在浏览器中快速探测IP端口是否开放 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-08T02:30:41"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/kkkfxwiecwr/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/kcortozdf4/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fx3sipc9agqi%2f&text=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%bf%ab%e9%80%9f%e6%8e%a2%e6%b5%8bIP%e7%ab%af%e5%8f%a3%e6%98%af%e5%90%a6%e5%bc%80%e6%94%be"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fx3sipc9agqi%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fx3sipc9agqi%2f&text=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%bf%ab%e9%80%9f%e6%8e%a2%e6%b5%8bIP%e7%ab%af%e5%8f%a3%e6%98%af%e5%90%a6%e5%bc%80%e6%94%be"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fx3sipc9agqi%2f&title=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%bf%ab%e9%80%9f%e6%8e%a2%e6%b5%8bIP%e7%ab%af%e5%8f%a3%e6%98%af%e5%90%a6%e5%bc%80%e6%94%be"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fx3sipc9agqi%2f&is_video=false&description=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%bf%ab%e9%80%9f%e6%8e%a2%e6%b5%8bIP%e7%ab%af%e5%8f%a3%e6%98%af%e5%90%a6%e5%bc%80%e6%94%be"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%bf%ab%e9%80%9f%e6%8e%a2%e6%b5%8bIP%e7%ab%af%e5%8f%a3%e6%98%af%e5%90%a6%e5%bc%80%e6%94%be&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fx3sipc9agqi%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fx3sipc9agqi%2f&title=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%bf%ab%e9%80%9f%e6%8e%a2%e6%b5%8bIP%e7%ab%af%e5%8f%a3%e6%98%af%e5%90%a6%e5%bc%80%e6%94%be"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fx3sipc9agqi%2f&title=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%bf%ab%e9%80%9f%e6%8e%a2%e6%b5%8bIP%e7%ab%af%e5%8f%a3%e6%98%af%e5%90%a6%e5%bc%80%e6%94%be"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fx3sipc9agqi%2f&title=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%bf%ab%e9%80%9f%e6%8e%a2%e6%b5%8bIP%e7%ab%af%e5%8f%a3%e6%98%af%e5%90%a6%e5%bc%80%e6%94%be"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fx3sipc9agqi%2f&title=%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%bf%ab%e9%80%9f%e6%8e%a2%e6%b5%8bIP%e7%ab%af%e5%8f%a3%e6%98%af%e5%90%a6%e5%bc%80%e6%94%be"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">在浏览器中快速探测IP端口是否开放</h1><div class="meta"><div class="postdate"><time datetime="2019-02-08" itemprop="datePublished">2019-02-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e0×00 前言\x3c\/h2\x3e\n\x3cp\x3e前两天 freebuf上的的XSS到内网的公开课很受启发，从一个页面到局域网，威力着实增强不少\x3c\/p\x3e\n\x3cp\x3e公开课上检测内网 IP 实现方式用的是 img 标签，加载网站的 favicon.ico 图标，然后监听 onload 事件，看图片能不能加载成功简单易用，就是太慢了 --\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/segmentfault.com\/img\/bVvjZL\x22 src=\x22https:\/\/static.alili.techhttps:\/\/segmentfault.com\/img\/bVvjZL\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e0×02 分析\x3c\/h2\x3e\n\x3cp\x3e浏览器有几秒的尝试容错时间，对于媒体资源，浏览器限制同一域名并发请求为个位数（\x3ca href=\x22https:\/\/github.com\/tvrcgo\/paper\/issues\/4\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e一般为 6 个\x3c\/a\x3e），也就是说，把\x3ca href=\x22https:\/\/http2.akamai.com\/demo\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e图片全放到页面上\x3c\/a\x3e，也不能同时开始检测，只能一点一点来，扫端口的时候会非常慢。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/segmentfault.com\/img\/bVvjV2\x22 src=\x22https:\/\/static.alili.techhttps:\/\/segmentfault.com\/img\/bVvjV2\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e管理员在内网搭建的东西也可能没有图标。。。\x3c\/p\x3e\n\x3cp\x3e探测 IP 端口开放原理就是向目标发送请求，看是否有回应。在上面的 img 中是在加载成功和失败体现出来的。img 嫌慢也可以试试别的嘛，经过一番搜索找到了\x3ca href=\x22https:\/\/defuse.ca\/in-browser-port-scanning.htm\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这个\x3c\/a\x3e，\x3ca href=\x22http:\/\/jsscan.sourceforge.net\/jsscan2.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这个\x3c\/a\x3e和\x3ca href=\x22http:\/\/www.andlabs.org\/tools\/jsrecon.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这个\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch4\x3e第一个页面:\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22document.getElementById(\x26quot;testdiv\x26quot;).innerHTML = \x27\x3cimg src=\x26quot;http:\/\/\x27 \x2b ip \x2b \x27:\x27 \x2b port \x2b \x27\x26quot; alt=\x26quot;\x26quot; onerror=\x26quot;error_handler(\x27 \x2b our_scanobj_index \x2b \x27);\x26quot; \/\x3e\x27;\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x22testdiv\x22\x3c\/span\x3e).innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;img src=\x22http:\/\/\x27\x3c\/span\x3e \x2b ip \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27:\x27\x3c\/span\x3e \x2b port \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22 alt=\x22\x22 onerror=\x22error_handler(\x27\x3c\/span\x3e \x2b our_scanobj_index \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27);\x22 \/\x26gt;\x27\x3c\/span\x3e;\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/segmentfault.com\/img\/bVvj0S\x22 src=\x22https:\/\/static.alili.techhttps:\/\/segmentfault.com\/img\/bVvj0S\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e是通过加载单个 img，使用的 onerror 事件，10 秒以内触发判断为 open。html 页面不能解析为图片格式，所以也会触发 onerror。\x3c\/p\x3e\n\x3ch4\x3e第二个页面:\x3c\/h4\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/segmentfault.com\/img\/bVvj05\x22 src=\x22https:\/\/static.alili.techhttps:\/\/segmentfault.com\/img\/bVvj05\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22switch(port){\n     case 21:  src = \x27ftp:\/\/\x27 \x2b this.id() \x2b \x27@\x27 \x2b host \x2b \x27\/\x27; break;\/\/ftp\n     case 25:  src = \x27mailto:\/\/\x27 \x2b this.getid() \x2b \x27@\x27 \x2b host ; break;\/\/smtp **\n     case 70:  src = \x27gopher:\/\/\x27 \x2b host \x2b \x27\/\x27; break;\/\/gopher\n     case 119: src = \x27news:\/\/\x27 \x2b host \x2b \x27\/\x27; break;\/\/nntp **\n     case 443: src = \x27https:\/\/\x27 \x2b host \x2b \x27\/\x27 \x2b this.getid() \x2b \x27.jpg\x27;\n     default:  src = \x27http:\/\/\x27 \x2b host \x2b \x27:\x27 \x2b port \x2b \x27\/\x27 \x2b this.getid() \x2b \x27.jpg\x27;\/\/ getid is here to prevent cache seekings;\n  }\n  \/\/ ports 19,70,110,143 always return up in IE\n  \/\/ ** if outlook is the default mail client and default newsreader in  IE the request does not return anything\n  img.src = src;\n  setTimeout(function () {\n     if (!img) return;\n     img = undefined;\n     callback( host, port, \x27down\x27,id);\n  }, timeout);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e(port){\n     \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e21\x3c\/span\x3e:  src = \x3cspan class=\x22hljs-string\x22\x3e\x27ftp:\/\/\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.id() \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27@\x27\x3c\/span\x3e \x2b host \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e; \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/ftp\x3c\/span\x3e\n     \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e25\x3c\/span\x3e:  src = \x3cspan class=\x22hljs-string\x22\x3e\x27mailto:\/\/\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getid() \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27@\x27\x3c\/span\x3e \x2b host ; \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/smtp **\x3c\/span\x3e\n     \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e70\x3c\/span\x3e:  src = \x3cspan class=\x22hljs-string\x22\x3e\x27gopher:\/\/\x27\x3c\/span\x3e \x2b host \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e; \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/gopher\x3c\/span\x3e\n     \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e119\x3c\/span\x3e: src = \x3cspan class=\x22hljs-string\x22\x3e\x27news:\/\/\x27\x3c\/span\x3e \x2b host \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e; \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/nntp **\x3c\/span\x3e\n     \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e443\x3c\/span\x3e: src = \x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/\x27\x3c\/span\x3e \x2b host \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getid() \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27.jpg\x27\x3c\/span\x3e;\n     \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:  src = \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/\x27\x3c\/span\x3e \x2b host \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27:\x27\x3c\/span\x3e \x2b port \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getid() \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27.jpg\x27\x3c\/span\x3e;\x3cspan class=\x22hljs-comment\x22\x3e\/\/ getid is here to prevent cache seekings;\x3c\/span\x3e\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ports 19,70,110,143 always return up in IE\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ** if outlook is the default mail client and default newsreader in  IE the request does not return anything\x3c\/span\x3e\n  img.src = src;\n  setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n     \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!img) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n     img = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e;\n     callback( host, port, \x3cspan class=\x22hljs-string\x22\x3e\x27down\x27\x3c\/span\x3e,id);\n  }, timeout);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e功能比第一个多不少，尝试多种协议，80 端口可以探测出来\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/segmentfault.com\/img\/bVvj1e\x22 src=\x22https:\/\/static.alili.techhttps:\/\/segmentfault.com\/img\/bVvj1e\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e77，79 被浏览器屏蔽，马上触发事件，所以误报了。\x3c\/p\x3e\n\x3ch4\x3e第三个页面：\x3c\/h4\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/segmentfault.com\/img\/bVvj1v\x22 src=\x22https:\/\/static.alili.techhttps:\/\/segmentfault.com\/img\/bVvj1v\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e用 websocket 准确率很好，特殊端口做过处理没有误报，作者还有一篇\x3ca href=\x22http:\/\/www.andlabs.org\/tools\/jsrecon\/jsrecon.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e笔记\x3c\/a\x3e，就是 js 和 html 耦合严重，不好提取出来用，趁着放假干脆造了个新轮子。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e0×03 构架\x3c\/h2\x3e\n\x3cp\x3e最终选用的 WebSocket，听着就高大上，非 http 的端口也能探测，文档看的 \x3ca href=\x22http:\/\/javascript.ruanyifeng.com\/htmlapi\/websocket.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eruanyifeng\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/WebSocket\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMDN\x3c\/a\x3e 查到 websocket 并发连接 \x3ca href=\x22https:\/\/samsaffron.com\/archive\/2015\/12\/29\/websockets-caution-required\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e挺高的\x3c\/a\x3e (255 in Chrome and 200 in Firefox)，加入了一个队列模块\x3c\/p\x3e\n\x3cp\x3ejs 如下：\x3cbr\x3e\x3ccode\x3ejs.later.js\x3c\/code\x3e 简单的包装了 setInterval，超时检测全靠它\x3cbr\x3e\x3ccode\x3ejs.queue.js\x3c\/code\x3e 队列和并发控制\x3cbr\x3e\x3ccode\x3ejs.portscan.js\x3c\/code\x3e端口扫描的逻辑都在这\x3cbr\x3e前端界面用的是 semantic-ui 和 Vue\x3c\/p\x3e\n\x3cp\x3e介绍\x3cbr\x3e\x3ccode\x3ejs.later.js\x3c\/code\x3e 作用比较简单，在这里就是一个 setTimeout 的用法，就不多写了。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ejs.queue.js\x3c\/code\x3e 结合 websocket 的高并发，很给力，可以动态调整并发数量，鼠标键盘没反应人离开后多跑点任务加快效率\x3c\/p\x3e\n\x3cp\x3e使用示例（可以在演示页面测试）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var q = new Queue(function(task, next, timer) {\n    \/\/ 跳过部分任务，不执行next，模拟超时\n    if (task % 5 === 0) return;\n    \/\/模拟延迟异步任务\n    $.get(\x27https:\/\/httpbin.org\/delay\/1\x27, function() {\n        console.log(task);\n        \/\/此任务完成，继续下一个\n        next();\n    });\n}, 3); \/\/3个并发请求\nfor (var i = 0; i \x3c 15; i\x2b\x2b) {\n    q.push(i);\n}\nq.timeout = 10000;\nq.onTimeout = function(task) {\n    console.warn(\x27queue:timeout:\x27 \x2b task);\n}\nq.onfinish = function() {\n    console.info(\x27队列执行完毕\x27);\n}\nq.start();\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e q = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Queue(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etask, next, timer\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 跳过部分任务，不执行next，模拟超时\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (task % \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/模拟延迟异步任务\x3c\/span\x3e\n    $.get(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/httpbin.org\/delay\/1\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(task);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/此任务完成，继续下一个\x3c\/span\x3e\n        next();\n    });\n}, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/3个并发请求\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; \x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e; i\x2b\x2b) {\n    q.push(i);\n}\nq.timeout = \x3cspan class=\x22hljs-number\x22\x3e10000\x3c\/span\x3e;\nq.onTimeout = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etask\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.warn(\x3cspan class=\x22hljs-string\x22\x3e\x27queue:timeout:\x27\x3c\/span\x3e \x2b task);\n}\nq.onfinish = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.info(\x3cspan class=\x22hljs-string\x22\x3e\x27队列执行完毕\x27\x3c\/span\x3e);\n}\nq.start();\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ejs.portscan.js\x3c\/code\x3e 有三种扫描方式：\x3cbr\x3e\x3ccode\x3escan_single\x3c\/code\x3e 扫描单个目标\x3cbr\x3e\x3ccode\x3escan_batch\x3c\/code\x3e 扫描一个数组\x3cbr\x3e\x3ccode\x3escan_range\x3c\/code\x3e 生成列表并扫描以上三个接口都可以直接使用 scan，根据传入参数不同自动选择对应的方法去执行。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var ps = new PortScan();\nps.onscan = function(flag, task){\n   alert(task \x2b \x27扫描完成，状态为：\x27 \x2b flag)\n}\nps.onopen = function(task){\n   prompt(\x27开放端口\x27, task)\n}\nps.onfinsh = function(){\n   alert(\x27scan完成\x27)\n}\n\n\/\/ 分别执行以下三个方法\n\/\/ 探测单个目标\nps.scan(\x27baidu.com\x27);\n\n\/\/ 批量探测\nps.scan([\x27baidu.com:22\x27, \x27baidu.com:443\x27, \x27baidu.com:1024\x27])\n\n\/\/ 生成一段地址并探测\nps.scan(\x27baidu.com:*\x27, 75, 85)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ps = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e PortScan();\nps.onscan = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(flag, task)\x3c\/span\x3e\x3c\/span\x3e{\n   alert(task \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27扫描完成，状态为：\x27\x3c\/span\x3e \x2b flag)\n}\nps.onopen = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(task)\x3c\/span\x3e\x3c\/span\x3e{\n   prompt(\x3cspan class=\x22hljs-string\x22\x3e\x27开放端口\x27\x3c\/span\x3e, task)\n}\nps.onfinsh = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e{\n   alert(\x3cspan class=\x22hljs-string\x22\x3e\x27scan完成\x27\x3c\/span\x3e)\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 分别执行以下三个方法\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 探测单个目标\x3c\/span\x3e\nps.scan(\x3cspan class=\x22hljs-string\x22\x3e\x27baidu.com\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 批量探测\x3c\/span\x3e\nps.scan([\x3cspan class=\x22hljs-string\x22\x3e\x27baidu.com:22\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27baidu.com:443\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27baidu.com:1024\x27\x3c\/span\x3e])\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 生成一段地址并探测\x3c\/span\x3e\nps.scan(\x3cspan class=\x22hljs-string\x22\x3e\x27baidu.com:*\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e75\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e85\x3c\/span\x3e)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用 WebSocket 发送请求的核心方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 使用websocket探测端口\nPortScan.prototype.wscan = function (target, callback) {\n    var _this = this;\n    var ws = new WebSocket(this.wsprotocol \x2b target);\n    ws.onerror = ws.onopen = function (e) {\n        stopTimer();\n        _this.portstate(\x27open\x27, target, callback);\n    }\n    var workerkiller = function (flag) {\n        stopTimer(flag);\n        ws.onerror = null;\n        ws.close();\n        \/\/ 如果是队列控制超时此处就不再执行next\n        callback = flag === \x27worker_timeout\x27 ? null : callback;\n        _this.portstate(flag, target, callback);\n    }\n    var stopTimer = this.timeoutexit(workerkiller);\n    return workerkiller;\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用websocket探测端口\x3c\/span\x3e\nPortScan.prototype.wscan = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3c\/span\x3e(target, \x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _this = \x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ws = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eWebSocket\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.wsprotocol \x2b target);\n    ws.onerror = ws.onopen = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3c\/span\x3e(e) {\n        stopTimer();\n        _this.portstate(\x3cspan class=\x22hljs-string\x22\x3e\x27open\x27\x3c\/span\x3e, target, \x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e);\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e workerkiller = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3c\/span\x3e(flag) {\n        stopTimer(flag);\n        ws.onerror = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n        ws.close();\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果是队列控制超时此处就不再执行next\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e = flag === \x3cspan class=\x22hljs-string\x22\x3e\x27worker_timeout\x27\x3c\/span\x3e ? \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e : \x3cspan class=\x22hljs-type\x22\x3ecallback\x3c\/span\x3e;\n        _this.portstate(flag, target, \x3cspan class=\x22hljs-keyword\x22\x3ecallback\x3c\/span\x3e);\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e stopTimer = \x3cspan class=\x22hljs-built_in\x22\x3ethis\x3c\/span\x3e.timeoutexit(workerkiller);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e workerkiller;\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ewscan接收两个参数，target 是目标地址，callback 是回调方法，请求结束后会把扫描结果传入此方法。新建 WebSocket 请求后，在 ws 对象上设置了 ws.onerror 和 ws.onopen 事件。\x3c\/p\x3e\n\x3cp\x3e想要成功建立连接需要服务器端先回应\x3ccode\x3eHTTP\/1.1 101 Switching Protocols\x3c\/code\x3e，如果被扫描的端口开放并且返回了数据，数据格式和 WebSocket 不一致会触发 onerror 事件，成功建立连接后则触发 onopen。\x3c\/p\x3e\n\x3cp\x3eworkerkiller 方法用来在超时后停止当前这个请求继续等待端口响应，首先清空 onerror 事件，然后执行 ws.close() 关闭连接。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3evar stopTimer = this.timeoutexit(workerkiller);\x3c\/code\x3etimeoutexit 调用的是 js.later.js 里的方法。根据设置的超时时间（默认设置的 5 秒），启动 workerkiller 停止此请求。端口判定为不通。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3e_this.portstate(\x27open\x27, target, callback);\x3c\/code\x3eportstate 是 PortScan 对象提供的一个方法，请求结束传入\x3ccode\x3eopen\x3c\/code\x3e或是\x3ccode\x3etimeout\x3c\/code\x3e，在 portstate 内部会触发扫描事件。在 ws 的 onerror 触发能触发，说明服务端有回应数据，状态是\x3ccode\x3eopen\x3c\/code\x3e，ps.onopen 就会被调用，上面例子中 ps.onopen 弹出的 prompt 窗口显示扫到的开放端口就是由 portstate 去执行的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 扫描批量目标\nPortScan.prototype.scan_batch = function (tasks, onfinish, onscan, isonopen_onopen) {\n    this.setEvents(onfinish, onscan, isonopen_onopen);\n    var _this = this;\n    var q = this.queue = new Queue(this.scan_single, this.portscan_concurrence);\n    q.tasks = tasks;\n    q.onfinish = function () {\n        _this.onfinish \x26amp;\x26amp; _this.onfinish(_this.opentarget);\n    }\n    q.start();\n    return q;\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 扫描批量目标\x3c\/span\x3e\nPortScan.prototype.scan_batch = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(tasks, onfinish, onscan, isonopen_onopen)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setEvents(onfinish, onscan, isonopen_onopen);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _this = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e q = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.queue = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Queue(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.scan_single, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.portscan_concurrence);\n    q.tasks = tasks;\n    q.onfinish = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n        _this.onfinish \x26amp;\x26amp; _this.onfinish(_this.opentarget);\n    }\n    q.start();\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e q;\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e扫描批量目标使用 js.queue.js 的并发队列功能，去执行的 scan_single 执行单个任务，scan_single 在扫描前做了一些额外的工作：把浏览器屏蔽的端口过滤掉了，ps.onscan 收到的状态就是\x3ccode\x3eblocked\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3escan_range 遍历指定的范围，\x3ccode\x3ehost.replace(\x27*\x27, i)\x3c\/code\x3e，生成目标地址，最后调用 scan_batch。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e0×04 测试\x3c\/h2\x3e\n\x3cp\x3e上面搞那么复杂就是为了 PortScan 的代码用起来简单灵活。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var ps = new PortScan();\nps.onfinsh = function(opentarget){\n    alert(opentarget);\n   \/\/ opentarget是所有探测到端口开放的IP地址，花费时间大约10秒多\n   \/\/ 探测到目标后可接Black-Hole思路，自动化检测cms，根据相关漏洞getshell继而漫游内网\n}\n\/\/ webrtc获得内网网段参见 http:\/\/zone.wooyun.org\/content\/24219\nps.scan(\x27192.168.0.*\x27, 1, 254); \/\/ 加端口号也可以 \x27192.168.0.*:8080\x27\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ps = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e PortScan();\nps.onfinsh = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(opentarget)\x3c\/span\x3e\x3c\/span\x3e{\n    alert(opentarget);\n   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ opentarget是所有探测到端口开放的IP地址，花费时间大约10秒多\x3c\/span\x3e\n   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 探测到目标后可接Black-Hole思路，自动化检测cms，根据相关漏洞getshell继而漫游内网\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ webrtc获得内网网段参见 http:\/\/zone.wooyun.org\/content\/24219\x3c\/span\x3e\nps.scan(\x3cspan class=\x22hljs-string\x22\x3e\x27192.168.0.*\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e254\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 加端口号也可以 \x27192.168.0.*:8080\x27\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/js-port-scan.sec.dog\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3c\/a\x3e\x3ca href=\x22http:\/\/js-port-scan.sec.dog\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/js-port-scan.sec.dog\/\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/segmentfault.com\/img\/bVvlUf\x22 src=\x22https:\/\/static.alili.techhttps:\/\/segmentfault.com\/img\/bVvlUf\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/segmentfault.com\/img\/bVvlUk\x22 src=\x22https:\/\/static.alili.techhttps:\/\/segmentfault.com\/img\/bVvlUk\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e-\x3c\/p\x3e\n\x3cp\x3e（上个月写的，有些地方描述不够详细准确，有空了再更新，那三个js，在demo页面上 - 2016）\x3cbr\x3e\x3cstrong\x3e（demo链接已更新，代码略有改动，修复了ie下运行的bug，增加了ws，ajax，video，image等请求方式，ps.use(\x27websocket\x27) - 2017-02-10 ）\x3c\/strong\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>在浏览器中快速探测IP端口是否开放</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005746121">https://segmentfault.com/a/1190000005746121</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/x3sipc9agqi/" target="_blank">https://alili.tech/archive/x3sipc9agqi/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>