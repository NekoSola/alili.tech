<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="ES6 系列之 Generator 的自动执行"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>ES6 系列之 Generator 的自动执行 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/vn4a0ma8dba/",
				"appid": "1613049289050283", 
				"title": "ES6 系列之 Generator 的自动执行 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-13T02:31:22"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/fw82afy56wq/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/apgtugcoy9c/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fvn4a0ma8dba%2f&text=ES6%20%e7%b3%bb%e5%88%97%e4%b9%8b%20Generator%20%e7%9a%84%e8%87%aa%e5%8a%a8%e6%89%a7%e8%a1%8c"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fvn4a0ma8dba%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fvn4a0ma8dba%2f&text=ES6%20%e7%b3%bb%e5%88%97%e4%b9%8b%20Generator%20%e7%9a%84%e8%87%aa%e5%8a%a8%e6%89%a7%e8%a1%8c"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fvn4a0ma8dba%2f&title=ES6%20%e7%b3%bb%e5%88%97%e4%b9%8b%20Generator%20%e7%9a%84%e8%87%aa%e5%8a%a8%e6%89%a7%e8%a1%8c"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fvn4a0ma8dba%2f&is_video=false&description=ES6%20%e7%b3%bb%e5%88%97%e4%b9%8b%20Generator%20%e7%9a%84%e8%87%aa%e5%8a%a8%e6%89%a7%e8%a1%8c"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=ES6%20%e7%b3%bb%e5%88%97%e4%b9%8b%20Generator%20%e7%9a%84%e8%87%aa%e5%8a%a8%e6%89%a7%e8%a1%8c&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fvn4a0ma8dba%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fvn4a0ma8dba%2f&title=ES6%20%e7%b3%bb%e5%88%97%e4%b9%8b%20Generator%20%e7%9a%84%e8%87%aa%e5%8a%a8%e6%89%a7%e8%a1%8c"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvn4a0ma8dba%2f&title=ES6%20%e7%b3%bb%e5%88%97%e4%b9%8b%20Generator%20%e7%9a%84%e8%87%aa%e5%8a%a8%e6%89%a7%e8%a1%8c"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvn4a0ma8dba%2f&title=ES6%20%e7%b3%bb%e5%88%97%e4%b9%8b%20Generator%20%e7%9a%84%e8%87%aa%e5%8a%a8%e6%89%a7%e8%a1%8c"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fvn4a0ma8dba%2f&title=ES6%20%e7%b3%bb%e5%88%97%e4%b9%8b%20Generator%20%e7%9a%84%e8%87%aa%e5%8a%a8%e6%89%a7%e8%a1%8c"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">ES6 系列之 Generator 的自动执行</h1><div class="meta"><div class="postdate"><time datetime="2019-02-13" itemprop="datePublished">2019-02-13</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e单个异步任务\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var fetch = require(\x27node-fetch\x27);\n\nfunction* gen(){\n    var url = \x27https:\/\/api.github.com\/users\/github\x27;\n    var result = yield fetch(url);\n    console.log(result.bio);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fetch = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27node-fetch\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = \x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetch(url);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(result.bio);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了获得最终的执行结果，你需要这样做：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var g = gen();\nvar result = g.next();\n\nresult.value.then(function(data){\n    return data.json();\n}).then(function(data){\n    g.next(data);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e g = gen();\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = g.next();\n\nresult.value.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e data.json();\n}).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    g.next(data);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e首先执行 Generator 函数，获取遍历器对象。\x3c\/p\x3e\n\x3cp\x3e然后使用 next 方法，执行异步任务的第一阶段，即 fetch(url)。\x3c\/p\x3e\n\x3cp\x3e注意，由于 fetch(url) 会返回一个 Promise 对象，所以 result 的值为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ value: Promise { \x3cpending\x3e }, done: false }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode class=\x22jsx\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e{ \x3cspan class=\x22hljs-attribute\x22\x3evalue\x3c\/span\x3e: Promise { \x26lt;pending\x26gt; }, \x3cspan class=\x22hljs-selector-tag\x22\x3edone\x3c\/span\x3e: \x3cspan class=\x22hljs-selector-tag\x22\x3efalse\x3c\/span\x3e }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后我们为这个 Promise 对象添加一个 then 方法，先将其返回的数据格式化(\x3ccode\x3edata.json()\x3c\/code\x3e)，再调用 g.next，将获得的数据传进去，由此可以执行异步任务的第二阶段，代码执行完毕。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e多个异步任务\x3c\/h2\x3e\n\x3cp\x3e上节我们只调用了一个接口，那如果我们调用了多个接口，使用了多个 yield，我们岂不是要在 then 函数中不断的嵌套下去……\x3c\/p\x3e\n\x3cp\x3e所以我们来看看执行多个异步任务的情况：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var fetch = require(\x27node-fetch\x27);\n\nfunction* gen() {\n    var r1 = yield fetch(\x27https:\/\/api.github.com\/users\/github\x27);\n    var r2 = yield fetch(\x27https:\/\/api.github.com\/users\/github\/followers\x27);\n    var r3 = yield fetch(\x27https:\/\/api.github.com\/users\/github\/repos\x27);\n\n    console.log([r1.bio, r2[0].login, r3[0].full_name].join(\x27\\n\x27));\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fetch = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27node-fetch\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r1 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r2 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\/followers\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r3 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\/repos\x27\x3c\/span\x3e);\n\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log([r1.bio, r2[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].login, r3[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].full_name].join(\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e));\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了获得最终的执行结果，你可能要写成：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var g = gen();\nvar result1 = g.next();\n\nresult1.value.then(function(data){\n    return data.json();\n})\n.then(function(data){\n    return g.next(data).value;\n})\n.then(function(data){\n    return data.json();\n})\n.then(function(data){\n    return g.next(data).value\n})\n.then(function(data){\n    return data.json();\n})\n.then(function(data){\n    g.next(data)\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e g = gen();\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result1 = g.next();\n\nresult1.value.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e data.json();\n})\n.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e g.next(data).value;\n})\n.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e data.json();\n})\n.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e g.next(data).value\n})\n.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e data.json();\n})\n.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    g.next(data)\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但我知道你肯定不想写成这样……\x3c\/p\x3e\n\x3cp\x3e其实，利用递归，我们可以这样写：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function run(gen) {\n    var g = gen();\n\n    function next(data) {\n        var result = g.next(data);\n\n        if (result.done) return;\n\n        result.value.then(function(data) {\n            return data.json();\n        }).then(function(data) {\n            next(data);\n        });\n\n    }\n\n    next();\n}\n\nrun(gen);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erun\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3egen\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e g = gen();\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enext\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = g.next(data);\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (result.done) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n\n        result.value.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e data.json();\n        }).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n            next(data);\n        });\n\n    }\n\n    next();\n}\n\nrun(gen);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中的关键就是 yield 的时候返回一个 Promise 对象，给这个 Promise 对象添加 then 方法，当异步操作成功时执行 then 中的 onFullfilled 函数，onFullfilled 函数中又去执行 g.next，从而让 Generator 继续执行，然后再返回一个 Promise，再在成功时执行 g.next，然后再返回……\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e启动器函数\x3c\/h2\x3e\n\x3cp\x3e在 run 这个启动器函数中，我们在 then 函数中将数据格式化 \x3ccode\x3edata.json()\x3c\/code\x3e，但在更广泛的情况下，比如 yield 直接跟一个 Promise，而非一个 fetch 函数返回的 Promise，因为没有 json 方法，代码就会报错。所以为了更具备通用性，连同这个例子和启动器，我们修改为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var fetch = require(\x27node-fetch\x27);\n\nfunction* gen() {\n    var r1 = yield fetch(\x27https:\/\/api.github.com\/users\/github\x27);\n    var json1 = yield r1.json();\n    var r2 = yield fetch(\x27https:\/\/api.github.com\/users\/github\/followers\x27);\n    var json2 = yield r2.json();\n    var r3 = yield fetch(\x27https:\/\/api.github.com\/users\/github\/repos\x27);\n    var json3 = yield r3.json();\n\n    console.log([json1.bio, json2[0].login, json3[0].full_name].join(\x27\\n\x27));\n}\n\nfunction run(gen) {\n    var g = gen();\n\n    function next(data) {\n        var result = g.next(data);\n\n        if (result.done) return;\n\n        result.value.then(function(data) {\n            next(data);\n        });\n\n    }\n\n    next();\n}\n\nrun(gen);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fetch = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27node-fetch\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r1 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e json1 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e r1.json();\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r2 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\/followers\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e json2 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e r2.json();\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r3 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\/repos\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e json3 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e r3.json();\n\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log([json1.bio, json2[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].login, json3[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].full_name].join(\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e));\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erun\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3egen\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e g = gen();\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enext\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = g.next(data);\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (result.done) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n\n        result.value.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n            next(data);\n        });\n\n    }\n\n    next();\n}\n\nrun(gen);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e只要 yield 后跟着一个 Promise 对象，我们就可以利用这个 run 函数将 Generator 函数自动执行。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e回调函数\x3c\/h2\x3e\n\x3cp\x3eyield 后一定要跟着一个 Promise 对象才能保证 Generator 的自动执行吗？如果只是一个回调函数呢？我们来看个例子：\x3c\/p\x3e\n\x3cp\x3e首先我们来模拟一个普通的异步请求：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function fetchData(url, cb) {\n    setTimeout(function(){\n        cb({status: 200, data: url})\n    }, 1000)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efetchData\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, cb\x3c\/span\x3e) \x3c\/span\x3e{\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        cb({\x3cspan class=\x22hljs-attr\x22\x3estatus\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: url})\n    }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们将这种函数改造成：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function fetchData(url) {\n    return function(cb){\n        setTimeout(function(){\n            cb({status: 200, data: url})\n        }, 1000)\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efetchData\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e)\x3c\/span\x3e{\n        setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n            cb({\x3cspan class=\x22hljs-attr\x22\x3estatus\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: url})\n        }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于这样的 Generator 函数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* gen() {\n    var r1 = yield fetchData(\x27https:\/\/api.github.com\/users\/github\x27);\n    var r2 = yield fetchData(\x27https:\/\/api.github.com\/users\/github\/followers\x27);\n\n    console.log([r1.data, r2.data].join(\x27\\n\x27));\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r1 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetchData(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r2 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetchData(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\/followers\x27\x3c\/span\x3e);\n\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log([r1.data, r2.data].join(\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e));\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果要获得最终的结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var g = gen();\n\nvar r1 = g.next();\n\nr1.value(function(data) {\n    var r2 = g.next(data);\n    r2.value(function(data) {\n        g.next(data);\n    });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e g = gen();\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r1 = g.next();\n\nr1.value(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r2 = g.next(data);\n    r2.value(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n        g.next(data);\n    });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果写成这样的话，我们会面临跟第一节同样的问题，那就是当使用多个 yield 时，代码会循环嵌套起来……\x3c\/p\x3e\n\x3cp\x3e同样利用递归，所以我们可以将其改造为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function run(gen) {\n    var g = gen();\n\n    function next(data) {\n        var result = g.next(data);\n\n        if (result.done) return;\n\n        result.value(next);\n    }\n\n    next();\n}\n\nrun(gen);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erun\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3egen\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e g = gen();\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enext\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = g.next(data);\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (result.done) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n\n        result.value(next);\n    }\n\n    next();\n}\n\nrun(gen);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3erun\x3c\/h2\x3e\n\x3cp\x3e由此可以看到 Generator 函数的自动执行需要一种机制，即当异步操作有了结果，能够自动交回执行权。\x3c\/p\x3e\n\x3cp\x3e而两种方法可以做到这一点。\x3c\/p\x3e\n\x3cp\x3e（1）回调函数。将异步操作进行包装，暴露出回调函数，在回调函数里面交回执行权。\x3c\/p\x3e\n\x3cp\x3e（2）Promise 对象。将异步操作包装成 Promise 对象，用 then 方法交回执行权。\x3c\/p\x3e\n\x3cp\x3e在两种方法中，我们各写了一个 run 启动器函数，那我们能不能将这两种方式结合在一些，写一个通用的 run 函数呢？我们尝试一下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 第一版\nfunction run(gen) {\n    var gen = gen();\n\n    function next(data) {\n        var result = gen.next(data);\n        if (result.done) return;\n\n        if (isPromise(result.value)) {\n            result.value.then(function(data) {\n                next(data);\n            });\n        } else {\n            result.value(next)\n        }\n    }\n\n    next()\n}\n\nfunction isPromise(obj) {\n    return \x27function\x27 == typeof obj.then;\n}\n\nmodule.exports = run;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 第一版\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erun\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3egen\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e gen = gen();\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enext\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = gen.next(data);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (result.done) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isPromise(result.value)) {\n            result.value.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n                next(data);\n            });\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            result.value(next)\n        }\n    }\n\n    next()\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eisPromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e == \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e obj.then;\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = run;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其实实现的很简单，判断 result.value 是否是 Promise，是就添加 then 函数，不是就直接执行。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3ereturn Promise\x3c\/h2\x3e\n\x3cp\x3e我们已经写了一个不错的启动器函数，支持 yield 后跟回调函数或者 Promise 对象。\x3c\/p\x3e\n\x3cp\x3e现在有一个问题需要思考，就是我们如何获得 Generator 函数的返回值呢？又如果 Generator 函数中出现了错误，就比如 fetch 了一个不存在的接口，这个错误该如何捕获呢？\x3c\/p\x3e\n\x3cp\x3e这很容易让人想到 Promise，如果这个启动器函数返回一个 Promise，我们就可以给这个 Promise 对象添加 then 函数，当所有的异步操作执行成功后，我们执行 onFullfilled 函数，如果有任何失败，就执行 onRejected 函数。\x3c\/p\x3e\n\x3cp\x3e我们写一版：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 第二版\nfunction run(gen) {\n    var gen = gen();\n\n    return new Promise(function(resolve, reject) {\n\n        function next(data) {\n            try {\n                var result = gen.next(data);\n            } catch (e) {\n                return reject(e);\n            }\n\n            if (result.done) {\n                return resolve(result.value)\n            };\n\n            var value = toPromise(result.value);\n\n            value.then(function(data) {\n                next(data);\n            }, function(e) {\n                reject(e)\n            });\n        }\n\n        next()\n    })\n\n}\n\nfunction isPromise(obj) {\n    return \x27function\x27 == typeof obj.then;\n}\n\nfunction toPromise(obj) {\n    if (isPromise(obj)) return obj;\n    if (\x27function\x27 == typeof obj) return thunkToPromise(obj);\n    return obj;\n}\n\nfunction thunkToPromise(fn) {\n    return new Promise(function(resolve, reject) {\n        fn(function(err, res) {\n            if (err) return reject(err);\n            resolve(res);\n        });\n    });\n}\n\nmodule.exports = run;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 第二版\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erun\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3egen\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e gen = gen();\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enext\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = gen.next(data);\n            } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e reject(e);\n            }\n\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (result.done) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e resolve(result.value)\n            };\n\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e value = toPromise(result.value);\n\n            value.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n                next(data);\n            }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n                reject(e)\n            });\n        }\n\n        next()\n    })\n\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eisPromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e == \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e obj.then;\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etoPromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isPromise(obj)) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e obj;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e == \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e obj) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e thunkToPromise(obj);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e obj;\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ethunkToPromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n        fn(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, res\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e reject(err);\n            resolve(res);\n        });\n    });\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = run;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e与第一版有很大的不同：\x3c\/p\x3e\n\x3cp\x3e首先，我们返回了一个 Promise，当 \x3ccode\x3eresult.done\x3c\/code\x3e 为 true 的时候，我们将该值 \x3ccode\x3eresolve(result.value)\x3c\/code\x3e，如果执行的过程中出现错误，被 catch 住，我们会将原因 \x3ccode\x3ereject(e)\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e其次，我们会使用 \x3ccode\x3ethunkToPromise\x3c\/code\x3e 将回调函数包装成一个 Promise，然后统一的添加 then 函数。在这里值得注意的是，在 \x3ccode\x3ethunkToPromise\x3c\/code\x3e 函数中，我们遵循了 error first 的原则，这意味着当我们处理回调函数的情况时：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 模拟数据请求\nfunction fetchData(url) {\n    return function(cb) {\n        setTimeout(function() {\n            cb(null, { status: 200, data: url })\n        }, 1000)\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 模拟数据请求\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efetchData\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n        setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n            cb(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3estatus\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: url })\n        }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在成功时，第一个参数应该返回 null，表示没有错误原因。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e优化\x3c\/h2\x3e\n\x3cp\x3e我们在第二版的基础上将代码写的更加简洁优雅一点，最终的代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 第三版\nfunction run(gen) {\n\n    return new Promise(function(resolve, reject) {\n        if (typeof gen == \x27function\x27) gen = gen();\n\n        \/\/ 如果 gen 不是一个迭代器\n        if (!gen || typeof gen.next !== \x27function\x27) return resolve(gen)\n\n        onFulfilled();\n\n        function onFulfilled(res) {\n            var ret;\n            try {\n                ret = gen.next(res);\n            } catch (e) {\n                return reject(e);\n            }\n            next(ret);\n        }\n\n        function onRejected(err) {\n            var ret;\n            try {\n                ret = gen.throw(err);\n            } catch (e) {\n                return reject(e);\n            }\n            next(ret);\n        }\n\n        function next(ret) {\n            if (ret.done) return resolve(ret.value);\n            var value = toPromise(ret.value);\n            if (value \x26amp;\x26amp; isPromise(value)) return value.then(onFulfilled, onRejected);\n            return onRejected(new TypeError(\x27You may only yield a function, promise \x27 \x2b\n                \x27but the following object was passed: \x26quot;\x27 \x2b String(ret.value) \x2b \x27\x26quot;\x27));\n        }\n    })\n}\n\nfunction isPromise(obj) {\n    return \x27function\x27 == typeof obj.then;\n}\n\nfunction toPromise(obj) {\n    if (isPromise(obj)) return obj;\n    if (\x27function\x27 == typeof obj) return thunkToPromise(obj);\n    return obj;\n}\n\nfunction thunkToPromise(fn) {\n    return new Promise(function(resolve, reject) {\n        fn(function(err, res) {\n            if (err) return reject(err);\n            resolve(res);\n        });\n    });\n}\n\nmodule.exports = run;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 第三版\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erun\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3egen\x3c\/span\x3e) \x3c\/span\x3e{\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e gen == \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) gen = gen();\n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果 gen 不是一个迭代器\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!gen || \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e gen.next !== \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e resolve(gen)\n\n        onFulfilled();\n\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eonFulfilled\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ret;\n            \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n                ret = gen.next(res);\n            } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e reject(e);\n            }\n            next(ret);\n        }\n\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eonRejected\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ret;\n            \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n                ret = gen.throw(err);\n            } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e reject(e);\n            }\n            next(ret);\n        }\n\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3enext\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eret\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (ret.done) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e resolve(ret.value);\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e value = toPromise(ret.value);\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (value \x26amp;\x26amp; isPromise(value)) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e value.then(onFulfilled, onRejected);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e onRejected(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eTypeError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27You may only yield a function, promise \x27\x3c\/span\x3e \x2b\n                \x3cspan class=\x22hljs-string\x22\x3e\x27but the following object was passed: \x22\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e(ret.value) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22\x27\x3c\/span\x3e));\n        }\n    })\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eisPromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e == \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e obj.then;\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etoPromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isPromise(obj)) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e obj;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e == \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e obj) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e thunkToPromise(obj);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e obj;\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ethunkToPromise\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efn\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n        fn(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, res\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e reject(err);\n            resolve(res);\n        });\n    });\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = run;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3eco\x3c\/h2\x3e\n\x3cp\x3e如果我们再将这个启动器函数写的完善一些，我们就相当于写了一个 co，实际上，上面的代码确实是来自于 co……\x3c\/p\x3e\n\x3cp\x3e而 co 是什么？ co 是大神 TJ Holowaychuk 于 2013 年 6 月发布的一个小模块，用于 Generator 函数的自动执行。\x3c\/p\x3e\n\x3cp\x3e如果直接使用 co 模块，这两种不同的例子可以简写为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ yield 后是一个 Promise\nvar fetch = require(\x27node-fetch\x27);\nvar co = require(\x27co\x27);\n\nfunction* gen() {\n    var r1 = yield fetch(\x27https:\/\/api.github.com\/users\/github\x27);\n    var json1 = yield r1.json();\n    var r2 = yield fetch(\x27https:\/\/api.github.com\/users\/github\/followers\x27);\n    var json2 = yield r2.json();\n    var r3 = yield fetch(\x27https:\/\/api.github.com\/users\/github\/repos\x27);\n    var json3 = yield r3.json();\n\n    console.log([json1.bio, json2[0].login, json3[0].full_name].join(\x27\\n\x27));\n}\n\nco(gen);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ yield 后是一个 Promise\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fetch = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27node-fetch\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e co = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27co\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r1 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e json1 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e r1.json();\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r2 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\/followers\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e json2 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e r2.json();\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r3 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\/repos\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e json3 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e r3.json();\n\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log([json1.bio, json2[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].login, json3[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].full_name].join(\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e));\n}\n\nco(gen);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ yield 后是一个回调函数\nvar co = require(\x27co\x27);\n\nfunction fetchData(url) {\n    return function(cb) {\n        setTimeout(function() {\n            cb(null, { status: 200, data: url })\n        }, 1000)\n    }\n}\n\nfunction* gen() {\n    var r1 = yield fetchData(\x27https:\/\/api.github.com\/users\/github\x27);\n    var r2 = yield fetchData(\x27https:\/\/api.github.com\/users\/github\/followers\x27);\n\n    console.log([r1.data, r2.data].join(\x27\\n\x27));\n}\n\nco(gen);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ yield 后是一个回调函数\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e co = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27co\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efetchData\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) \x3c\/span\x3e{\n        setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n            cb(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3estatus\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: url })\n        }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n    }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r1 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetchData(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e r2 = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetchData(\x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/api.github.com\/users\/github\/followers\x27\x3c\/span\x3e);\n\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log([r1.data, r2.data].join(\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e));\n}\n\nco(gen);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e是不是特别的好用？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3eES6 系列\x3c\/h2\x3e\n\x3cp\x3eES6 系列目录地址：\x3ca href=\x22https:\/\/github.com\/mqyqingfeng\/Blog\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/mqyqingfeng\/Blog\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3eES6 系列预计写二十篇左右，旨在加深 ES6 部分知识点的理解，重点讲解块级作用域、标签模板、箭头函数、Symbol、Set、Map 以及 Promise 的模拟实现、模块加载方案、异步处理等内容。\x3c\/p\x3e\n\x3cp\x3e如果有错误或者不严谨的地方，请务必给予指正，十分感谢。如果喜欢或者有所启发，欢迎 star，对作者也是一种鼓励。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>ES6 系列之 Generator 的自动执行</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000016731734">https://segmentfault.com/a/1190000016731734</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/vn4a0ma8dba/" target="_blank">https://alili.tech/archive/vn4a0ma8dba/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>