<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="nodejs 异步I/O和事件驱动"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>nodejs 异步I/O和事件驱动 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/zugqhvdlz7/",
				"appid": "1613049289050283", 
				"title": "nodejs 异步I/O和事件驱动 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-10T02:30:42"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/pboomcy145b/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/tzpo03ilcqi/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fzugqhvdlz7%2f&text=nodejs%20%e5%bc%82%e6%ad%a5I%2fO%e5%92%8c%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fzugqhvdlz7%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fzugqhvdlz7%2f&text=nodejs%20%e5%bc%82%e6%ad%a5I%2fO%e5%92%8c%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fzugqhvdlz7%2f&title=nodejs%20%e5%bc%82%e6%ad%a5I%2fO%e5%92%8c%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fzugqhvdlz7%2f&is_video=false&description=nodejs%20%e5%bc%82%e6%ad%a5I%2fO%e5%92%8c%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=nodejs%20%e5%bc%82%e6%ad%a5I%2fO%e5%92%8c%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fzugqhvdlz7%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fzugqhvdlz7%2f&title=nodejs%20%e5%bc%82%e6%ad%a5I%2fO%e5%92%8c%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzugqhvdlz7%2f&title=nodejs%20%e5%bc%82%e6%ad%a5I%2fO%e5%92%8c%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzugqhvdlz7%2f&title=nodejs%20%e5%bc%82%e6%ad%a5I%2fO%e5%92%8c%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzugqhvdlz7%2f&title=nodejs%20%e5%bc%82%e6%ad%a5I%2fO%e5%92%8c%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">nodejs 异步I/O和事件驱动</h1><div class="meta"><div class="postdate"><time datetime="2019-02-10" itemprop="datePublished">2019-02-10</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3enodejs 异步I\/O和事件驱动\x3c\/h1\x3e\n\x3cblockquote\x3e\x3cp\x3e注：本文是对众多博客的学习和总结，可能存在理解错误。请带着怀疑的眼光，同时如果有错误希望能指出。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e接触\x3ccode\x3enodejs\x3c\/code\x3e有两个月，对\x3ccode\x3enodejs\x3c\/code\x3e的两大特性一直有点模糊，即\x3ccode\x3e异步IO\x3c\/code\x3e和\x3ccode\x3e事件驱动\x3c\/code\x3e。通过对\x3cstrong\x3e\x3cem\x3e《深入浅出nodejs》\x3c\/em\x3e\x3c\/strong\x3e和几篇博客的阅读以后，有了大致的了解，总结一下。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e几个例子\x3c\/h2\x3e\n\x3cp\x3e在开始之前，先来看几个简单例子，这也是我在使用\x3ccode\x3enodejs\x3c\/code\x3e时候遇到的几个比较困惑的例子。\x3c\/p\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3eexample 1\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var fs = require(\x26quot;fs\x26quot;);\nvar debug = require(\x27debug\x27)(\x27example1\x27);\n\ndebug(\x26quot;begin\x26quot;);\n\nsetTimeout(function(){\n    debug(\x26quot;timeout1\x26quot;);\n});\n\nsetTimeout(function(){\n    debug(\x26quot;timeout2\x26quot;);\n});\n\ndebug(\x27end\x27);\n\/** 运行结果\nSat, 21 May 2016 08:41:09 GMT example1 begin\nSat, 21 May 2016 08:41:09 GMT example1 end\nSat, 21 May 2016 08:41:09 GMT example1 timeout1\nSat, 21 May 2016 08:41:09 GMT example1 timeout2\n*\/\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22fs\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e debug = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27debug\x27\x3c\/span\x3e)(\x3cspan class=\x22hljs-string\x22\x3e\x27example1\x27\x3c\/span\x3e);\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x22begin\x22\x3c\/span\x3e);\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    debug(\x3cspan class=\x22hljs-string\x22\x3e\x22timeout1\x22\x3c\/span\x3e);\n});\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    debug(\x3cspan class=\x22hljs-string\x22\x3e\x22timeout2\x22\x3c\/span\x3e);\n});\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/** 运行结果\nSat, 21 May 2016 08:41:09 GMT example1 begin\nSat, 21 May 2016 08:41:09 GMT example1 end\nSat, 21 May 2016 08:41:09 GMT example1 timeout1\nSat, 21 May 2016 08:41:09 GMT example1 timeout2\n*\/\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3equestion 1\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e为何\x3ccode\x3etimeout1\x3c\/code\x3e和\x3ccode\x3etimeout2\x3c\/code\x3e的结果会在\x3ccode\x3eend\x3c\/code\x3e后面？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3eexample 2\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var fs = require(\x26quot;fs\x26quot;);\nvar debug = require(\x27debug\x27)(\x27example2\x27);\n\ndebug(\x26quot;begin\x26quot;);\n\nsetTimeout(function(){\n    debug(\x26quot;timeout1\x26quot;);\n});\n\nsetTimeout(function(){\n    debug(\x26quot;timeout2\x26quot;);\n});\n\ndebug(\x27end\x27);\n\nwhile(true);\n\/**  运行结果\nSat, 21 May 2016 08:45:47 GMT example2 begin\nSat, 21 May 2016 08:45:47 GMT example2 end\n*\/\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22fs\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e debug = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27debug\x27\x3c\/span\x3e)(\x3cspan class=\x22hljs-string\x22\x3e\x27example2\x27\x3c\/span\x3e);\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x22begin\x22\x3c\/span\x3e);\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    debug(\x3cspan class=\x22hljs-string\x22\x3e\x22timeout1\x22\x3c\/span\x3e);\n});\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    debug(\x3cspan class=\x22hljs-string\x22\x3e\x22timeout2\x22\x3c\/span\x3e);\n});\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/**  运行结果\nSat, 21 May 2016 08:45:47 GMT example2 begin\nSat, 21 May 2016 08:45:47 GMT example2 end\n*\/\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3equestion 2\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e为何\x3ccode\x3etimeout1\x3c\/code\x3e和\x3ccode\x3etimeout2\x3c\/code\x3e没有输出到终端？\x3ccode\x3ewhile(true)\x3c\/code\x3e到底阻塞了什么？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3eexample 3\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var fs = require(\x26quot;fs\x26quot;);\nvar debug = require(\x27debug\x27)(\x27example3\x27);\n\ndebug(\x26quot;begin\x26quot;);\n\nsetTimeout(function(){\n    debug(\x26quot;timeout1\x26quot;);\n    while (true);\n});\n\nsetTimeout(function(){\n    debug(\x26quot;timeout2\x26quot;);\n});\n\ndebug(\x27end\x27);\n\/**  运行结果\nSat, 21 May 2016 08:49:12 GMT example3 begin\nSat, 21 May 2016 08:49:12 GMT example3 end\nSat, 21 May 2016 08:49:12 GMT example3 timeout1\n*\/\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22fs\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e debug = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27debug\x27\x3c\/span\x3e)(\x3cspan class=\x22hljs-string\x22\x3e\x27example3\x27\x3c\/span\x3e);\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x22begin\x22\x3c\/span\x3e);\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    debug(\x3cspan class=\x22hljs-string\x22\x3e\x22timeout1\x22\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n});\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    debug(\x3cspan class=\x22hljs-string\x22\x3e\x22timeout2\x22\x3c\/span\x3e);\n});\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/**  运行结果\nSat, 21 May 2016 08:49:12 GMT example3 begin\nSat, 21 May 2016 08:49:12 GMT example3 end\nSat, 21 May 2016 08:49:12 GMT example3 timeout1\n*\/\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3equestion 3\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e为什么\x3ccode\x3etimeout1\x3c\/code\x3e中回调函数会阻塞\x3ccode\x3etimeout2\x3c\/code\x3e中的回调函数的执行？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3eexample 4\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var fs = require(\x26quot;fs\x26quot;);\nvar debug = require(\x27debug\x27)(\x27example4\x27);\n\ndebug(\x26quot;begin\x26quot;);\n\nsetTimeout(function(){\n    debug(\x26quot;timeout1\x26quot;);\n    \/**\n     * 模拟计算密集\n     *\/\n    for(var i = 0 ; i \x3c 1000000 ; \x2b\x2bi){\n        for(var j = 0 ; j \x3c 100000 ; \x2b\x2bj);\n    }\n});\n\nsetTimeout(function(){\n    debug(\x26quot;timeout2\x26quot;);\n});\n\ndebug(\x27end\x27);\n\/**\nSat, 21 May 2016 08:53:27 GMT example4 begin\nSat, 21 May 2016 08:53:27 GMT example4 end\nSat, 21 May 2016 08:53:27 GMT example4 timeout1\nSat, 21 May 2016 08:54:09 GMT example4 timeout2  \/\/注意这里的时间晚了好久\n*\/\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22fs\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e debug = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27debug\x27\x3c\/span\x3e)(\x3cspan class=\x22hljs-string\x22\x3e\x27example4\x27\x3c\/span\x3e);\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x22begin\x22\x3c\/span\x3e);\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    debug(\x3cspan class=\x22hljs-string\x22\x3e\x22timeout1\x22\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/**\n     * 模拟计算密集\n     *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ; i \x26lt; \x3cspan class=\x22hljs-number\x22\x3e1000000\x3c\/span\x3e ; \x2b\x2bi){\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e j = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e ; j \x26lt; \x3cspan class=\x22hljs-number\x22\x3e100000\x3c\/span\x3e ; \x2b\x2bj);\n    }\n});\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    debug(\x3cspan class=\x22hljs-string\x22\x3e\x22timeout2\x22\x3c\/span\x3e);\n});\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\nSat, 21 May 2016 08:53:27 GMT example4 begin\nSat, 21 May 2016 08:53:27 GMT example4 end\nSat, 21 May 2016 08:53:27 GMT example4 timeout1\nSat, 21 May 2016 08:54:09 GMT example4 timeout2  \/\/注意这里的时间晚了好久\n*\/\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3equestion 4\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e和上面的问题一样，为何\x3ccode\x3etimeout1\x3c\/code\x3e的计算密集型工作将会阻塞\x3ccode\x3etimeout2\x3c\/code\x3e的回调函数的执行？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eexample 5\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var fs = require(\x26quot;fs\x26quot;);\nvar debug = require(\x27debug\x27)(\x27example5\x27);\n\ndebug(\x26quot;begin\x26quot;);\n\nfs.readFile(\x27package.json\x27,\x27utf-8\x27,function(err,data){\n    if(err)  \n        debug(err);\n    else\n        debug(\x26quot;get file content\x26quot;);\n});\n\nsetTimeout(function(){\n    debug(\x26quot;timeout2\x26quot;);\n});\n\ndebug(\x27end\x27);\n\/** 运行结果\nSat, 21 May 2016 08:59:14 GMT example5 begin\nSat, 21 May 2016 08:59:14 GMT example5 end\nSat, 21 May 2016 08:59:14 GMT example5 timeout2\nSat, 21 May 2016 08:59:14 GMT example5 get file content\n*\/\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22fs\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e debug = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27debug\x27\x3c\/span\x3e)(\x3cspan class=\x22hljs-string\x22\x3e\x27example5\x27\x3c\/span\x3e);\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x22begin\x22\x3c\/span\x3e);\n\nfs.readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27package.json\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr,data\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(err)  \n        debug(err);\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e\n        debug(\x3cspan class=\x22hljs-string\x22\x3e\x22get file content\x22\x3c\/span\x3e);\n});\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    debug(\x3cspan class=\x22hljs-string\x22\x3e\x22timeout2\x22\x3c\/span\x3e);\n});\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/** 运行结果\nSat, 21 May 2016 08:59:14 GMT example5 begin\nSat, 21 May 2016 08:59:14 GMT example5 end\nSat, 21 May 2016 08:59:14 GMT example5 timeout2\nSat, 21 May 2016 08:59:14 GMT example5 get file content\n*\/\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3equestion 5\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e为何读取文件的\x3ccode\x3eIO\x3c\/code\x3e操作不会阻塞\x3ccode\x3etimeout2\x3c\/code\x3e的执行？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3chr\x3e\n\x3cp\x3e接下来我们就带着上面几个疑惑去理解\x3ccode\x3enodejs\x3c\/code\x3e中的\x3ccode\x3e异步IO\x3c\/code\x3e和\x3ccode\x3e事件驱动\x3c\/code\x3e是如何工作的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e异步IO(asynchronous I\/O)\x3c\/h2\x3e\n\x3cp\x3e首先来理解几个容易混淆的概念，\x3ccode\x3e阻塞IO(blocking I\/O)\x3c\/code\x3e和\x3ccode\x3e非阻塞IO(non-blocking I\/O)\x3c\/code\x3e，\x3ccode\x3e同步IO(synchronous I\/O)和异步IO(synchronous I\/O)\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e博主一直天真的以为\x3ccode\x3e非阻塞I\/O\x3c\/code\x3e就是\x3ccode\x3e异步I\/O\x3c\/code\x3e T_T，\x3ccode\x3eapue\x3c\/code\x3e一直没有读懂。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e阻塞I\/O 和 非阻塞I\/O\x3c\/h3\x3e\n\x3cp\x3e简单来说，\x3cstrong\x3e阻塞I\/O\x3c\/strong\x3e就是当用户发一个读取文件描述符的操作的时候，进程就会被阻塞，直到要读取的数据全部准备好返回给用户，这时候进程才会解除\x3ccode\x3eblock\x3c\/code\x3e的状态。\x3c\/p\x3e\n\x3cp\x3e那\x3cstrong\x3e非阻塞I\/O\x3c\/strong\x3e呢，就与上面的情况相反，用户发起一个读取文件描述符操作的时，函数立即返回，不作任何等待，进程继续执行。但是程序如何知道要读取的数据已经准备好了呢？最简单的方法就是轮询。\x3c\/p\x3e\n\x3cp\x3e除此之外，还有一种叫做\x3ccode\x3eIO多路复用\x3c\/code\x3e的模式，就是用一个阻塞函数同时监听多个文件描述符，当其中有一个文件描述符准备好了，就马上返回，在\x3ccode\x3elinux\x3c\/code\x3e下，\x3ccode\x3eselect\x3c\/code\x3e,\x3ccode\x3epoll\x3c\/code\x3e,\x3ccode\x3eepoll\x3c\/code\x3e都提供了\x3ccode\x3eIO多路复用\x3c\/code\x3e的功能。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e同步I\/O 和 异步I\/O\x3c\/h3\x3e\n\x3cp\x3e那么\x3ccode\x3e同步I\/O\x3c\/code\x3e和\x3ccode\x3e异步I\/O\x3c\/code\x3e又有什么区别么？是不是只要做到\x3ccode\x3e非阻塞IO\x3c\/code\x3e就可以实现\x3ccode\x3e异步I\/O\x3c\/code\x3e呢？\x3c\/p\x3e\n\x3cp\x3e其实不然。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3e同步I\/O(synchronous I\/O)\x3c\/code\x3e做\x3ccode\x3eI\/O operation\x3c\/code\x3e的时候会将process阻塞,所以\x3ccode\x3e阻塞I\/O\x3c\/code\x3e，\x3ccode\x3e非阻塞I\/O\x3c\/code\x3e，\x3ccode\x3eIO多路复用I\/O\x3c\/code\x3e都是\x3ccode\x3e同步I\/O\x3c\/code\x3e。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3e异步I\/O(asynchronous I\/O)\x3c\/code\x3e做\x3ccode\x3eI\/O opertaion\x3c\/code\x3e的时候将不会造成任何的阻塞。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3ccode\x3e非阻塞I\/O\x3c\/code\x3e都不阻塞了为什么不是\x3ccode\x3e异步I\/O\x3c\/code\x3e呢？其实当\x3ccode\x3e非阻塞I\/O\x3c\/code\x3e准备好数据以后还是要阻塞住进程去内核拿数据的。所以算不上\x3ccode\x3e异步I\/O\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e这里借一张图(图来自\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000003063859?utm_source=Weibo\x26amp;utm_medium=shareLink\x26amp;utm_campaign=socialShare\x22\x3e这里\x3c\/a\x3e)来说明他们之间的区别\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000005173228\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000005173228\x22 alt=\x22![Alt text\\\x22 title=\x22![Alt text\\\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e][1]\x3c\/p\x3e\n\x3cp\x3e更多IO更多的详细内容可以在这里找到:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000003063859?utm_source=Weibo\x26amp;utm_medium=shareLink\x26amp;utm_campaign=socialShare#articleHeader0\x22 target=\x22_blank\x22\x3eLinux IO模式及 select、poll、epoll详解\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.ulduzsoft.com\/2014\/01\/select-poll-epoll-practical-difference-for-system-architects\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eselect \/ poll \/ epoll: practical difference for system architects\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e事件驱动\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3e事件驱动(event-driven)\x3c\/code\x3e是\x3ccode\x3enodejs\x3c\/code\x3e中的第二大特性。何为\x3ccode\x3e事件驱动\x3c\/code\x3e呢？简单来说，就是通过监听事件的状态变化来做出相应的操作。比如读取一个文件，文件读取完毕，或者文件读取错误，那么就触发对应的状态，然后调用对应的回掉函数来进行处理。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e线程驱动和事件驱动\x3c\/h3\x3e\n\x3cp\x3e那么\x3ccode\x3e线程驱动\x3c\/code\x3e编程和\x3ccode\x3e事件驱动\x3c\/code\x3e编程之间的区别是什么呢？\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3e线程驱动\x3c\/code\x3e就是当收到一个请求的时候，将会为该请求开一个新的线程来处理请求。一般存在一个线程池，线程池中有空闲的线程，会从线程池中拿取线程来进行处理，如果线程池中没有空闲的线程，新来的请求将会进入队列排队，直到线程池中空闲线程。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3e事件驱动\x3c\/code\x3e就是当进来一个新的请求的时，请求将会被压入队列中，然后通过一个循环来检测队列中的事件状态变化，如果检测到有状态变化的事件，那么就执行该事件对应的处理代码，一般都是回调函数。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e对于\x3ccode\x3e事件驱动\x3c\/code\x3e编程来说，如果某个时间的回调函数是\x3ccode\x3e计算密集型\x3c\/code\x3e，或者是\x3ccode\x3e阻塞I\/O\x3c\/code\x3e,那么这个回调函数将会阻塞后面所有事件回调函数的执行。这一点尤为重要。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3enodejs的事件驱动和异步I\/O\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e事件驱动模型\x3c\/h3\x3e\n\x3cp\x3e上面介绍了那么多的概念，现在我们来看看\x3ccode\x3enodejs\x3c\/code\x3e中的\x3ccode\x3e事件驱动\x3c\/code\x3e和\x3ccode\x3e异步I\/O\x3c\/code\x3e是如何实现的.\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3enodejs\x3c\/code\x3e是\x3cstrong\x3e单线程(single thread)\x3c\/strong\x3e运行的，通过一个\x3cstrong\x3e事件循环(event-loop)\x3c\/strong\x3e来循环取出\x3cstrong\x3e消息队列(event-queue)\x3c\/strong\x3e中的消息进行处理,处理过程基本上就是去调用该\x3cstrong\x3e消息\x3c\/strong\x3e对应的回调函数。\x3cstrong\x3e消息队列\x3c\/strong\x3e就是当一个事件状态发生变化时，就将一个消息压入队列中。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3enodejs\x3c\/code\x3e的时间驱动模型一般要注意下面几个点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e因为是\x3cstrong\x3e单线程\x3c\/strong\x3e的，所以当顺序执行\x3ccode\x3ejs\x3c\/code\x3e文件中的代码的时候，\x3cstrong\x3e事件循环\x3c\/strong\x3e是被暂停的。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当\x3ccode\x3ejs\x3c\/code\x3e文件执行完以后，\x3cstrong\x3e事件循环\x3c\/strong\x3e开始运行，并从\x3cstrong\x3e消息队列\x3c\/strong\x3e中取出消息，开始执行回调函数\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e因为是\x3cstrong\x3e单线程\x3c\/strong\x3e的，所以当回调函数被执行的时候，\x3cstrong\x3e事件循环\x3c\/strong\x3e是被暂停的\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当涉及到I\/O操作的时候，\x3ccode\x3enodejs\x3c\/code\x3e会开一个独立的线程来进行\x3ccode\x3e异步I\/O\x3c\/code\x3e操作，操作结束以后将消息压入\x3cstrong\x3e消息队列\x3c\/strong\x3e。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e下面我们从一个简单的\x3ccode\x3ejs\x3c\/code\x3e文件入手，来看看    \x3ccode\x3enodejs\x3c\/code\x3e是如何执行的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var fs = require(\x26quot;fs\x26quot;);\nvar debug = require(\x27debug\x27)(\x27example1\x27);\n\ndebug(\x26quot;begin\x26quot;);\n\nfs.readFile(\x27package.json\x27,\x27utf-8\x27,function(err,data){\n    if(err)  \n        debug(err);\n    else\n        debug(\x26quot;get file content\x26quot;);\n});\n\nsetTimeout(function(){\n    debug(\x26quot;timeout2\x26quot;);\n});\n\ndebug(\x27end\x27); \/\/ 运行到这里之前，事件循环是暂停的\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22fs\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e debug = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27debug\x27\x3c\/span\x3e)(\x3cspan class=\x22hljs-string\x22\x3e\x27example1\x27\x3c\/span\x3e);\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x22begin\x22\x3c\/span\x3e);\n\nfs.readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27package.json\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr,data\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(err)  \n        debug(err);\n    \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e\n        debug(\x3cspan class=\x22hljs-string\x22\x3e\x22get file content\x22\x3c\/span\x3e);\n});\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    debug(\x3cspan class=\x22hljs-string\x22\x3e\x22timeout2\x22\x3c\/span\x3e);\n});\n\ndebug(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 运行到这里之前，事件循环是暂停的\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e同步执行\x3ccode\x3edebug(\x22begin\x22)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e异步调用\x3ccode\x3efs.readFile()\x3c\/code\x3e，此时会开一个新的线程去进行\x3ccode\x3e异步I\/O\x3c\/code\x3e操作\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e异步调用\x3ccode\x3esetTimeout()\x3c\/code\x3e，马上将超时信息压入到\x3cstrong\x3e消息队列\x3c\/strong\x3e中\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e同步调用\x3ccode\x3edebug(\x22end\x22)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e开启\x3cstrong\x3e事件循环\x3c\/strong\x3e，弹出\x3cstrong\x3e消息队列\x3c\/strong\x3e中的信息(目前是超时信息)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e然后执行信息对应的回调函数(\x3cstrong\x3e事件循环\x3c\/strong\x3e又被暂停)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e回调函数\x3c\/strong\x3e执行结束后，开始\x3cstrong\x3e事件循环\x3c\/strong\x3e(目前\x3cstrong\x3e消息队列\x3c\/strong\x3e中没有任何东西，文件还没读完)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3e异步I\/O\x3c\/code\x3e读取文件完毕，将消息压入\x3cstrong\x3e消息队列(\x3c\/strong\x3e消息中含有文件内容或者是出错信息)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e事件循环\x3c\/strong\x3e取得消息，执行回调\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e程序退出。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e这里借一张图来说明\x3ccode\x3enodejs\x3c\/code\x3e的事件驱动模型（图来自\x3ca href=\x22http:\/\/blog.carbonfive.com\/2013\/10\/27\/the-javascript-event-loop-explained\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e）\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006792647\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006792647\x22 alt=\x22![这里写图片描述\\\x22 title=\x22![这里写图片描述\\\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e][2]\x3c\/p\x3e\n\x3cp\x3e这里最后要说的一点就是如何手动将一个函数推入队列,\x3ccode\x3enodejs\x3c\/code\x3e为我们提供了几个比较方便的方法:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3esetTimeout()\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eprocess.nextTick()\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3esetImmediate()\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e异步I\/O\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3enodejs\x3c\/code\x3e中的\x3ccode\x3e异步I\/O\x3c\/code\x3e的操作是通过\x3ccode\x3elibuv\x3c\/code\x3e这个库来实现的，包含了\x3ccode\x3ewindow\x3c\/code\x3e和\x3ccode\x3elinux\x3c\/code\x3e下面的\x3ccode\x3e异步I\/O\x3c\/code\x3e实现，博主也没有研究过这个库，感兴趣的读者可以移步到\x3ca href=\x22https:\/\/github.com\/libuv\/libuv\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e问题答案\x3c\/h3\x3e\n\x3cp\x3e好，到目前为止，已经可以回答上面的问题了\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3equestion 1\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e为何\x3ccode\x3etimeout1\x3c\/code\x3e和\x3ccode\x3etimeout2\x3c\/code\x3e的结果会在end后面？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3eanswer 1\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e因为此时\x3ccode\x3etimeout1\x3c\/code\x3e和\x3ccode\x3etimeout2\x3c\/code\x3e只是被异步函数推入到了队列中，\x3cstrong\x3e事件循环\x3c\/strong\x3e还是暂停状态\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3equestion 2\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e为何\x3ccode\x3etimeout1\x3c\/code\x3e和\x3ccode\x3etimeout2\x3c\/code\x3e没有输出到终端？\x3ccode\x3ewhile(true)\x3c\/code\x3e到底阻塞了什么？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3eanswer 2\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e因为此处直接阻塞了\x3cstrong\x3e事件循环\x3c\/strong\x3e，还没开始，就已经被阻塞了\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3equestion 3,4\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3col\x3e\n\x3cli\x3e\x3cp\x3e为什么\x3ccode\x3etimeout1\x3c\/code\x3e中回调函数会阻塞\x3ccode\x3etimeout2\x3c\/code\x3e中的回调函数的执行？\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e为何\x3ccode\x3etimeout1\x3c\/code\x3e的计算密集型工作将会阻塞\x3ccode\x3etimeout2\x3c\/code\x3e的回调函数的执行？\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3eanswer 3,4\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e因为该回调函数执行返回\x3cstrong\x3e事件循环\x3c\/strong\x3e才会继续执行，回调函数将会阻塞事件循环的运行\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3equestion 5\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e为何读取文件的IO操作不会阻塞\x3ccode\x3etimeout2\x3c\/code\x3e的执行？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3eanswer 5\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e因为\x3ccode\x3eIO\x3c\/code\x3e操作是异步的，会开启一个新的线程，不会阻塞到\x3cstrong\x3e事件循环\x3c\/strong\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3chr\x3e\n\x3cp\x3e参考文献：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/stackoverflow.com\/questions\/19822668\/what-exactly-is-a-node-js-event-loop-tick\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWhat exactly is a Node.js event loop tick?\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/stackoverflow.com\/questions\/15599966\/what-is-the-difference-between-a-thread-based-server-and-an-event-based-server\/15600044#15600044\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWhat is the difference between a thread-based server and an event-based server?\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/stackoverflow.com\/questions\/37316728\/some-confusion-about-nodejs-threads\/37316928#37316928\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eSome confusion about nodejs threads\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/blog.carbonfive.com\/2013\/10\/27\/the-javascript-event-loop-explained\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eThe JavaScript Event Loop: Explained\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/daniel.haxx.se\/docs\/poll-vs-select.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epoll vs select vs event-based\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000003063859?utm_source=Weibo\x26amp;utm_medium=shareLink\x26amp;utm_campaign=socialShare#articleHeader0\x22\x3eLinux IO模式及 select、poll、epoll详解\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>nodejs 异步I/O和事件驱动</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005173218">https://segmentfault.com/a/1190000005173218</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/zugqhvdlz7/" target="_blank">https://alili.tech/archive/zugqhvdlz7/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>