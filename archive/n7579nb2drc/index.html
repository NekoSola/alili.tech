<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Web Components 是个什么样的东西"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Web Components 是个什么样的东西 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/n7579nb2drc/",
				"appid": "1613049289050283", 
				"title": "Web Components 是个什么样的东西 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-04T02:30:58"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/sq56p1zfd8m/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/6zw4e4s8ey9/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fn7579nb2drc%2f&text=Web%20Components%20%e6%98%af%e4%b8%aa%e4%bb%80%e4%b9%88%e6%a0%b7%e7%9a%84%e4%b8%9c%e8%a5%bf"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fn7579nb2drc%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fn7579nb2drc%2f&text=Web%20Components%20%e6%98%af%e4%b8%aa%e4%bb%80%e4%b9%88%e6%a0%b7%e7%9a%84%e4%b8%9c%e8%a5%bf"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fn7579nb2drc%2f&title=Web%20Components%20%e6%98%af%e4%b8%aa%e4%bb%80%e4%b9%88%e6%a0%b7%e7%9a%84%e4%b8%9c%e8%a5%bf"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fn7579nb2drc%2f&is_video=false&description=Web%20Components%20%e6%98%af%e4%b8%aa%e4%bb%80%e4%b9%88%e6%a0%b7%e7%9a%84%e4%b8%9c%e8%a5%bf"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Web%20Components%20%e6%98%af%e4%b8%aa%e4%bb%80%e4%b9%88%e6%a0%b7%e7%9a%84%e4%b8%9c%e8%a5%bf&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fn7579nb2drc%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fn7579nb2drc%2f&title=Web%20Components%20%e6%98%af%e4%b8%aa%e4%bb%80%e4%b9%88%e6%a0%b7%e7%9a%84%e4%b8%9c%e8%a5%bf"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fn7579nb2drc%2f&title=Web%20Components%20%e6%98%af%e4%b8%aa%e4%bb%80%e4%b9%88%e6%a0%b7%e7%9a%84%e4%b8%9c%e8%a5%bf"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fn7579nb2drc%2f&title=Web%20Components%20%e6%98%af%e4%b8%aa%e4%bb%80%e4%b9%88%e6%a0%b7%e7%9a%84%e4%b8%9c%e8%a5%bf"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fn7579nb2drc%2f&title=Web%20Components%20%e6%98%af%e4%b8%aa%e4%bb%80%e4%b9%88%e6%a0%b7%e7%9a%84%e4%b8%9c%e8%a5%bf"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Web Components 是个什么样的东西</h1><div class="meta"><div class="postdate"><time datetime="2019-02-04" itemprop="datePublished">2019-02-04</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e前端组件化这个主题相关的内容已经火了很久很久，angular 刚出来时的 \x3ccode\x3eDirective\x3c\/code\x3e 到 angular2 的 \x3ccode\x3ecomponents\x3c\/code\x3e，还有 React 的 \x3ccode\x3ecomponents\x3c\/code\x3e 等等，无一不是前端组件化的一种实现和探索，但是提上议程的 Web Components 标准是个怎样的东西，相关的一些框架或者类库，如 React，Angular2，甚至是 x-tag，polymer 现在实现的组件化的东西和 Web Components 标准差别在哪里？我花时间努力地把现有的 \x3ca href=\x22https:\/\/github.com\/w3c\/webcomponents\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eW3C Web Components\x3c\/a\x3e 文档看了下，然后坚强地写下这些记录。\x3c\/p\x3e\n\x3cp\x3e首先我们需要知道，Web Components 包括了四个部分：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/w3c.github.io\/webcomponents\/spec\/custom\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCustom Elements\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/w3c.github.io\/webcomponents\/spec\/imports\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHTML Imports\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/html.spec.whatwg.org\/multipage\/scripting.html#the-template-element\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHTML Templates\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/w3c.github.io\/webcomponents\/spec\/shadow\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eShadow DOM\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e这四部分有机地组合在一起，才是 Web Components。\x3c\/p\x3e\n\x3cp\x3e可以用自定义的标签来引入组件是前端组件化的基础，在页面引用 HTML 文件和 HTML 模板是用于支撑编写组件视图和组件资源管理，而 Shadow DOM 则是隔离组件间代码的冲突和影响。\x3c\/p\x3e\n\x3cp\x3e下边分别是每一部分的笔记内容。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3eCustom Elements\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e概述\x3c\/h3\x3e\n\x3cp\x3eCustom Elements 顾名思义，是提供一种方式让开发者可以自定义 HTML 元素，包括特定的组成，样式和行为。支持 Web Components 标准的浏览器会提供一系列 API 给开发者用于创建自定义的元素，或者扩展现有元素。\x3c\/p\x3e\n\x3cp\x3e这一项标准的草案还处于不稳定的状态，时有更新，API 还会有所变化，下边的笔记以 \x3ca href=\x22https:\/\/www.w3.org\/TR\/2016\/WD-custom-elements-20160226\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCutsom Elements 2016.02.26\x3c\/a\x3e 这个版本为准，因为在最新的 chrome 浏览器已经是可以工作的了，这样可以使用 demo 来做尝试，最后我会再简单写一下最新文档和这个的区别。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3eregisterElement\x3c\/h3\x3e\n\x3cp\x3e首先，我们可以尝试在 chrome 控制台输入 \x3ccode\x3eHTMLInputElement\x3c\/code\x3e，可以看到是有这么一个东西的，这个理解为 input DOM 元素实例化时的构造函数，基础的是 \x3ccode\x3eHTMLElement\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3eWeb Components 标准提出提供这么一个接口：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22document.registerElement(\x27x-foo\x27, {\n  prototype: Object.create(HTMLElement.prototype, {\n    createdCallback: {      \n      value: function() { ... }\n    },\n    ...\n  })\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.registerElement(\x3cspan class=\x22hljs-string\x22\x3e\x27x-foo\x27\x3c\/span\x3e, {\n  \x3cspan class=\x22hljs-attr\x22\x3eprototype\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.create(HTMLElement.prototype, {\n    \x3cspan class=\x22hljs-attr\x22\x3ecreatedCallback\x3c\/span\x3e: {      \n      \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ ... }\n    },\n    ...\n  })\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e你可以使用 \x3ccode\x3edocument.registerElement\x3c\/code\x3e 来注册一个标签，标准中为了提供 namesapce 的支持，防止冲突，规定标签类型（也可以理解为名字）需要使用 \x3ccode\x3e-\x3c\/code\x3e 连接。同时，不能是以下这一些：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eannotation-xml\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ecolor-profile\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efont-face\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efont-face-src\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efont-face-uri\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efont-face-format\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efont-face-name\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3emissing-glyph\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e第二个参数是标签相关的配置，主要是提供一个 \x3ccode\x3eprototype\x3c\/code\x3e，这个原型对象是以 \x3ccode\x3eHTMLElement\x3c\/code\x3e 等的原型为基础创建的对象。然后你便可以在 HTML 中去使用自定义的标签。如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv\x3e\n  \x3cx-foo\x3e\x3c\/x-foo\x3e\n\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ex-foo\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ex-foo\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e是不是嗅到了 React 的味道？好吧，React 说它自己主要不是做这个事情的。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e生命周期和回调\x3c\/h3\x3e\n\x3cp\x3e在这个 API 的基础上，Web Components 标准提供了一系列控制自定义元素的方法。我们来一一看下：\x3c\/p\x3e\n\x3cp\x3e一个自定义元素会经历以下这些生命周期：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e注册前创建\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e注册自定义元素定义\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在注册后创建元素实例\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e元素插入到 document 中\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e元素从 document 中移除\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e元素的属性变化时\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e这个是很重要的内容，开发者可以在注册新的自定义元素时指定对应的生命周期回调来为自定义元素添加各种自定义的行为，这些生命周期回调包括了：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3ecreatedCallback\x3cbr\x3e  自定义元素注册后，在实例化之后会调用，通常多用于做元素的初始化，如插入子元素，绑定事件等。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eattachedCallback\x3cbr\x3e  元素插入到 document 时触发。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3edetachedCallback\x3cbr\x3e  元素从 document 中移除时触发，可能会用于做类似 destroy 之类的事情。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eattributeChangedCallback\x3cbr\x3e  元素属性变化时触发，可以用于从外到内的通信。外部通过修改元素的属性来让内部获取相关的数据并且执行对应的操作。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e这个回调在不同情况下有对应不同的参数：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e设置属性时，参数列表是：属性名称，null，值，命名空间\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e修改属性时，参数列表是：属性名称，旧值，新值，命名空间\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e删除属性时，参数列表是：属性名称，旧值，null，命名空间\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e好了，就上边了解到的基础上，假设我们要创建一个自定义的 \x3ccode\x3ebutton-hello\x3c\/code\x3e 按钮，点击时会 \x3ccode\x3ealert(\x27hello world\x27)\x3c\/code\x3e，代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22document.registerElement(\x27button-hello\x27, {\n  prototype: Object.create(HTMLButtonElement.prototype, {\n    createdCallback: {\n      value: function createdCallback() {\n        this.innerHTML = \x27\x3cbutton\x3ehello world\x3c\/button\x3e\x27\n        this.addEventListener(\x27click\x27, () =\x3e {\n          alert(\x27hello world\x27)\n        })\n      }\n    }\n  })\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.registerElement(\x3cspan class=\x22hljs-string\x22\x3e\x27button-hello\x27\x3c\/span\x3e, {\n  \x3cspan class=\x22hljs-attr\x22\x3eprototype\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.create(HTMLButtonElement.prototype, {\n    \x3cspan class=\x22hljs-attr\x22\x3ecreatedCallback\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreatedCallback\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.innerHTML = \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;button\x26gt;hello world\x26lt;\/button\x26gt;\x27\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, () =\x26gt; {\n          alert(\x3cspan class=\x22hljs-string\x22\x3e\x27hello world\x27\x3c\/span\x3e)\n        })\n      }\n    }\n  })\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e要留意上述代码执行之后才能使用 \x3ccode\x3e\x26lt;button-hello\x26gt;\x26lt;\/button-hello\x26gt;\x3c\/code\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e扩展原有元素\x3c\/h3\x3e\n\x3cp\x3e其实，如果我们需要一个按钮，完全不需要重新自定义一个元素，Web Components 标准提供了一种扩展现有标签的方式，把上边的代码调整一下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22document.registerElement(\x27button-hello\x27, {\n  prototype: Object.create(HTMLButtonElement.prototype, {\n    createdCallback: {\n      value: function createdCallback() {\n        this.addEventListener(\x27click\x27, () =\x3e {\n          alert(\x27hello world\x27)\n        })\n      }\n    }\n  }),\n  extends: \x27button\x27\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.registerElement(\x3cspan class=\x22hljs-string\x22\x3e\x27button-hello\x27\x3c\/span\x3e, {\n  \x3cspan class=\x22hljs-attr\x22\x3eprototype\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.create(HTMLButtonElement.prototype, {\n    \x3cspan class=\x22hljs-attr\x22\x3ecreatedCallback\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreatedCallback\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, () =\x26gt; {\n          alert(\x3cspan class=\x22hljs-string\x22\x3e\x27hello world\x27\x3c\/span\x3e)\n        })\n      }\n    }\n  }),\n  \x3cspan class=\x22hljs-attr\x22\x3eextends\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27button\x27\x3c\/span\x3e\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后在 HTML 中要这么使用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cbutton is=\x26quot;button-hello\x26quot;\x3ehello world\x3c\/button\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eis\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22button-hello\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3ehello world\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用 \x3ccode\x3eis\x3c\/code\x3e 属性来声明一个扩展的类型，看起来也蛮酷的。生命周期和自定义元素标签的保持一致。\x3c\/p\x3e\n\x3cp\x3e当我们需要多个标签组合成新的元素时，我们可以使用自定义的元素标签，但是如果只是需要在原有的 HTML 标签上进行扩展的话，使用 \x3ccode\x3eis\x3c\/code\x3e 的这种元素扩展的方式就好。\x3c\/p\x3e\n\x3cp\x3e原有的 \x3ccode\x3ecreateElement\x3c\/code\x3e 和 \x3ccode\x3ecreateElementNS\x3c\/code\x3e，在 Web Components 标准中也扩展成为支持元素扩展，例如要创建一个 \x3ccode\x3ebutton-hello\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const hello = document.createElement(\x27button\x27, \x27button-hello\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hello = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27button\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27button-hello\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e标准文档中还有很多细节上的内容，例如接口的参数说明和要求，回调队列的实现要求等，这些更多是对于实现这个标准的浏览器开发者的要求，这里不做详细描述了，内容很多，有兴趣的自行查阅：\x3ca href=\x22https:\/\/www.w3.org\/TR\/2016\/WD-custom-elements-20160226\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCutsom Elements 2016.02.26\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e和最新版的区别\x3c\/h3\x3e\n\x3cp\x3e前边我提到说文档的更新变化很快，截止至我写这个文章的时候，最新的文档是这个：\x3ca href=\x22https:\/\/www.w3.org\/TR\/custom-elements\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCustom Elements 2016.07.21\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e细节不做描述了，讲讲我看到的最大变化，就是向 ES6 靠拢。大致有下边三点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e从原本的扩展 prototype 来定义元素调整为建议使用 class extends 的方式\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e注册自定义元素接口调整，更加方便使用，传入 type 和 class 即可\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e生命周期回调调整，\x3ccode\x3ecreatedCallback\x3c\/code\x3e 直接用 class 的 \x3ccode\x3econstructor\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e前两个点，我们直接看下代码，原本的代码按照新的标准，应该调整为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class ButtonHelloElement extends HTMLButtonElement {\n  constructor() {\n    super()\n\n    this.addEventListener(\x27click\x27, () =\x3e {\n      alert(\x27hello world\x27)\n    })\n  }\n}\n\ncustomElements.define(\x27button-hello\x27, ButtonHelloElement, { extends: \x27button\x27 })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eButtonHelloElement\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHTMLButtonElement\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e() {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e()\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, () =\x26gt; {\n      alert(\x3cspan class=\x22hljs-string\x22\x3e\x27hello world\x27\x3c\/span\x3e)\n    })\n  }\n}\n\ncustomElements.define(\x3cspan class=\x22hljs-string\x22\x3e\x27button-hello\x27\x3c\/span\x3e, ButtonHelloElement, { \x3cspan class=\x22hljs-attr\x22\x3eextends\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27button\x27\x3c\/span\x3e })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e从代码上看会感觉更加 OO，编写上也比原本要显得方便一些，原本的生命周期回调是调整为新的：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3econstructor in class 作用相当于原本的 createdCallback\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3econnectedCallback 作用相当于 attachedCallback\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3edisconnectedCallback 作用相当于 detachedCallback\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eadoptedCallback 使用 \x3ccode\x3edocument.adoptNode(node)\x3c\/code\x3e 时触发\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eattributeChangedCallback 和原本保持一致\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3econnect 事件和插入元素到 document 有些许区别，主要就是插入元素到 document 时，元素状态会变成 \x3ccode\x3econnected\x3c\/code\x3e，这时会触发 connectedCallback，disconnect 亦是如此。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3eHTML Imports\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e概述\x3c\/h3\x3e\n\x3cp\x3eHTML Imports 是一种在 HTMLs 中引用以及复用其他的 HTML 文档的方式。这个 Import 很漂亮，可以简单理解为我们常见的模板中的 \x3ccode\x3einclude\x3c\/code\x3e 之类的作用。\x3c\/p\x3e\n\x3cp\x3e我们最常见的引入一个 css 文件的方式是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3clink rel=\x26quot;stylesheet\x26quot; href=\x26quot;\/css\/master.css\x26quot;\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/css\/master.css\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eWeb Components 现在提供多了一个这个：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3clink rel=\x26quot;import\x26quot; href=\x26quot;\/components\/header.html\x26quot;\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22import\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/components\/header.html\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3eHTMLLinkElement\x3c\/h3\x3e\n\x3cp\x3e原本的 \x3ccode\x3elink\x3c\/code\x3e 标签在添加了 HTML Import 之后，多了一个只读的 \x3ccode\x3eimport\x3c\/code\x3e 属性，当出现下边两种情况时，这个属性为 \x3ccode\x3enull\x3c\/code\x3e：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e该 \x3ccode\x3elink\x3c\/code\x3e 不是用来 import 一个 HTML 的。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e该 \x3ccode\x3elink\x3c\/code\x3e 元素不在 document 中。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e否则，这个属性会返回一个表示引入的 HTML 文件的文档对象，类似于 \x3ccode\x3edocument\x3c\/code\x3e。比如说，在上边的代码基础上，可以这样做：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const link = document.querySelector(\x27link[rel=import]\x27)\nconst header = link.import;\n\nconst pulse = header.querySelector(\x27div.logo\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e link = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27link[rel=import]\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e header = link.import;\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e pulse = header.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27div.logo\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e阻塞式\x3c\/h3\x3e\n\x3cp\x3e我们要知道的是，默认的 \x3ccode\x3elink\x3c\/code\x3e 加载是阻塞式的，除非你给他添加一个 \x3ccode\x3easync\x3c\/code\x3e 标识。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e阻塞式从某种程度上讲是有必要的，当你 improt 的是一个完整的自定义组件并且需要在主 HTML 中用标签直接使用时，非阻塞的就会出现错误了，因为标签还没有被注册。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3edocument\x3c\/h3\x3e\n\x3cp\x3e有一点值得留意的是，在 import 的 HTML 中，我们编写的 script 里边的 \x3ccode\x3edocument\x3c\/code\x3e 是指向 import 这个 HTML 的主 HTML 的 document。\x3c\/p\x3e\n\x3cp\x3e如果我们要获取 import 的 HTML 的 document 的话，得这么来：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const d = document.currentScript.ownerDocument\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e d = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.currentScript.ownerDocument\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样设计是因为 import 进来的 HTML 需要用到主 HTML 的 document。例如我们上边提到的 \x3ccode\x3eregisterElement\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e在一个被 import 的 HTML 文件中使用下边三个方法会抛出一个 \x3ca href=\x22https:\/\/html.spec.whatwg.org\/multipage\/infrastructure.html#invalidstateerror\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eInvalidStateError\x3c\/a\x3e 异常：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3edocument.open()\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3edocument.write()\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3edocument.close()\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e对于 HTML Import，标准文档中还有很大一部分内容是关于多个依赖加载的处理算法的，在这里就不详述了，有机会的话找时间再开篇谈，这些内容是需要浏览器去实现的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3eHTML Templates\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e概述\x3c\/h3\x3e\n\x3cp\x3e这个东西很简单，用过 handlebars 的人都知道有这么一个东西：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript id=\x26quot;template\x26quot; type=\x26quot;text\/x-handlebars-template\x26quot;\x3e\n  ...\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22template\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\/x-handlebars-template\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\n  ...\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其他模板引擎也有类似的东西，那么 HTML Templates 便是把这个东西官方标准化，提供了一个 \x3ccode\x3etemplate\x3c\/code\x3e 标签来存放以后需要但是暂时不渲染的 HTML 代码。\x3c\/p\x3e\n\x3cp\x3e以后可以这么写了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ctemplate id=\x26quot;template\x26quot;\x3e\n  ...\n\x3c\/template\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22template\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  ...\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e接口和应用\x3c\/h3\x3e\n\x3cp\x3etemplate 元素有一个只读的属性 \x3ccode\x3econtent\x3c\/code\x3e，用于返回这个 template 里边的内容，返回的结果是一个 \x3ccode\x3eDocumentFragment\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e具体是如何使用的，直接参考官方给出的例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!doctype html\x3e\n\x3chtml lang=\x26quot;en\x26quot;\x3e\n  \x3chead\x3e\n    \x3ctitle\x3eHomework\x3c\/title\x3e\n  \x3cbody\x3e\n    \x3ctemplate id=\x26quot;template\x26quot;\x3e\x3cp\x3eSmile!\x3c\/p\x3e\x3c\/template\x3e\n    \x3cscript\x3e\n      let num = 3;\n      const fragment = document.getElementById(\x27template\x27).content.cloneNode(true);\n      while (num-- \x3e 1) {\n        fragment.firstChild.before(fragment.firstChild.cloneNode(true));\n        fragment.firstChild.textContent \x2b= fragment.lastChild.textContent;\n      }\n      document.body.appendChild(fragment);\n    \x3c\/script\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!doctype html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elang\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22en\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3eHomework\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22template\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3eSmile!\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e num = \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fragment = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27template\x27\x3c\/span\x3e).content.cloneNode(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (num-- \x26gt; \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n        fragment.firstChild.before(fragment.firstChild.cloneNode(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e));\n        fragment.firstChild.textContent \x2b= fragment.lastChild.textContent;\n      }\n      \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.appendChild(fragment);\n    \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用 \x3ccode\x3eDocumentFragment\x3c\/code\x3e 的 clone 方法以 \x3ccode\x3etemplate\x3c\/code\x3e 里的代码为基础创建一个元素节点，然后你便可以操作这个元素节点，最后在需要的时候插入到 document 中特定位置便可以了。\x3c\/p\x3e\n\x3cp\x3eTemplate 相关的东西不多，而且它现在已经是纳入生效的 \x3ca href=\x22https:\/\/html.spec.whatwg.org\/multipage\/scripting.html#the-template-element\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e标准文档\x3c\/a\x3e 中了。\x3c\/p\x3e\n\x3cp\x3e我们接下来看看重磅的 Shadow DOM。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader14\x22\x3eShadow DOM\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e概述\x3c\/h3\x3e\n\x3cp\x3eShadow DOM 好像提出好久了，最本质的需求是需要一个隔离组件代码作用域的东西，例如我组件代码的 CSS 不能影响其他组件之类的，而 \x3ccode\x3eiframe\x3c\/code\x3e 又太重并且可能有各种奇怪问题。\x3c\/p\x3e\n\x3cp\x3e可以这么说，Shadow DOM 旨在提供一种更好地组织页面元素的方式，来为日趋复杂的页面应用提供强大支持，避免代码间的相互影响。\x3c\/p\x3e\n\x3cp\x3e看下在 chrome 它会是咋样的：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006763834\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006763834\x22 alt=\x22Shadow DOM in chrome\x22 title=\x22Shadow DOM in chrome\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我们可以通过 \x3ccode\x3ecreateShadowRoot()\x3c\/code\x3e 来给一个元素节点创建 Shadow Root，这些元素类型必须是下边列表的其中一个，否则会抛出 NotSupportedError 异常。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e自定义的元素\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3earticle\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3easide\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eblockquote\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ebody\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ediv\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eheader, footer\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eh1, h2, h3, h4, h5, h6\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3enav\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ep\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3esection\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3espan\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3ccode\x3ecreateShadowRoot()\x3c\/code\x3e 是现在 chrome 实现的 API，来自文档：\x3ca href=\x22https:\/\/www.w3.org\/TR\/2014\/WD-shadow-dom-20140617\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/www.w3.org\/TR\/2014\/WD...\x3c\/a\x3e。最新的文档 API 已经调整为 \x3ccode\x3eattachShadow()\x3c\/code\x3e。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e返回的 Shadow Root 对象从 DocumentFragment 继承而来，所以可以使用相关的一些方法，例如 \x3ccode\x3eshadowRoot.getElementById(\x27id\x27)\x3c\/code\x3e 来获取 Shadow DOM 里边的元素。\x3c\/p\x3e\n\x3cp\x3e简单的使用如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const div = document.getElementById(\x27id\x27)\nconst shadowRoot = div.createShadowRoot()\nconst span = document.createElement(\x27span\x27)\n\nspan.textContent = \x27hello world\x27\nshadowRoot.appendChild(span)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e div = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27id\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e shadowRoot = div.createShadowRoot()\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e span = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27span\x27\x3c\/span\x3e)\n\nspan.textContent = \x3cspan class=\x22hljs-string\x22\x3e\x27hello world\x27\x3c\/span\x3e\nshadowRoot.appendChild(span)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这里，我把这个 div 成为是这个 Shadow DOM 的 \x3cstrong\x3e宿主元素\x3c\/strong\x3e，下边的内容会延续使用这个称呼。\x3c\/p\x3e\n\x3cp\x3eShadow DOM 本身就为了代码隔离而生，所以在 document 上使用 query 时，是没法获取到 Shadow DOM 里边的元素的，需要在 Shadow Root 上做 query 才行。\x3c\/p\x3e\n\x3cp\x3e在这里附上一个文档，里边有详细的关于新的标准和现在 blink 引擎实现的 Shadow DOM 的区别，官方上称之为 v0 和 v1：\x3ca href=\x22https:\/\/github.com\/w3c\/webcomponents\/blob\/gh-pages\/proposals\/shadow-dom-v1-in-blink.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eShadow DOM v1 in Blink\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3eAPI\x3c\/h3\x3e\n\x3cp\x3eShadow Root 除了从 DocumentFragment 继承而来的属性和方法外，还多了另外两个属性：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3ehost 只读属性，用来获取这个 Shadow Root 所属的元素\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3einnerHTML 用来获取或者设置里边的 HTML 字符串，和我们常用的 \x3ccode\x3eelement.innerHTML\x3c\/code\x3e 是一样的\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e另外，在最新的标准文档中，元素除了上边提到的 \x3ccode\x3eattachShadow\x3c\/code\x3e 方法之外，还多了三个属性：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eassignedSlot 只读，这个元素如果被分配到了某个 Shadow DOM 里边的 slot，那么会返回这个对应的 slot 元素\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eslot 元素的 slot 属性，用来指定 slot 的名称\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eshadowRoot 只读，元素下面对应的 Shadow Root 对象\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3eslot 是什么？接着看下边的内容，看完下一节的最后一部分就会明白上述内容和 slot 相关的两个 API 有什么作用。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3eslot\x3c\/h3\x3e\n\x3cp\x3eslot 提供了在使用自定义标签的时候可以传递子模板给到内部使用的能力，可以简单看下 \x3ca href=\x22https:\/\/vuejs.org.cn\/guide\/components.html#\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVue\x3c\/a\x3e 的一个例子。\x3c\/p\x3e\n\x3cp\x3e我们先来看下现在 chrome 可以跑的 v0 版本，这一个版本是提供了一个 content 标签，代表了一个占位符，并且有一个 \x3ccode\x3eselect\x3c\/code\x3e 属性用来指定使用哪些子元素。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!-- component input-toggle template --\x3e\n\x3cinput type=\x26quot;checkbox\x26quot;\x3e\x3c\/input\x3e\n\x3ccontent select=\x26quot;.span\x26quot;\x3e\x3c\/content\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- component input-toggle template --\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22checkbox\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3econtent\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eselect\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22.span\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3econtent\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e自定义的元素里边的子元素代码是这样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput-toggle name=\x26quot;hello\x26quot;\x3e\n  \x3cspan\x3ehello\x3c\/span\x3e\n  \x3cspan class=\x26quot;span\x26quot;\x3etest\x3c\/span\x3e\n\x3c\/input-toggle\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput-toggle\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22hello\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3ehello\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22span\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3etest\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3einput-toggle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么展现的结果会和下边的代码是一样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput-toggle name=\x26quot;hello\x26quot;\x3e\n  \x3cinput type=\x26quot;checkbox\x26quot;\x3e\x3c\/input\x3e\n  \x3cspan class=\x26quot;span\x26quot;\x3etest\x3c\/span\x3e\n\x3c\/input-toggle\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput-toggle\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22hello\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22checkbox\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22span\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3etest\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3einput-toggle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里只是说展现结果，实际上，\x3ccode\x3einput-toggle\x3c\/code\x3e 里边应该是创建了一个 Shadow DOM，然后 \x3ccode\x3econtent\x3c\/code\x3e 标签引用了目标的 \x3ccode\x3espan\x3c\/code\x3e 内容，在 chrome 看是这样的：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006745773\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006745773\x22 alt=\x22content tag in chrome\x22 title=\x22content tag in chrome\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e然后，是最新标准中的 slot 使用方式，直接上例子代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!-- component input-toggle template --\x3e\n\x3cinput type=\x26quot;checkbox\x26quot;\x3e\x3c\/input\x3e\n\x3cslot name=\x26quot;text\x26quot;\x3e\x3c\/slot\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- component input-toggle template --\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22checkbox\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eslot\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eslot\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在自定义的元素标签是这么使用 slot 的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput-toggle name=\x26quot;hello\x26quot;\x3e\n  \x3cinput type=\x26quot;checkbox\x26quot;\x3e\x3c\/input\x3e\n  \x3cspan class=\x26quot;span\x26quot; slot=\x26quot;text\x26quot;\x3etest\x3c\/span\x3e\n\x3c\/input-toggle\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput-toggle\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22hello\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22checkbox\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22span\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eslot\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3etest\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3einput-toggle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过 \x3ccode\x3eslot=\x22text\x22\x3c\/code\x3e 的属性来让元素内部的 slot 占位符可以引用到这个元素，多个元素使用这个属性也是可以的。这样子我们便拥有了使用标签是从外部传 template 给到自定义元素的内部去使用，而且具备指定放在那里的能力。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader18\x22\x3eCSS 相关\x3c\/h3\x3e\n\x3cp\x3e因为有 Shadow DOM 的存在，所以在 CSS 上又添加了很多相关的东西，其中一部分还是属于讨论中的草案，命名之类的可能会有变更，下边提及的内容主要来自文档：\x3ca href=\x22https:\/\/www.w3.org\/TR\/css-scoping-1\/#shadow-dom\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eShadow DOM in CSS scoping 1\x3c\/a\x3e，很多部分在 chrome 是已经实现的了，有兴趣可以写 demo 试试。\x3c\/p\x3e\n\x3cp\x3e因为 Shadow DOM 很大程度上是为了隔离样式作用域而诞生的，主文档中的样式规则不对 Shadow DOM 里的子文档生效，子文档中的样式规则也不影响外部文档。\x3c\/p\x3e\n\x3cp\x3e但不可避免的，在某些场景下，我们需要外部可以控制 Shadow DOM 中样式，如提供一个组件给你，有时候你会希望可以自定义它内部的一些样式，同时，Shadow DOM 中的代码有时候可能需要能够控制其所属元素的样式，甚至，组件内部可以定义上边提到的通过 slot 传递进来的 HTML 的样式。所以呢，是的，CSS 选择器中添加了几个伪类，我们一一来看下它们有什么作用。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e在阅读下边描述的时候，请留意一下选择器的代码是在什么位置的，Shadow DOM 内部还是外部。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3ccode\x3e:host\x3c\/code\x3e 用于在 Shadow DOM 内部选择到其宿主元素，当它不是在 Shadow DOM 中使用时，便匹配不到任意元素。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e在 Shadow DOM 中的 * 选择器是无法选择到其宿主元素的。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3ccode\x3e:host( \x26lt;selector\x26gt; )\x3c\/code\x3e 括号中是一个选择器，这个可以理解为是一个用于兼容在主文档和 Shadow DOM 中使用的方法，当这个选择器在 Shadow DOM 中时，会匹配到括号中选择器对应的宿主元素，如果不是，则匹配括号中选择器能够匹配到的元素。\x3c\/p\x3e\n\x3cp\x3e文档中提供了一个例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cx-foo class=\x26quot;foo\x26quot;\x3e\n  \x3c\x26quot;shadow tree\x26quot;\x3e\n    \x3cdiv class=\x26quot;foo\x26quot;\x3e...\x3c\/div\x3e\n  \x3c\/\x3e\n\x3c\/x-foo\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ex-foo\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e\x22shadow\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etree\x3c\/span\x3e\x22\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e...\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ex-foo\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这个 \x3ccode\x3eshadow tree\x3c\/code\x3e 内部的样式代码中，会有这样的结果：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3e:host\x3c\/code\x3e 匹配 \x3ccode\x3e\x26lt;x-foo\x26gt;\x3c\/code\x3e 元素\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ex-foo\x3c\/code\x3e 匹配不到元素\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3e.foo\x3c\/code\x3e 只匹配到 \x3ccode\x3e\x26lt;div\x26gt;\x3c\/code\x3e 元素\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3e.foo:host\x3c\/code\x3e 匹配不到元素\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3e:host(.foo)\x3c\/code\x3e 匹配 \x3ccode\x3e\x26lt;x-foo\x26gt;\x3c\/code\x3e 元素\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3ccode\x3e:host-context( \x26lt;selector\x26gt; )\x3c\/code\x3e，用于在 Shadow DOM 中来检测宿主元素的父级元素，如果宿主元素或者其祖先元素能够被括号中的选择器匹配到的话，那么这个伪类选择器便匹配到这个 Shadow DOM 的宿主元素。个人理解是用于在宿主元素外部元素满足一定的条件时添加样式。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3e::shadow\x3c\/code\x3e 这个伪类用于在 Shadow DOM 外部匹配其内部的元素，而 \x3ccode\x3e\/deep\/\x3c\/code\x3e 这个标识也有同样的作用，我们来看一个例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cx-foo\x3e\n   \x3c\x26quot;shadow tree\x26quot;\x3e\n     \x3cdiv\x3e\n       \x3cspan id=\x26quot;not-top\x26quot;\x3e...\x3c\/span\x3e\n     \x3c\/div\x3e\n     \x3cspan id=\x26quot;top\x26quot;\x3e...\x3c\/span\x3e\n   \x3c\/\x3e\n \x3c\/x-foo\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ex-foo\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n   \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e\x22shadow\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etree\x3c\/span\x3e\x22\x26gt;\x3c\/span\x3e\n     \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n       \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22not-top\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e...\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n     \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n     \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22top\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e...\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n   \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x26gt;\x3c\/span\x3e\n \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ex-foo\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于上述这一段代码的 HTML 结构，在 Shadow DOM 外部的样式代码中，会是这样的：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ex-foo::shadow \x26gt; span\x3c\/code\x3e 可以匹配到 \x3ccode\x3e#top\x3c\/code\x3e 元素\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3e#top\x3c\/code\x3e 匹配不到元素\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ex-foo \/deep\/ span\x3c\/code\x3e 可以匹配到 \x3ccode\x3e#not-top\x3c\/code\x3e 和 \x3ccode\x3e#top\x3c\/code\x3e 元素\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3ccode\x3e\/deep\/\x3c\/code\x3e 这个标识的作用和我们的 \x3ccode\x3e\x26gt;\x3c\/code\x3e 选择器有点类似，只不过它是匹配其对应的 Shadow DOM 内部的，这个标识可能还会变化，例如改成 \x3ccode\x3e\x26gt;\x26gt;\x3c\/code\x3e 或者 \x3ccode\x3e\x26gt;\x26gt;\x26gt;\x3c\/code\x3e 之类的，个人感觉， \x3ccode\x3e\x26gt;\x26gt;\x3c\/code\x3e 会更舒服。\x3c\/p\x3e\n\x3cp\x3e最后一个，用于在 Shadow DOM 内部调整 slot 的样式，在我查阅的这个文档中，暂时是以 chrome 实现的为准，使用 \x3ccode\x3e::content\x3c\/code\x3e 伪类，不排除有更新为 \x3ccode\x3e::slot\x3c\/code\x3e 的可能性。我们看一个例子来了解一下，就算名称调整了也是差不多的用法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cx-foo\x3e\n  \x3cdiv id=\x26quot;one\x26quot; class=\x26quot;foo\x26quot;\x3e...\x3c\/div\x3e\n  \x3cdiv id=\x26quot;two\x26quot;\x3e...\x3c\/div\x3e\n  \x3cdiv id=\x26quot;three\x26quot; class=\x26quot;foo\x26quot;\x3e\n    \x3cdiv id=\x26quot;four\x26quot;\x3e...\x3c\/div\x3e\n  \x3c\/div\x3e\n  \x3c\x26quot;shadow tree\x26quot;\x3e\n    \x3cdiv id=\x26quot;five\x26quot;\x3e...\x3c\/div\x3e\n    \x3cdiv id=\x26quot;six\x26quot;\x3e...\x3c\/div\x3e\n    \x3ccontent select=\x26quot;.foo\x26quot;\x3e\x3c\/content\x3e\n  \x3c\/\x26quot;shadow tree\x26quot;\x3e\n\x3c\/x-foo\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ex-foo\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22one\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e...\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22two\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e...\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22three\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22four\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e...\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e\x22shadow\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etree\x3c\/span\x3e\x22\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22five\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e...\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22six\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e...\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3econtent\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eselect\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22.foo\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3econtent\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3e\x22shadow\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etree\x3c\/span\x3e\x22\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ex-foo\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在 Shadow DOM 内部的样式代码中，\x3ccode\x3e::content div\x3c\/code\x3e 可以匹配到 \x3ccode\x3e#one\x3c\/code\x3e，\x3ccode\x3e#three\x3c\/code\x3e 和 \x3ccode\x3e#four\x3c\/code\x3e，留意一下 \x3ccode\x3e#two\x3c\/code\x3e 为什么没被匹配到，因为它没有被 content 元素选中，即不会进行引用。如果更换成 slot 的 name 引用的方式亦是同理。\x3c\/p\x3e\n\x3cp\x3e层叠规则，按照这个文档的说法，对于两个优先级别一样的 CSS 声明，没有带 \x3ccode\x3e!important\x3c\/code\x3e 的，在 Shadow DOM 外部声明的优先级高于在 Shadow DOM 内部的，而带有 \x3ccode\x3e!important\x3c\/code\x3e 的，则相反。个人认为，这是提供给外部一定的控制能力，同时让内部可以限制一定的影响范围。\x3c\/p\x3e\n\x3cp\x3e继承方面相对简单，在 Shadow DOM 内部的顶级元素样式从宿主元素继承而来。\x3c\/p\x3e\n\x3cp\x3e至此，Web Components 四个部分介绍结束了，其中有一些细节，浏览器实现细节，还有使用上的部分细节，是没有提及的，因为详细记录的话，还会有很多东西，内容很多。当使用过程中有疑问时可以再次查阅标准文档，有机会的话会再完善这个文章。下一部分会把这四个内容组合起来，整体看下 Web Components 是怎么使用的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader19\x22\x3eWeb Components\x3c\/h2\x3e\n\x3cp\x3eWeb Components 总的来说是提供一整套完善的封装机制来把 Web 组件化这个东西标准化，每个框架实现的组件都统一标准地进行输入输出，这样可以更好推动组件的复用。结合上边各个部分的内容，我们整合一起来看下应该怎么使用这个标准来实现我们的组件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!-- components\/header.html --\x3e\n\x3ctemplate id=\x26quot;\x26quot;\x3e\n\x3cstyle\x3e\n::content li {\n  display: inline-block;\n  padding: 20px 10px;\n}\n\x3c\/style\x3e\n\x3ccontent select=\x26quot;ul\x26quot;\x3e\x3c\/content\x3e\n\x3c\/template\x3e\n\x3cscript\x3e\n(function() {\n  const element = Object.create(HTMLInputElement.prototype)\n  const template = document.currentScript.ownerDocument.querySelector(\x27template\x27)\n\n  element.createdCallback = function() {\n    const shadowRoot = this.createShadowRoot()\n    const clone = document.importNode(template.content, true)\n    shadowRoot.appendChild(clone)\n\n    this.addEventListener(\x27click\x27, function(event) {\n      console.log(event.target.textContent)\n    })\n  }\n\n  document.registerElement(\x27test-header\x27, { prototype: element })\n})()\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- components\/header.html --\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n\x3cspan class=\x22hljs-selector-pseudo\x22\x3e::content\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eli\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: inline-block;\n  \x3cspan class=\x22hljs-attribute\x22\x3epadding\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e20px\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e10px\x3c\/span\x3e;\n}\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3econtent\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eselect\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22ul\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3econtent\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etemplate\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e element = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.create(HTMLInputElement.prototype)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e template = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.currentScript.ownerDocument.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27template\x27\x3c\/span\x3e)\n\n  element.createdCallback = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e shadowRoot = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.createShadowRoot()\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e clone = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.importNode(template.content, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e)\n    shadowRoot.appendChild(clone)\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(event.target.textContent)\n    })\n  }\n\n  \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.registerElement(\x3cspan class=\x22hljs-string\x22\x3e\x27test-header\x27\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3eprototype\x3c\/span\x3e: element })\n})()\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这是一个简单的组件的例子，用于定义一个 \x3ccode\x3etest-header\x3c\/code\x3e，并且给传递进来的子元素 \x3ccode\x3eli\x3c\/code\x3e 添加了一些组件内部的样式，同时给组件绑定了一个点击事件，来打印点击目标的文本内容。\x3c\/p\x3e\n\x3cp\x3e看下如何在一个 HTML 文件中引入并且使用一个组件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!-- index.html --\x3e\n\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n  \x3chead\x3e\n    \x3cmeta charset=\x26quot;utf-8\x26quot;\x3e\n    \x3ctitle\x3e\x3c\/title\x3e\n\n    \x3clink rel=\x26quot;import\x26quot; href=\x26quot;components\/header.html\x26quot;\x3e\n  \x3c\/head\x3e\n  \x3cbody\x3e\n    \x3ctest-header\x3e\n      \x3cul\x3e\n        \x3cli\x3eHome\x3c\/li\x3e\n        \x3cli\x3eAbout\x3c\/li\x3e\n      \x3c\/ul\x3e\n    \x3c\/test-header\x3e\n  \x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!-- index.html --\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3emeta\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etitle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22import\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22components\/header.html\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3etest-header\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3eHome\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3eAbout\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3etest-header\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e一个 \x3ccode\x3eimport\x3c\/code\x3e 的 \x3ccode\x3e\x26lt;link\x26gt;\x3c\/code\x3e 把组件的 HTML 文件引用进来，这样会执行组件中的脚本，来注册一个 \x3ccode\x3etest-header\x3c\/code\x3e 元素，这样子我们便可以在主文档中使用这个元素的标签。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e上边的例子是可以在 chrome 正常运行的。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e所以，根据上边简单的例子可以看出，各个部分的内容是有机结合在一起，Custom Elements 提供了自定义元素和标签的能力，template 提供组件模板，import 提供了在 HTML 中合理引入组件的方式，而 Shadow DOM 则处理组件间代码隔离的问题。\x3c\/p\x3e\n\x3cp\x3e不得不承认，Web Components 标准的提出解决了一些问题，必须交由浏览器去处理的是 Shadow DOM，在没有 Shadow DOM 的浏览器上实现代码隔离的方式多多少少有缺陷。个人我觉得组件化的各个 API 不够简洁易用，依旧有 \x3ccode\x3egetElementById\x3c\/code\x3e 这些的味道，但是交由各个类库去简化也可以接受，而 import 功能上没问题，但是加载多个组件时性能问题还是值得商榷，标准可能需要在这个方面提供更多给浏览器的指引，例如是否有可能提供一种单一请求加载多个组件 HTML 的方式等。\x3c\/p\x3e\n\x3cp\x3e在现在的移动化趋势中，Web Components 不仅仅是 Web 端的问题，越来越多的开发者期望以 Web 的方式去实现移动应用，而多端复用的实现渐渐是以组件的形式铺开，例如 \x3ca href=\x22https:\/\/github.com\/facebook\/react-native\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReact Native\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/github.com\/alibaba\/weex\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWeex\x3c\/a\x3e。所以 Web Components 的标准可能会影响到多端开发 Web 化的一个模式和发展。\x3c\/p\x3e\n\x3cp\x3e最后，再啰嗦一句，Web Components 个人觉得还是未来发展趋势，所以才有了这个文章。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Web Components 是个什么样的东西</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006745770">https://segmentfault.com/a/1190000006745770</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/n7579nb2drc/" target="_blank">https://alili.tech/archive/n7579nb2drc/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>