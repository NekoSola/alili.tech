<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="瞅瞅Facebook是怎么保证CSS代码质量的"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>瞅瞅Facebook是怎么保证CSS代码质量的 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/obbxs1xycsg/",
				"appid": "1613049289050283", 
				"title": "瞅瞅Facebook是怎么保证CSS代码质量的 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-09T02:30:58"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/990vsm47t8i/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/0q7mbbs55i6b/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fobbxs1xycsg%2f&text=%e7%9e%85%e7%9e%85Facebook%e6%98%af%e6%80%8e%e4%b9%88%e4%bf%9d%e8%af%81CSS%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e7%9a%84"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fobbxs1xycsg%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fobbxs1xycsg%2f&text=%e7%9e%85%e7%9e%85Facebook%e6%98%af%e6%80%8e%e4%b9%88%e4%bf%9d%e8%af%81CSS%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e7%9a%84"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fobbxs1xycsg%2f&title=%e7%9e%85%e7%9e%85Facebook%e6%98%af%e6%80%8e%e4%b9%88%e4%bf%9d%e8%af%81CSS%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e7%9a%84"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fobbxs1xycsg%2f&is_video=false&description=%e7%9e%85%e7%9e%85Facebook%e6%98%af%e6%80%8e%e4%b9%88%e4%bf%9d%e8%af%81CSS%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e7%9a%84"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%9e%85%e7%9e%85Facebook%e6%98%af%e6%80%8e%e4%b9%88%e4%bf%9d%e8%af%81CSS%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e7%9a%84&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fobbxs1xycsg%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fobbxs1xycsg%2f&title=%e7%9e%85%e7%9e%85Facebook%e6%98%af%e6%80%8e%e4%b9%88%e4%bf%9d%e8%af%81CSS%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e7%9a%84"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fobbxs1xycsg%2f&title=%e7%9e%85%e7%9e%85Facebook%e6%98%af%e6%80%8e%e4%b9%88%e4%bf%9d%e8%af%81CSS%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e7%9a%84"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fobbxs1xycsg%2f&title=%e7%9e%85%e7%9e%85Facebook%e6%98%af%e6%80%8e%e4%b9%88%e4%bf%9d%e8%af%81CSS%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e7%9a%84"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fobbxs1xycsg%2f&title=%e7%9e%85%e7%9e%85Facebook%e6%98%af%e6%80%8e%e4%b9%88%e4%bf%9d%e8%af%81CSS%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e7%9a%84"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">瞅瞅Facebook是怎么保证CSS代码质量的</h1><div class="meta"><div class="postdate"><time datetime="2019-02-09" itemprop="datePublished">2019-02-09</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e\x3ca href=\x22https:\/\/code.facebook.com\/posts\/879890885467584\/improving-css-quality-at-facebook-and-beyond\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e原文地址\x3c\/a\x3e\x3cbr\x3e本文从属于笔者的\x3ca href=\x22https:\/\/github.com\/wxyyxc1992\/Web-Frontend-Introduction-And-Best-Practices\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWeb 前端入门与最佳实践\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e在Facebook里，上千名工程师工作在不同的产品线上，为全世界的用户提供可靠优质的服务，而我们在代码质量管理方面也面临着独一无二的挑战。不仅仅是因为我们面对的是一个庞大的代码基库，还有日渐增加的各种各样的特性，有时候如果你想去重构提高某一个模块，往往会影响到其他很多模块。具体在CSS而言，我们需要处理上千份不停变化的CSS文件。之前我们着力于通过Code Review、代码样式规范以及重构等手段协同工作，而保障代码质量，但是还是会有很多的错误悄悄从眼皮底下溜走，被提交进入到代码库里。我们一直用自建的CSS Linter来检测基本的代码错误与保证一致的编码风格，尽管它基本上已经满足了我们的目标，但还是存在很多的问题，因此我也想在这篇文章里对如何保障CSS的代码质量进行一些讨论。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3eRegex is not Enough:之前用的是正则匹配，不咋的啊\x3c\/h1\x3e\n\x3cp\x3e老的Linter主要是基于很多个正则表达式对CSS中的语法进行提取，大概是这个样子的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\npreg_match_all(\n \/\/ This pattern matches [attr] selectors with no preceding selector.  \n    \x27\/\\\/\\*.*?\\*\\\/|\\{[^}]*\\}|\\s(\\[[^\\]]\x2b\\])\/s\x27,\n $data,   \n $matches,   \n PREG_SET_ORDER | PREG_OFFSET_CAPTURE);\n foreach ($matches as $match) {\n   if (isset($match[1])) {\n     raiseError(...);\n   }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs taggerscript\x22\x3e\x3ccode\x3e\npreg_match_all(\n \/\/ This pattern matches [attr] selectors with no preceding selector.  \n    \x27\/\x3cspan class=\x22hljs-symbol\x22\x3e\\\/\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\\*\x3c\/span\x3e.*?\x3cspan class=\x22hljs-symbol\x22\x3e\\*\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\\\/\x3c\/span\x3e|\x3cspan class=\x22hljs-symbol\x22\x3e\\{\x3c\/span\x3e[^}]*\x3cspan class=\x22hljs-symbol\x22\x3e\\}\x3c\/span\x3e|\x3cspan class=\x22hljs-symbol\x22\x3e\\s\x3c\/span\x3e(\x3cspan class=\x22hljs-symbol\x22\x3e\\[\x3c\/span\x3e[^\x3cspan class=\x22hljs-symbol\x22\x3e\\]\x3c\/span\x3e]\x2b\x3cspan class=\x22hljs-symbol\x22\x3e\\]\x3c\/span\x3e)\/s\x27,\n \x3cspan class=\x22hljs-keyword\x22\x3e$data,   \n $matches,   \n PREG_SET_ORDER | PREG_OFFSET_CAPTURE);\n foreach \x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3e$matches as $match) {\n   if \x3c\/span\x3e(isset(\x3cspan class=\x22hljs-keyword\x22\x3e$match[1])) {\n     raiseError\x3c\/span\x3e(...);\n   }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e基本上一个检测规则就需要添加一个专门的匹配规则，非常不好维护，在性能上也有很大的问题。对于每个规则俺们都需要遍历整个文件，性能差得很。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3eAbstract Syntax Tree\x3c\/h1\x3e\n\x3cp\x3e受够了正则表达式，我们想搞一个更好用的也是更细致的CSS解释器。CSS本身也是一门语言，老把它当做纯文本文件处理也不好，因此我们打算用AST，即抽象语法树的方式构建一个解析器。这种新的处理方式在性能上面有个很不错的提升，譬如我们的代码库中有这么一段CSS代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n{\n  display: none:\n  background-color: #8B1D3;\n  padding: 10px,10px,0,0;\n  opacity: 1.0f;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\n{\n  \x3cspan class=\x22hljs-attribute\x22\x3edisplay\x3c\/span\x3e: none:\n  background-color: \x3cspan class=\x22hljs-number\x22\x3e#8B1D3\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3epadding\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10px\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e10px\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-attribute\x22\x3eopacity\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1.0\x3c\/span\x3ef;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e眼神好的估计才能看出这个代码片段中存在的问题，譬如某个属性名错了、十六进制的颜色代码写错的，分隔符写错了等等。浏览器才不会主动给你报错呢，这样开发者自己也就很难找到错误了。在具体实现上，我们发现\x3ca href=\x22http:\/\/postcss.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePostCSS\x3c\/a\x3e 是个不错的工具，因此我们选择了\x3ca href=\x22http:\/\/stylelint.io\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eStylelint\x3c\/a\x3e作为我们新的Linter工具，它是基于PostCSS构建的，非常的灵活，社区也不错。\x3c\/p\x3e\n\x3cp\x3e就像JavaScript中的Esprima以及ESLint一样，Stylelint提供了对于完整的AST的访问方式，能够让你根据不同的情况更快速简单的访问具体的代码节点，譬如现在我们的检测规则写成了这个样子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nroot.walkDecls(node =\x3e {\n  if (node.prop === \x27text-transform\x27 \x26amp;\x26amp; node.value === \x27uppercase\x27) {\n    report({\n      ...\n    });\n  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3e\nroot.walkDecls(\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e=\x26gt; {\n  if\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eprop\x3c\/span\x3e === \x27text-transform\x27 \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3evalue\x3c\/span\x3e === \x27uppercase\x27) {\n    report({\n      ...\n    });\n  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们也可以传入一些基本的函数，譬如\x3ccode\x3elinear-gradient\x3c\/code\x3e，就像这个样子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ disallow things like linear-gradient(top, blue, green) w. incorrect first valueroot.walkDecls(node =\x3e {\n  const parsedValue = styleParser(node.value);\n  parsedValue.walk(valueNode =\x3e {\n    if (valueNode.type === \x27function\x27 \x26amp;\x26amp; valueNode.value === \x27linear-gradient\x27) {\n      const firstValueInGradient = styleParser.stringify(valueNode.nodes[0]);\n      if (disallowedFirstValuesInGradient.indexOf(firstValueInGradient) \x3e -1) {\n        report({\n          ...\n        });\n      }\n    }\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ disallow things like linear-gradient(top, blue, green) w. incorrect first valueroot.walkDecls(node =\x26gt; {\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e parsedValue = styleParser(node.\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e);\n  parsedValue.walk(valueNode =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (valueNode.type === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e \x26amp;\x26amp; valueNode.\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e === \x3cspan class=\x22hljs-string\x22\x3e\x27linear-gradient\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e firstValueInGradient = styleParser.stringify(valueNode.nodes[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]);\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (disallowedFirstValuesInGradient.indexOf(firstValueInGradient) \x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n        report({\n          ...\n        });\n      }\n    }\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样子写出来的检测规则可读性更好，也更好去理解与维护，并且这种方式无论是在怎样的CSS格式化的情况下，以及不管规则和声明放在哪边，都能正常地工作。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader2\x22\x3eCustom rules:自定义规则\x3c\/h1\x3e\n\x3cp\x3e我们默认使用了一些Stylelint内置的规则，譬如\x3ca href=\x22https:\/\/www.facebook.com\/l.php?u=https%3A%2F%2Fgithub.com%2Fstylelint%2Fstylelint%2Ftree%2Fmaster%2Fsrc%2Frules%2Fdeclaration-no-important\x26amp;h=oAQG1Tctr\x26amp;s=1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edeclaration-no-important\x3c\/a\x3e,\x3ca href=\x22https:\/\/github.com\/stylelint\/stylelint\/blob\/master\/src\/rules\/selector-no-universal\/README.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eselector-no-universal\x3c\/a\x3e, 以及 \x3ca href=\x22https:\/\/github.com\/stylelint\/stylelint\/tree\/master\/src\/rules\/selector-class-pattern\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eselector-class-pattern\x3c\/a\x3e。如何添加自定义规则的方法可以参考\x3ca href=\x22http:\/\/stylelint.io\/developer-guide\/plugins\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebuilt-in plugin mechanism\x3c\/a\x3e，而我们使用的譬如：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eslow-css-properties 来告警一些性能较差的属性，譬如opacity或者box-shadow\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efilters-with-svg-files 来告警Edge中不支持SVG的过滤\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3euse-variables来告警那些可以被内置的常量替换的一些变量\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ecommon-properties-whitelist 来检测是否有些误写的其实不存在的属性\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3emobile-flexbox 来检测一些不被老版本手机浏览器支持的属性\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3etext-transform-uppercase 来告警 \x22text-transform: uppercase\x22，这个在某些语言表现的不友好\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e我们也贡献了部分\x3ca href=\x22https:\/\/www.facebook.com\/l.php?u=https%3A%2F%2Fgithub.com%2Fstylelint%2Fstylelint%2Fpull%2F675\x26amp;h=GAQF25sgV\x26amp;s=1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e规则\x3c\/a\x3e 以及 \x3ca href=\x22https:\/\/www.facebook.com\/l.php?u=https%3A%2F%2Fgithub.com%2Fstylelint%2Fstylelint%2Fpull%2F689\x26amp;h=hAQHu_d3q\x26amp;s=1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ead插件itions\x3c\/a\x3e 给Stylelint。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3eAutomatic replacement:自动替换\x3c\/h1\x3e\n\x3cp\x3e我们检测过程中有一个重要的工作就是自动格式化，Linter会在发现某些问题的时候问你是否需要根据规则进行替换，这个功能会节约你大量的手动修改校正的时间。一般来说，我们提交代码之前都会审视下Linter报出的错误，然后去修复这些错误。可惜的是Stylelint并没有内嵌的自动格式化与修复机制，因此我们重写了部分的Stylelint的规则来增加一个自动替换与修复的功能。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006772126?w=736\x26amp;h=689\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006772126?w=736\x26amp;h=689\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader4\x22\x3eTest all the things\x3c\/h1\x3e\n\x3cp\x3e我们老的Linter还有个问题就是没有单元测试，这点就好像代码上线前不进行单元测试一样不靠谱。我们面对的可能是任意格式的处理文本，因此我们也要保证我们的检测规则能够适用于真实有效的环境，这里我们是选择了Jest这个测试框架，Stylelint对它的支持挺好的，然后大概一个单元测试是这个样子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\ntest.ok(\x27div { background-image: linear-gradient( 0deg, blue, green 40%, red ); }\x27, \n  \x27linear gradient with valid syntax\x27);\ntest.notOk(\x27a { background: linear-gradient(top, blue, green); }\x27, \n  message, \n    \x27linear-gradient with invalid syntax\x27);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs maxima\x22\x3e\x3ccode\x3e\ntest.ok(\x27div { \x3cspan class=\x22hljs-built_in\x22\x3ebackground\x3c\/span\x3e-\x3cspan class=\x22hljs-built_in\x22\x3eimage\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3elinear\x3c\/span\x3e-gradient( \x3cspan class=\x22hljs-number\x22\x3e0deg\x3c\/span\x3e, blue, green \x3cspan class=\x22hljs-number\x22\x3e40\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e%\x3c\/span\x3e, red ); }\x27, \n  \x27\x3cspan class=\x22hljs-built_in\x22\x3elinear\x3c\/span\x3e gradient with valid syntax\x27);\ntest.notOk(\x27a { \x3cspan class=\x22hljs-built_in\x22\x3ebackground\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3elinear\x3c\/span\x3e-gradient(top, blue, green); }\x27, \n  message, \n    \x27\x3cspan class=\x22hljs-built_in\x22\x3elinear\x3c\/span\x3e-gradient with invalid syntax\x27);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader5\x22\x3eWhat‘s next\x3c\/h1\x3e\n\x3cp\x3e换一个靠谱的CSS Linter工具只是保证高质量的CSS的代码的第一步，我们还打算添加很多自定义的检测规则来捕获一些常见的错误，保证使用规定的最佳实践以及统一代码约定规范。我们已经在JavaScript的校验中进行了这一工作。\x3c\/p\x3e\n\x3cp\x3e另外对于React社区中存在的CSS-in-JS这种写法，对于CSS Linter也是个不小的挑战，现在的大部分的Linter都是着眼于处理传统的CSS文件，以后会添加对于JSX的处理规范吧。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006058452\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006058452\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>瞅瞅Facebook是怎么保证CSS代码质量的</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005719354">https://segmentfault.com/a/1190000005719354</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/obbxs1xycsg/" target="_blank">https://alili.tech/archive/obbxs1xycsg/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>