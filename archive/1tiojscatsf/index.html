<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="【vuejs进阶】 vuejs路由实现原理"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>【vuejs进阶】 vuejs路由实现原理 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/1tiojscatsf/",
				"appid": "1613049289050283", 
				"title": "【vuejs进阶】 vuejs路由实现原理 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-15T02:30:44"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/x55qb8uciq/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/a2rlb5a200l/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f1tiojscatsf%2f&text=%e3%80%90vuejs%e8%bf%9b%e9%98%b6%e3%80%91%20vuejs%e8%b7%af%e7%94%b1%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f1tiojscatsf%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f1tiojscatsf%2f&text=%e3%80%90vuejs%e8%bf%9b%e9%98%b6%e3%80%91%20vuejs%e8%b7%af%e7%94%b1%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f1tiojscatsf%2f&title=%e3%80%90vuejs%e8%bf%9b%e9%98%b6%e3%80%91%20vuejs%e8%b7%af%e7%94%b1%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f1tiojscatsf%2f&is_video=false&description=%e3%80%90vuejs%e8%bf%9b%e9%98%b6%e3%80%91%20vuejs%e8%b7%af%e7%94%b1%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e3%80%90vuejs%e8%bf%9b%e9%98%b6%e3%80%91%20vuejs%e8%b7%af%e7%94%b1%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f1tiojscatsf%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f1tiojscatsf%2f&title=%e3%80%90vuejs%e8%bf%9b%e9%98%b6%e3%80%91%20vuejs%e8%b7%af%e7%94%b1%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f1tiojscatsf%2f&title=%e3%80%90vuejs%e8%bf%9b%e9%98%b6%e3%80%91%20vuejs%e8%b7%af%e7%94%b1%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f1tiojscatsf%2f&title=%e3%80%90vuejs%e8%bf%9b%e9%98%b6%e3%80%91%20vuejs%e8%b7%af%e7%94%b1%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f1tiojscatsf%2f&title=%e3%80%90vuejs%e8%bf%9b%e9%98%b6%e3%80%91%20vuejs%e8%b7%af%e7%94%b1%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">【vuejs进阶】 vuejs路由实现原理</h1><div class="meta"><div class="postdate"><time datetime="2019-02-15" itemprop="datePublished">2019-02-15</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e一般源码中，都会用到 \x3cem\x3ewindow.history\x3c\/em\x3e 和 \x3ccode\x3elocation.hash\x3c\/code\x3e\n\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3ehistory 实现\x3c\/h2\x3e\n\x3cp\x3ewindow.history 对象包含浏览器的历史，window.history 对象在编写时可不使用 window 这个前缀。history是实现SPA前端路由是一种主流方法，它有几个原始方法：\x3c\/p\x3e\n\x3ch5\x3ehistory.back()\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22与在浏览器点击后退按钮相同\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e与在浏览器点击后退按钮相同\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3ehistory.forward()\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22与在浏览器中点击按钮向前相同\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e与在浏览器中点击按钮向前相同\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch6\x3ehistory.go(n)\x3c\/h6\x3e\n\x3cp\x3e接受一个整数作为参数，移动到该整数指定的页面，比如go(1)相当于forward()，go(-1)相当于back()，go(0)相当于刷新当前页面\x3cbr\x3e如果移动的位置超出了访问历史的边界，以上三个方法并不报错，而是静默失败\x3c\/p\x3e\n\x3cp\x3e在HTML5，history对象提出了 pushState() 方法和 replaceState() 方法，这两个方法可以用来向历史栈中添加数据，就好像 url 变化了一样（过去只有 url 变化历史栈才会变化），这样就可以很好的模拟浏览历史和前进后退了，现在的前端路由也是基于这个原理实现的。\x3c\/p\x3e\n\x3ch4\x3ehistory.pushState\x3c\/h4\x3e\n\x3cp\x3epushState(stateObj, title, url) 方法向历史栈中写入数据，其第一个参数是要写入的数据对象（不大于640kB)，第二个参数是页面的 title, 第三个参数是 url (相对路径)。\x3c\/p\x3e\n\x3cp\x3estateObj ：一个与指定网址相关的状态对象，popstate事件触发时，该对象会传入回调函数。如果不需要这个对象，此* 处可以填null。\x3cbr\x3etitle：新页面的标题，但是所有浏览器目前都忽略这个值，因此这里可以填null。\x3cbr\x3eurl：新的网址，必须与当前页面处在同一个域。浏览器的地址栏将显示这个网址。\x3cbr\x3e关于pushState，有几个值得注意的地方：\x3c\/p\x3e\n\x3cp\x3epushState方法不会触发页面刷新，只是导致history对象发生变化，地址栏会有反应,只有当触发前进后退等事件（back()和forward()等）时浏览器才会刷新\x3cbr\x3e这里的 url 是受到同源策略限制的，防止恶意脚本模仿其他网站 url 用来欺骗用户，所以当违背同源策略时将会报错\x3c\/p\x3e\n\x3ch4\x3ehistory.replaceState\x3c\/h4\x3e\n\x3cp\x3ereplaceState(stateObj, title, url) 和pushState的区别就在于它不是写入而是替换修改浏览历史中当前纪录，其余和 pushState一模一样。\x3c\/p\x3e\n\x3ch4\x3epopstate事件\x3c\/h4\x3e\n\x3cp\x3e定义：每当同一个文档的浏览历史（即history对象）出现变化时，就会触发popstate事件。\x3cbr\x3e注意：仅仅调用pushState方法或replaceState方法 ，并不会触发该事件，只有用户点击浏览器倒退按钮和前进按钮，或者使用JavaScript调用back、forward、go方法时才会触发。另外，该事件只针对同一个文档，如果浏览历史的切换，导致加载不同的文档，该事件也不会触发。\x3cbr\x3e用法：使用的时候，可以为popstate事件指定回调函数。这个回调函数的参数是一个event事件对象，它的state属性指向pushState和replaceState方法为当前URL所提供的状态对象（即这两个方法的第一个参数）。\x3c\/p\x3e\n\x3ch5\x3eHISTORY实现SPA前端路由代码\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ca class=\x26quot;spa\x26quot;\x3eabc.html\x3c\/a\x3e\n\x3ca class=\x26quot;spa\x26quot;\x3e123.html\x3c\/a\x3e\n\x3ca href=\x26quot;\/rdhub\x26quot; class=\x26quot;spa \x26quot;\x3erdhub\x3c\/a\x3e\n  \/\/ 注册路由\n  document.querySelectorAll(\x27.spa\x27).forEach(item =\x3e {\n    item.addEventListener(\x27click\x27, e =\x3e {\n      e.preventDefault();\n      let link = item.textContent;\n      if (!!(window.history \x26amp;\x26amp; history.pushState)) {\n        \/\/ 支持History API\n        window.history.pushState({name: \x27history\x27}, link, link);\n      } else {\n        \/\/ 不支持,可使用一些Polyfill库来实现\n      }\n    }, false)\n  });\n\n  \/\/ 监听路由\n  window.addEventListener(\x27popstate\x27, e =\x3e {\n    console.log({\n      location: location.href,\n      state: e.state\n    })\n  }, false)\npopstate监听函数里打印的e.state便是history.pushState()里传入的第一个参数，在这里即为{name: \x27history\x27}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e\x26lt;a \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22spa\x22\x3c\/span\x3e\x26gt;abc.html\x26lt;\/a\x26gt;\n\x26lt;a \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22spa\x22\x3c\/span\x3e\x26gt;\x3cspan class=\x22hljs-number\x22\x3e123.\x3c\/span\x3ehtml\x26lt;\/a\x26gt;\n\x26lt;a href=\x3cspan class=\x22hljs-string\x22\x3e\x22\/rdhub\x22\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22spa \x22\x3c\/span\x3e\x26gt;rdhub\x26lt;\/a\x26gt;\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注册路由\x3c\/span\x3e\n  document.querySelectorAll(\x3cspan class=\x22hljs-string\x22\x3e\x27.spa\x27\x3c\/span\x3e).forEach(item =\x26gt; {\n    item.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, e =\x26gt; {\n      e.preventDefault();\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e link = item.textContent;\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!!(window.history \x26amp;\x26amp; history.pushState)) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 支持History API\x3c\/span\x3e\n        window.history.pushState({name: \x3cspan class=\x22hljs-string\x22\x3e\x27history\x27\x3c\/span\x3e}, link, link);\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 不支持,可使用一些Polyfill库来实现\x3c\/span\x3e\n      }\n    }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n  });\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 监听路由\x3c\/span\x3e\n  window.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27popstate\x27\x3c\/span\x3e, e =\x26gt; {\n    console.log({\n      location: location.href,\n      state: e.state\n    })\n  }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\npopstate监听函数里打印的e.state便是history.pushState()里传入的第一个参数，在这里即为{name: \x3cspan class=\x22hljs-string\x22\x3e\x27history\x27\x3c\/span\x3e}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3ehash\x3c\/h2\x3e\n\x3ch4\x3ehash基本介绍\x3c\/h4\x3e\n\x3cblockquote\x3eurl 中可以带有一个 hash \x3ca href=\x22http:\/\/localhost\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/localhost\x3c\/a\x3e:9000\/#\/rdhub.html\x3c\/blockquote\x3e\n\x3cp\x3ewindow 对象中有一个事件是 onhashchange，以下几种情况都会触发这个事件：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e直接更改浏览器地址，在最后面增加或改变#hash；\x3c\/li\x3e\n\x3cli\x3e通过改变location.href或location.hash的值；\x3c\/li\x3e\n\x3cli\x3e通过触发点击带锚点的链接；\x3c\/li\x3e\n\x3cli\x3e浏览器前进后退可能导致hash的变化，前提是两个网页地址中的hash值不同。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch4\x3ehash实现SPA前端路由代码\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ca href=\x26quot;\/rdhub\x26quot; class=\x26quot;spa\x26quot;\x3erdhub\x3c\/a\x3e\n\x3ca href=\x26quot;\/abc\x26quot; class=\x26quot;spa\x26quot;\x3eabc\x3c\/a\x3e\n\x3ca href=\x26quot;\/123\x26quot; class=\x26quot;spa\x26quot;\x3e123\x3c\/a\x3e\n\x3ca href=\x26quot;\/hash\x26quot; class=\x26quot;spa\x26quot;\x3ehash\x3c\/a\x3e\n  document.querySelectorAll(\x27.spa\x27).forEach(item =\x3e {\n    item.addEventListener(\x27click\x27, e =\x3e {\n      e.preventDefault();\n      let link = item.textContent;\n      location.hash = link;\n    }, false)\n  });\n  \/\/ 监听路由\n  window.addEventListener(\x27hashchange\x27, e =\x3e {\n    console.log({\n      location: location.href,\n      hash: location.hash\n    })\n  }, false)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e\x26lt;a href=\x3cspan class=\x22hljs-string\x22\x3e\x22\/rdhub\x22\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22spa\x22\x3c\/span\x3e\x26gt;rdhub\x26lt;\/a\x26gt;\n\x26lt;a href=\x3cspan class=\x22hljs-string\x22\x3e\x22\/abc\x22\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22spa\x22\x3c\/span\x3e\x26gt;abc\x26lt;\/a\x26gt;\n\x26lt;a href=\x3cspan class=\x22hljs-string\x22\x3e\x22\/123\x22\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22spa\x22\x3c\/span\x3e\x26gt;\x3cspan class=\x22hljs-number\x22\x3e123\x3c\/span\x3e\x26lt;\/a\x26gt;\n\x26lt;a href=\x3cspan class=\x22hljs-string\x22\x3e\x22\/hash\x22\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22spa\x22\x3c\/span\x3e\x26gt;hash\x26lt;\/a\x26gt;\n  document.querySelectorAll(\x3cspan class=\x22hljs-string\x22\x3e\x27.spa\x27\x3c\/span\x3e).forEach(item =\x26gt; {\n    item.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, e =\x26gt; {\n      e.preventDefault();\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e link = item.textContent;\n      location.hash = link;\n    }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n  });\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 监听路由\x3c\/span\x3e\n  window.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27hashchange\x27\x3c\/span\x3e, e =\x26gt; {\n    console.log({\n      location: location.href,\n      hash: location.hash\n    })\n  }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ehash模式与history模式，这两种模式都是通过浏览器接口实现的，除此之外vue-router还为非浏览器环境准备了一个abstract模式，其原理为用一个数组stack模拟出浏览器历史记录栈的功能。当然，以上只是一些核心逻辑，为保证系统的鲁棒性源码中还有大量的辅助逻辑，也很值得学习。\x3c\/code\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e两种模式比较\x3c\/h2\x3e\n\x3cp\x3epushState设置的新URL可以是与当前URL同源的任意URL；而hash只可修改#后面的部分，故只可设置与当前同文档的URL\x3c\/p\x3e\n\x3cp\x3epushState设置的新URL可以与当前URL一模一样，这样也会把记录添加到栈中；而hash设置的新值必须与原来不一样才会触发记录添加到栈中\x3c\/p\x3e\n\x3cp\x3epushState通过stateObject可以添加任意类型的数据到记录中；而hash只可添加短字符串\x3c\/p\x3e\n\x3cp\x3epushState可额外设置title属性供后续使用\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3ehistory模式的一个问题\x3c\/h2\x3e\n\x3cp\x3e我们知道对于单页应用来讲，理想的使用场景是仅在进入应用时加载index.html，后续在的网络操作通过Ajax完成，不会根据URL重新请求页面，但是难免遇到特殊情况，比如用户直接在地址栏中输入并回车，浏览器重启重新加载应用等。\x3c\/p\x3e\n\x3cp\x3ehash模式仅改变hash部分的内容，而hash部分是不会包含在HTTP请求中的：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/rdhub.cn\/#\/user\/id\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/rdhub.cn\/#\/user\/id\x3c\/a\x3e \/\/ 如重新请求只会发送\x3ca href=\x22http:\/\/rdhub.cn\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/rdhub.cn\/\x3c\/a\x3e\x3cbr\x3e故在hash模式下遇到根据URL请求页面的情况不会有问题。\x3c\/p\x3e\n\x3cp\x3e而history模式则会将URL修改得就和正常请求后端的URL一样\x3cbr\x3e\x3ca href=\x22http:\/\/rdhub.cn\/user\/id\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/rdhub.cn\/user\/id\x3c\/a\x3e\x3cbr\x3e在此情况下重新向后端发送请求，如后端没有配置对应\/user\/id的路由处理，则会返回404错误。\x3c\/p\x3e\n\x3cp\x3e官方推荐的解决办法是在服务端增加一个覆盖所有情况的候选资源：如果 URL 匹配不到任何静态资源，则应该返回同一个 index.html 页面，这个页面就是你 app 依赖的页面。同时这么做以后，服务器就不再返回 404 错误页面，因为对于所有路径都会返回 index.html 文件。为了避免这种情况，在 Vue 应用里面覆盖所有的路由情况，然后在给出一个 404 页面。或者，如果是用 Node.js 作后台，可以使用服务端的路由来匹配 URL，当没有匹配到路由的时候返回 404，从而实现 fallback。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e参考资料：\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e浏览器History API ：\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/History_API\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/developer.mozilla.org...\x3c\/a\x3e\n\x3c\/li\x3e\n\x3cli\x3e解决History模式访问404的方案：\x3ca href=\x22https:\/\/router.vuejs.org\/zh\/guide\/essentials\/history-mode.html#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BE%8B%E5%AD%90\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/router.vuejs.org\/zh\/g...\x3c\/a\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e关于我们\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.yuque.com\/rdhub\/about\/info\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/www.yuque.com\/rdhub\/a...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e关注订阅号\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000016783011?w=300\x26amp;h=390\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000016783011?w=300\x26amp;h=390\x22 alt=\x222018-10-20-18-44-29\x22 title=\x222018-10-20-18-44-29\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>【vuejs进阶】 vuejs路由实现原理</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000016781365">https://segmentfault.com/a/1190000016781365</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/1tiojscatsf/" target="_blank">https://alili.tech/archive/1tiojscatsf/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>