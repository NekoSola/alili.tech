<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="JS魔法堂：彻底理解0.1 &#43; 0.2 === 0.30000000000000004的背后"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>JS魔法堂：彻底理解0.1 &#43; 0.2 === 0.30000000000000004的背后 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/c5o31gi2txw/",
				"appid": "1613049289050283", 
				"title": "JS魔法堂：彻底理解0.1 &#43; 0.2 === 0.30000000000000004的背后 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-11T02:30:49"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/0k42h9r0qfz6/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/f73imq54ud/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fc5o31gi2txw%2f&text=JS%e9%ad%94%e6%b3%95%e5%a0%82%ef%bc%9a%e5%bd%bb%e5%ba%95%e7%90%86%e8%a7%a30.1%20%2b%200.2%20%3d%3d%3d%200.30000000000000004%e7%9a%84%e8%83%8c%e5%90%8e"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fc5o31gi2txw%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fc5o31gi2txw%2f&text=JS%e9%ad%94%e6%b3%95%e5%a0%82%ef%bc%9a%e5%bd%bb%e5%ba%95%e7%90%86%e8%a7%a30.1%20%2b%200.2%20%3d%3d%3d%200.30000000000000004%e7%9a%84%e8%83%8c%e5%90%8e"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fc5o31gi2txw%2f&title=JS%e9%ad%94%e6%b3%95%e5%a0%82%ef%bc%9a%e5%bd%bb%e5%ba%95%e7%90%86%e8%a7%a30.1%20%2b%200.2%20%3d%3d%3d%200.30000000000000004%e7%9a%84%e8%83%8c%e5%90%8e"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fc5o31gi2txw%2f&is_video=false&description=JS%e9%ad%94%e6%b3%95%e5%a0%82%ef%bc%9a%e5%bd%bb%e5%ba%95%e7%90%86%e8%a7%a30.1%20%2b%200.2%20%3d%3d%3d%200.30000000000000004%e7%9a%84%e8%83%8c%e5%90%8e"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=JS%e9%ad%94%e6%b3%95%e5%a0%82%ef%bc%9a%e5%bd%bb%e5%ba%95%e7%90%86%e8%a7%a30.1%20%2b%200.2%20%3d%3d%3d%200.30000000000000004%e7%9a%84%e8%83%8c%e5%90%8e&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fc5o31gi2txw%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fc5o31gi2txw%2f&title=JS%e9%ad%94%e6%b3%95%e5%a0%82%ef%bc%9a%e5%bd%bb%e5%ba%95%e7%90%86%e8%a7%a30.1%20%2b%200.2%20%3d%3d%3d%200.30000000000000004%e7%9a%84%e8%83%8c%e5%90%8e"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fc5o31gi2txw%2f&title=JS%e9%ad%94%e6%b3%95%e5%a0%82%ef%bc%9a%e5%bd%bb%e5%ba%95%e7%90%86%e8%a7%a30.1%20%2b%200.2%20%3d%3d%3d%200.30000000000000004%e7%9a%84%e8%83%8c%e5%90%8e"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fc5o31gi2txw%2f&title=JS%e9%ad%94%e6%b3%95%e5%a0%82%ef%bc%9a%e5%bd%bb%e5%ba%95%e7%90%86%e8%a7%a30.1%20%2b%200.2%20%3d%3d%3d%200.30000000000000004%e7%9a%84%e8%83%8c%e5%90%8e"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fc5o31gi2txw%2f&title=JS%e9%ad%94%e6%b3%95%e5%a0%82%ef%bc%9a%e5%bd%bb%e5%ba%95%e7%90%86%e8%a7%a30.1%20%2b%200.2%20%3d%3d%3d%200.30000000000000004%e7%9a%84%e8%83%8c%e5%90%8e"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">JS魔法堂：彻底理解0.1 &#43; 0.2 === 0.30000000000000004的背后</h1><div class="meta"><div class="postdate"><time datetime="2019-02-11" itemprop="datePublished">2019-02-11</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch3 id=\x22articleHeader0\x22\x3eBrief\x3c\/h3\x3e\n\x3cp\x3e一天有个朋友问我“JS中计算0.7 * 180怎么会等于125.99999999998，坑也太多了吧！”那时我猜测是二进制表示数值时发生round-off error所导致，但并不清楚具体是如何导致，并且有什么方法去规避。于是用了3周时间静下心把这个问题搞懂，在学习的过程中还发现不仅0.7 * 180==125.99999999998，还有以下的坑\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e著名的 0.1 \x2b 0.2 === 0.30000000000000004\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e1000000000000000128 === 1000000000000000129\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3eIEEE 754 Floating-point\x3c\/h3\x3e\n\x3cp\x3e众所周知JS仅有Number这个数值类型，而Number采用的时IEEE 754 64位双精度浮点数编码。而浮点数表示方式具有以下特点：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e浮点数可表示的值范围比同等位数的整数表示方式的值范围要大得多；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e浮点数无法精确表示其值范围内的所有数值，而有符号和无符号整数则是精确表示其值范围内的每个数值；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e浮点数只能精确表示m*2e的数值；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当biased-exponent为2e-1-1时，浮点数能精确表示该范围内的各整数值；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当biased-exponent不为2e-1-1时，浮点数不能精确表示该范围内的各整数值。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e由于部分数值无法精确表示（存储），于是在运算统计后偏差会愈见明显。\x3c\/p\x3e\n\x3cp\x3e想了解更多浮点数的知识可参考以下文章：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/fsjohnhuang\/p\/5060242.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《基础野：细说原码、反码和补码》\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/fsjohnhuang\/p\/5078290.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《基础野：细说无符号整数》\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/fsjohnhuang\/p\/5082829.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《基础野：细说有符号整数》\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/fsjohnhuang\/p\/5109766.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《基础野：细说浮点数》\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3eWhy 0.1 \x2b 0.2 === 0.30000000000000004?\x3c\/h3\x3e\n\x3cp\x3e在浮点数运算中产生误差值的示例中，最出名应该是0.1 \x2b 0.2 === 0.30000000000000004了，到底有多有名？看看这个网站就知道了\x3ca href=\x22http:\/\/0.30000000000000004.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/0.30000000000000004.com\/\x3c\/a\x3e。也就是说不仅是JavaScript会产生这种问题，只要是采用IEEE 754 Floating-point的浮点数编码方式来表示浮点数时，则会产生这类问题。下面我们来分析整个运算过程。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e0.1 的二进制表示为 1.1001100110011001100110011001100110011001100110011001 1(0011)\x2b * 2^-4；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当64bit的存储空间无法存储完整的无限循环小数，而IEEE 754 Floating-point采用round to nearest, tie to even的舍入模式，因此0.1实际存储时的位模式是0-01111111011-1001100110011001100110011001100110011001100110011010；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e0.2 的二进制表示为 1.1001100110011001100110011001100110011001100110011001 1(0011)\x2b * 2^-3；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当64bit的存储空间无法存储完整的无限循环小数，而IEEE 754 Floating-point采用round to nearest, tie to even的舍入模式，因此0.2实际存储时的位模式是0-01111111100-1001100110011001100110011001100110011001100110011010；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e实际存储的位模式作为操作数进行浮点数加法，得到 0-01111111101-0011001100110011001100110011001100110011001100110100。转换为十进制即为0.30000000000000004。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3eWhy 0.7 * 180===125.99999999998?\x3c\/h3\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e0.7实际存储时的位模式是0-01111111110-0110011001100110011001100110011001100110011001100110；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e180实际存储时的位模式是0-10000000110-0110100000000000000000000000000000000000000000000000；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e实际存储的位模式作为操作数进行浮点数乘法，得到0-10000000101-1111011111111111111111111111111111111111101010000001。转换为十进制即为125.99999999998。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3eWhy 1000000000000000128 === 1000000000000000129?\x3c\/h3\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e1000000000000000128实际存储时的位模式是0-10000111010-1011110000010110110101100111010011101100100000000001；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e1000000000000000129实际存储时的位模式是0-10000111010-1011110000010110110101100111010011101100100000000001；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e因此1000000000000000128和1000000000000000129的实际存储的位模式是一样的。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3eSolution\x3c\/h3\x3e\n\x3cp\x3e到这里我们都理解只要采取IEEE 754 FP的浮点数编码的语言均会出现上述问题，只是它们的标准类库已经为我们提供了解决方案而已。而JS呢？显然没有。坏处自然是掉坑了，而好处恰恰也是掉坑了:)\x3c\/p\x3e\n\x3cp\x3e针对不同的应用需求，我们有不同的实现方式。\x3c\/p\x3e\n\x3ch4\x3eSolution 0x00 - Simple implementation\x3c\/h4\x3e\n\x3cp\x3e对于小数和小整数的简单运算可用如下方式\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function numAdd(num1\/*:String*\/, num2\/*:String*\/) { \n    var baseNum, baseNum1, baseNum2; \n    try { \n        baseNum1 = num1.split(\x26quot;.\x26quot;)[1].length; \n    } catch (e) { \n        baseNum1 = 0; \n    } \n    try { \n        baseNum2 = num2.split(\x26quot;.\x26quot;)[1].length; \n    } catch (e) { \n        baseNum2 = 0;\n    } \n    baseNum = Math.pow(10, Math.max(baseNum1, baseNum2)); \n    return (num1 * baseNum \x2b num2 * baseNum) \/ baseNum; \n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs armasm\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-symbol\x22\x3efunction\x3c\/span\x3e numAdd(num1\x3cspan class=\x22hljs-comment\x22\x3e\/*:String*\/\x3c\/span\x3e, num2\x3cspan class=\x22hljs-comment\x22\x3e\/*:String*\/\x3c\/span\x3e) { \n    var \x3cspan class=\x22hljs-keyword\x22\x3ebaseNum, \x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3ebaseNum1, \x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3ebaseNum2; \x3c\/span\x3e\n    try { \n        \x3cspan class=\x22hljs-keyword\x22\x3ebaseNum1 \x3c\/span\x3e= num1.split(\x3cspan class=\x22hljs-string\x22\x3e\x22.\x22\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].length\x3cspan class=\x22hljs-comment\x22\x3e; \x3c\/span\x3e\n    } catch (e) { \n        \x3cspan class=\x22hljs-keyword\x22\x3ebaseNum1 \x3c\/span\x3e= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e; \x3c\/span\x3e\n    } \n    try { \n        \x3cspan class=\x22hljs-keyword\x22\x3ebaseNum2 \x3c\/span\x3e= num2.split(\x3cspan class=\x22hljs-string\x22\x3e\x22.\x22\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e].length\x3cspan class=\x22hljs-comment\x22\x3e; \x3c\/span\x3e\n    } catch (e) { \n        \x3cspan class=\x22hljs-keyword\x22\x3ebaseNum2 \x3c\/span\x3e= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n    } \n    \x3cspan class=\x22hljs-keyword\x22\x3ebaseNum \x3c\/span\x3e= Math.pow(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e, Math.max(\x3cspan class=\x22hljs-keyword\x22\x3ebaseNum1, \x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3ebaseNum2)); \x3c\/span\x3e\n    return (num1 * \x3cspan class=\x22hljs-keyword\x22\x3ebaseNum \x3c\/span\x3e\x2b num2 * \x3cspan class=\x22hljs-keyword\x22\x3ebaseNum) \x3c\/span\x3e\/ \x3cspan class=\x22hljs-keyword\x22\x3ebaseNum; \x3c\/span\x3e\n}\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3eSolution 0x01 - math.js\x3c\/h4\x3e\n\x3cp\x3e若需要复杂且全面的运算功能那必须上math.js，其内部引用了decimal.js和fraction.js。功能异常强大，用于生产环境上妥妥的！\x3c\/p\x3e\n\x3ch4\x3eSolution 0x02 - D.js\x3c\/h4\x3e\n\x3cp\x3eD.js算是我的练手项目吧，截止本文发表时D.js版本为V0.2.0，仅实现了加、减、乘和整除运算而已，bug是一堆堆的，但至少解决了0.1\x2b0.2的问题了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var sum = D.add(0.1, 0.2)\nconsole.log(sum \x2b \x27\x27) \/\/ 0.3\n\nvar product = D.mul(\x26quot;1e-2\x26quot;, \x26quot;2e-4\x26quot;)\nconsole.log(product \x2b \x27\x27) \/\/ 0.000002\n\nvar quotient = D.div(-3, 2)\nconsole.log(quotient \x2b \x27\x27) \/\/ -(1\x2b1\/2)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lasso\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3esum\x3c\/span\x3e = D.add(\x3cspan class=\x22hljs-number\x22\x3e0.1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0.2\x3c\/span\x3e)\nconsole.\x3cspan class=\x22hljs-keyword\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3esum\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 0.3\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e product = D.mul(\x3cspan class=\x22hljs-string\x22\x3e\x221e-2\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x222e-4\x22\x3c\/span\x3e)\nconsole.\x3cspan class=\x22hljs-keyword\x22\x3elog\x3c\/span\x3e(product \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 0.000002\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e quotient = D.div(\x3cspan class=\x22hljs-number\x22\x3e-3\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)\nconsole.\x3cspan class=\x22hljs-keyword\x22\x3elog\x3c\/span\x3e(quotient \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ -(1\x2b1\/2)\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e解题思路：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e由于仅位于Number.MIN_SAFE_INTEGER和Number.MAX_SAFE_INTEGER间的整数才能被精准地表示，也就是只要保证运算过程的操作数和结果均落在这个阀值内，那么运算结果就是精准无误的；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e问题的关键落在如何将小数和极大数转换或拆分为Number.MIN_SAFE_INTEGER至Number.MAX_SAFE_INTEGER阀值间的数了；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e小数转换为整数，自然就是通过科学计数法表示，并通过右移小数点，减小幂的方式处理；(如0.000123 等价于 123 * 10-6)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e而极大数则需要拆分，拆分的规则是多样的。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e按因式拆分：假设对12345进行拆分得到 5 * 2469；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e按位拆分：假设以3个数值为一组对12345进行拆分得到345和12，而实际值为12*1000 \x2b 345。\x3cbr\x3e 就我而言，1 的拆分规则结构不稳定，而且不直观；而 2 的规则直观，且拆分和恢复的公式固定。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e余数由符号位、分子和分母组成，而符号与整数部分一致，因此只需考虑如何表示分子和分母即可。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e无限循环数则仅需考虑如何表示循环数段即可。（如10.2343434则分成10.23 和循环数34和34的权重即可）\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e得到编码规则后，那就剩下基于指定编码如何实现各种运算的问题了。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e基于上述的数值编码规则如何实现加、减运算呢？\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e基于上述的数值编码规则如何实现乘、除运算呢？（其实只要加、减运算解决了，乘除必然可解，就是效率问题而已）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e基于上述的数值编码规则如何实现其它如sin、tan、%等数学运算呢？\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e另外由于涉及数学运算，那么将作为add、sub、mul和div等入参的变量保持如同数学公式运算数般纯净（Persistent\/Immutable Data Structure）是必须的，那是否还要引入immutable.js呢？（D.js现在采用按需生成副本的方式，可预见随着代码量的增加，这种方式会导致整体代码无法维护）\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eConclusion\x3c\/h3\x3e\n\x3cp\x3e依照我的尿性，D.js将采取不定期持续更新的策略（待我理解Persistent\/Immutable Data Structure后吧:)）。欢迎各位指教！\x3c\/p\x3e\n\x3cp\x3e尊重原创，转载请注明来自：\x3ca href=\x22http:\/\/www.cnblogs.com\/fsjohnhuang\/p\/5115672.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.cnblogs.com\/fsjohnhuang\/p\/5115672.html\x3c\/a\x3e ^_^肥子John\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eThanks\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/es5.github.io\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/es5.github.io\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/MikeMcl\/decimal.js\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/MikeMcl\/decimal.js\/\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2010\/06\/ieee_floating-point_representation.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.ruanyifeng.com\/blog\/2010\/06\/ieee_floating-point_representation.html\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/demon.tw\/copy-paste\/javascript-precision.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/demon.tw\/copy-paste\/javascript-precision.html\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>JS魔法堂：彻底理解0.1 + 0.2 === 0.30000000000000004的背后</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005022170">https://segmentfault.com/a/1190000005022170</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/c5o31gi2txw/" target="_blank">https://alili.tech/archive/c5o31gi2txw/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>