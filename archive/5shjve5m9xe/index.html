<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="手把手深入理解 webpack dev middleware 原理與相關 plugins"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>手把手深入理解 webpack dev middleware 原理與相關 plugins | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/5shjve5m9xe/",
				"appid": "1613049289050283", 
				"title": "手把手深入理解 webpack dev middleware 原理與相關 plugins | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-09T02:30:59"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/j8hl0d9sqtd/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/ocodi9lc9i/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f5shjve5m9xe%2f&text=%e6%89%8b%e6%8a%8a%e6%89%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%20webpack%20dev%20middleware%20%e5%8e%9f%e7%90%86%e8%88%87%e7%9b%b8%e9%97%9c%20plugins"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f5shjve5m9xe%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f5shjve5m9xe%2f&text=%e6%89%8b%e6%8a%8a%e6%89%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%20webpack%20dev%20middleware%20%e5%8e%9f%e7%90%86%e8%88%87%e7%9b%b8%e9%97%9c%20plugins"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f5shjve5m9xe%2f&title=%e6%89%8b%e6%8a%8a%e6%89%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%20webpack%20dev%20middleware%20%e5%8e%9f%e7%90%86%e8%88%87%e7%9b%b8%e9%97%9c%20plugins"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f5shjve5m9xe%2f&is_video=false&description=%e6%89%8b%e6%8a%8a%e6%89%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%20webpack%20dev%20middleware%20%e5%8e%9f%e7%90%86%e8%88%87%e7%9b%b8%e9%97%9c%20plugins"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%89%8b%e6%8a%8a%e6%89%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%20webpack%20dev%20middleware%20%e5%8e%9f%e7%90%86%e8%88%87%e7%9b%b8%e9%97%9c%20plugins&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f5shjve5m9xe%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f5shjve5m9xe%2f&title=%e6%89%8b%e6%8a%8a%e6%89%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%20webpack%20dev%20middleware%20%e5%8e%9f%e7%90%86%e8%88%87%e7%9b%b8%e9%97%9c%20plugins"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5shjve5m9xe%2f&title=%e6%89%8b%e6%8a%8a%e6%89%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%20webpack%20dev%20middleware%20%e5%8e%9f%e7%90%86%e8%88%87%e7%9b%b8%e9%97%9c%20plugins"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5shjve5m9xe%2f&title=%e6%89%8b%e6%8a%8a%e6%89%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%20webpack%20dev%20middleware%20%e5%8e%9f%e7%90%86%e8%88%87%e7%9b%b8%e9%97%9c%20plugins"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f5shjve5m9xe%2f&title=%e6%89%8b%e6%8a%8a%e6%89%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%20webpack%20dev%20middleware%20%e5%8e%9f%e7%90%86%e8%88%87%e7%9b%b8%e9%97%9c%20plugins"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">手把手深入理解 webpack dev middleware 原理與相關 plugins</h1><div class="meta"><div class="postdate"><time datetime="2019-02-09" itemprop="datePublished">2019-02-09</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e本文將對 webpack 周邊的 middleware 與 plugin 套件等作些介紹，若您對於 webpack 還不了解可以參考這篇\x3ca href=\x22http:\/\/andyyou.github.io\/javascript\/2015\/07\/23\/webpack.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e彙整的翻譯\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3ewebpack dev server 是什麼?\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3ewebpack dev server\x3c\/code\x3e 是一個開發伺服器，內建 webpack 使用的 live reloading 功能。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e那 webpack dev middleware 是啥?\x3c\/h3\x3e\n\x3cp\x3e它就是一個用來組織包裝 webpack 使其可以變成中介軟體，或稱中間件的容器。回想一下 express 你大概可以明白關於 middleware 的用途，就是在輸入到輸出的過程中 \x3ccode\x3e加工\x3c\/code\x3e 的一種手段。單純說 middleware 的話我們可以想成一系列\x3ccode\x3e任務, 動作\x3c\/code\x3e(actions stack)，不只 express 有，在 Ruby 中的 rake 也具備這種機制。\x3c\/p\x3e\n\x3cp\x3e先看看\x3ca href=\x22https:\/\/webpack.github.io\/docs\/webpack-dev-server.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eweb dev server\x3c\/a\x3e的說明\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eThe webpack-dev-server is a little node.js Express server, which uses the webpack-dev-middleware to serve a webpack bundle.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e從頭說起的話就是 \x3ccode\x3ewebpack\x3c\/code\x3e 本身只負責打包編譯的功能 \x3ccode\x3ebundle\x3c\/code\x3e, \x3ccode\x3ewebpack-dev-server\x3c\/code\x3e 當然就是協助我們開發的伺服器，這個伺服器底層是靠 express 來實作的，接著思考一下我們要如何更新(live reload)呢? 當然是需要取得 webpack 編好的資料啊，於是就需要在從 \x3ccode\x3erequest\x3c\/code\x3e 到 \x3ccode\x3eresponse\x3c\/code\x3e 的過程中透過 express 的 middleware 取得資料，而方法就是透過 webpack-dev-middleware 。\x3c\/p\x3e\n\x3cp\x3e比起直接編譯成檔案，webpack-dev-middleware 這個套件還多了一些好處:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e不需要一直寫入磁碟，所有產生的結果會直接存在記憶體\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在監視模式(watch mode)下如果檔案發生異動，middleware 會馬上停止提供舊版的 bundle 並且會延遲請求的回應直到編譯完成，如此一來我們就不需要去\x3ccode\x3e觀察編譯是否結束了\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3ewebpack hot middleware 是什麼?\x3c\/h3\x3e\n\x3cp\x3e我們都知道 webpack dev server 有提供一種\x3ccode\x3eHot Module Replacement\/Hot Reloading\x3c\/code\x3e 熱替換的功能。在一般 \x3ccode\x3ewebpack-dev-server\x3c\/code\x3e 的時候我們會在 \x3ccode\x3ewebpack.config.js\x3c\/code\x3e 加入 \x3ccode\x3enew webpack.HotModuleReplacementPlugin()\x3c\/code\x3e 或設定來啟用。\x3c\/p\x3e\n\x3cp\x3e而 \x3cstrong\x3ewebpack hot middleware\x3c\/strong\x3e 是給 \x3ccode\x3ewebpack-dev-middleware\x3c\/code\x3e 用的。就是讓我們在一般的 server 上加上熱替換的功能，總結來說就是 \x3ccode\x3ewebpack-dev-middleware\x3c\/code\x3e \x2b \x3ccode\x3ewebpack-hot-middleware\x3c\/code\x3e 即可讓我們用 express 客製一個有熱替換功能的 webpack 開發伺服器。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e使用 webpack-dev-server 當中介軟體\x3c\/h3\x3e\n\x3cp\x3ewebpack 提供了 express 的 middleware 讓我們可以處理一些靜態資源檔而不是使用 \x3ccode\x3eexpress.static\x3c\/code\x3e。要達成這項功能，我們需要安裝 \x3ccode\x3ewebpack-dev-middleware\x3c\/code\x3e 和 \x3ccode\x3ewebpack-hot-middleware\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ npm i webpack express webpack-dev-middleware webpack-hot-middleware -D\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode class=\x22zsh\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e$ npm \x3cspan class=\x22hljs-selector-tag\x22\x3ei\x3c\/span\x3e webpack express webpack-dev-middleware webpack-hot-middleware -D\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e安裝完成套件之後，首先我們需要設定一個 \x3ccode\x3ewebpack.dev.config.js\x3c\/code\x3e 檔案，並且在 \x3ccode\x3eentry\x3c\/code\x3e 中加上 \x3ccode\x3ewebpack\/hot\/dev-server\x3c\/code\x3e 和 \x3ccode\x3ewebpack-hot-middleware\/client\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22entry: [\n  \x27webpack\/hot\/dev-server\x27,\n  \x27webpack-hot-middleware\/client\x27,\n  \x27client\/index.js\x27\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sml\x22\x3e\x3ccode\x3eentry: [\n  \x3cspan class=\x22hljs-symbol\x22\x3e\x27webpack\x3c\/span\x3e\/hot\/dev-server\x27,\n  \x3cspan class=\x22hljs-symbol\x22\x3e\x27webpack\x3c\/span\x3e-hot-middleware\/client\x27,\n  \x3cspan class=\x22hljs-symbol\x22\x3e\x27client\x3c\/span\x3e\/index.js\x27\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e這個 \x3ccode\x3ewebpack.config\x3c\/code\x3e 主要是給開發伺服器用的，由於這時的匯出都會存在記憶體中，因此 \x3ccode\x3epath\x3c\/code\x3e 可以直接設為根\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22output: {\n  path: \x27\/\x27,\n  publicPath: \x27http:\/\/localhost:8080\/scripts\/\x27,\n  filename: \x27bundle.js\x27\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3eoutput\x3c\/span\x3e: {\n  \x3cspan class=\x22hljs-attribute\x22\x3epath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\n  publicPath: \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/localhost:8080\/scripts\/\x27\x3c\/span\x3e,\n  filename: \x3cspan class=\x22hljs-string\x22\x3e\x27bundle.js\x27\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最後補上任何您所需要的 loaders，最重要的是記得。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22plugins: [\n  new webpack.HotModuleReplacementPlugin()\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eplugins: [\n  \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.HotModuleReplacementPlugin()\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接著下來我們開始來撰寫這個開發環境的設定檔和 express 程式。\x3c\/p\x3e\n\x3cp\x3e我們會匯入 webpack，webpack-dev-middleware， webpack-hot-middleware 和 express。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e若需要搭配樣板引擎請自行安裝 ejs 或 jade\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var express = require(\x27express\x27)\nvar webpack = require(\x27webpack\x27)\nvar WebpackDevMiddleware = require(\x27webpack-dev-middleware\x27)\nvar WebpackHotMiddleware = require(\x27webpack-hot-middleware\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27express\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e webpack = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e WebpackDevMiddleware = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack-dev-middleware\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e WebpackHotMiddleware = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack-hot-middleware\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e載入套件之後，使用 express 建立一個 http 應用程式與路由\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22app = express()\nrouter = express.Router()\n\nrouter.get(\x27\/\x27, MainController)\napp.use(router)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eapp = express()\nrouter = express.Router()\n\nrouter.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e, MainController)\napp.use(router)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面只是一個一般的 Server 應用，為了達成 webpack 的神奇黑魔法我們需要匯入 webpack 的設定\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var config = require(\x27.\/webpack.dev.config\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e config = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/webpack.dev.config\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ewebpack 的角色就是我們的編譯器，透過下面的程式碼建立編譯器的 instance\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var compiler = webpack(config)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lisp\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3evar compiler = webpack(\x3cspan class=\x22hljs-name\x22\x3econfig\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e重點來了，我們有了伺服器 express，有了編譯核心 webpack，接著我們需要 wrapper 來打包 webpack 將其合進 express 的 middleware stack 中。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22app.use(WebpackDevMiddleware(compiler, {\n  publicPath: config.output.publicPath,\n  stats: { colors: true }\n}))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eapp.use(WebpackDevMiddleware(compiler, {\n  \x3cspan class=\x22hljs-attr\x22\x3epublicPath\x3c\/span\x3e: config.output.publicPath,\n  \x3cspan class=\x22hljs-attr\x22\x3estats\x3c\/span\x3e: { \x3cspan class=\x22hljs-attr\x22\x3ecolors\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e }\n}))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3epublicPath\x3c\/code\x3e 就是我們想要存取前端 bundle 的網址，路徑，位置。然後我們要再加上 webpack-hot-middleware 使其具備熱替換的功能。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22app.use(WebpackHotMiddleware(compiler, {\n  log: console.log\n}))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eapp.use(WebpackHotMiddleware(compiler, {\n  \x3cspan class=\x22hljs-attr\x22\x3elog\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log\n}))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最後則是 express 的監聽事件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22app.listen(8080, function () {\n  console.log(\x27Listening on 8080\x27)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eapp.listen(\x3cspan class=\x22hljs-number\x22\x3e8080\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Listening on 8080\x27\x3c\/span\x3e)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e完整的 server 程式碼如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var express = require(\x27express\x27)\nvar webpack = require(\x27webpack\x27)\nvar WebpackDevMiddleware = require(\x27webpack-dev-middleware\x27)\nvar WebpackHotMiddleware = require(\x27webpack-hot-middleware\x27)\nvar config = require(\x27.\/config\/webpack.dev.config\x27)\nvar compiler = webpack(config)\n\napp = express()\napp.set(\x27views\x27, \x27.\/views\x27)\napp.set(\x27view engine\x27, \x27ejs\x27)\napp.use(express.static(\x27public\x27));\n\napp.use(WebpackDevMiddleware(compiler, {\n  publicPath: config.output.publicPath,\n  stats: { colors: true }\n}))\napp.use(WebpackHotMiddleware(compiler))\n\nvar router = express.Router()\nrouter.get(\x27\/\x27, function (req, res, next) {\n  res.render(\x27index\x27, { message: \x27Hey there!\x27});\n})\napp.use(router)\n\napp.listen(8080, function () {\n  console.log(\x27Listening on 8080\x27)\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27express\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e webpack = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e WebpackDevMiddleware = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack-dev-middleware\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e WebpackHotMiddleware = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack-hot-middleware\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e config = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/config\/webpack.dev.config\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e compiler = webpack(config)\n\napp = express()\napp.set(\x3cspan class=\x22hljs-string\x22\x3e\x27views\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27.\/views\x27\x3c\/span\x3e)\napp.set(\x3cspan class=\x22hljs-string\x22\x3e\x27view engine\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27ejs\x27\x3c\/span\x3e)\napp.use(express.static(\x3cspan class=\x22hljs-string\x22\x3e\x27public\x27\x3c\/span\x3e));\n\napp.use(WebpackDevMiddleware(compiler, {\n  \x3cspan class=\x22hljs-attr\x22\x3epublicPath\x3c\/span\x3e: config.output.publicPath,\n  \x3cspan class=\x22hljs-attr\x22\x3estats\x3c\/span\x3e: { \x3cspan class=\x22hljs-attr\x22\x3ecolors\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e }\n}))\napp.use(WebpackHotMiddleware(compiler))\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e router = express.Router()\nrouter.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n  res.render(\x3cspan class=\x22hljs-string\x22\x3e\x27index\x27\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Hey there!\x27\x3c\/span\x3e});\n})\napp.use(router)\n\napp.listen(\x3cspan class=\x22hljs-number\x22\x3e8080\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Listening on 8080\x27\x3c\/span\x3e)\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e換個思路\x3c\/h3\x3e\n\x3cp\x3e假設我們並不是要實作一個全站 SPA 的站，實務上我們的確會遇到需要拆分為許多 view \x3ccode\x3e.html\x3c\/code\x3e 的狀況，這種情況下我們會希望自己客製的這個 server 就像 \x3ccode\x3ewebpack-dev-server\x3c\/code\x3e 一樣，當然，這邊只是要指出做法，如果一樣您當然就直接用 webpack-dev-server 就好了。\x3c\/p\x3e\n\x3cp\x3e根據上面這個需求最簡單的方式就是透過 \x3ccode\x3eexpress.static(__dirname)\x3c\/code\x3e 讓 express 直接 return raw 檔案。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3ehtml-webpack-plugin\x3c\/h3\x3e\n\x3cp\x3e小弟認為在學習的過程中，最重要的就是搞懂動機，而這個 \x3ccode\x3ehtml-webpack-plugin\x3c\/code\x3e 插件，其用途就是簡化建立 html 的過程。\x3c\/p\x3e\n\x3cp\x3e先回頭看看上一小節，很直覺的，我們會依據需求建立\x3ccode\x3e不同的頁面(.html)\x3c\/code\x3e，因為在開發過程中很多時候前端只需要注重那些\x3ccode\x3e互動介面的邏輯\x3c\/code\x3e，\x3ccode\x3e樣式\x3c\/code\x3e，\x3ccode\x3e樣板\x3c\/code\x3e，\x3ccode\x3e標籤結構\x3c\/code\x3e ，那我們的重點只有 client 端的 html, js, css 就不在話下了吧！再如果我們又以\x3ccode\x3e元件\x3c\/code\x3e為思路中心來設計實踐的話，那麼 html 裡面大部分的東西都會往元件的 template 搬。依據 SPA 的思路，html 的責任就只是把我們的 bundle 載入並掛載 \x3ccode\x3eroot component\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e如果照著這樣的想法，不斷的新增 html 結果大部分的內容都是重複的那就不太靠譜啦。我們就需要一種簡化工作的方式。\x3c\/p\x3e\n\x3cp\x3e這個套件如上面所說就是簡化\x3ccode\x3e建立載入 bundle 的 html\x3c\/code\x3e的步驟，用在 webpack 打包的檔案包含每次編譯都會更新的 hash 時特方便。\x3c\/p\x3e\n\x3cp\x3e我們可以讓套件幫我們產生 html 或者搭配 loaders 與其他樣版引擎。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e基本的用法\x3c\/h3\x3e\n\x3cp\x3e第一種最簡單的用途就是為我們的 bundle 包上一層 html\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22plugins: [\n  new HtmlWebpackPlugin({\n    filename: \x27i_love_this_file.html\x27\n  })\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-string\x22\x3eplugins:\x3c\/span\x3e [\n  \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e HtmlWebpackPlugin({\n\x3cspan class=\x22hljs-symbol\x22\x3e    filename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27i_love_this_file.html\x27\x3c\/span\x3e\n  })\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果我們有多個 \x3ccode\x3eentry\x3c\/code\x3e 進入點，那麼所有的 bundle 都會被加進這個自動產生的 HTML 中。\x3cbr\x3e如果我們透過 webpack 匯出了 css 資源檔(例如 extract-text-plugin) 那麼這些檔案也會透過 \x3ccode\x3e\x26lt;link\x26gt;\x3c\/code\x3e 被加入 HTML 中。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3ehtml-webpack-plugin 的設定\x3c\/h3\x3e\n\x3cp\x3e當然這個套件也有一些參數，讓我們可以透過設定提供其他的功能。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3etitle\x3c\/code\x3e: 設定該 html  的 \x3ccode\x3e\x26lt;title\x26gt;\x3c\/code\x3e 標籤\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3efilename\x3c\/code\x3e: html 檔名，也當作路徑存取。預設是 \x3ccode\x3eindex.html\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3etemplate\x3c\/code\x3e: 樣板的路徑，也就是說我們可以先組織 HTML 在載入讓 \x3ccode\x3ehtml-webpack-plugin\x3c\/code\x3e 幫我們注入(inject) bundle。此部分要注意相對路徑是從 server 程式檔案出發。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3einject\x3c\/code\x3e: 將所有的資源檔注入 \x3ccode\x3etemplate\x3c\/code\x3e 或 \x3ccode\x3etemplateContent\x3c\/code\x3e，當值是 \x3ccode\x3etrue\x3c\/code\x3e, \x3ccode\x3e\x27body\x27\x3c\/code\x3e 的時候所有的 js 資源檔都會被注入 \x3ccode\x3e\x26lt;\/body\x26gt;\x3c\/code\x3e 之前，\x3ccode\x3e\x27head\x27\x3c\/code\x3e 則是 \x3ccode\x3e\x26lt;head\x26gt;\x3c\/code\x3e 之間，\x3ccode\x3efalse\x3c\/code\x3e 自然就是關閉\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3etrue: Boolean\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efalse: Boolean\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ehead: String\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ebody: String\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3efavicon\x3c\/code\x3e: 替 HTML 加上 favicon 路徑\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3eminify\x3c\/code\x3e: 傳入 \x3ca href=\x22https:\/\/github.com\/kangax\/html-minifier#options-quick-reference\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehtml-minifier\x3c\/a\x3e 參數物件，壓縮輸出。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eoptions: Object\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efalse: Boolean\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3ehash\x3c\/code\x3e: \x3ccode\x3etrue\x3c\/code\x3e 時替 webpack 編譯的檔案或結果路徑結尾補上 hash，這麼做的用意是在開發時期當檔案有異動時可以避免瀏覽器快取\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3etrue: Boolean\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efalse: Boolean\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3ecache\x3c\/code\x3e: 預設是 \x3ccode\x3etrue\x3c\/code\x3e 快取檔案，除非檔案有異動\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3etrue: Boolean\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efalse: Boolean\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3eshowErrors\x3c\/code\x3e: 預設 \x3ccode\x3etrue\x3c\/code\x3e 例外或錯誤資訊會寫入 html 頁面\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3etrue: Boolean\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efalse: Boolean\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3echunks\x3c\/code\x3e: 允許我們加入一些程式碼片段，例如單元測試\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3echunksSortMode\x3c\/code\x3e: 控制 chunks 排序\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3enone: String\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eauto: String\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3edependency: String\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e{}: Function\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eexcludeChunks\x3c\/code\x3e: 略過部分 chunk 程式碼片段\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3exhtml\x3c\/code\x3e: 設定為 \x3ccode\x3etrue\x3c\/code\x3e 的話 \x3ccode\x3elink\x3c\/code\x3e 標籤會是 self-closing ，預設是 \x3ccode\x3efalse\x3c\/code\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3etrue: Boolean\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3efalse: Boolean\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e腦力激盪 - 如果要多個頁面搭配各自的 bundle?\x3c\/h3\x3e\n\x3cp\x3ewebapck 難就難在其靈活之中伴隨著複雜，不同的思路有著不同的做法。這一小節目的是為了不讓我們對 webpack 使用上僵化而提出的一個小題目。\x3c\/p\x3e\n\x3cp\x3e要達成這個需求，我們可以先使用 webpack.config 中 \x3ccode\x3e[name]\x3c\/code\x3e 的功能拆分我們的 bundle\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  entry: {\n    a: \x27.\/path\/src\/a\x27,\n    b: \x27.\/path\/src\/b\x27,\n    c: \x27.\/path\/src\/c\x27\n  },\n  output: {\n    filename: \x27[name].bundle.js\x27\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e{\n  \x3cspan class=\x22hljs-attribute\x22\x3eentry\x3c\/span\x3e: {\n    a: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/path\/src\/a\x27\x3c\/span\x3e,\n    b: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/path\/src\/b\x27\x3c\/span\x3e,\n    c: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/path\/src\/c\x27\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-selector-tag\x22\x3eoutput\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attribute\x22\x3efilename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27[name].bundle.js\x27\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接著透過 \x3ccode\x3ehtml-webpack-plugin\x3c\/code\x3e 的參數，把 \x3ccode\x3einject: false\x3c\/code\x3e 然後 \x3ccode\x3etemplate\x3c\/code\x3e 在各自的 template 中使用 bundle。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e\n\x3ca href=\x22https:\/\/github.com\/jaketrent\/html-webpack-template\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehtml-webpack-template\x3c\/a\x3e - 更牛的方式\x3c\/h3\x3e\n\x3cp\x3e照著上面的方式你可能又跟我抱怨，那不是又要產一堆 HTML 了嗎? 對啊！原本這個架構就是針對 SPA 設計的嘛。不過透過這樣來來回回的思考動機與流程我相信對於您日後使用 webpack 與閱讀設定有很大的幫助。現在的問題是 - 你覺得產一大堆 HTML 不是很靠譜，於是我們就有了 \x3ccode\x3ehtml-webpack-template\x3c\/code\x3e 的產生啦。\x3c\/p\x3e\n\x3cp\x3e這個東西大略的用法就是\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22plugins: [\n  new HtmlWebpackPlugin({\n    title: \x27Sample\x27,\n    filename: \x27sample.html\x27\n  }),\n  new HtmlWebpackPlugin({\n    inject: false, \/\/ 必須\n    template: require(\x27html-webpack-template\x27), \/\/ 必須\n    filename: \x27sp.html\x27, \/\/ 存取的路徑\n\n    \/\/ 只需要特定 bundle 可以這樣設定\n    chunks: [\x27vender\x27],\n    title: \x27OH My Gosh\x27,\n    \/\/ 可以參考 html-webpack-template 的參數設定\n    \/\/ 下面為提供 GA\n    googleAnalytics: {\n      trackingId: \x27UA-XXXX-XX\x27,\n      pageViewOnLoad: true\n    }\n  })\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eplugins: [\n  \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e HtmlWebpackPlugin({\n    \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Sample\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3efilename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27sample.html\x27\x3c\/span\x3e\n  }),\n  \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e HtmlWebpackPlugin({\n    \x3cspan class=\x22hljs-attr\x22\x3einject\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 必須\x3c\/span\x3e\n    template: \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27html-webpack-template\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 必須\x3c\/span\x3e\n    filename: \x3cspan class=\x22hljs-string\x22\x3e\x27sp.html\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 存取的路徑\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 只需要特定 bundle 可以這樣設定\x3c\/span\x3e\n    chunks: [\x3cspan class=\x22hljs-string\x22\x3e\x27vender\x27\x3c\/span\x3e],\n    \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27OH My Gosh\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 可以參考 html-webpack-template 的參數設定\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 下面為提供 GA\x3c\/span\x3e\n    googleAnalytics: {\n      \x3cspan class=\x22hljs-attr\x22\x3etrackingId\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27UA-XXXX-XX\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3epageViewOnLoad\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    }\n  })\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3ehtml-webpack-plugin 事件\x3c\/h3\x3e\n\x3cp\x3e特地介紹此套件的事件也是因為挺有可能會需要一些時間點對 html 動些手腳，有了事件的機制我們就可以讓\x3ccode\x3e其他套件\x3c\/code\x3e修改產生的 html\x3c\/p\x3e\n\x3cp\x3e非同步事件:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ehtml-webpack-plugin-before-html-generation\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ehtml-webpack-plugin-before-html-processing\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ehtml-webpack-plugin-after-html-processing\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ehtml-webpack-plugin-after-emit\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e同步事件:\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e\x3ccode\x3ehtml-webpack-plugin-alter-chunks\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e大略的用法就是在透過 hook event 綁定的事件做些處理\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22compiler.plugin(\x27compilation\x27, function(compilation) {\n  console.log(\x27The compiler is starting a new compilation...\x27);\n\n  compilation.plugin(\x27html-webpack-plugin-before-html-processing\x27, function(htmlPluginData, callback) {\n    htmlPluginData.html \x2b= \x27The magic footer\x27;\n    callback(null, htmlPluginData);\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3ecompiler.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x27compilation\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecompilation\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27The compiler is starting a new compilation...\x27\x3c\/span\x3e);\n\n  compilation.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x27html-webpack-plugin-before-html-processing\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ehtmlPluginData, callback\x3c\/span\x3e) \x3c\/span\x3e{\n    htmlPluginData.html \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x27The magic footer\x27\x3c\/span\x3e;\n    callback(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, htmlPluginData);\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3ewebpack-hot-middleware\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3ewebpack-hot-middleware\x3c\/code\x3e 這個套件只能搭配 \x3ccode\x3ewebpack-dev-middleware\x3c\/code\x3e 使用，其實就是把熱替換的功能加到一般 server 應用。\x3c\/p\x3e\n\x3cp\x3e這個模組只專注在處理 webpack 和瀏覽器溝通的機制。這個中介軟體會去訂閱監聽開發伺服器，當更新或異動發生的時候它就透過 webpack 的 HMR API 來更新。實際上讓您的程式能無縫的使用熱替換已超過本文範圍，在這部分通常會靠其他模組來處理。\x3c\/p\x3e\n\x3cp\x3e安裝完套件與在伺服器 app 中套用之外，要記得 webpack.config 的 plugin 也要加上 \x3ccode\x3eHotModuleReplacementPlugin\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22plugins: [\n  \/\/ Webpack 1.0\n  new webpack.optimize.OccurenceOrderPlugin(),\n  \/\/ Webpack 2.0 fixed this mispelling\n  \/\/ new webpack.optimize.OccurrenceOrderPlugin(),\n  new webpack.HotModuleReplacementPlugin(),\n  new webpack.NoErrorsPlugin()\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eplugins: [\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Webpack 1.0\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.optimize.OccurenceOrderPlugin(),\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Webpack 2.0 fixed this mispelling\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ new webpack.optimize.OccurrenceOrderPlugin(),\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.HotModuleReplacementPlugin(),\n  \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.NoErrorsPlugin()\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e簡短地介紹一下 \x3ccode\x3eOccurrenceOrderPlugin\x3c\/code\x3e 部份，您應該知道 webapck 會給編譯好的程式碼片段一個 id 以用來辨別。\x3c\/p\x3e\n\x3cp\x3e透過上面的這個 plugin 可以讓 webpack 在 id 的分派上優化並保持一致性。\x3c\/p\x3e\n\x3cp\x3e接著要在 entry point 加上 \x3ccode\x3ewebpack-hot-middleware\/client\x3c\/code\x3e 這隻檔案會連到 server 目的是當 server 重新編譯好檔案時收到通知然後更新 client 的檔案。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e如何撰寫 plugin\x3c\/h3\x3e\n\x3cp\x3e為什麼要了解怎麼寫 plugin 呢? 因為某些 plugin 可以擴展支援其他 plugin 相互傳遞資料或需要客製後續任務，所以稍微明白 plugin 的寫法可以讓我們對於 plugin 的設定更加清楚。\x3c\/p\x3e\n\x3cp\x3eplugin 的架構設計促使第三方開發者讓 webpack 核心發揮出無限的潛力。在不同建置階段執行 callback ，開發者可以自訂出特有的行為。\x3c\/p\x3e\n\x3cp\x3e當然建置 plugin 比起開發 loader 是較進階的議題，因為我們必須要理解 webpack 內部的一些 hook 事件。\x3c\/p\x3e\n\x3ch5\x3e編譯器與編譯結果\x3c\/h5\x3e\n\x3cp\x3e要開發 plugin 第一步就是先了解其中最重要的兩個角色 \x3ccode\x3ecompiler\x3c\/code\x3e 和 \x3ccode\x3ecompilation\x3c\/code\x3e 物件\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ecompiler\x3c\/code\x3e 編譯器物件代表一個完整設定的 webpack 環境。這個物件在 webpack 發動之後就會被建置，而且只會建置一次。然後它會配置所有可以操作的設定包含 \x3ccode\x3eloaders\x3c\/code\x3e, \x3ccode\x3eplugins\x3c\/code\x3e。當我們套用一個 plugin 這個 plugin 會收到 \x3ccode\x3ecompiler\x3c\/code\x3e 的參考透過存取這個\x3ccode\x3e參考 reference\x3c\/code\x3e就可以取得 webpack 環境\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ecompilation\x3c\/code\x3e 編譯成果這個物件代表的是\x3ccode\x3e某個版本的編譯後的資源檔\x3c\/code\x3e，在運行 webpack dev middleware 期間每當檔案發生異動就會產生一個新的 \x3ccode\x3ecompilation\x3c\/code\x3e 也就是產生新的編譯結果。這個\x3ccode\x3e編譯結果\x3c\/code\x3e包含的訊息包含 module 模組的狀態，編譯後的資源檔，發生異動的檔案，被觀察的相依套件等。這個編譯結果物件也提供一些執行 callback 的機會讓我們可以在過程中客製一些自己想要的行為。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e任何 webpack plugin 都必須依靠這兩者來完成，所以有需要對其原始碼有些大概的了解\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/webpack\/webpack\/blob\/master\/lib\/Compiler.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCompiler Source\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/webpack\/webpack\/blob\/master\/lib\/Compilation.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCompilation Source\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e基本 plugin 架構\x3c\/h3\x3e\n\x3cp\x3e本質上來說 plugin 只是一個物件實例具有 apply 方法，這個 \x3ccode\x3eapply\x3c\/code\x3e 會在安裝時期被 \x3ccode\x3ewebpack compiler\x3c\/code\x3e 執行一次。\x3c\/p\x3e\n\x3cp\x3e透過這一次的執行呢我們就可以繫結許多事件，直接來看看程式碼您就明白了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function MyPlugin(options) {\n  \/\/ 設定參數\n  this.options = options\n}\n\nMyPlugin.prototype.apply = function(compiler) {\n  compiler.plugin(\x27done\x27, function() {\n    \/\/ 當 plugin 安裝完成就會...\n    console.log(\x27Hello World!\x27);\n  })\n\n  \/\/ 我們自然需要拿到編譯的結果\n  compiler.plugin(\x26quot;compilation\x26quot;, function(compilation) {\n    console.log(compilation.assets)\n\n    compilation.plugin(\x26quot;optimize\x26quot;, function() {\n      console.log(\x26quot;Assets are being optimized.\x26quot;);\n    });\n });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eMyPlugin\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 設定參數\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.options = options\n}\n\nMyPlugin.prototype.apply = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecompiler\x3c\/span\x3e) \x3c\/span\x3e{\n  compiler.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x27done\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 當 plugin 安裝完成就會...\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Hello World!\x27\x3c\/span\x3e);\n  })\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 我們自然需要拿到編譯的結果\x3c\/span\x3e\n  compiler.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x22compilation\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecompilation\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(compilation.assets)\n\n    compilation.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x22optimize\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Assets are being optimized.\x22\x3c\/span\x3e);\n    });\n });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eOK! 我們現在並不是要開發套件所以點到這邊我想就足夠了，剩下的您可以自行參考相關文件。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/webpack\/docs\/wiki\/plugins\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e詳細 plugin API\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3eextract-text-webpack-plugin\x3c\/h3\x3e\n\x3cp\x3e顧名思義這個 plugin 的用途就是把 text 類型的結果匯出成一個檔案，先說這不是非常精確的描述，但概念來說 text 類型指的就是\x3ccode\x3e不會\x3c\/code\x3e輸出成 \x3ccode\x3emodule.exports\x3c\/code\x3e 或 \x3ccode\x3ejson\x3c\/code\x3e 的資料。而像是 CSS 這類的資源檔 webpack 其實最終就是在 JS 中幫我們建個 style tag 的  dom 然後整包放進去。\x3ccode\x3efile-loader\x3c\/code\x3e, \x3ccode\x3eraw-loader\x3c\/code\x3e 等等這類內容大略就屬於 text 類型。\x3ca href=\x22https:\/\/webpack.github.io\/docs\/loader-conventions.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e查閱各種 loaders 回傳資料類型\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e於是乎以 entry point 為單位過程中解析的 text 內容就會被抽出來匯出成一個檔案。最常見的用法就是把 css 抽出來:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var ExtractTextPlugin = require(\x26quot;extract-text-webpack-plugin\x26quot;)\n\nmodule.exports = {\n  module: {\n    loaders: [\n      { test: \/\\.css$\/, loader: ExtractTextPlugin.extract(\x26quot;style\x26quot;, \x26quot;css\x26quot;) }\n    ]\n  },\n  plugins: [\n    \/\/ 注意: 這邊的副檔名如果亂下是會造成瀏覽器行為不符合預期的，例如不給副檔名那瀏覽器就會當作 binary 下載\n    new ExtractTextPlugin(\x26quot;styles.css\x26quot;)\n  ]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ExtractTextPlugin = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22extract-text-webpack-plugin\x22\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n  \x3cspan class=\x22hljs-attr\x22\x3emodule\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3eloaders\x3c\/span\x3e: [\n      { \x3cspan class=\x22hljs-attr\x22\x3etest\x3c\/span\x3e: \x3cspan class=\x22hljs-regexp\x22\x3e\/\\.css$\/\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eloader\x3c\/span\x3e: ExtractTextPlugin.extract(\x3cspan class=\x22hljs-string\x22\x3e\x22style\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22css\x22\x3c\/span\x3e) }\n    ]\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eplugins\x3c\/span\x3e: [\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注意: 這邊的副檔名如果亂下是會造成瀏覽器行為不符合預期的，例如不給副檔名那瀏覽器就會當作 binary 下載\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ExtractTextPlugin(\x3cspan class=\x22hljs-string\x22\x3e\x22styles.css\x22\x3c\/span\x3e)\n  ]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果想要拆分多個檔案，那麼就先初始化 instance\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let ExtractTextPlugin = require(\x27extract-text-webpack-plugin\x27);\n\n\/\/ multiple extract instances\nlet cssExtractor = new ExtractTextPlugin(\x27stylesheets\/[name].css\x27);\nlet lessExtractor = new ExtractTextPlugin(\x27stylesheets\/[name].less\x27);\n\nmodule.exports = {\n  module: {\n    loaders: [\n      {test: \/\\.scss$\/i, loader: cssExtractor.extract([\x27css\x27,\x27sass\x27])},\n      {test: \/\\.less$\/i, loader: lessExtractor.extract([\x27css\x27,\x27less\x27])},\n      ...\n    ]\n  },\n  plugins: [\n    cssExtractor,\n    lessExtractor\n  ]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ExtractTextPlugin = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27extract-text-webpack-plugin\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ multiple extract instances\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e cssExtractor = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ExtractTextPlugin(\x3cspan class=\x22hljs-string\x22\x3e\x27stylesheets\/[name].css\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e lessExtractor = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ExtractTextPlugin(\x3cspan class=\x22hljs-string\x22\x3e\x27stylesheets\/[name].less\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n  \x3cspan class=\x22hljs-attr\x22\x3emodule\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3eloaders\x3c\/span\x3e: [\n      {\x3cspan class=\x22hljs-attr\x22\x3etest\x3c\/span\x3e: \x3cspan class=\x22hljs-regexp\x22\x3e\/\\.scss$\/i\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eloader\x3c\/span\x3e: cssExtractor.extract([\x3cspan class=\x22hljs-string\x22\x3e\x27css\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27sass\x27\x3c\/span\x3e])},\n      {\x3cspan class=\x22hljs-attr\x22\x3etest\x3c\/span\x3e: \x3cspan class=\x22hljs-regexp\x22\x3e\/\\.less$\/i\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eloader\x3c\/span\x3e: lessExtractor.extract([\x3cspan class=\x22hljs-string\x22\x3e\x27css\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27less\x27\x3c\/span\x3e])},\n      ...\n    ]\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eplugins\x3c\/span\x3e: [\n    cssExtractor,\n    lessExtractor\n  ]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3eHMR 熱替換\x3c\/h3\x3e\n\x3cp\x3eHot Module Replacement (HRM) 又稱熱替換，功能就是在程式運行中交換，移除，增加模組且不會使頁面重新載入。這跟我們伺服器的熱插拔差不多概念。\x3c\/p\x3e\n\x3ch5\x3e它是怎麼運作的?\x3c\/h5\x3e\n\x3cp\x3ewebpack 在 bundle 中即我們的 js 裡加入了一個小型的 HMR 執行環境，在編譯過程中這個 runtime 會在我們的 app 中運行。\x3c\/p\x3e\n\x3cp\x3e當建置完成時 webpack 也不會消失反而會持續存在，繼續監控原始碼檔案是否發生修改。一旦 webpack 發現程式有改變他就會去重新編譯那些有修改的模組，不全部重建。根據設定要嘛就是 webpack 把訊號丟給 HRM runtime 要嘛就是 HRM 自己更新異動資訊。不管哪種方式反正重點就是 HRM runtime 會取得修改的模組，接著就試著在運行的狀態下更新模組。首先會先檢查更新的模組是否能 \x3ccode\x3eself-accept\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e關於 \x3ccode\x3eself-accept\x3c\/code\x3e 先看看\x3ca href=\x22https:\/\/github.com\/webpack\/hot-node-example\/blob\/master\/index.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e範例\x3c\/a\x3e和\x3ca href=\x22https:\/\/github.com\/webpack\/webpack\/tree\/master\/test\/hotCases\/runtime\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e原始碼\x3c\/a\x3e，意思是要\x3ccode\x3e支援熱替換的模組或說編譯結果\x3c\/code\x3e基本上是應該要實作 \x3ccode\x3emodule.hot.accept\x3c\/code\x3e 和遵循其他熱替換的規則。\x3c\/p\x3e\n\x3cp\x3e如果沒有辦法自己確認自己可以直接被更新，那就往上傳，通知那些 require 匯入使用自己的模組更新，就這樣層層往上。直到有人可以 accept 或到頂，不過一旦到根就表示熱替換失敗。\x3c\/p\x3e\n\x3cp\x3e讀到這邊你可能通了，為什麼當我們要讓 React 支援 Hot Mode 的時候需要一個 \x3ccode\x3ereact-hot-loader\x3c\/code\x3e。以及因為要和 HRM 執行環境溝通的關係我們需要在 bundle 的 entry point 加上 \x3ccode\x3ewebpack\/hot\/dev-server\x3c\/code\x3e, \x3ccode\x3ewebpack-hot-middleware\/client\x3c\/code\x3e 之類的東西。\x3c\/p\x3e\n\x3ch5\x3e從 App 的角度\x3c\/h5\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006763873\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006763873\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e當 App 程式開始執行(就是載入 bundle) HMR runtime 執行環境就會啟用，接下來程式就會要求 HMR runtime 幫我們檢查是否需要更新。HMR 會幫我們下載更新然後通知 App 程式有哪些更新可用。\x3c\/p\x3e\n\x3ch5\x3e從編譯器(webpack\/compiler)的角度\x3c\/h5\x3e\n\x3cp\x3e除了一般的資源檔像是圖片，css，編譯器還需要觸發\x3ccode\x3e更新事件\x3c\/code\x3e讓程式碼可以完成新舊替換。這個\x22更新\x22包含兩個部分\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e更新的 Manifest 支援配置文件(json)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e一或多個更新的\x3ccode\x3echunks\x3c\/code\x3e程式片段(js)\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e支援配置文件包含更新後編譯結果的 hash 和新的 chunks 程式碼片段的列表。而新的 chunks 則包含更新後模組的程式碼或 \x3ccode\x3eflag\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e編譯器同時也會確保模組和片段 ID 是一致的，透過一個 \x3ccode\x3erecords\x3c\/code\x3e 的 json 檔案來儲存相關資訊。\x3c\/p\x3e\n\x3ch5\x3e從模組角度\x3c\/h5\x3e\n\x3cp\x3eHMR 是選擇性的功能，所以只有在模組包含 HRM 程式碼才會被影響作用。也就是在模組中使用文件有提供的 API。一般來說模組的開發者 handler 會在模組相依的部分更新時被執行。當然也可以寫一個 handler 在這個模組更新時被呼叫。\x3c\/p\x3e\n\x3cp\x3e在大部分的情況並不需要為每一個模組都撰寫\x3ccode\x3e支援 HMR 的程式碼\x3c\/code\x3e，當一個模組沒有遵循處理規則時就會往上層傳遞事件，意味著只有上方有一個 handler 可以處理就好，但不要讓這個冒泡事件一路冒到頂喔。\x3c\/p\x3e\n\x3ch5\x3e從 HMR runtime 角度\x3c\/h5\x3e\n\x3cp\x3e模組系統的執行環境其實是額外加入的程式，用來追蹤模組之間的父子關係。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if(module.hot) {\n    ...\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.hot) {\n    ...\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e從管理的角度，這個執行環境 runtime 支援 \x3ccode\x3echeck\x3c\/code\x3e 和 \x3ccode\x3eapply\x3c\/code\x3e 兩個方法。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3echeck\x3c\/code\x3e 的功能是發出 HTTP request 用來取得上面提到的 Manifest，當 request 失敗時就等於沒有任何更新。否則就會依照得到的\x3ccode\x3e更新列表\x3c\/code\x3e去比對 chunks。\x3c\/p\x3e\n\x3cp\x3e對每個已載入的 chunk 都會有對應更新的程式碼要被下載。所有模組更新會被存在 runtime 中準備拿來更新。當執行環境切換成 \x3ccode\x3eready\x3c\/code\x3e 狀態就表示更新的程式碼都被下載完成了隨時可以套用。\x3c\/p\x3e\n\x3cp\x3e接著 \x3ccode\x3eapply\x3c\/code\x3e 方法會將所有已更新的模組的 \x3ccode\x3eflag\x3c\/code\x3e 標記為 \x3ccode\x3einvalid\x3c\/code\x3e 無效，然後無效的模組需要 update 的 handler 處理函式，這個 handler 會在模組中或者父節點上。只要沒有這個 handler 就會持續往上曾傳遞並標註為 \x3ccode\x3einvalid\x3c\/code\x3e，一旦冒泡機制冒到頂端即 \x3ccode\x3eentry point\x3c\/code\x3e 就表示熱替換失敗。\x3c\/p\x3e\n\x3cp\x3e所有被標記為無效的模組都會透過 \x3ccode\x3emodule.hot.dispose\x3c\/code\x3e 卸載，然後更新 hash，再來所有 \x3ccode\x3emodule.hot.accept\x3c\/code\x3e 的 handlers 會被調用。\x3c\/p\x3e\n\x3cp\x3e執行環境切回 \x3ccode\x3eidle\x3c\/code\x3e 狀態表示所有更新都完成了。\x3c\/p\x3e\n\x3cp\x3e講這麼多其實簡單來說就是我們的模組要補一些 hot mode 的邏輯\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var app = require(\x26quot;.\/app\x26quot;);\n\n\/\/ 模擬每 5 秒更新一次\nsetInterval(function() {\n    console.log(app(new Date()));\n}, 5000);\n\nif(module.hot) {\n    module.hot.accept(\x26quot;.\/app\x26quot;, function() {\n        app = require(\x26quot;.\/app\x26quot;);\n    });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22.\/app\x22\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 模擬每 5 秒更新一次\x3c\/span\x3e\nsetInterval(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(app(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e()));\n}, \x3cspan class=\x22hljs-number\x22\x3e5000\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.hot) {\n    \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.hot.accept(\x3cspan class=\x22hljs-string\x22\x3e\x22.\/app\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        app = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22.\/app\x22\x3c\/span\x3e);\n    });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e檔案的更新流程\x3c\/h5\x3e\n\x3cp\x3e左邊表示初始化時編譯器產生的結構，右邊則是當模組 4 和 9 更新時的流程。\x3cbr\x3e方塊表示從 Entry 開始，webpack 幫我們編譯產生的部份從 Entry 然後轉換成 Chunk 0 - 4\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000004840685\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000004840685\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3e資源參考\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/ampedandwired\/html-webpack-plugin\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehtml-webpack-plugin\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/madole.github.io\/blog\/2015\/08\/26\/setting-up-webpack-dev-middleware-in-your-express-application\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack dev middleware 說明\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3e備註\x3c\/h3\x3e\n\x3cp\x3e部分內容可能理解不夠精確若有錯誤歡迎指教留言\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>手把手深入理解 webpack dev middleware 原理與相關 plugins</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005614604">https://segmentfault.com/a/1190000005614604</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/5shjve5m9xe/" target="_blank">https://alili.tech/archive/5shjve5m9xe/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>