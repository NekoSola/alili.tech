<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="不会写shell的程序员照样是好前端——用Node.JS实现git hooks"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>不会写shell的程序员照样是好前端——用Node.JS实现git hooks | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/8h6yy84myj8/",
				"appid": "1613049289050283", 
				"title": "不会写shell的程序员照样是好前端——用Node.JS实现git hooks | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-11T02:30:49"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/o0w4l8o5r5/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/69ljhhsi3xa/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f8h6yy84myj8%2f&text=%e4%b8%8d%e4%bc%9a%e5%86%99shell%e7%9a%84%e7%a8%8b%e5%ba%8f%e5%91%98%e7%85%a7%e6%a0%b7%e6%98%af%e5%a5%bd%e5%89%8d%e7%ab%af%e2%80%94%e2%80%94%e7%94%a8Node.JS%e5%ae%9e%e7%8e%b0git%20hooks"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f8h6yy84myj8%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f8h6yy84myj8%2f&text=%e4%b8%8d%e4%bc%9a%e5%86%99shell%e7%9a%84%e7%a8%8b%e5%ba%8f%e5%91%98%e7%85%a7%e6%a0%b7%e6%98%af%e5%a5%bd%e5%89%8d%e7%ab%af%e2%80%94%e2%80%94%e7%94%a8Node.JS%e5%ae%9e%e7%8e%b0git%20hooks"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f8h6yy84myj8%2f&title=%e4%b8%8d%e4%bc%9a%e5%86%99shell%e7%9a%84%e7%a8%8b%e5%ba%8f%e5%91%98%e7%85%a7%e6%a0%b7%e6%98%af%e5%a5%bd%e5%89%8d%e7%ab%af%e2%80%94%e2%80%94%e7%94%a8Node.JS%e5%ae%9e%e7%8e%b0git%20hooks"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f8h6yy84myj8%2f&is_video=false&description=%e4%b8%8d%e4%bc%9a%e5%86%99shell%e7%9a%84%e7%a8%8b%e5%ba%8f%e5%91%98%e7%85%a7%e6%a0%b7%e6%98%af%e5%a5%bd%e5%89%8d%e7%ab%af%e2%80%94%e2%80%94%e7%94%a8Node.JS%e5%ae%9e%e7%8e%b0git%20hooks"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%b8%8d%e4%bc%9a%e5%86%99shell%e7%9a%84%e7%a8%8b%e5%ba%8f%e5%91%98%e7%85%a7%e6%a0%b7%e6%98%af%e5%a5%bd%e5%89%8d%e7%ab%af%e2%80%94%e2%80%94%e7%94%a8Node.JS%e5%ae%9e%e7%8e%b0git%20hooks&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f8h6yy84myj8%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f8h6yy84myj8%2f&title=%e4%b8%8d%e4%bc%9a%e5%86%99shell%e7%9a%84%e7%a8%8b%e5%ba%8f%e5%91%98%e7%85%a7%e6%a0%b7%e6%98%af%e5%a5%bd%e5%89%8d%e7%ab%af%e2%80%94%e2%80%94%e7%94%a8Node.JS%e5%ae%9e%e7%8e%b0git%20hooks"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f8h6yy84myj8%2f&title=%e4%b8%8d%e4%bc%9a%e5%86%99shell%e7%9a%84%e7%a8%8b%e5%ba%8f%e5%91%98%e7%85%a7%e6%a0%b7%e6%98%af%e5%a5%bd%e5%89%8d%e7%ab%af%e2%80%94%e2%80%94%e7%94%a8Node.JS%e5%ae%9e%e7%8e%b0git%20hooks"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f8h6yy84myj8%2f&title=%e4%b8%8d%e4%bc%9a%e5%86%99shell%e7%9a%84%e7%a8%8b%e5%ba%8f%e5%91%98%e7%85%a7%e6%a0%b7%e6%98%af%e5%a5%bd%e5%89%8d%e7%ab%af%e2%80%94%e2%80%94%e7%94%a8Node.JS%e5%ae%9e%e7%8e%b0git%20hooks"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f8h6yy84myj8%2f&title=%e4%b8%8d%e4%bc%9a%e5%86%99shell%e7%9a%84%e7%a8%8b%e5%ba%8f%e5%91%98%e7%85%a7%e6%a0%b7%e6%98%af%e5%a5%bd%e5%89%8d%e7%ab%af%e2%80%94%e2%80%94%e7%94%a8Node.JS%e5%ae%9e%e7%8e%b0git%20hooks"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">不会写shell的程序员照样是好前端——用Node.JS实现git hooks</h1><div class="meta"><div class="postdate"><time datetime="2019-02-11" itemprop="datePublished">2019-02-11</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3egit hooks想必很多攻城狮都不陌生，官方对于hooks有详细的\x3ca href=\x22https:\/\/git-scm.com\/book\/en\/v2\/Customizing-Git-Git-Hooks\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e文档\x3c\/a\x3e，也有站内网友的文章\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000000356485\x22\x3eGit Hooks (1)：介绍\x3c\/a\x3e,\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000000356487\x22 target=\x22_blank\x22\x3eGIt Hooks (2)：脚本分类\x3c\/a\x3e，说的非常详细了，这里就不多做介绍，这里主要介绍一下如何写一个hook。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e一个基本的git hook长什么样？\x3c\/h2\x3e\n\x3cp\x3e对git-hooks有一个入门认识的朋友都知道，hooks存放在git仓库的\x3ccode\x3e.git\/hooks\x3c\/code\x3e目录下，其中包括很多hooks，这些是在git 仓库创建的时候自动生成的，后缀名统一都是\x3ccode\x3e.sample\x3c\/code\x3e，表示这些hooks都是默认不启用的，当把后缀名去掉之后，就变成了可以使用的hook。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e举个栗子\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVuNGr\x22 src=\x22https:\/\/static.alili.tech\/img\/bVuNGr\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3epre-commit这个hook是在\x3ccode\x3egit commit\x3c\/code\x3e的时候触发的hook，这个hook里面写了什么呢？代码我就不贴了，没啥劲，主要的几点就是：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e这是一个shell脚本\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e这个脚本运行了一些东西然后退出了\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e退出的时候退出的错误码不是确定的\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e这就是一个hook的最基本的组成：在命令行执行git操作的时候，自动执行hooks目录下相应的可执行脚本，然后根据脚本的退出状态决定此次操作是否成功。当退出的错误码不为0的时候，表示失败，操作终止，否则操作继续。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e模拟场景\x3c\/h3\x3e\n\x3cp\x3e如果现在有这样一个场景，在你的git仓库里，要求不允许提交\x3ccode\x3edist\x3c\/code\x3e目录，并且通过\x3ccode\x3emocha\x3c\/code\x3e的测试，否则不允许提交，用git hook 怎么做呢？\x3c\/p\x3e\n\x3cp\x3e首先，这是在提交的时候的一个限制，所以应该考虑使用\x3ccode\x3epre-commit\x3c\/code\x3e这个hook，代码就不写了（不会写shell... Orz），整个过程如下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e检查是否有\x3ccode\x3edist\x3c\/code\x3e目录，如果没有的话下一步，否则退出，错误码置为1。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e执行mocha命令进行测试，如果测试全部通过的话，退出，错误码为0，否则错误码为1，同样退出。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e这样，当上述任何一步没有通过的时候，这个hook就会被终止，git-commit就无法通过，也就达到了限制提交的目的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3eshell脚本的局限性——不会写\x3c\/h2\x3e\n\x3cp\x3e作为一名普通的前端，兼，一名不太合格的工程师，我对于shell脚本实在是不熟悉，连Linux命令都玩不转，别说写出666的shell脚本了，囧~ 所以要另辟巧径做这件事。\x3c\/p\x3e\n\x3cp\x3e前端仔们对js应该是非常熟练的，所以如果能用js写hooks，那不就爽了？而Node.JS正好给了我们希望，感激涕零的话就不多说了，绝对感动到哭！\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVuNJ5\x22 src=\x22https:\/\/static.alili.tech\/img\/bVuNJ5\x22 alt=\x2220151004154819_vcYJV.thumb.224_0.jpeg\x22 title=\x2220151004154819_vcYJV.thumb.224_0.jpeg\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eNode.js写起脚本来也非常简单，比如一个最简单的脚本\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22#!\/usr\/bin\/env node\n\nconsole.log(\x27Hello World!\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs autoit\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-meta\x22\x3e#!\/usr\/bin\/env node\x3c\/span\x3e\n\nconsole.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Hello World!\x27\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e给脚本赋予可执行权限之后就完全可以当做shell脚本来跑了，麻麻再也不用担心我不会shell了。同样的，在hooks中我们也可以这样用。再举个栗子\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVuNKy\x22 src=\x22https:\/\/static.alili.tech\/img\/bVuNKy\x22 alt=\x22060cc75c10385343024d82b79513b07ecb808848.jpg\x22 title=\x22060cc75c10385343024d82b79513b07ecb808848.jpg\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e还是刚才的场景，不允许有\x3ccode\x3edist\x3c\/code\x3e目录，同时通过所有mocha测试，用Node就可以这样写（这次我能show出代码了）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22#!\/usr\/bin\/env node\nvar fs = require(\x27fs\x27),\n    spawnSync = require(\x27child_process\x27).spawnSync;\nif(fs.existsSync(\x27.\/dist\x27)){\n    console.log(\x27Commit Abort!Please remove dist directory.\x27);\n    process.exit(1);\n}\n\/\/ 使用同步方法spawnSync执行mocha，测试的结果在result.status中，通过为0，不通过为1\nvar result = spawnSync(\x27.\/node_modules\/.bin\/mocha\x27,[\x27test\x27]); \nif(result.status){\n    console.log(\x27Commit Abort!Test failure.\x27);\n}\nprocess.exit(result.status);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e#!\/usr\/bin\/env node\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27fs\x27\x3c\/span\x3e),\n    spawnSync = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27child_process\x27\x3c\/span\x3e).spawnSync;\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(fs.existsSync(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/dist\x27\x3c\/span\x3e)){\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Commit Abort!Please remove dist directory.\x27\x3c\/span\x3e);\n    process.exit(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 使用同步方法spawnSync执行mocha，测试的结果在result.status中，通过为0，不通过为1\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = spawnSync(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/node_modules\/.bin\/mocha\x27\x3c\/span\x3e,[\x3cspan class=\x22hljs-string\x22\x3e\x27test\x27\x3c\/span\x3e]); \n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(result.status){\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Commit Abort!Test failure.\x27\x3c\/span\x3e);\n}\nprocess.exit(result.status);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这就是一个用Node.JS实现的基本的git-hook。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3eNode.JS的局限性——不能动\x3c\/h2\x3e\n\x3cp\x3eclient-side hook的一个问题就是没法在随着仓库变动，如果项目成员多的话，每个人都需要在自己本地添加一次，hooks有变动了更新也比较麻烦。\x3c\/p\x3e\n\x3ch4\x3e解决方案\x3c\/h4\x3e\n\x3cp\x3e我个人对这个问题有一个简单解决方案，我做了一个仓库\x3ca href=\x22https:\/\/github.com\/y8n\/git-hooks-node\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egit-hooks-node\x3c\/a\x3e，每次写好git hooks之后通过自己写的工具进行build，生成一个类似于安装器的文件，然后提交到远程仓库，如\x3ca href=\x22https:\/\/github.com\/y8n\/git-hooks-node\/blob\/master\/xgfe-ma\/pre-commit.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epre-commit.js\x3c\/a\x3e是hook具体的内容，\x3ca href=\x22https:\/\/github.com\/y8n\/git-hooks-node\/blob\/master\/xgfe-ma\/pre-commit.installer.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epre-commit.installer.js\x3c\/a\x3e是生成的安装文件，也是一个脚本，github上的每一个文件都有相应的raw地址，如这个安装文件的地址为\x3ca href=\x22https:\/\/raw.githubusercontent.com\/y8n\/git-hooks-node\/master\/xgfe-ma\/pre-commit.installer.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eraw pre-commit.installer.js\x3c\/a\x3e，然后mac OS下的用户就可以使用\x3ccode\x3ecurl\x3c\/code\x3e获取脚本并运行，如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22curl https:\/\/raw.githubusercontent.com\/y8n\/git-hooks-node\/master\/xgfe-ma\/pre-commit.installer.js | node\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3ecurl https:\/\/raw.githubusercontent.com\/y8n\/git-hooks-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e\/master\x3c\/span\x3e\/xgfe-ma\/pre-commit.installer.js | \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3c\/code\x3e\x3cspan class=\x22hljs-title\x22\x3e\x3c\/span\x3e\x3c\/pre\x3e\n\x3cp\x3e安装效果如下\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVuNNb\x22 src=\x22https:\/\/static.alili.tech\/img\/bVuNNb\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这样只要写好一个hook并发布，项目成员只要知道地址就可以一键安转（想想还有点小激动呢）。这样虽然没有解决hook不会随着仓库移动的问题，但也提供了一种在项目组里通用一套hook的方案。\x3c\/p\x3e\n\x3ch4\x3e其他解决方法\x3c\/h4\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/typicode\/husky\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehusky\x3c\/a\x3e是GitHub上一个开源项目，它的做法是在\x3ccode\x3enpm install\x3c\/code\x3e这个模块的时候自动在\x3ccode\x3e.git\/hooks\x3c\/code\x3e目录下创建很多hooks，然后再在package.json中指定每一个hook的执行脚本，如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x26quot;scripts\x26quot;: {\n    \x26quot;precommit\x26quot;: \x26quot;npm test\x26quot;,\n    \x26quot;prepush\x26quot;: \x26quot;npm test\x26quot;,\n    \x26quot;commit-msg\x26quot;: \x26quot;.\/validate-commit-msg.js\x26quot;,\n    \x26quot;...\x26quot;: \x26quot;...\x26quot;\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xquery\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22precommit\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22npm test\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22prepush\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22npm test\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22commit-msg\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22.\/validate-commit-msg.js\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22...\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22...\x22\x3c\/span\x3e\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样就可以把hooks随着项目变动，真正做到项目成员共用一个git hook，但问题就是必须在项目中依赖husky，不过想想这样的方法也比上面我的方法高明许多 -.-!\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>不会写shell的程序员照样是好前端——用Node.JS实现git hooks</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000004918996">https://segmentfault.com/a/1190000004918996</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/8h6yy84myj8/" target="_blank">https://alili.tech/archive/8h6yy84myj8/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>