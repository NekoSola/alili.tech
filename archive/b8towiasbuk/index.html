<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="[译] 实例解析 ES6 Proxy 使用场景"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>[译] 实例解析 ES6 Proxy 使用场景 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/b8towiasbuk/",
				"appid": "1613049289050283", 
				"title": "[译] 实例解析 ES6 Proxy 使用场景 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-06T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/76nbuuzf2v5/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/ievxu5omngn/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fb8towiasbuk%2f&text=%5b%e8%af%91%5d%20%e5%ae%9e%e4%be%8b%e8%a7%a3%e6%9e%90%20ES6%20Proxy%20%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fb8towiasbuk%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fb8towiasbuk%2f&text=%5b%e8%af%91%5d%20%e5%ae%9e%e4%be%8b%e8%a7%a3%e6%9e%90%20ES6%20Proxy%20%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fb8towiasbuk%2f&title=%5b%e8%af%91%5d%20%e5%ae%9e%e4%be%8b%e8%a7%a3%e6%9e%90%20ES6%20Proxy%20%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fb8towiasbuk%2f&is_video=false&description=%5b%e8%af%91%5d%20%e5%ae%9e%e4%be%8b%e8%a7%a3%e6%9e%90%20ES6%20Proxy%20%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%5b%e8%af%91%5d%20%e5%ae%9e%e4%be%8b%e8%a7%a3%e6%9e%90%20ES6%20Proxy%20%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fb8towiasbuk%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fb8towiasbuk%2f&title=%5b%e8%af%91%5d%20%e5%ae%9e%e4%be%8b%e8%a7%a3%e6%9e%90%20ES6%20Proxy%20%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fb8towiasbuk%2f&title=%5b%e8%af%91%5d%20%e5%ae%9e%e4%be%8b%e8%a7%a3%e6%9e%90%20ES6%20Proxy%20%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fb8towiasbuk%2f&title=%5b%e8%af%91%5d%20%e5%ae%9e%e4%be%8b%e8%a7%a3%e6%9e%90%20ES6%20Proxy%20%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fb8towiasbuk%2f&title=%5b%e8%af%91%5d%20%e5%ae%9e%e4%be%8b%e8%a7%a3%e6%9e%90%20ES6%20Proxy%20%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">[译] 实例解析 ES6 Proxy 使用场景</h1><div class="meta"><div class="postdate"><time datetime="2019-02-06" itemprop="datePublished">2019-02-06</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e文章永久链接地址：\x3ca href=\x22http:\/\/pinggod.com\/2016\/%E5%AE%9E%E4%BE%8B%E8%A7%A3%E6%9E%90-ES6-Proxy-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/pinggod.com\/2016\/%E5%AE%9E%E4%BE%8B%E8%A7%A3%E6%9E%90-ES6-Proxy-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF\/\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3eES6 中的箭头函数、数组解构、rest 参数等特性一经实现就广为流传，但类似 Proxy 这样的特性却很少见到有开发者在使用，一方面在于浏览器的兼容性，另一方面也在于要想发挥这些特性的优势需要开发者深入地理解其使用场景。就我个人而言是非常喜欢 ES6 的 Proxy，因为它让我们以简洁易懂的方式控制了外部对对象的访问。在下文中，首先我会介绍 Proxy 的使用方式，然后列举具体实例解释 Proxy 的使用场景。\x3c\/p\x3e\n\x3cp\x3eProxy，见名知意，其功能非常类似于设计模式中的代理模式，该模式常用于三个方面：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e拦截和监视外部对对象的访问\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e降低函数或类的复杂度\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在复杂操作前对操作进行校验或对所需资源进行管理\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e在支持 Proxy 的浏览器环境中，Proxy 是一个全局对象，可以直接使用。\x3ccode\x3eProxy(target, handler)\x3c\/code\x3e 是一个构造函数，\x3ccode\x3etarget\x3c\/code\x3e 是被代理的对象，\x3ccode\x3ehandlder\x3c\/code\x3e 是声明了各类代理操作的对象，最终返回一个代理对象。外界每次通过代理对象访问 \x3ccode\x3etarget\x3c\/code\x3e 对象的属性时，就会经过 \x3ccode\x3ehandler\x3c\/code\x3e 对象，从这个流程来看，代理对象很类似 middleware（中间件）。那么 Proxy 可以拦截什么操作呢？最常见的就是 get（读取）、set（修改）对象属性等操作，完整的可拦截操作列表请点击\x3ca href=\x22http:\/\/www.ecma-international.org\/ecma-262\/6.0\/#sec-proxy-object-internal-methods-and-internal-slots\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e。此外，Proxy 对象还提供了一个 \x3ccode\x3erevoke\x3c\/code\x3e 方法，可以随时注销所有的代理操作。在我们正式介绍 Proxy 之前，建议你对 Reflect 有一定的了解，它也是一个 ES6 新增的全局对象，详细信息请参考 \x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/JavaScript\/Reference\/Global_Objects\/Reflect\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMDN Reflect\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3eBasic\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const target = {  \n    name: \x27Billy Bob\x27,\n    age: 15\n};\n\nconst handler = {  \n    get(target, key, proxy) {\n        const today = new Date();\n        console.log(`GET request made for ${key} at ${today}`);\n\n        return Reflect.get(target, key, proxy);\n    }\n};\n\nconst proxy = new Proxy(target, handler);\nproxy.name;\n\/\/ =\x3e \x26quot;GET request made for name at Thu Jul 21 2016 15:26:20 GMT\x2b0800 (CST)\x26quot;\n\/\/ =\x3e \x26quot;Billy Bob\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e target = {  \n    \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Billy Bob\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e handler = {  \n    get(target, key, proxy) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e today = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e();\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`GET request made for \x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e at \x3cspan class=\x22hljs-subst\x22\x3e${today}\x3c\/span\x3e`\x3c\/span\x3e);\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.get(target, key, proxy);\n    }\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e proxy = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eProxy\x3c\/span\x3e(target, handler);\nproxy.name;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ =\x26gt; \x22GET request made for name at Thu Jul 21 2016 15:26:20 GMT\x2b0800 (CST)\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ =\x26gt; \x22Billy Bob\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面的代码中，我们首先定义了一个被代理的目标对象 \x3ccode\x3etarget\x3c\/code\x3e，然后声明了包含所有代理操作的 \x3ccode\x3ehandler\x3c\/code\x3e 对象，接下来使用 \x3ccode\x3eProxy(target, handler)\x3c\/code\x3e 创建代理对象 \x3ccode\x3eproxy\x3c\/code\x3e，此后所有使用 \x3ccode\x3eproxy\x3c\/code\x3e 对 \x3ccode\x3etarget\x3c\/code\x3e 属性的访问都会经过 \x3ccode\x3ehandler\x3c\/code\x3e 的处理。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e1. 抽离校验模块\x3c\/h2\x3e\n\x3cp\x3e让我们从一个简单的类型校验开始做起，这个示例演示了如何使用 Proxy 保障数据类型的准确性：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let numericDataStore = {  \n    count: 0,\n    amount: 1234,\n    total: 14\n};\n\nnumericDataStore = new Proxy(numericDataStore, {  \n    set(target, key, value, proxy) {\n        if (typeof value !== \x27number\x27) {\n            throw Error(\x26quot;Properties in numericDataStore can only be numbers\x26quot;);\n        }\n        return Reflect.set(target, key, value, proxy);\n    }\n});\n\n\/\/ 抛出错误，因为 \x26quot;foo\x26quot; 不是数值\nnumericDataStore.count = \x26quot;foo\x26quot;;\n\n\/\/ 赋值成功\nnumericDataStore.count = 333;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e numericDataStore = {  \n    \x3cspan class=\x22hljs-attr\x22\x3ecount\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eamount\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1234\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3etotal\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e14\x3c\/span\x3e\n};\n\nnumericDataStore = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eProxy\x3c\/span\x3e(numericDataStore, {  \n    set(target, key, value, proxy) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e value !== \x3cspan class=\x22hljs-string\x22\x3e\x27number\x27\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22Properties in numericDataStore can only be numbers\x22\x3c\/span\x3e);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.set(target, key, value, proxy);\n    }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 抛出错误，因为 \x22foo\x22 不是数值\x3c\/span\x3e\nnumericDataStore.count = \x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 赋值成功\x3c\/span\x3e\nnumericDataStore.count = \x3cspan class=\x22hljs-number\x22\x3e333\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果要直接为对象的所有属性开发一个校验器可能很快就会让代码结构变得臃肿，使用 Proxy 则可以将校验器从核心逻辑分离出来自成一体：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function createValidator(target, validator) {  \n    return new Proxy(target, {\n        _validator: validator,\n        set(target, key, value, proxy) {\n            if (target.hasOwnProperty(key)) {\n                let validator = this._validator[key];\n                if (!!validator(value)) {\n                    return Reflect.set(target, key, value, proxy);\n                } else {\n                    throw Error(`Cannot set ${key} to ${value}. Invalid.`);\n                }\n            } else {\n                throw Error(`${key} is not a valid property`)\n            }\n        }\n    });\n}\n\nconst personValidators = {  \n    name(val) {\n        return typeof val === \x27string\x27;\n    },\n    age(val) {\n        return typeof age === \x27number\x27 \x26amp;\x26amp; age \x3e 18;\n    }\n}\nclass Person {  \n    constructor(name, age) {\n        this.name = name;\n        this.age = age;\n        return createValidator(this, personValidators);\n    }\n}\n\nconst bill = new Person(\x27Bill\x27, 25);\n\n\/\/ 以下操作都会报错\nbill.name = 0;  \nbill.age = \x27Bill\x27;  \nbill.age = 15;  \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateValidator\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etarget, validator\x3c\/span\x3e) \x3c\/span\x3e{  \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eProxy\x3c\/span\x3e(target, {\n        \x3cspan class=\x22hljs-attr\x22\x3e_validator\x3c\/span\x3e: validator,\n        set(target, key, value, proxy) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (target.hasOwnProperty(key)) {\n                \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e validator = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._validator[key];\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!!validator(value)) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.set(target, key, value, proxy);\n                } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e`Cannot set \x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e to \x3cspan class=\x22hljs-subst\x22\x3e${value}\x3c\/span\x3e. Invalid.`\x3c\/span\x3e);\n                }\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e is not a valid property`\x3c\/span\x3e)\n            }\n        }\n    });\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e personValidators = {  \n    name(val) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e val === \x3cspan class=\x22hljs-string\x22\x3e\x27string\x27\x3c\/span\x3e;\n    },\n    age(val) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e age === \x3cspan class=\x22hljs-string\x22\x3e\x27number\x27\x3c\/span\x3e \x26amp;\x26amp; age \x26gt; \x3cspan class=\x22hljs-number\x22\x3e18\x3c\/span\x3e;\n    }\n}\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ePerson\x3c\/span\x3e \x3c\/span\x3e{  \n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(name, age) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name = name;\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.age = age;\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e createValidator(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, personValidators);\n    }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e bill = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Person(\x3cspan class=\x22hljs-string\x22\x3e\x27Bill\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e25\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 以下操作都会报错\x3c\/span\x3e\nbill.name = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;  \nbill.age = \x3cspan class=\x22hljs-string\x22\x3e\x27Bill\x27\x3c\/span\x3e;  \nbill.age = \x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e;  \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过校验器和主逻辑的分离，你可以无限扩展 \x3ccode\x3epersonValidators\x3c\/code\x3e 校验器的内容，而不会对相关的类或函数造成直接破坏。更复杂一点，我们还可以使用 Proxy 模拟类型检查，检查函数是否接收了类型和数量都正确的参数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let obj = {  \n    pickyMethodOne: function(obj, str, num) { \/* ... *\/ },\n    pickyMethodTwo: function(num, obj) { \/*... *\/ }\n};\n\nconst argTypes = {  \n    pickyMethodOne: [\x26quot;object\x26quot;, \x26quot;string\x26quot;, \x26quot;number\x26quot;],\n    pickyMethodTwo: [\x26quot;number\x26quot;, \x26quot;object\x26quot;]\n};\n\nobj = new Proxy(obj, {  \n    get: function(target, key, proxy) {\n        var value = target[key];\n        return function(...args) {\n            var checkArgs = argChecker(key, args, argTypes[key]);\n            return Reflect.apply(value, target, args);\n        };\n    }\n});\n\nfunction argChecker(name, args, checkers) {  \n    for (var idx = 0; idx \x3c args.length; idx\x2b\x2b) {\n        var arg = args[idx];\n        var type = checkers[idx];\n        if (!arg || typeof arg !== type) {\n            console.warn(`You are incorrectly implementing the signature of ${name}. Check param ${idx \x2b 1}`);\n        }\n    }\n}\n\nobj.pickyMethodOne();  \n\/\/ \x3e You are incorrectly implementing the signature of pickyMethodOne. Check param 1\n\/\/ \x3e You are incorrectly implementing the signature of pickyMethodOne. Check param 2\n\/\/ \x3e You are incorrectly implementing the signature of pickyMethodOne. Check param 3\n\nobj.pickyMethodTwo(\x26quot;wopdopadoo\x26quot;, {});  \n\/\/ \x3e You are incorrectly implementing the signature of pickyMethodTwo. Check param 1\n\n\/\/ No warnings logged\nobj.pickyMethodOne({}, \x26quot;a little string\x26quot;, 123);  \nobj.pickyMethodOne(123, {});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e obj = {  \n    \x3cspan class=\x22hljs-attr\x22\x3epickyMethodOne\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj, str, num\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n    \x3cspan class=\x22hljs-attr\x22\x3epickyMethodTwo\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enum, obj\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/*... *\/\x3c\/span\x3e }\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e argTypes = {  \n    \x3cspan class=\x22hljs-attr\x22\x3epickyMethodOne\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22object\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22string\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22number\x22\x3c\/span\x3e],\n    \x3cspan class=\x22hljs-attr\x22\x3epickyMethodTwo\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22number\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22object\x22\x3c\/span\x3e]\n};\n\nobj = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eProxy\x3c\/span\x3e(obj, {  \n    \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etarget, key, proxy\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e value = target[key];\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e...args\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e checkArgs = argChecker(key, args, argTypes[key]);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.apply(value, target, args);\n        };\n    }\n});\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eargChecker\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ename, args, checkers\x3c\/span\x3e) \x3c\/span\x3e{  \n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e idx = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; idx \x26lt; args.length; idx\x2b\x2b) {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e arg = args[idx];\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e type = checkers[idx];\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!arg || \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e arg !== type) {\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.warn(\x3cspan class=\x22hljs-string\x22\x3e`You are incorrectly implementing the signature of \x3cspan class=\x22hljs-subst\x22\x3e${name}\x3c\/span\x3e. Check param \x3cspan class=\x22hljs-subst\x22\x3e${idx \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e}\x3c\/span\x3e`\x3c\/span\x3e);\n        }\n    }\n}\n\nobj.pickyMethodOne();  \n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; You are incorrectly implementing the signature of pickyMethodOne. Check param 1\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; You are incorrectly implementing the signature of pickyMethodOne. Check param 2\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; You are incorrectly implementing the signature of pickyMethodOne. Check param 3\x3c\/span\x3e\n\nobj.pickyMethodTwo(\x3cspan class=\x22hljs-string\x22\x3e\x22wopdopadoo\x22\x3c\/span\x3e, {});  \n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt; You are incorrectly implementing the signature of pickyMethodTwo. Check param 1\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ No warnings logged\x3c\/span\x3e\nobj.pickyMethodOne({}, \x3cspan class=\x22hljs-string\x22\x3e\x22a little string\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e123\x3c\/span\x3e);  \nobj.pickyMethodOne(\x3cspan class=\x22hljs-number\x22\x3e123\x3c\/span\x3e, {});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e2. 私有属性\x3c\/h2\x3e\n\x3cp\x3e在 JavaScript 或其他语言中，大家会约定俗成地在变量名之前添加下划线 \x3ccode\x3e_\x3c\/code\x3e 来表明这是一个私有属性（并不是真正的私有），但我们无法保证真的没人会去访问或修改它。在下面的代码中，我们声明了一个私有的 \x3ccode\x3eapiKey\x3c\/code\x3e，便于 \x3ccode\x3eapi\x3c\/code\x3e 这个对象内部的方法调用，但不希望从外部也能够访问 \x3ccode\x3eapi._apiKey\x3c\/code\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var api = {  \n    _apiKey: \x27123abc456def\x27,\n    \/* mock methods that use this._apiKey *\/\n    getUsers: function(){}, \n    getUser: function(userId){}, \n    setUser: function(userId, config){}\n};\n\n\/\/ logs \x27123abc456def\x27;\nconsole.log(\x26quot;An apiKey we want to keep private\x26quot;, api._apiKey);\n\n\/\/ get and mutate _apiKeys as desired\nvar apiKey = api._apiKey;  \napi._apiKey = \x27987654321\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e api = {  \n    \x3cspan class=\x22hljs-attr\x22\x3e_apiKey\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27123abc456def\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/* mock methods that use this._apiKey *\/\x3c\/span\x3e\n    getUsers: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{}, \n    \x3cspan class=\x22hljs-attr\x22\x3egetUser\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3euserId\x3c\/span\x3e)\x3c\/span\x3e{}, \n    \x3cspan class=\x22hljs-attr\x22\x3esetUser\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3euserId, config\x3c\/span\x3e)\x3c\/span\x3e{}\n};\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ logs \x27123abc456def\x27;\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22An apiKey we want to keep private\x22\x3c\/span\x3e, api._apiKey);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ get and mutate _apiKeys as desired\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e apiKey = api._apiKey;  \napi._apiKey = \x3cspan class=\x22hljs-string\x22\x3e\x27987654321\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e很显然，约定俗成是没有束缚力的。使用 ES6 Proxy 我们就可以实现真实的私有变量了，下面针对不同的读取方式演示两个不同的私有化方法。第一种方法是使用 set \/ get 拦截读写请求并返回 \x3ccode\x3eundefined\x3c\/code\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let api = {  \n    _apiKey: \x27123abc456def\x27,\n    getUsers: function(){ }, \n    getUser: function(userId){ }, \n    setUser: function(userId, config){ }\n};\n\nconst RESTRICTED = [\x27_apiKey\x27];\napi = new Proxy(api, {  \n    get(target, key, proxy) {\n        if(RESTRICTED.indexOf(key) \x3e -1) {\n            throw Error(`${key} is restricted. Please see api documentation for further info.`);\n        }\n        return Reflect.get(target, key, proxy);\n    },\n    set(target, key, value, proxy) {\n        if(RESTRICTED.indexOf(key) \x3e -1) {\n            throw Error(`${key} is restricted. Please see api documentation for further info.`);\n        }\n        return Reflect.get(target, key, value, proxy);\n    }\n});\n\n\/\/ 以下操作都会抛出错误\nconsole.log(api._apiKey);\napi._apiKey = \x27987654321\x27;  \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e api = {  \n    \x3cspan class=\x22hljs-attr\x22\x3e_apiKey\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27123abc456def\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3egetUsers\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{ }, \n    \x3cspan class=\x22hljs-attr\x22\x3egetUser\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3euserId\x3c\/span\x3e)\x3c\/span\x3e{ }, \n    \x3cspan class=\x22hljs-attr\x22\x3esetUser\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3euserId, config\x3c\/span\x3e)\x3c\/span\x3e{ }\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e RESTRICTED = [\x3cspan class=\x22hljs-string\x22\x3e\x27_apiKey\x27\x3c\/span\x3e];\napi = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eProxy\x3c\/span\x3e(api, {  \n    get(target, key, proxy) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(RESTRICTED.indexOf(key) \x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e is restricted. Please see api documentation for further info.`\x3c\/span\x3e);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.get(target, key, proxy);\n    },\n    set(target, key, value, proxy) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(RESTRICTED.indexOf(key) \x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e is restricted. Please see api documentation for further info.`\x3c\/span\x3e);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.get(target, key, value, proxy);\n    }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 以下操作都会抛出错误\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(api._apiKey);\napi._apiKey = \x3cspan class=\x22hljs-string\x22\x3e\x27987654321\x27\x3c\/span\x3e;  \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第二种方法是使用 has 拦截 in 操作：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var api = {  \n    _apiKey: \x27123abc456def\x27,\n    getUsers: function(){ }, \n    getUser: function(userId){ }, \n    setUser: function(userId, config){ }\n};\n\nconst RESTRICTED = [\x27_apiKey\x27];\napi = new Proxy(api, {  \n    has(target, key) {\n        return (RESTRICTED.indexOf(key) \x3e -1) ?\n            false :\n            Reflect.has(target, key);\n    }\n});\n\n\/\/ these log false, and `for in` iterators will ignore _apiKey\nconsole.log(\x26quot;_apiKey\x26quot; in api);\n\nfor (var key in api) {  \n    if (api.hasOwnProperty(key) \x26amp;\x26amp; key === \x26quot;_apiKey\x26quot;) {\n        console.log(\x26quot;This will never be logged because the proxy obscures _apiKey...\x26quot;)\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e api = {  \n    \x3cspan class=\x22hljs-attr\x22\x3e_apiKey\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27123abc456def\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3egetUsers\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{ }, \n    \x3cspan class=\x22hljs-attr\x22\x3egetUser\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3euserId\x3c\/span\x3e)\x3c\/span\x3e{ }, \n    \x3cspan class=\x22hljs-attr\x22\x3esetUser\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3euserId, config\x3c\/span\x3e)\x3c\/span\x3e{ }\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e RESTRICTED = [\x3cspan class=\x22hljs-string\x22\x3e\x27_apiKey\x27\x3c\/span\x3e];\napi = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eProxy\x3c\/span\x3e(api, {  \n    has(target, key) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (RESTRICTED.indexOf(key) \x26gt; \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) ?\n            \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e :\n            \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.has(target, key);\n    }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ these log false, and `for in` iterators will ignore _apiKey\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22_apiKey\x22\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e api);\n\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e key \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e api) {  \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (api.hasOwnProperty(key) \x26amp;\x26amp; key === \x3cspan class=\x22hljs-string\x22\x3e\x22_apiKey\x22\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22This will never be logged because the proxy obscures _apiKey...\x22\x3c\/span\x3e)\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e3. 访问日志\x3c\/h2\x3e\n\x3cp\x3e对于那些调用频繁、运行缓慢或占用执行环境资源较多的属性或接口，开发者会希望记录它们的使用情况或性能表现，这个时候就可以使用 Proxy 充当中间件的角色，轻而易举实现日志功能：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let api = {  \n    _apiKey: \x27123abc456def\x27,\n    getUsers: function() { \/* ... *\/ },\n    getUser: function(userId) { \/* ... *\/ },\n    setUser: function(userId, config) { \/* ... *\/ }\n};\n\nfunction logMethodAsync(timestamp, method) {  \n    setTimeout(function() {\n        console.log(`${timestamp} - Logging ${method} request asynchronously.`);\n    }, 0)\n}\n\napi = new Proxy(api, {  \n    get: function(target, key, proxy) {\n        var value = target[key];\n        return function(...arguments) {\n            logMethodAsync(new Date(), key);\n            return Reflect.apply(value, target, arguments);\n        };\n    }\n});\n\napi.getUsers();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e api = {  \n    \x3cspan class=\x22hljs-attr\x22\x3e_apiKey\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27123abc456def\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3egetUsers\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n    \x3cspan class=\x22hljs-attr\x22\x3egetUser\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3euserId\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e },\n    \x3cspan class=\x22hljs-attr\x22\x3esetUser\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3euserId, config\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/* ... *\/\x3c\/span\x3e }\n};\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3elogMethodAsync\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etimestamp, method\x3c\/span\x3e) \x3c\/span\x3e{  \n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${timestamp}\x3c\/span\x3e - Logging \x3cspan class=\x22hljs-subst\x22\x3e${method}\x3c\/span\x3e request asynchronously.`\x3c\/span\x3e);\n    }, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\n}\n\napi = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eProxy\x3c\/span\x3e(api, {  \n    \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etarget, key, proxy\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e value = target[key];\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e...arguments\x3c\/span\x3e) \x3c\/span\x3e{\n            logMethodAsync(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e(), key);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.apply(value, target, \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e);\n        };\n    }\n});\n\napi.getUsers();\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e4. 预警和拦截\x3c\/h2\x3e\n\x3cp\x3e假设你不想让其他开发者删除 \x3ccode\x3enoDelete\x3c\/code\x3e 属性，还想让调用 \x3ccode\x3eoldMethod\x3c\/code\x3e 的开发者了解到这个方法已经被废弃了，或者告诉开发者不要修改 \x3ccode\x3edoNotChange\x3c\/code\x3e 属性，那么就可以使用 Proxy 来实现：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let dataStore = {  \n    noDelete: 1235,\n    oldMethod: function() {\/*...*\/ },\n    doNotChange: \x26quot;tried and true\x26quot;\n};\n\nconst NODELETE = [\x27noDelete\x27];  \nconst NOCHANGE = [\x27doNotChange\x27];\nconst DEPRECATED = [\x27oldMethod\x27];  \n\ndataStore = new Proxy(dataStore, {  \n    set(target, key, value, proxy) {\n        if (NOCHANGE.includes(key)) {\n            throw Error(`Error! ${key} is immutable.`);\n        }\n        return Reflect.set(target, key, value, proxy);\n    },\n    deleteProperty(target, key) {\n        if (NODELETE.includes(key)) {\n            throw Error(`Error! ${key} cannot be deleted.`);\n        }\n        return Reflect.deleteProperty(target, key);\n\n    },\n    get(target, key, proxy) {\n        if (DEPRECATED.includes(key)) {\n            console.warn(`Warning! ${key} is deprecated.`);\n        }\n        var val = target[key];\n\n        return typeof val === \x27function\x27 ?\n            function(...args) {\n                Reflect.apply(target[key], target, args);\n            } :\n            val;\n    }\n});\n\n\/\/ these will throw errors or log warnings, respectively\ndataStore.doNotChange = \x26quot;foo\x26quot;;  \ndelete dataStore.noDelete;  \ndataStore.oldMethod();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e dataStore = {  \n    \x3cspan class=\x22hljs-attr\x22\x3enoDelete\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1235\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eoldMethod\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e },\n    \x3cspan class=\x22hljs-attr\x22\x3edoNotChange\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22tried and true\x22\x3c\/span\x3e\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e NODELETE = [\x3cspan class=\x22hljs-string\x22\x3e\x27noDelete\x27\x3c\/span\x3e];  \n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e NOCHANGE = [\x3cspan class=\x22hljs-string\x22\x3e\x27doNotChange\x27\x3c\/span\x3e];\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e DEPRECATED = [\x3cspan class=\x22hljs-string\x22\x3e\x27oldMethod\x27\x3c\/span\x3e];  \n\ndataStore = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eProxy\x3c\/span\x3e(dataStore, {  \n    set(target, key, value, proxy) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (NOCHANGE.includes(key)) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e`Error! \x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e is immutable.`\x3c\/span\x3e);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.set(target, key, value, proxy);\n    },\n    deleteProperty(target, key) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (NODELETE.includes(key)) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e`Error! \x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e cannot be deleted.`\x3c\/span\x3e);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.deleteProperty(target, key);\n\n    },\n    get(target, key, proxy) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (DEPRECATED.includes(key)) {\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.warn(\x3cspan class=\x22hljs-string\x22\x3e`Warning! \x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e is deprecated.`\x3c\/span\x3e);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e val = target[key];\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e val === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e ?\n            \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e...args\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.apply(target[key], target, args);\n            } :\n            val;\n    }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ these will throw errors or log warnings, respectively\x3c\/span\x3e\ndataStore.doNotChange = \x3cspan class=\x22hljs-string\x22\x3e\x22foo\x22\x3c\/span\x3e;  \n\x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e dataStore.noDelete;  \ndataStore.oldMethod();\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e5. 过滤操作\x3c\/h2\x3e\n\x3cp\x3e某些操作会非常占用资源，比如传输大文件，这个时候如果文件已经在分块发送了，就不需要在对新的请求作出相应（非绝对），这个时候就可以使用 Proxy 对当请求进行特征检测，并根据特征过滤出哪些是不需要响应的，哪些是需要响应的。下面的代码简单演示了过滤特征的方式，并不是完整代码，相信大家会理解其中的妙处：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let obj = {  \n    getGiantFile: function(fileId) {\/*...*\/ }\n};\n\nobj = new Proxy(obj, {  \n    get(target, key, proxy) {\n        return function(...args) {\n            const id = args[0];\n            let isEnroute = checkEnroute(id);\n            let isDownloading = checkStatus(id);      \n            let cached = getCached(id);\n\n            if (isEnroute || isDownloading) {\n                return false;\n            }\n            if (cached) {\n                return cached;\n            }\n            return Reflect.apply(target[key], target, args);\n        }\n    }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e obj = {  \n    \x3cspan class=\x22hljs-attr\x22\x3egetGiantFile\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efileId\x3c\/span\x3e) \x3c\/span\x3e{\x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e }\n};\n\nobj = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eProxy\x3c\/span\x3e(obj, {  \n    get(target, key, proxy) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e...args\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e id = args[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e isEnroute = checkEnroute(id);\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e isDownloading = checkStatus(id);      \n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e cached = getCached(id);\n\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isEnroute || isDownloading) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n            }\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (cached) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cached;\n            }\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eReflect\x3c\/span\x3e.apply(target[key], target, args);\n        }\n    }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e6. 中断代理\x3c\/h2\x3e\n\x3cp\x3eProxy 支持随时取消对 \x3ccode\x3etarget\x3c\/code\x3e 的代理，这一操作常用于完全封闭对数据或接口的访问。在下面的示例中，我们使用了 \x3ccode\x3eProxy.revocable\x3c\/code\x3e 方法创建了可撤销代理的代理对象：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let sensitiveData = { username: \x27devbryce\x27 };\nconst {sensitiveData, revokeAccess} = Proxy.revocable(sensitiveData, handler);\nfunction handleSuspectedHack(){  \n    revokeAccess();\n}\n\n\/\/ logs \x27devbryce\x27\nconsole.log(sensitiveData.username);\nhandleSuspectedHack();\n\/\/ TypeError: Revoked\nconsole.log(sensitiveData.username);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e sensitiveData = { \x3cspan class=\x22hljs-attr\x22\x3eusername\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27devbryce\x27\x3c\/span\x3e };\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e {sensitiveData, revokeAccess} = \x3cspan class=\x22hljs-built_in\x22\x3eProxy\x3c\/span\x3e.revocable(sensitiveData, handler);\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehandleSuspectedHack\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{  \n    revokeAccess();\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ logs \x27devbryce\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(sensitiveData.username);\nhandleSuspectedHack();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ TypeError: Revoked\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(sensitiveData.username);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3eDecorator\x3c\/h2\x3e\n\x3cp\x3eES7 中实现的 Decorator，相当于设计模式中的装饰器模式。如果简单地区分 Proxy 和 Decorator 的使用场景，可以概括为：Proxy 的核心作用是控制外界对被代理者内部的访问，Decorator 的核心作用是增强被装饰者的功能。只要在它们核心的使用场景上做好区别，那么像是访问日志这样的功能，虽然本文使用了 Proxy 实现，但也可以使用 Decorator 实现，开发者可以根据项目的需求、团队的规范、自己的偏好自由选择。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>[译] 实例解析 ES6 Proxy 使用场景</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006035363">https://segmentfault.com/a/1190000006035363</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/b8towiasbuk/" target="_blank">https://alili.tech/archive/b8towiasbuk/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>