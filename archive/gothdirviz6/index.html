<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Redux 莞式教程 之 简明篇"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Redux 莞式教程 之 简明篇 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/gothdirviz6/",
				"appid": "1613049289050283", 
				"title": "Redux 莞式教程 之 简明篇 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-05T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/fftzu3xv0qk/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/fcbxpy5am0u/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fgothdirviz6%2f&text=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e7%ae%80%e6%98%8e%e7%af%87"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fgothdirviz6%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fgothdirviz6%2f&text=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e7%ae%80%e6%98%8e%e7%af%87"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fgothdirviz6%2f&title=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e7%ae%80%e6%98%8e%e7%af%87"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fgothdirviz6%2f&is_video=false&description=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e7%ae%80%e6%98%8e%e7%af%87"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e7%ae%80%e6%98%8e%e7%af%87&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fgothdirviz6%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fgothdirviz6%2f&title=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e7%ae%80%e6%98%8e%e7%af%87"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgothdirviz6%2f&title=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e7%ae%80%e6%98%8e%e7%af%87"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgothdirviz6%2f&title=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e7%ae%80%e6%98%8e%e7%af%87"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fgothdirviz6%2f&title=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e7%ae%80%e6%98%8e%e7%af%87"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Redux 莞式教程 之 简明篇</h1><div class="meta"><div class="postdate"><time datetime="2019-02-05" itemprop="datePublished">2019-02-05</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3eRedux 简明教程\x3c\/h1\x3e\n\x3cblockquote\x3e\n\x3cp\x3e原文链接（保持更新）：\x3ca href=\x22https:\/\/github.com\/kenberkeley\/redux-simple-tutorial\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3c\/a\x3e\x3ca href=\x22https:\/\/github.com\/kenberkeley\/redux-simple-tutorial\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/kenberkele...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e写在前面\x3c\/h3\x3e\n\x3cp\x3e本教程深入浅出，配套 简明教程、\x3ca href=\x22https:\/\/github.com\/kenberkeley\/redux-simple-tutorial\/blob\/master\/redux-advanced-tutorial.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e进阶教程\x3c\/a\x3e（源码精读）以及文档注释丰满的 \x3ca href=\x22https:\/\/github.com\/kenberkeley\/react-demo\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eDemo\x3c\/a\x3e 等一条龙服务\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e§ 为什么要用 Redux\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e当然还有 \x3ca href=\x22https:\/\/github.com\/facebook\/flux\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eFlux\x3c\/a\x3e、\x3ca href=\x22https:\/\/github.com\/reflux\/refluxjs\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eReflux\x3c\/a\x3e、\x3ca href=\x22https:\/\/github.com\/mobxjs\/mobx\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMobx\x3c\/a\x3e 等状态管理库可供选择\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e抛开需求讲实用性都是耍流氓，因此下面由我扮演您那可亲可爱的产品经理\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e⊙ 需求 1：在控制台上记录用户的每个动作\x3c\/h3\x3e\n\x3cp\x3e不知道您是否有后端的开发经验，后端一般会有记录访问日志的\x3cstrong\x3e中间件\x3c\/strong\x3e  \x3cbr\x3e例如，在 Express 中实现一个简单的 Logger 如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var loggerMiddleware = function(req, res, next) {\n  console.log(\x27[Logger]\x27, req.method, req.originalUrl)\n  next()\n}\n...\napp.use(loggerMiddleware)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e loggerMiddleware = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27[Logger]\x27\x3c\/span\x3e, req.method, req.originalUrl)\n  next()\n}\n...\napp.use(loggerMiddleware)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e每次访问的时候，都会在控制台中留下类似下面的日志便于追踪调试：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22[Logger] GET  \/\n[Logger] POST \/login\n[Logger] GET  \/user?uid=10086\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs prolog\x22\x3e\x3ccode\x3e[\x3cspan class=\x22hljs-symbol\x22\x3eLogger\x3c\/span\x3e] \x3cspan class=\x22hljs-symbol\x22\x3eGET\x3c\/span\x3e  \/\n[\x3cspan class=\x22hljs-symbol\x22\x3eLogger\x3c\/span\x3e] \x3cspan class=\x22hljs-symbol\x22\x3ePOST\x3c\/span\x3e \/login\n[\x3cspan class=\x22hljs-symbol\x22\x3eLogger\x3c\/span\x3e] \x3cspan class=\x22hljs-symbol\x22\x3eGET\x3c\/span\x3e  \/user?uid=\x3cspan class=\x22hljs-number\x22\x3e10086\x3c\/span\x3e\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果我们把场景转移到前端，请问该如何实现用户的动作跟踪记录？  \x3cbr\x3e我们可能会这样写：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** jQuery **\/\n$(\x27#loginBtn\x27).on(\x27click\x27, function(e) {\n  console.log(\x27[Logger] 用户登录\x27)\n  ...\n})\n$(\x27#logoutBtn\x27).on(\x27click\x27, function() {\n  console.log(\x27[Logger] 用户退出登录\x27)\n  ...\n})\n\n\/** MVC \/ MVVM 框架（这里以纯 Vue 举例） **\/\nmethods: {\n  handleLogin () {\n    console.log(\x27[Logger] 用户登录\x27)\n    ...\n  },\n  handleLogout () {\n    console.log(\x27[Logger] 用户退出登录\x27)\n    ...\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** jQuery **\/\x3c\/span\x3e\n$(\x3cspan class=\x22hljs-string\x22\x3e\x27#loginBtn\x27\x3c\/span\x3e).on(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27[Logger] 用户登录\x27\x3c\/span\x3e)\n  ...\n})\n$(\x3cspan class=\x22hljs-string\x22\x3e\x27#logoutBtn\x27\x3c\/span\x3e).on(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27[Logger] 用户退出登录\x27\x3c\/span\x3e)\n  ...\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/** MVC \/ MVVM 框架（这里以纯 Vue 举例） **\/\x3c\/span\x3e\nmethods: {\n  handleLogin () {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27[Logger] 用户登录\x27\x3c\/span\x3e)\n    ...\n  },\n  handleLogout () {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27[Logger] 用户退出登录\x27\x3c\/span\x3e)\n    ...\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上述 jQuery 与 MV* 的写法并没有本质上的区别  \x3cbr\x3e记录用户行为代码的侵入性极强，可维护性与扩展性堪忧\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e⊙ 需求 2：在上述需求的基础上，记录用户的操作时间\x3c\/h3\x3e\n\x3cblockquote\x3e\x3cp\x3e哼！最讨厌就是改需求了，这种简单的需求难道不是应该一开始就想好的吗？  \x3cbr\x3e呵呵，如果每位产品经理都能一开始就把需求完善好，我们就不用加班了好伐\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e显然地，前端的童鞋又得一个一个去改（当然 编辑器 \/ IDE 都支持全局替换）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** jQuery **\/\n$(\x27#loginBtn\x27).on(\x27click\x27, function(e) {\n  console.log(\x27[Logger] 用户登录\x27, new Date())\n  ...\n})\n$(\x27#logoutBtn\x27).on(\x27click\x27, function() {\n  console.log(\x27[Logger] 用户退出登录\x27, new Date())\n  ...\n})\n\n\/** MVC \/ MVVM 框架（这里以 Vue 举例） **\/\nmethods: {\n  handleLogin () {\n    console.log(\x27[Logger] 用户登录\x27, new Date())\n    ...\n  },\n  handleLogout () {\n    console.log(\x27[Logger] 用户退出登录\x27, new Date())\n    ...\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** jQuery **\/\x3c\/span\x3e\n$(\x3cspan class=\x22hljs-string\x22\x3e\x27#loginBtn\x27\x3c\/span\x3e).on(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27[Logger] 用户登录\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e())\n  ...\n})\n$(\x3cspan class=\x22hljs-string\x22\x3e\x27#logoutBtn\x27\x3c\/span\x3e).on(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27[Logger] 用户退出登录\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e())\n  ...\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/** MVC \/ MVVM 框架（这里以 Vue 举例） **\/\x3c\/span\x3e\nmethods: {\n  handleLogin () {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27[Logger] 用户登录\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e())\n    ...\n  },\n  handleLogout () {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27[Logger] 用户退出登录\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e())\n    ...\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而后端的童鞋只需要稍微修改一下原来的中间件即可：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var loggerMiddleware = function(req, res, next) {\n  console.log(\x27[Logger]\x27, new Date(), req.method, req.originalUrl)\n  next()\n}\n...\napp.use(loggerMiddleware)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e loggerMiddleware = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27[Logger]\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e(), req.method, req.originalUrl)\n  next()\n}\n...\napp.use(loggerMiddleware)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e⊙ 需求 3：正式上线的时候，把控制台中有关 Logger 的输出全部去掉\x3c\/h3\x3e\n\x3cp\x3e难道您以为有了 UglifyJS，配置一个 \x3ccode\x3edrop_console: true\x3c\/code\x3e 就好了吗？图样图森破，拿衣服！  \x3cbr\x3e请看清楚了，仅仅是去掉有关 Logger 的 \x3ccode\x3econsole.log\x3c\/code\x3e，其他的要保留哦亲~~~  \x3cbr\x3e于是前端的童鞋又不得不乖乖地一个一个注释掉（当然也可以设置一个环境变量判断是否输出，甚至可以重写 \x3ccode\x3econsole.log\x3c\/code\x3e）\x3c\/p\x3e\n\x3cp\x3e而我们后端的童鞋呢？只需要注释掉一行代码即可：\x3ccode\x3e\/\/ app.use(loggerMiddleware)\x3c\/code\x3e，真可谓是不费吹灰之力\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e⊙ 需求 4：正式上线后，自动收集 bug，并还原出当时的场景\x3c\/h3\x3e\n\x3cp\x3e收集用户报错还是比较简单的，\x3ca href=\x22http:\/\/stackoverflow.com\/questions\/5328154\/#5328206\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e利用 \x3ccode\x3ewindow.error\x3c\/code\x3e 事件\x3c\/a\x3e，然后根据 Source Map 定位到源码（但一般查不出什么）\x3c\/p\x3e\n\x3cp\x3e但要完全还原出当时的使用场景，几乎是不可能的。因为您不知道这个报错，用户是怎么一步一步操作得来的  \x3cbr\x3e就算知道用户是如何操作得来的，但在您的电脑上，测试永远都是通过的（不是我写的程序有问题，是用户用的方式有问题）\x3c\/p\x3e\n\x3cp\x3e相对地，后端的报错的收集、定位以及还原却是相当简单。只要一个 API 有 bug，那无论用什么设备访问，都会得到这个 bug  \x3cbr\x3e还原 bug 也是相当简单：把数据库备份导入到另一台机器，部署同样的运行环境与代码。如无意外，bug 肯定可以完美重现\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e在这个问题上拿后端跟前端对比，确实有失公允。但为了鼓吹 Redux 的优越，只能勉为其难了  \x3c\/p\x3e\n\x3cp\x3e实际上 jQuery \/ MV* 中也能实现用户动作的跟踪，用一个数组往里面 \x3ccode\x3epush\x3c\/code\x3e 用户动作即可  \x3cbr\x3e但这样操作的意义不大，因为仅仅只有动作，无法反映动作前后，应用状态的变动情况\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e※ 小结\x3c\/h3\x3e\n\x3cp\x3e为何前后端对于这类需求的处理竟然大相径庭？后端为何可以如此优雅？  \x3cbr\x3e原因在于，后端具有\x3cstrong\x3e统一的入口\x3c\/strong\x3e与\x3cstrong\x3e统一的状态管理（数据库）\x3c\/strong\x3e，因此可以引入\x3cstrong\x3e中间件机制\x3c\/strong\x3e来\x3cstrong\x3e统一\x3c\/strong\x3e实现某些功能  \x3c\/p\x3e\n\x3cp\x3e多年来，前端工程师忍辱负重，操着卖白粉的心，赚着买白菜的钱，一直处于程序员鄙视链的底层  \x3cbr\x3e于是有大牛就把后端 MVC 的开发思维搬到前端，\x3cstrong\x3e将应用中所有的动作与状态都统一管理\x3c\/strong\x3e，让一切\x3cstrong\x3e有据可循\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e使用 Redux，借助 \x3ca href=\x22https:\/\/github.com\/gaearon\/redux-devtools\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eRedux DevTools\x3c\/a\x3e 可以实现出“华丽如时光旅行一般的调试效果”  \x3cbr\x3e实际上就是开发调试过程中可以\x3cstrong\x3e撤销与重做\x3c\/strong\x3e，并且支持应用状态的导入和导出（就像是数据库的备份）  \x3cbr\x3e而且，由于可以使用日志完整记录下每个动作，因此做到像 Git 般，随时随地恢复到之前的状态\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e由于可以导出和导入应用的状态（包括路由状态），因此还可以实现前后端同构（服务端渲染）  \x3cbr\x3e当然，既然有了动作日志以及动作前后的状态备份，那么还原用户报错场景还会是一个难题吗？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e§ Store\x3c\/h2\x3e\n\x3cp\x3e首先要区分 \x3ccode\x3estore\x3c\/code\x3e 和 \x3ccode\x3estate\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3estate\x3c\/code\x3e 是应用的状态，一般本质上是一个普通\x3cstrong\x3e对象\x3c\/strong\x3e  \x3cbr\x3e例如，我们有一个 Web APP，包含 计数器 和 待办事项 两大功能  \x3cbr\x3e那么我们可以为该应用设计出对应的存储数据结构（应用初始状态）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 应用初始 state，本代码块记为 code-1 **\/\n{\n  counter: 0,\n  todos: []\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 应用初始 state，本代码块记为 code-1 **\/\x3c\/span\x3e\n{\n  \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etodos\x3c\/span\x3e: []\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3estore\x3c\/code\x3e 是应用状态 \x3ccode\x3estate\x3c\/code\x3e 的管理者，包含下列四个函数：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3egetState()                  # 获取整个 state\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3edispatch(action)            # ※ 触发 state 改变的【唯一途径】※\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3esubscribe(listener)         # 您可以理解成是 DOM 中的 addEventListener\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ereplaceReducer(nextReducer) # 一般在 Webpack Code-Splitting 按需加载的时候用\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e二者的关系是：\x3ccode\x3estate = store.getState()\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3eRedux 规定，一个应用只应有一个单一的 \x3ccode\x3estore\x3c\/code\x3e，其管理着唯一的应用状态 \x3ccode\x3estate\x3c\/code\x3e  \x3cbr\x3eRedux 还规定，不能直接修改应用的状态 \x3ccode\x3estate\x3c\/code\x3e，也就是说，下面的行为是不允许的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var state = store.getState()\nstate.counter = state.counter \x2b 1 \/\/ 禁止在业务逻辑中直接修改 state\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e state = store.getState()\nstate.counter = state.counter \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 禁止在业务逻辑中直接修改 state\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e若要改变 \x3ccode\x3estate\x3c\/code\x3e，必须 \x3ccode\x3edispatch\x3c\/code\x3e 一个 \x3ccode\x3eaction\x3c\/code\x3e，这是修改应用状态的不二法门\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e现在您只需要记住 \x3ccode\x3eaction\x3c\/code\x3e 只是一个包含 \x3cstrong\x3e\x3ccode\x3etype\x3c\/code\x3e\x3c\/strong\x3e 属性的普通\x3cstrong\x3e对象\x3c\/strong\x3e即可  \x3cbr\x3e例如 \x3ccode\x3e{ type: \x27INCREMENT\x27 }\x3c\/code\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e上面提到，\x3ccode\x3estate\x3c\/code\x3e 是通过 \x3ccode\x3estore.getState()\x3c\/code\x3e 获取，那么 \x3ccode\x3estore\x3c\/code\x3e 又是怎么来的呢？  \x3cbr\x3e想生成一个 \x3ccode\x3estore\x3c\/code\x3e，我们需要调用 Redux 的 \x3ccode\x3ecreateStore\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { createStore } from \x27redux\x27\n...\nconst store = createStore(reducer, initialState) \/\/ store 是靠传入 reducer 生成的哦！\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { createStore } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e\n...\nconst store = createStore(reducer, initialState) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ store 是靠传入 reducer 生成的哦！\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e现在您只需要记住 \x3ccode\x3ereducer\x3c\/code\x3e 是一个 \x3cstrong\x3e函数\x3c\/strong\x3e，负责\x3cstrong\x3e更新\x3c\/strong\x3e并返回一个\x3cstrong\x3e新的\x3c\/strong\x3e \x3ccode\x3estate\x3c\/code\x3e  \x3cbr\x3e而 \x3ccode\x3einitialState\x3c\/code\x3e 主要用于前后端同构的数据同步（详情请关注 React 服务端渲染）\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e§ Action\x3c\/h2\x3e\n\x3cp\x3e上面提到，\x3ccode\x3eaction\x3c\/code\x3e（动作）实质上是包含 \x3ccode\x3etype\x3c\/code\x3e 属性的普通对象，这个 \x3ccode\x3etype\x3c\/code\x3e 是我们实现用户行为追踪的关键  \x3cbr\x3e例如，增加一个待办事项 的 \x3ccode\x3eaction\x3c\/code\x3e 可能是像下面一样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 本代码块记为 code-2 **\/\n{\n  type: \x27ADD_TODO\x27,\n  payload: {\n    id: 1,\n    content: \x27待办事项1\x27,\n    completed: false\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 本代码块记为 code-2 **\/\x3c\/span\x3e\n{\n  \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27ADD_TODO\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27待办事项1\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecompleted\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当然，\x3ccode\x3eaction\x3c\/code\x3e 的形式是多种多样的，唯一的约束仅仅就是包含一个 \x3ccode\x3etype\x3c\/code\x3e 属性罢了  \x3cbr\x3e也就是说，下面这些 \x3ccode\x3eaction\x3c\/code\x3e 都是合法的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 如下都是合法的，但就是不够规范 **\/\n{\n  type: \x27ADD_TODO\x27,\n  id: 1,\n  content: \x27待办事项1\x27,\n  completed: false\n}\n\n{\n  type: \x27ADD_TODO\x27,\n  abcdefg: {\n    id: 1,\n    content: \x27待办事项1\x27,\n    completed: false\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 如下都是合法的，但就是不够规范 **\/\x3c\/span\x3e\n{\n  \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27ADD_TODO\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27待办事项1\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3ecompleted\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n}\n\n{\n  \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27ADD_TODO\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eabcdefg\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27待办事项1\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecompleted\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e虽说没有约束，但最好还是遵循\x3ca href=\x22https:\/\/github.com\/acdlite\/flux-standard-action\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e规范\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e如果需要新增一个代办事项，实际上就是将 \x3ccode\x3ecode-2\x3c\/code\x3e 中的 \x3ccode\x3epayload\x3c\/code\x3e \x3cstrong\x3e“写入”\x3c\/strong\x3e 到 \x3ccode\x3estate.todos\x3c\/code\x3e 数组中（如何“写入”？在此留个悬念）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 本代码块记为 code-3 **\/\n{\n  counter: 0,\n  todos: [{\n    id: 1,\n    content: \x27待办事项1\x27,\n    completed: false\n  }]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 本代码块记为 code-3 **\/\x3c\/span\x3e\n{\n  \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etodos\x3c\/span\x3e: [{\n    \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27待办事项1\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecompleted\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  }]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e刨根问底，\x3ccode\x3eaction\x3c\/code\x3e 是谁生成的呢？\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e⊙ Action Creator\x3c\/h3\x3e\n\x3cblockquote\x3e\x3cp\x3eAction Creator 可以是同步的，也可以是异步的\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e顾名思义，Action Creator 是 \x3ccode\x3eaction\x3c\/code\x3e 的创造者，本质上就是一个\x3cstrong\x3e函数\x3c\/strong\x3e，返回值是一个 \x3ccode\x3eaction\x3c\/code\x3e（\x3cstrong\x3e对象\x3c\/strong\x3e）  \x3cbr\x3e例如下面就是一个 “新增一个待办事项” 的 Action Creator：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 本代码块记为 code-4 **\/\nvar id = 1\nfunction addTodo(content) {\n  return {\n    type: \x27ADD_TODO\x27,\n    payload: {\n      id: id\x2b\x2b,\n      content: content, \/\/ 待办事项内容\n      completed: false  \/\/ 是否完成的标识\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 本代码块记为 code-4 **\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e id = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eaddTodo\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3econtent\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27ADD_TODO\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: id\x2b\x2b,\n      \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e: content, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 待办事项内容\x3c\/span\x3e\n      completed: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 是否完成的标识\x3c\/span\x3e\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e将该函数应用到一个表单（假设 \x3ccode\x3estore\x3c\/code\x3e 为全局变量，并引入了 jQuery ）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c--! 本代码块记为 code-5 --\x3e\n\x3cinput type=\x26quot;text\x26quot; id=\x26quot;todoInput\x26quot; \/\x3e\n\x3cbutton id=\x26quot;btn\x26quot;\x3e提交\x3c\/button\x3e\n\n\x3cscript\x3e\n$(\x27#btn\x27).on(\x27click\x27, function() {\n  var content = $(\x27#todoInput\x27).val() \/\/ 获取输入框的值\n  var action = addTodo(content) \/\/ 执行 Action Creator 获得 action\n  store.dispatch(action) \/\/ 改变 state 的不二法门：dispatch 一个 action！！！\n})\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e--!\x3c\/span\x3e 本代码块记为 \x3cspan class=\x22hljs-attr\x22\x3ecode-5\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e--\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22todoInput\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22btn\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e提交\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n$(\x3cspan class=\x22hljs-string\x22\x3e\x27#btn\x27\x3c\/span\x3e).on(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e content = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#todoInput\x27\x3c\/span\x3e).val() \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取输入框的值\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e action = addTodo(content) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 执行 Action Creator 获得 action\x3c\/span\x3e\n  store.dispatch(action) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 改变 state 的不二法门：dispatch 一个 action！！！\x3c\/span\x3e\n})\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在输入框中输入 “待办事项2” 后，点击一下提交按钮，我们的 \x3ccode\x3estate\x3c\/code\x3e 就变成了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 本代码块记为 code-6 **\/\n{\n  counter: 0,\n  todos: [{\n    id: 1,\n    content: \x27待办事项1\x27,\n    completed: false\n  }, {\n    id: 2,\n    content: \x27待办事项2\x27,\n    completed: false\n  }]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 本代码块记为 code-6 **\/\x3c\/span\x3e\n{\n  \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etodos\x3c\/span\x3e: [{\n    \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27待办事项1\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecompleted\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  }, {\n    \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3econtent\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27待办事项2\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ecompleted\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  }]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e通俗点讲，Action Creator 用于绑定到用户的操作（点击按钮等），其返回值 \x3ccode\x3eaction\x3c\/code\x3e 用于之后的 \x3ccode\x3edispatch(action)\x3c\/code\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e刚刚提到过，\x3ccode\x3eaction\x3c\/code\x3e 明明就没有强制的规范，为什么 \x3ccode\x3estore.dispatch(action)\x3c\/code\x3e 之后，  \x3cbr\x3eRedux 会明确知道是提取 \x3ccode\x3eaction.payload\x3c\/code\x3e，并且是对应写入到 \x3ccode\x3estate.todos\x3c\/code\x3e 数组中？  \x3cbr\x3e又是谁负责“写入”的呢？悬念即将揭晓...\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e§ Reducer\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3eReducer 必须是同步的纯函数\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e用户每次 \x3ccode\x3edispatch(action)\x3c\/code\x3e 后，都会触发 \x3ccode\x3ereducer\x3c\/code\x3e  的执行  \x3cbr\x3e\x3ccode\x3ereducer\x3c\/code\x3e 的实质是一个\x3cstrong\x3e函数\x3c\/strong\x3e，根据 \x3ccode\x3eaction.type\x3c\/code\x3e 来\x3cstrong\x3e更新\x3c\/strong\x3e \x3ccode\x3estate\x3c\/code\x3e 并返回 \x3ccode\x3enextState\x3c\/code\x3e  \x3cbr\x3e最后会用 \x3ccode\x3ereducer\x3c\/code\x3e 的返回值 \x3ccode\x3enextState\x3c\/code\x3e \x3cstrong\x3e完全替换掉\x3c\/strong\x3e原来的 \x3ccode\x3estate\x3c\/code\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e注意：上面的这个 “更新” 并不是指 \x3ccode\x3ereducer\x3c\/code\x3e 可以直接对 \x3ccode\x3estate\x3c\/code\x3e 进行修改  \x3cbr\x3eRedux 规定，须先复制一份 \x3ccode\x3estate\x3c\/code\x3e，在副本 \x3ccode\x3enextState\x3c\/code\x3e 上进行修改操作  \x3cbr\x3e例如，可以使用 lodash 的 \x3ccode\x3edeepClone\x3c\/code\x3e，也可以使用 \x3ccode\x3eObject.assign \/ map \/ filter\/ ...\x3c\/code\x3e 等返回副本的函数\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e在上面 Action Creator 中提到的 待办事项的 \x3ccode\x3ereducer\x3c\/code\x3e 大概是长这个样子 (为了容易理解，在此不使用 ES6 \/ \x3ca href=\x22https:\/\/github.com\/facebook\/immutable-js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eImmutable.js\x3c\/a\x3e)：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 本代码块记为 code-7 **\/\nvar initState = {\n  counter: 0,\n  todos: []\n}\n\nfunction reducer(state, action) {\n  \/\/ ※ 应用的初始状态是在第一次执行 reducer 时设置的（除非是服务端渲染） ※\n  if (!state) state = initState\n  \n  switch (action.type) {\n    case \x27ADD_TODO\x27:\n      var nextState = _.deepClone(state) \/\/ 用到了 lodash 的深克隆\n      nextState.todos.push(action.payload) \n      return nextState\n\n    default:\n    \/\/ 由于 nextState 会把原 state 整个替换掉\n    \/\/ 若无修改，必须返回原 state（否则就是 undefined）\n      return state\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 本代码块记为 code-7 **\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e initState = {\n  \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etodos\x3c\/span\x3e: []\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estate, action\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ※ 应用的初始状态是在第一次执行 reducer 时设置的（除非是服务端渲染） ※\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!state) state = initState\n  \n  \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27ADD_TODO\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e nextState = _.deepClone(state) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用到了 lodash 的深克隆\x3c\/span\x3e\n      nextState.todos.push(action.payload) \n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e nextState\n\n    \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 由于 nextState 会把原 state 整个替换掉\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 若无修改，必须返回原 state（否则就是 undefined）\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e state\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e通俗点讲，就是 \x3ccode\x3ereducer\x3c\/code\x3e 返回啥，\x3ccode\x3estate\x3c\/code\x3e 就被替换成啥\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e§ 总结\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3estore\x3c\/code\x3e 由 Redux 的 \x3ccode\x3ecreateStore(reducer)\x3c\/code\x3e 生成\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3estate\x3c\/code\x3e 通过 \x3ccode\x3estore.getState()\x3c\/code\x3e 获取，本质上一般是一个存储着整个应用状态的\x3cstrong\x3e对象\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eaction\x3c\/code\x3e 本质上是一个包含 \x3ccode\x3etype\x3c\/code\x3e 属性的普通\x3cstrong\x3e对象\x3c\/strong\x3e，由 Action Creator (\x3cstrong\x3e函数\x3c\/strong\x3e) 产生\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e改变 \x3ccode\x3estate\x3c\/code\x3e 必须 \x3ccode\x3edispatch\x3c\/code\x3e 一个 \x3ccode\x3eaction\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ereducer\x3c\/code\x3e 本质上是根据 \x3ccode\x3eaction.type\x3c\/code\x3e 来更新 \x3ccode\x3estate\x3c\/code\x3e 并返回 \x3ccode\x3enextState\x3c\/code\x3e 的\x3cstrong\x3e函数\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ereducer\x3c\/code\x3e 必须返回值，否则 \x3ccode\x3enextState\x3c\/code\x3e 即为 \x3ccode\x3eundefined\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e实际上，\x3cstrong\x3e\x3ccode\x3estate\x3c\/code\x3e 就是所有 \x3ccode\x3ereducer\x3c\/code\x3e 返回值的汇总\x3c\/strong\x3e（本教程只有一个 \x3ccode\x3ereducer\x3c\/code\x3e，主要是应用场景比较简单）\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cblockquote\x3e\x3cp\x3eAction Creator =\x26gt; \x3ccode\x3eaction\x3c\/code\x3e =\x26gt; \x3ccode\x3estore.dispatch(action)\x3c\/code\x3e =\x26gt; \x3ccode\x3ereducer(state, action)\x3c\/code\x3e =\x26gt; \x3cdel\x3e\x3ccode\x3e原 state\x3c\/code\x3e\x3c\/del\x3e \x3ccode\x3estate = nextState\x3c\/code\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e⊙ Redux 与传统后端 MVC 的对照\x3c\/h3\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3eRedux\x3c\/th\x3e\n\x3cth\x3e传统后端 MVC\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3estore\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e数据库实例\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3estate\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e数据库中存储的数据\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3edispatch(action)\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e用户发起请求\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3eaction: { type, payload }\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e\n\x3ccode\x3etype\x3c\/code\x3e 表示请求的 URL，\x3ccode\x3epayload\x3c\/code\x3e 表示请求的数据\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3ereducer\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e路由 \x2b 控制器（handler）\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\n\x3ccode\x3ereducer\x3c\/code\x3e 中的 \x3ccode\x3eswitch-case\x3c\/code\x3e 分支\x3c\/td\x3e\n\x3ctd\x3e路由，根据 \x3ccode\x3eaction.type\x3c\/code\x3e 路由到对应的控制器\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\n\x3ccode\x3ereducer\x3c\/code\x3e 内部对 \x3ccode\x3estate\x3c\/code\x3e 的处理\x3c\/td\x3e\n\x3ctd\x3e控制器对数据库进行增删改操作\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\n\x3ccode\x3ereducer\x3c\/code\x3e 返回 \x3ccode\x3enextState\x3c\/code\x3e\n\x3c\/td\x3e\n\x3ctd\x3e将修改后的记录写回数据库\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3ch2 id=\x22articleHeader14\x22\x3e§ 最简单的例子 ( \x3ca href=\x22http:\/\/jsbin.com\/zivare\/edit?html,console\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e在线演示\x3c\/a\x3e )\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n\x3chead\x3e\n  \x3cscript src=\x26quot;\/\/cdn.bootcss.com\/redux\/3.5.2\/redux.min.js\x26quot;\x3e\x3c\/script\x3e\n\x3c\/head\x3e\n\x3cbody\x3e\n\x3cscript\x3e\n\/** Action Creators *\/\nfunction inc() {\n  return { type: \x27INCREMENT\x27 };\n}\nfunction dec() {\n  return { type: \x27DECREMENT\x27 };\n}\n\nfunction reducer(state, action) {\n  \/\/ 首次调用本函数时设置初始 state\n  state = state || { counter: 0 };\n\n  switch (action.type) {\n    case \x27INCREMENT\x27:\n      return { counter: state.counter \x2b 1 };\n    case \x27DECREMENT\x27:\n      return { counter: state.counter - 1 };\n    default:\n      return state; \/\/ 无论如何都返回一个 state\n  }\n}\n\nvar store = Redux.createStore(reducer);\n\nconsole.log( store.getState() ); \/\/ { counter: 0 }\n\nstore.dispatch(inc());\nconsole.log( store.getState() ); \/\/ { counter: 1 }\n\nstore.dispatch(inc());\nconsole.log( store.getState() ); \/\/ { counter: 2 }\n\nstore.dispatch(dec());\nconsole.log( store.getState() ); \/\/ { counter: 1 }\n\x3c\/script\x3e\n\x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/\/cdn.bootcss.com\/redux\/3.5.2\/redux.min.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/** Action Creators *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einc\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27INCREMENT\x27\x3c\/span\x3e };\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edec\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27DECREMENT\x27\x3c\/span\x3e };\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estate, action\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 首次调用本函数时设置初始 state\x3c\/span\x3e\n  state = state || { \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e };\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27INCREMENT\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: state.counter \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e };\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27DECREMENT\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: state.counter - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e };\n    \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e state; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 无论如何都返回一个 state\x3c\/span\x3e\n  }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e store = Redux.createStore(reducer);\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log( store.getState() ); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { counter: 0 }\x3c\/span\x3e\n\nstore.dispatch(inc());\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log( store.getState() ); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { counter: 1 }\x3c\/span\x3e\n\nstore.dispatch(inc());\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log( store.getState() ); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { counter: 2 }\x3c\/span\x3e\n\nstore.dispatch(dec());\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log( store.getState() ); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ { counter: 1 }\x3c\/span\x3e\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e由上可知，Redux 并不一定要搭配 React 使用。Redux 纯粹只是一个状态管理库，几乎可以搭配任何框架使用  \x3cbr\x3e（上述例子连 jQuery 都没用哦亲）\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader15\x22\x3e\x3ca href=\x22https:\/\/github.com\/kenberkeley\/redux-simple-tutorial\/blob\/master\/redux-advanced-tutorial.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e§ 下一章：Redux 进阶教程\x3c\/a\x3e\x3c\/h2\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Redux 莞式教程 之 简明篇</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006701765">https://segmentfault.com/a/1190000006701765</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/gothdirviz6/" target="_blank">https://alili.tech/archive/gothdirviz6/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>