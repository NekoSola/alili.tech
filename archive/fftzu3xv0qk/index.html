<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Redux 莞式教程 之 进阶篇"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Redux 莞式教程 之 进阶篇 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/fftzu3xv0qk/",
				"appid": "1613049289050283", 
				"title": "Redux 莞式教程 之 进阶篇 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-05T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/9b97vklvudf/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/gothdirviz6/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ffftzu3xv0qk%2f&text=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e8%bf%9b%e9%98%b6%e7%af%87"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ffftzu3xv0qk%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ffftzu3xv0qk%2f&text=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e8%bf%9b%e9%98%b6%e7%af%87"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ffftzu3xv0qk%2f&title=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e8%bf%9b%e9%98%b6%e7%af%87"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ffftzu3xv0qk%2f&is_video=false&description=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e8%bf%9b%e9%98%b6%e7%af%87"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e8%bf%9b%e9%98%b6%e7%af%87&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ffftzu3xv0qk%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ffftzu3xv0qk%2f&title=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e8%bf%9b%e9%98%b6%e7%af%87"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffftzu3xv0qk%2f&title=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e8%bf%9b%e9%98%b6%e7%af%87"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffftzu3xv0qk%2f&title=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e8%bf%9b%e9%98%b6%e7%af%87"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffftzu3xv0qk%2f&title=Redux%20%e8%8e%9e%e5%bc%8f%e6%95%99%e7%a8%8b%20%e4%b9%8b%20%e8%bf%9b%e9%98%b6%e7%af%87"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Redux 莞式教程 之 进阶篇</h1><div class="meta"><div class="postdate"><time datetime="2019-02-05" itemprop="datePublished">2019-02-05</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3eRedux 进阶教程\x3c\/h1\x3e\n\x3cblockquote\x3e\n\x3cp\x3e原文（保持更新）：\x3ca href=\x22https:\/\/github.com\/kenberkeley\/redux-simple-tutorial\/blob\/master\/redux-advanced-tutorial.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3c\/a\x3e\x3ca href=\x22https:\/\/github.com\/kenberkeley\/redux-simple-tutorial\/blob\/master\/redux-advanced-tutorial.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/kenberkele...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e写在前面\x3c\/h3\x3e\n\x3cp\x3e相信您已经看过 \x3ca href=\x22https:\/\/github.com\/kenberkeley\/redux-simple-tutorial\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eRedux 简明教程\x3c\/a\x3e，本教程是简明教程的实战化版本，伴随源码分析  \x3cbr\x3eRedux 用的是 ES6 编写，看到有疑惑的地方的，可以复制粘贴到\x3ca href=\x22http:\/\/babeljs.io\/repl\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e这里\x3c\/a\x3e在线编译 ES5\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e§ Redux API 总览\x3c\/h2\x3e\n\x3cp\x3e在 Redux 的\x3ca href=\x22https:\/\/github.com\/reactjs\/redux\/tree\/master\/src\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e源码目录\x3c\/a\x3e \x3ccode\x3esrc\/\x3c\/code\x3e，我们可以看到如下文件结构：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22├── utils\/\n│     ├── warning.js # 打酱油的，负责在控制台显示警告信息\n├── applyMiddleware.js\n├── bindActionCreators.js\n├── combineReducers.js\n├── compose.js\n├── createStore.js\n├── index.js # 入口文件\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs axapta\x22\x3e\x3ccode\x3e├── utils\/\n│     ├── warning.js \x3cspan class=\x22hljs-meta\x22\x3e# 打酱油的，负责在控制台显示警告信息\x3c\/span\x3e\n├── applyMiddleware.js\n├── bindActionCreators.js\n├── combineReducers.js\n├── compose.js\n├── createStore.js\n├── \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e.js \x3cspan class=\x22hljs-meta\x22\x3e# 入口文件\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e除去打酱油的 \x3ccode\x3eutils\/warning.js\x3c\/code\x3e 以及入口文件 \x3ccode\x3eindex.js\x3c\/code\x3e，剩下那 5 个就是 Redux 的 API\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e§ \x3ca href=\x22http:\/\/cn.redux.js.org\/docs\/api\/compose.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecompose(...functions)\x3c\/a\x3e\n\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e先说这个 API 的原因是它没有依赖，是一个纯函数\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e⊙ 源码分析\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 看起来逼格很高，实际运用其实是这样子的：\n * compose(f, g, h)(...arg) =\x3e f(g(h(...args)))\n *\n * 值得注意的是，它用到了 reduceRight，因此执行顺序是从右到左\n *\n * @param  {多个函数，用逗号隔开}\n * @return {函数}\n *\/\n\nexport default function compose(...funcs) {\n  if (funcs.length === 0) {\n    return arg =\x3e arg\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0]\n  }\n\n  const last = funcs[funcs.length - 1]\n  const rest = funcs.slice(0, -1)\n  return (...args) =\x3e rest.reduceRight((composed, f) =\x3e f(composed), last(...args))\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 看起来逼格很高，实际运用其实是这样子的：\n * compose(f, g, h)(...arg) =\x26gt; f(g(h(...args)))\n *\n * 值得注意的是，它用到了 reduceRight，因此执行顺序是从右到左\n *\n * @param  {多个函数，用逗号隔开}\n * @return {函数}\n *\/\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecompose\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e...funcs\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (funcs.length === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3earg\x3c\/span\x3e =\x26gt;\x3c\/span\x3e arg\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (funcs.length === \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e funcs[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e last = funcs[funcs.length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e rest = funcs.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e...args\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e rest.reduceRight(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ecomposed, f\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e f(composed), last(...args))\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里的关键点在于，\x3ccode\x3ereduceRight\x3c\/code\x3e 可传入初始值：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 由于 reduce \/ reduceRight 仅仅是方向的不同，因此下面用 reduce 说明即可\nvar arr = [1, 2, 3, 4, 5]\n\nvar re1 = arr.reduce(function(total, i) {\n  return total \x2b i\n})\nconsole.log(re1) \/\/ 15\n\nvar re2 = arr.reduce(function(total, i) {\n  return total \x2b i\n}, 100) \/\/ \x3c---------------传入一个初始值\nconsole.log(re2) \/\/ 115\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 由于 reduce \/ reduceRight 仅仅是方向的不同，因此下面用 reduce 说明即可\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e arr = [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e]\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e re1 = arr.reduce(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etotal, i\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e total \x2b i\n})\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(re1) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 15\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e re2 = arr.reduce(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etotal, i\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e total \x2b i\n}, \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt;---------------传入一个初始值\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(re2) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 115\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e下面是 \x3ccode\x3ecompose\x3c\/code\x3e 的实例（\x3ca href=\x22http:\/\/jsbin.com\/gavomes\/edit?html,console\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e在线演示\x3c\/a\x3e）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n\x3chead\x3e\n  \x3cscript src=\x26quot;\/\/cdn.bootcss.com\/redux\/3.5.2\/redux.min.js\x26quot;\x3e\x3c\/script\x3e\n\x3c\/head\x3e\n\x3cbody\x3e\n\x3cscript\x3e\nfunction func1(num) {\n  console.log(\x27func1 获得参数 \x27 \x2b num);\n  return num \x2b 1;\n}\n\nfunction func2(num) {\n  console.log(\x27func2 获得参数 \x27 \x2b num);\n  return num \x2b 2;\n}\n  \nfunction func3(num) {\n  console.log(\x27func3 获得参数 \x27 \x2b num);\n  return num \x2b 3;\n}\n\n\/\/ 有点难看（如果函数名再长一点，那屏幕就不够宽了）\nvar re1 = func3(func2(func1(0)));\nconsole.log(\x27re1：\x27 \x2b re1);\n\nconsole.log(\x27===============\x27);\n\n\/\/ 很优雅\nvar re2 = Redux.compose(func3, func2, func1)(0);\nconsole.log(\x27re2：\x27 \x2b re2);\n\x3c\/script\x3e\n\x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/\/cdn.bootcss.com\/redux\/3.5.2\/redux.min.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efunc1\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enum\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27func1 获得参数 \x27\x3c\/span\x3e \x2b num);\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efunc2\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enum\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27func2 获得参数 \x27\x3c\/span\x3e \x2b num);\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num \x2b \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n}\n  \n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efunc3\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enum\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27func3 获得参数 \x27\x3c\/span\x3e \x2b num);\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num \x2b \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 有点难看（如果函数名再长一点，那屏幕就不够宽了）\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e re1 = func3(func2(func1(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)));\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27re1：\x27\x3c\/span\x3e \x2b re1);\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27===============\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 很优雅\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e re2 = Redux.compose(func3, func2, func1)(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27re2：\x27\x3c\/span\x3e \x2b re2);\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e控制台输出：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22func1 获得参数 0\nfunc2 获得参数 1\nfunc3 获得参数 3\nre1：6\n===============\nfunc1 获得参数 0\nfunc2 获得参数 1\nfunc3 获得参数 3\nre2：6\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs asciidoc\x22\x3e\x3ccode\x3efunc1 获得参数 0\nfunc2 获得参数 1\nfunc3 获得参数 3\n\x3cspan class=\x22hljs-section\x22\x3ere1：6\n===============\x3c\/span\x3e\nfunc1 获得参数 0\nfunc2 获得参数 1\nfunc3 获得参数 3\nre2：6\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e§ \x3ca href=\x22http:\/\/cn.redux.js.org\/docs\/api\/createStore.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecreateStore(reducer, initialState, enhancer)\x3c\/a\x3e\n\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e⊙ 源码分析\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import isPlainObject from \x27lodash\/isPlainObject\x27\nimport $$observable from \x27symbol-observable\x27\n\n\/**\n * 这是 Redux 的私有 action 常量\n * 长得太丑了，你不要鸟就行了\n *\/\nexport var ActionTypes = {\n  INIT: \x27@@redux\/INIT\x27\n}\n\n\/**\n * @param  {函数}  reducer 不多解释了\n * @param  {对象}  preloadedState 主要用于前后端同构时的数据同步\n * @param  {函数}  enhancer 很牛逼，可以实现中间件、时间旅行，持久化等\n * ※ Redux 仅提供 appleMiddleware 这个 Store Enhancer ※\n * @return {Store}\n *\/\nexport default function createStore(reducer, preloadedState, enhancer) {\n  \/\/ 这里省略的代码，到本文的最后再讲述（用于压轴你懂的）\n  \n  var currentReducer = reducer\n  var currentState = preloadedState \/\/     这就是整个应用的 state\n  var currentListeners = [] \/\/             用于存储订阅的回调函数，dispatch 后逐个执行\n  var nextListeners = currentListeners \/\/ 【悬念1：为什么需要两个 存放回调函数 的变量？】\n  var isDispatching = false\n\n  \/**\n   * 【悬念1·解疑】\n   * 试想，dispatch 后，回调函数正在乖乖地被逐个执行（for 循环进行时）\n   * 假设回调函数队列原本是这样的 [a, b, c, d]\n   *\n   * 现在 for 循环执行到第 3 步，亦即 a、b 已经被执行，准备执行 c\n   * 但在这电光火石的瞬间，a 被取消订阅！！！\n   *\n   * 那么此时回调函数队列就变成了 [b, c, d]\n   * 那么第 3 步就对应换成了 d！！！\n   * c 被跳过了！！！这就是躺枪。。。\n   * \n   * 作为一个回调函数，最大的耻辱就是得不到执行\n   * 因此为了避免这个问题，本函数会在上述场景中把\n   * currentListeners 复制给 nextListeners\n   *\n   * 这样的话，dispatch 后，在逐个执行回调函数的过程中\n   * 如果有新增订阅或取消订阅，都在 nextListeners 中操作\n   * 让 currentListeners 中的回调函数得以完整地执行\n   *\n   * 既然新增是在 nextListeners 中 push，因此毫无疑问\n   * 新的回调函数不会在本次 currentListeners 的循环体中被触发\n   *\n   * （上述事件发生的几率虽然很低，但还是严谨点比较好）\n   *\/\n  function ensureCanMutateNextListeners() { \/\/ \x3c-------这货就叫做【ensure 哥】吧\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice()\n    }\n  }\n\n  \/**\n   * 返回 state\n   *\/\n  function getState() {\n    return currentState\n  }\n\n  \/**\n   * 负责注册回调函数的老司机\n   * \n   * 这里需要注意的就是，回调函数中如果需要获取 state\n   * 那每次获取都请使用 getState()，而不是开头用一个变量缓存住它\n   * 因为回调函数执行期间，有可能有连续几个 dispatch 让 state 改得物是人非\n   * 而且别忘了，dispatch 之后，整个 state 是被完全替换掉的\n   * 你缓存的 state 指向的可能已经是老掉牙的 state 了！！！\n   *\n   * @param  {函数} 想要订阅的回调函数\n   * @return {函数} 取消订阅的函数\n   *\/\n  function subscribe(listener) {\n    if (typeof listener !== \x27function\x27) {\n      throw new Error(\x27Expected listener to be a function.\x27)\n    }\n\n    var isSubscribed = true\n\n    ensureCanMutateNextListeners() \/\/ 调用 ensure 哥保平安\n    nextListeners.push(listener)   \/\/ 新增订阅在 nextListeners 中操作\n\n    \/\/ 返回一个取消订阅的函数\n    return function unsubscribe() {\n      if (!isSubscribed) {\n        return\n      }\n\n      isSubscribed = false\n\n      ensureCanMutateNextListeners() \/\/ 调用 ensure 哥保平安\n      var index = nextListeners.indexOf(listener)\n      nextListeners.splice(index, 1) \/\/ 取消订阅还是在 nextListeners 中操作\n    }\n  }\n\n  \/**\n   * 改变应用状态 state 的不二法门：dispatch 一个 action\n   * 内部的实现是：往 reducer 中传入 currentState 以及 action\n   * 用其返回值替换 currentState，最后逐个触发回调函数\n   *\n   * 如果 dispatch 的不是一个对象类型的 action（同步的），而是 Promise \/ thunk（异步的）\n   * 则需引入 redux-thunk 等中间件来反转控制权【悬念2：什么是反转控制权？】\n   * \n   * @param \x26amp; @return {对象} action\n   *\/\n  function dispatch(action) {\n    if (!isPlainObject(action)) {\n      throw new Error(\n        \x27Actions must be plain objects. \x27 \x2b\n        \x27Use custom middleware for async actions.\x27\n      )\n    }\n\n    if (typeof action.type === \x27undefined\x27) {\n      throw new Error(\n        \x27Actions may not have an undefined \x26quot;type\x26quot; property. \x27 \x2b\n        \x27Have you misspelled a constant?\x27\n      )\n    }\n\n    if (isDispatching) {\n      throw new Error(\x27Reducers may not dispatch actions.\x27)\n    }\n\n    try {\n      isDispatching = true\n      \/\/ 关键点：currentState 与 action 会流通到所有的 reducer\n      \/\/ 所有 reducer 的返回值整合后，替换掉当前的 currentState\n      currentState = currentReducer(currentState, action)\n    } finally {\n      isDispatching = false\n    }\n\n    \/\/ 令 currentListeners 等于 nextListeners，表示正在逐个执行回调函数（这就是上面 ensure 哥的判定条件）\n    var listeners = currentListeners = nextListeners\n\n    \/\/ 逐个触发回调函数。这里不缓存数组长度是明智的，原因见【悬念1·解疑】\n    for (var i = 0; i \x3c listeners.length; i\x2b\x2b) {\n      listeners[i]()\n    }\n\n    return action \/\/ 为了方便链式调用，dispatch 执行完毕后，返回 action（下文会提到的，稍微记住就好了）\n  }\n\n  \/**\n   * 替换当前 reducer 的老司机\n   * 主要用于代码分离按需加载、热替换等情况\n   *\n   * @param {函数} nextReducer\n   *\/\n  function replaceReducer(nextReducer) {\n    if (typeof nextReducer !== \x27function\x27) {\n      throw new Error(\x27Expected the nextReducer to be a function.\x27)\n    }\n\n    currentReducer = nextReducer \/\/         就是这么简单粗暴！\n    dispatch({ type: ActionTypes.INIT }) \/\/ 触发生成新的 state 树\n  }\n\n  \/**\n   * 这是留给 可观察\/响应式库 的接口（详情 https:\/\/github.com\/zenparsing\/es-observable）\n   * 如果您了解 RxJS 等响应式编程库，那可能会用到这个接口，否则请略过\n   * @return {observable}\n   *\/\n  function observable() {略}\n\n  \/\/ 这里 dispatch 只是为了生成 应用初始状态\n  dispatch({ type: ActionTypes.INIT })\n\n  return {\n    dispatch,\n    subscribe,\n    getState,\n    replaceReducer,\n    [$$observable]: observable\n  }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e isPlainObject \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27lodash\/isPlainObject\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e $$observable \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27symbol-observable\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 这是 Redux 的私有 action 常量\n * 长得太丑了，你不要鸟就行了\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ActionTypes = {\n  \x3cspan class=\x22hljs-attr\x22\x3eINIT\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27@@redux\/INIT\x27\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * @param  {函数}  reducer 不多解释了\n * @param  {对象}  preloadedState 主要用于前后端同构时的数据同步\n * @param  {函数}  enhancer 很牛逼，可以实现中间件、时间旅行，持久化等\n * ※ Redux 仅提供 appleMiddleware 这个 Store Enhancer ※\n * @return {Store}\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateStore\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereducer, preloadedState, enhancer\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里省略的代码，到本文的最后再讲述（用于压轴你懂的）\x3c\/span\x3e\n  \n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e currentReducer = reducer\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e currentState = preloadedState \x3cspan class=\x22hljs-comment\x22\x3e\/\/     这就是整个应用的 state\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e currentListeners = [] \x3cspan class=\x22hljs-comment\x22\x3e\/\/             用于存储订阅的回调函数，dispatch 后逐个执行\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e nextListeners = currentListeners \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 【悬念1：为什么需要两个 存放回调函数 的变量？】\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isDispatching = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 【悬念1·解疑】\n   * 试想，dispatch 后，回调函数正在乖乖地被逐个执行（for 循环进行时）\n   * 假设回调函数队列原本是这样的 [a, b, c, d]\n   *\n   * 现在 for 循环执行到第 3 步，亦即 a、b 已经被执行，准备执行 c\n   * 但在这电光火石的瞬间，a 被取消订阅！！！\n   *\n   * 那么此时回调函数队列就变成了 [b, c, d]\n   * 那么第 3 步就对应换成了 d！！！\n   * c 被跳过了！！！这就是躺枪。。。\n   * \n   * 作为一个回调函数，最大的耻辱就是得不到执行\n   * 因此为了避免这个问题，本函数会在上述场景中把\n   * currentListeners 复制给 nextListeners\n   *\n   * 这样的话，dispatch 后，在逐个执行回调函数的过程中\n   * 如果有新增订阅或取消订阅，都在 nextListeners 中操作\n   * 让 currentListeners 中的回调函数得以完整地执行\n   *\n   * 既然新增是在 nextListeners 中 push，因此毫无疑问\n   * 新的回调函数不会在本次 currentListeners 的循环体中被触发\n   *\n   * （上述事件发生的几率虽然很低，但还是严谨点比较好）\n   *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eensureCanMutateNextListeners\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt;-------这货就叫做【ensure 哥】吧\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice()\n    }\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 返回 state\n   *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetState\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e currentState\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 负责注册回调函数的老司机\n   * \n   * 这里需要注意的就是，回调函数中如果需要获取 state\n   * 那每次获取都请使用 getState()，而不是开头用一个变量缓存住它\n   * 因为回调函数执行期间，有可能有连续几个 dispatch 让 state 改得物是人非\n   * 而且别忘了，dispatch 之后，整个 state 是被完全替换掉的\n   * 你缓存的 state 指向的可能已经是老掉牙的 state 了！！！\n   *\n   * @param  {函数} 想要订阅的回调函数\n   * @return {函数} 取消订阅的函数\n   *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esubscribe\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3elistener\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e listener !== \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Expected listener to be a function.\x27\x3c\/span\x3e)\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e isSubscribed = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\n    ensureCanMutateNextListeners() \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用 ensure 哥保平安\x3c\/span\x3e\n    nextListeners.push(listener)   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新增订阅在 nextListeners 中操作\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 返回一个取消订阅的函数\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eunsubscribe\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!isSubscribed) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n      }\n\n      isSubscribed = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\n      ensureCanMutateNextListeners() \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用 ensure 哥保平安\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e index = nextListeners.indexOf(listener)\n      nextListeners.splice(index, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 取消订阅还是在 nextListeners 中操作\x3c\/span\x3e\n    }\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 改变应用状态 state 的不二法门：dispatch 一个 action\n   * 内部的实现是：往 reducer 中传入 currentState 以及 action\n   * 用其返回值替换 currentState，最后逐个触发回调函数\n   *\n   * 如果 dispatch 的不是一个对象类型的 action（同步的），而是 Promise \/ thunk（异步的）\n   * 则需引入 redux-thunk 等中间件来反转控制权【悬念2：什么是反转控制权？】\n   * \n   * @param \x26amp; @return {对象} action\n   *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edispatch\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!isPlainObject(action)) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\n        \x3cspan class=\x22hljs-string\x22\x3e\x27Actions must be plain objects. \x27\x3c\/span\x3e \x2b\n        \x3cspan class=\x22hljs-string\x22\x3e\x27Use custom middleware for async actions.\x27\x3c\/span\x3e\n      )\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e action.type === \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\n        \x3cspan class=\x22hljs-string\x22\x3e\x27Actions may not have an undefined \x22type\x22 property. \x27\x3c\/span\x3e \x2b\n        \x3cspan class=\x22hljs-string\x22\x3e\x27Have you misspelled a constant?\x27\x3c\/span\x3e\n      )\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isDispatching) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Reducers may not dispatch actions.\x27\x3c\/span\x3e)\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n      isDispatching = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 关键点：currentState 与 action 会流通到所有的 reducer\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 所有 reducer 的返回值整合后，替换掉当前的 currentState\x3c\/span\x3e\n      currentState = currentReducer(currentState, action)\n    } \x3cspan class=\x22hljs-keyword\x22\x3efinally\x3c\/span\x3e {\n      isDispatching = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 令 currentListeners 等于 nextListeners，表示正在逐个执行回调函数（这就是上面 ensure 哥的判定条件）\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e listeners = currentListeners = nextListeners\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 逐个触发回调函数。这里不缓存数组长度是明智的，原因见【悬念1·解疑】\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; listeners.length; i\x2b\x2b) {\n      listeners[i]()\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e action \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 为了方便链式调用，dispatch 执行完毕后，返回 action（下文会提到的，稍微记住就好了）\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 替换当前 reducer 的老司机\n   * 主要用于代码分离按需加载、热替换等情况\n   *\n   * @param {函数} nextReducer\n   *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereplaceReducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enextReducer\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e nextReducer !== \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Expected the nextReducer to be a function.\x27\x3c\/span\x3e)\n    }\n\n    currentReducer = nextReducer \x3cspan class=\x22hljs-comment\x22\x3e\/\/         就是这么简单粗暴！\x3c\/span\x3e\n    dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: ActionTypes.INIT }) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 触发生成新的 state 树\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 这是留给 可观察\/响应式库 的接口（详情 https:\/\/github.com\/zenparsing\/es-observable）\n   * 如果您了解 RxJS 等响应式编程库，那可能会用到这个接口，否则请略过\n   * @return {observable}\n   *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eobservable\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{略}\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里 dispatch 只是为了生成 应用初始状态\x3c\/span\x3e\n  dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: ActionTypes.INIT })\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    dispatch,\n    subscribe,\n    getState,\n    replaceReducer,\n    [$$observable]: observable\n  }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e【悬念2：什么是反转控制权？ · 解疑】  \x3cbr\x3e在同步场景下，\x3ccode\x3edispatch(action)\x3c\/code\x3e 的这个 \x3ccode\x3eaction\x3c\/code\x3e 中的数据是同步获取的，并没有控制权的切换问题  \x3cbr\x3e但异步场景下，则需要将 \x3ccode\x3edispatch\x3c\/code\x3e 传入到回调函数。待异步操作完成后，回调函数\x3cstrong\x3e自行\x3c\/strong\x3e调用 \x3ccode\x3edispatch(action)\x3c\/code\x3e  \x3c\/p\x3e\n\x3cp\x3e说白了：在异步 Action Creator 中\x3cstrong\x3e自行\x3c\/strong\x3e调用 \x3ccode\x3edispatch\x3c\/code\x3e 就相当于反转控制权  \x3cbr\x3e您完全可以自己实现，也可以借助 \x3ca href=\x22https:\/\/github.com\/gaearon\/redux-thunk\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-thunk\x3c\/a\x3e \/ \x3ca href=\x22https:\/\/github.com\/acdlite\/redux-promise\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-promise\x3c\/a\x3e 等中间件统一实现  \x3cbr\x3e（它们的作用也仅仅就是把 \x3ccode\x3edispatch\x3c\/code\x3e 等传入异步 Action Creator 罢了）\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e拓展阅读：阮老师的 \x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2015\/05\/thunk.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eThunk 函数的含义与用法\x3c\/a\x3e  \x3cbr\x3e题外话：您不觉得 JavaScript 的回调函数，就是反转控制权最普遍的体现吗？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e§ \x3ca href=\x22http:\/\/cn.redux.js.org\/docs\/api\/combineReducers.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecombineReducers(reducers)\x3c\/a\x3e\n\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e⊙ 应用场景\x3c\/h3\x3e\n\x3cp\x3e简明教程中的 \x3ccode\x3ecode-7\x3c\/code\x3e 如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 本代码块记为 code-7 **\/\nvar initState = {\n  counter: 0,\n  todos: []\n}\n\nfunction reducer(state, action) {\n  if (!state) state = initState\n  \n  switch (action.type) {\n    case \x27ADD_TODO\x27:\n      var nextState = _.deepClone(state) \/\/ 用到了 lodash 的深克隆\n      nextState.todos.push(action.payload) \n      return nextState\n\n    default:\n      return state\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 本代码块记为 code-7 **\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e initState = {\n  \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etodos\x3c\/span\x3e: []\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estate, action\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!state) state = initState\n  \n  \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27ADD_TODO\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e nextState = _.deepClone(state) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用到了 lodash 的深克隆\x3c\/span\x3e\n      nextState.todos.push(action.payload) \n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e nextState\n\n    \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e state\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面的 \x3ccode\x3ereducer\x3c\/code\x3e 仅仅是实现了 “新增待办事项” 的 \x3ccode\x3estate\x3c\/code\x3e 的处理  \x3cbr\x3e我们还有计数器的功能，下面我们继续增加计数器 “增加 1” 的功能：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 本代码块记为 code-8 **\/\nvar initState = { counter: 0, todos: [] }\n\nfunction reducer(state, action) {\n  if (!state) return initState \/\/ 若是初始化可立即返回应用初始状态\n  var nextState = _.deepClone(state) \/\/ 否则二话不说先克隆\n  \n  switch (action.type) {\n    case \x27ADD_TODO\x27: \/\/ 新增待办事项\n      nextState.todos.push(action.payload) \n      break   \n    case \x27INCREMENT\x27: \/\/ 计数器加 1\n      nextState.counter = nextState.counter \x2b 1\n      break\n  }\n  return nextState\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 本代码块记为 code-8 **\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e initState = { \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3etodos\x3c\/span\x3e: [] }\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estate, action\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!state) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e initState \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 若是初始化可立即返回应用初始状态\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e nextState = _.deepClone(state) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 否则二话不说先克隆\x3c\/span\x3e\n  \n  \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27ADD_TODO\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新增待办事项\x3c\/span\x3e\n      nextState.todos.push(action.payload) \n      \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e   \n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27INCREMENT\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 计数器加 1\x3c\/span\x3e\n      nextState.counter = nextState.counter \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e nextState\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果说还有其他的动作，都需要在 \x3ccode\x3ecode-8\x3c\/code\x3e 这个 \x3ccode\x3ereducer\x3c\/code\x3e 中继续堆砌处理逻辑  \x3cbr\x3e但我们知道，计数器 与 待办事项 属于两个不同的模块，不应该都堆在一起写  \x3cbr\x3e如果之后又要引入新的模块（例如留言板），该 \x3ccode\x3ereducer\x3c\/code\x3e 会越来越臃肿  \x3cbr\x3e此时就是 \x3ccode\x3ecombineReducers\x3c\/code\x3e 大显身手的时刻：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22目录结构如下\nreducers\/\n   ├── index.js\n   ├── counterReducer.js\n   ├── todosReducer.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e目录结构如下\nreducers\/\n   ├── index\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n   ├── counterReducer\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n   ├── todosReducer.js\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 本代码块记为 code-9 **\/\n\/* reducers\/index.js *\/\nimport { combineReducers } from \x27redux\x27\nimport counterReducer from \x27.\/counterReducer\x27\nimport todosReducer from \x27.\/todosReducer\x27\n\nconst rootReducer = combineReducers({\n  counter: counterReducer, \/\/ \x3c-------- 键名就是该 reducer 对应管理的 state\n  todos: todosReducer\n})\n\nexport default rootReducer\n\n-------------------------------------------------\n\n\/* reducers\/counterReducer.js *\/\nexport default function counterReducer(counter = 0, action) { \/\/ 传入的 state 其实是 state.counter\n  switch (action.type) {\n    case \x27INCREMENT\x27:\n      return counter \x2b 1 \/\/ counter 是值传递，因此可以直接返回一个值\n    default:\n      return counter\n  }\n}\n\n-------------------------------------------------\n\n\/* reducers\/todosReducers *\/\nexport default function todosReducer(todos = [], action) { \/\/ 传入的 state 其实是 state.todos\n  switch (action.type) {\n    case \x27ADD_TODO\x27:\n      return [ ...todos, action.payload ]\n    default:\n      return todos\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 本代码块记为 code-9 **\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/* reducers\/index.js *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { combineReducers } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e counterReducer \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/counterReducer\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e todosReducer \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/todosReducer\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e rootReducer = combineReducers({\n  \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: counterReducer, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt;-------- 键名就是该 reducer 对应管理的 state\x3c\/span\x3e\n  todos: todosReducer\n})\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e rootReducer\n\n-------------------------------------------------\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* reducers\/counterReducer.js *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecounterReducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecounter = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, action\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 传入的 state 其实是 state.counter\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27INCREMENT\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e counter \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ counter 是值传递，因此可以直接返回一个值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e counter\n  }\n}\n\n-------------------------------------------------\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* reducers\/todosReducers *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etodosReducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etodos = [], action\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 传入的 state 其实是 state.todos\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27ADD_TODO\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e [ ...todos, action.payload ]\n    \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e todos\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ecode-8 reducer\x3c\/code\x3e 与 \x3ccode\x3ecode-9 rootReducer\x3c\/code\x3e 的功能是一样的，但后者的各个子 \x3ccode\x3ereducer\x3c\/code\x3e 仅维护对应的那部分 \x3ccode\x3estate\x3c\/code\x3e  \x3cbr\x3e其可操作性、可维护性、可扩展性大大增强\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eFlux 中是根据不同的功能拆分出多个 \x3ccode\x3estore\x3c\/code\x3e 分而治之  \x3cbr\x3e而 Redux 只允许应用中有唯一的 \x3ccode\x3estore\x3c\/code\x3e，通过拆分出多个 \x3ccode\x3ereducer\x3c\/code\x3e 分别管理对应的 \x3ccode\x3estate\x3c\/code\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3chr\x3e\n\x3cp\x3e下面继续来深入使用 \x3ccode\x3ecombineReducers\x3c\/code\x3e。一直以来我们的应用状态都是只有两层，如下所示：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22state\n  ├── counter: 0\n  ├── todos: []\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e\n  ├── counter: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n  ├── todos: []\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果说现在又有一个需求：在待办事项模块中，存储用户每次操作（增删改）的时间，那么此时应用初始状态树应为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22state\n  ├── counter: 0\n  ├── todo\n        ├── optTime: []\n        ├── todoList: [] # 这其实就是原来的 todos！\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e\n  ├── counter: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n  ├── todo\n        ├── optTime: []\n        ├── todoList: [] \x3cspan class=\x22hljs-comment\x22\x3e# 这其实就是原来的 todos！\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么对应的 \x3ccode\x3ereducer\x3c\/code\x3e 就是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22目录结构如下\nreducers\/\n   ├── index.js \x3c-------------- combineReducers (生成 rootReducer)\n   ├── counterReducer.js\n   ├── todoReducers\/ \x3c--------- combineReducers\n           ├── index.js\n           ├── optTimeReducer.js\n           ├── todoListReducer.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e目录结构如下\nreducers\/\n   ├── index\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e \x26lt;-------------- combineReducers (生成 rootReducer)\n   ├── counterReducer\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n   ├── todoReducers\/ \x26lt;--------- combineReducers\n           ├── index\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n           ├── optTimeReducer\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n           ├── todoListReducer.js\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* reducers\/index.js *\/\nimport { combineReducers } from \x27redux\x27\nimport counterReducer from \x27.\/counterReducer\x27\nimport todoReducers from \x27.\/todoReducers\/\x27\n\nconst rootReducer = combineReducers({\n  counter: counterReducer,\n  todo: todoReducers\n})\n\nexport default rootReducer\n\n=================================================\n\n\/* reducers\/todoReducers\/index.js *\/\nimport { combineReducers } from \x27redux\x27\nimport optTimeReducer from \x27.\/optTimeReducer\x27\nimport todoListReducer from \x27.\/todoListReducer\x27\n\nconst todoReducers = combineReducers({\n  optTime: optTimeReducer,\n  todoList: todoListReducer\n})\n\nexport default todoReducers\n\n-------------------------------------------------\n\n\/* reducers\/todosReducers\/optTimeReducer.js *\/\nexport default function optTimeReducer(optTime = [], action) {\n  \/\/ 咦？这里怎么没有 switch-case 分支？谁说 reducer 就一定包含 switch-case 分支的？\n  return action.type.includes(\x27TODO\x27) ? [ ...optTime, new Date() ] : optTime\n}\n\n-------------------------------------------------\n\n\/* reducers\/todosReducers\/todoListReducer.js *\/\nexport default function todoListReducer(todoList = [], action) {\n  switch (action.type) {\n    case \x27ADD_TODO\x27:\n      return [ ...todoList, action.payload ]\n    default:\n      return todoList\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* reducers\/index.js *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { combineReducers } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e counterReducer \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/counterReducer\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e todoReducers \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/todoReducers\/\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e rootReducer = combineReducers({\n  \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: counterReducer,\n  \x3cspan class=\x22hljs-attr\x22\x3etodo\x3c\/span\x3e: todoReducers\n})\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e rootReducer\n\n=================================================\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* reducers\/todoReducers\/index.js *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { combineReducers } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e optTimeReducer \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/optTimeReducer\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e todoListReducer \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/todoListReducer\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e todoReducers = combineReducers({\n  \x3cspan class=\x22hljs-attr\x22\x3eoptTime\x3c\/span\x3e: optTimeReducer,\n  \x3cspan class=\x22hljs-attr\x22\x3etodoList\x3c\/span\x3e: todoListReducer\n})\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e todoReducers\n\n-------------------------------------------------\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* reducers\/todosReducers\/optTimeReducer.js *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eoptTimeReducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptTime = [], action\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 咦？这里怎么没有 switch-case 分支？谁说 reducer 就一定包含 switch-case 分支的？\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e action.type.includes(\x3cspan class=\x22hljs-string\x22\x3e\x27TODO\x27\x3c\/span\x3e) ? [ ...optTime, \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e() ] : optTime\n}\n\n-------------------------------------------------\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* reducers\/todosReducers\/todoListReducer.js *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etodoListReducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etodoList = [], action\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27ADD_TODO\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e [ ...todoList, action.payload ]\n    \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e todoList\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e无论您的应用状态树有多么的复杂，都可以通过逐层下分管理对应部分的 \x3ccode\x3estate\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22                                 counterReducer(counter, action) -------------------- counter\n                              ↗                                                              ↘\nrootReducer(state, action) —→∑     ↗ optTimeReducer(optTime, action) ------ optTime ↘         nextState\n                              ↘—→∑                                                    todo  ↗\n                                   ↘ todoListReducer(todoList,action) ----- todoList ↗\n\n\n注：左侧表示 dispatch 分发流，∑ 表示 combineReducers；右侧表示各实体 reducer 的返回值，最后汇总整合成 nextState\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3e                                 counterReducer(counter, action) -------------------- counter\n                              ↗                                                              ↘\nrootReducer(\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e, action) —→∑     ↗ optTimeReducer(optTime, action) ------ optTime ↘         nextState\n                              ↘—→∑                                                    todo  ↗\n                                   ↘ todoListReducer(todoList,action) ----- todoList ↗\n\n\n注：左侧表示 dispatch 分发流，∑ 表示 combineReducers；右侧表示各实体 reducer 的返回值，最后汇总整合成 nextState\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e看了上图，您应该能直观感受到为何取名为 \x3ccode\x3ereducer\x3c\/code\x3e 了吧？把 \x3ccode\x3estate\x3c\/code\x3e 分而治之，极大减轻开发与维护的难度\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e无论是 \x3ccode\x3edispatch\x3c\/code\x3e 哪个 \x3ccode\x3eaction\x3c\/code\x3e，都会流通\x3cstrong\x3e所有的\x3c\/strong\x3e \x3ccode\x3ereducer\x3c\/code\x3e  \x3cbr\x3e表面上看来，这样子很浪费性能，但 JavaScript 对于这种\x3cstrong\x3e纯函数\x3c\/strong\x3e的调用是很高效率的，因此请尽管放心  \x3cbr\x3e这也是为何 \x3ccode\x3ereducer\x3c\/code\x3e 必须返回其对应的 \x3ccode\x3estate\x3c\/code\x3e 的原因。否则整合状态树时，该 \x3ccode\x3ereducer\x3c\/code\x3e 对应的键名就是 \x3ccode\x3eundefined\x3c\/code\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e⊙ 源码分析\x3c\/h3\x3e\n\x3cblockquote\x3e\x3cp\x3e仅截取关键部分，毕竟有很大一部分都是类型检测警告\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function combineReducers(reducers) {\n  var reducerKeys = Object.keys(reducers)\n  var finalReducers = {}\n  \n  for (var i = 0; i \x3c reducerKeys.length; i\x2b\x2b) {\n    var key = reducerKeys[i]\n    if (typeof reducers[key] === \x27function\x27) {\n      finalReducers[key] = reducers[key]\n    }\n  }\n\n  var finalReducerKeys = Object.keys(finalReducers)\n\n  \/\/ 返回合成后的 reducer\n  return function combination(state = {}, action) {\n    var hasChanged = false\n    var nextState = {}\n    for (var i = 0; i \x3c finalReducerKeys.length; i\x2b\x2b) {\n      var key = finalReducerKeys[i]\n      var reducer = finalReducers[key]\n      var previousStateForKey = state[key]                       \/\/ 获取当前子 state\n      var nextStateForKey = reducer(previousStateForKey, action) \/\/ 执行各子 reducer 中获取子 nextState\n      nextState[key] = nextStateForKey                           \/\/ 将子 nextState 挂载到对应的键名\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey\n    }\n    return hasChanged ? nextState : state\n  }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecombineReducers\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereducers\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e reducerKeys = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(reducers)\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e finalReducers = {}\n  \n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; reducerKeys.length; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e key = reducerKeys[i]\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e reducers[key] === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n      finalReducers[key] = reducers[key]\n    }\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e finalReducerKeys = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(finalReducers)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 返回合成后的 reducer\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecombination\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estate = {}, action\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e hasChanged = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e nextState = {}\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; finalReducerKeys.length; i\x2b\x2b) {\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e key = finalReducerKeys[i]\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e reducer = finalReducers[key]\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e previousStateForKey = state[key]                       \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取当前子 state\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e nextStateForKey = reducer(previousStateForKey, action) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 执行各子 reducer 中获取子 nextState\x3c\/span\x3e\n      nextState[key] = nextStateForKey                           \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将子 nextState 挂载到对应的键名\x3c\/span\x3e\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e hasChanged ? nextState : state\n  }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e在此我的注释很少，因为代码写得实在是太过明了了，注释反而影响阅读  \x3cbr\x3e作者 Dan 用了大量的 \x3ccode\x3efor\x3c\/code\x3e 循环，的确有点不够优雅\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e§ \x3ca href=\x22http:\/\/cn.redux.js.org\/docs\/api\/bindActionCreators.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebindActionCreators(actionCreators, dispatch)\x3c\/a\x3e\n\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e这个 API 有点鸡肋，它无非就是做了这件事情：\x3ccode\x3edispatch(ActionCreator(XXX))\x3c\/code\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e⊙ 源码分析\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 为 Action Creator 加装上自动 dispatch 技能 *\/\nfunction bindActionCreator(actionCreator, dispatch) {\n  return (...args) =\x3e dispatch(actionCreator(...args))\n}\n\nexport default function bindActionCreators(actionCreators, dispatch) {\n  \/\/ 省去一大坨类型判断\n  var keys = Object.keys(actionCreators)\n  var boundActionCreators = {}\n  for (var i = 0; i \x3c keys.length; i\x2b\x2b) {\n    var key = keys[i]\n    var actionCreator = actionCreators[key]\n    if (typeof actionCreator === \x27function\x27) {\n      \/\/ 逐个装上自动 dispatch 技能\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)\n    }\n  }\n  return boundActionCreators\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 为 Action Creator 加装上自动 dispatch 技能 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ebindActionCreator\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eactionCreator, dispatch\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e...args\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e dispatch(actionCreator(...args))\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ebindActionCreators\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eactionCreators, dispatch\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 省去一大坨类型判断\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e keys = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(actionCreators)\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e boundActionCreators = {}\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; keys.length; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e key = keys[i]\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e actionCreator = actionCreators[key]\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e actionCreator === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 逐个装上自动 dispatch 技能\x3c\/span\x3e\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)\n    }\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e boundActionCreators\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e⊙ 应用场景\x3c\/h3\x3e\n\x3cp\x3e简明教程中的 \x3ccode\x3ecode-5\x3c\/code\x3e 如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c--! 本代码块记为 code-5 --\x3e\n\x3cinput id=\x26quot;todoInput\x26quot; type=\x26quot;text\x26quot; \/\x3e\n\x3cbutton id=\x26quot;btn\x26quot;\x3e提交\x3c\/button\x3e\n\n\x3cscript\x3e\n$(\x27#btn\x27).on(\x27click\x27, function() {\n  var content = $(\x27#todoInput\x27).val() \/\/ 获取输入框的值\n  var action = addTodo(content) \/\/ 执行 Action Creator 获得 action\n  store.dispatch(action) \/\/ 手动显式 dispatch 一个 action\n})\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e--!\x3c\/span\x3e 本代码块记为 \x3cspan class=\x22hljs-attr\x22\x3ecode-5\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e--\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22todoInput\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22btn\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e提交\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n$(\x3cspan class=\x22hljs-string\x22\x3e\x27#btn\x27\x3c\/span\x3e).on(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e content = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#todoInput\x27\x3c\/span\x3e).val() \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取输入框的值\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e action = addTodo(content) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 执行 Action Creator 获得 action\x3c\/span\x3e\n  store.dispatch(action) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 手动显式 dispatch 一个 action\x3c\/span\x3e\n})\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们看到，调用 \x3ccode\x3eaddTodo\x3c\/code\x3e 这个 Action Creator 后得到一个 \x3ccode\x3eaction\x3c\/code\x3e，之后又要手动 \x3ccode\x3edispatch(action)\x3c\/code\x3e  \x3cbr\x3e如果是只有一个两个 Action Creator 还是可以接受，但如果有很多个那就显得有点重复了（其实我觉得不重复哈哈哈）  \x3cbr\x3e这个时候我们就可以利用 \x3ccode\x3ebindActionCreators\x3c\/code\x3e 实现自动 \x3ccode\x3edispatch\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput id=\x26quot;todoInput\x26quot; type=\x26quot;text\x26quot; \/\x3e\n\x3cbutton id=\x26quot;btn\x26quot;\x3e提交\x3c\/button\x3e\n\n\x3cscript\x3e\n\/\/ 全局引入 Redux、jQuery，同时 store 是全局变量\nvar actionsCreators = Redux.bindActionCreators(\n  { addTodo: addTodo },\n  store.dispatch \/\/ 传入 dispatch 函数\n)\n\n$(\x27#btn\x27).on(\x27click\x27, function() {\n  var content = $(\x27#todoInput\x27).val()\n  actionCreators.addTodo(content) \/\/ 它会自动 dispatch\n})\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22todoInput\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22btn\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e提交\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 全局引入 Redux、jQuery，同时 store 是全局变量\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e actionsCreators = Redux.bindActionCreators(\n  { \x3cspan class=\x22hljs-attr\x22\x3eaddTodo\x3c\/span\x3e: addTodo },\n  store.dispatch \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 传入 dispatch 函数\x3c\/span\x3e\n)\n\n$(\x3cspan class=\x22hljs-string\x22\x3e\x27#btn\x27\x3c\/span\x3e).on(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e content = $(\x3cspan class=\x22hljs-string\x22\x3e\x27#todoInput\x27\x3c\/span\x3e).val()\n  actionCreators.addTodo(content) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 它会自动 dispatch\x3c\/span\x3e\n})\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e综上，这个 API 没啥卵用，尤其是异步场景下，基本用不上\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e§ \x3ca href=\x22http:\/\/cn.redux.js.org\/docs\/api\/applyMiddleware.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eapplyMiddleware(...middlewares)\x3c\/a\x3e\n\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3eRedux 中文文档 \x3ca href=\x22http:\/\/cn.redux.js.org\/docs\/advanced\/Middleware.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e高级 · Middleware\x3c\/a\x3e 有提到中间件的演化由来\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e首先要理解何谓 \x3ccode\x3eMiddleware\x3c\/code\x3e，何谓 \x3ccode\x3eEnhancer\x3c\/code\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e⊙ Middleware\x3c\/h3\x3e\n\x3cp\x3e说白了，Redux 引入中间件机制，其实就是为了在 \x3ccode\x3edispatch\x3c\/code\x3e 前后，\x3cstrong\x3e统一\x3c\/strong\x3e“做爱做的事”。。。  \x3cbr\x3e诸如统一的日志记录、引入 thunk 统一处理异步 Action Creator 等都属于中间件  \x3cbr\x3e下面是一个简单的打印动作前后 \x3ccode\x3estate\x3c\/code\x3e 的中间件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 装逼写法 *\/\nconst printStateMiddleware = ({ getState }) =\x3e next =\x3e action =\x3e {\n  console.log(\x27state before dispatch\x27, getState())\n  \n  let returnValue = next(action)\n\n  console.log(\x27state after dispatch\x27, getState())\n\n  return returnValue\n}\n\n-------------------------------------------------\n\n\/* 降低逼格写法 *\/\nfunction printStateMiddleware(middlewareAPI) { \/\/ 记为【锚点-1】，中间件内可用的 API\n  return function (dispatch) {                 \/\/ 记为【锚点-2】，传入原 dispatch 的引用\n    return function (action) {\n      console.log(\x27state before dispatch\x27, middlewareAPI.getState())\n  \n      var returnValue = dispatch(action) \/\/ 还记得吗，dispatch 的返回值其实还是 action\n  \n      console.log(\x27state after dispatch\x27, middlewareAPI.getState())\n\n      return returnValue \/\/ 继续传给下一个中间件作为参数 action\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 装逼写法 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e printStateMiddleware = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ getState }\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e next =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27state before dispatch\x27\x3c\/span\x3e, getState())\n  \n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e returnValue = next(action)\n\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27state after dispatch\x27\x3c\/span\x3e, getState())\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e returnValue\n}\n\n-------------------------------------------------\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* 降低逼格写法 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eprintStateMiddleware\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emiddlewareAPI\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 记为【锚点-1】，中间件内可用的 API\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) \x3c\/span\x3e{                 \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 记为【锚点-2】，传入原 dispatch 的引用\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27state before dispatch\x27\x3c\/span\x3e, middlewareAPI.getState())\n  \n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e returnValue = dispatch(action) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 还记得吗，dispatch 的返回值其实还是 action\x3c\/span\x3e\n  \n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27state after dispatch\x27\x3c\/span\x3e, middlewareAPI.getState())\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e returnValue \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 继续传给下一个中间件作为参数 action\x3c\/span\x3e\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e⊙ Store Enhancer\x3c\/h3\x3e\n\x3cp\x3e说白了，Store 增强器就是对生成的 \x3ccode\x3estore\x3c\/code\x3e API 进行改造，这是它与中间件最大的区别（中间件不修改 \x3ccode\x3estore\x3c\/code\x3e 的 API）  \x3cbr\x3e而改造 \x3ccode\x3estore\x3c\/code\x3e 的 API 就要从它的缔造者 \x3ccode\x3ecreateStore\x3c\/code\x3e 入手。例如，Redux 的 API \x3ccode\x3eapplyMiddleware\x3c\/code\x3e 就是一个 Store 增强器：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import compose from \x27.\/compose\x27 \/\/ 这货的作用其实就是 compose(f, g, h)(action) =\x3e f(g(h(action)))\n\n\/* 传入一坨中间件 *\/\nexport default function applyMiddleware(...middlewares) {\n\n  \/* 传入 createStore *\/\n  return function(createStore) {\n  \n    \/* 返回一个函数签名跟 createStore 一模一样的函数，亦即返回的是一个增强版的 createStore *\/\n    return function(reducer, preloadedState, enhancer) {\n    \n      \/\/ 用原 createStore 先生成一个 store，其包含 getState \/ dispatch \/ subscribe \/ replaceReducer 四个 API\n      var store = createStore(reducer, preloadedState, enhancer)\n      \n      var dispatch = store.dispatch \/\/ 指向原 dispatch\n      var chain = [] \/\/ 存储中间件的数组\n  \n      \/\/ 提供给中间件的 API（其实都是 store 的 API）\n      var middlewareAPI = {\n        getState: store.getState,\n        dispatch: (action) =\x3e dispatch(action)\n      }\n      \n      \/\/ 给中间件“装上” API，见上面 ⊙Middleware【降低逼格写法】的【锚点-1】 \n      chain = middlewares.map(middleware =\x3e middleware(middlewareAPI))\n      \n      \/\/ 串联各个中间件，为各个中间件传入原 store.dispatch，见【降低逼格写法】的【锚点-2】\n      dispatch = compose(...chain)(store.dispatch)\n  \n      return {\n        ...store, \/\/ store 的 API 中保留 getState \/ subsribe \/ replaceReducer\n        dispatch  \/\/ 新 dispatch 覆盖原 dispatch，往后调用 dispatch 就会触发 chain 内的中间件链式串联执行\n      }\n    }\n  }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e compose \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/compose\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这货的作用其实就是 compose(f, g, h)(action) =\x26gt; f(g(h(action)))\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/* 传入一坨中间件 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eapplyMiddleware\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e...middlewares\x3c\/span\x3e) \x3c\/span\x3e{\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/* 传入 createStore *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecreateStore\x3c\/span\x3e) \x3c\/span\x3e{\n  \n    \x3cspan class=\x22hljs-comment\x22\x3e\/* 返回一个函数签名跟 createStore 一模一样的函数，亦即返回的是一个增强版的 createStore *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereducer, preloadedState, enhancer\x3c\/span\x3e) \x3c\/span\x3e{\n    \n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用原 createStore 先生成一个 store，其包含 getState \/ dispatch \/ subscribe \/ replaceReducer 四个 API\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e store = createStore(reducer, preloadedState, enhancer)\n      \n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dispatch = store.dispatch \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 指向原 dispatch\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e chain = [] \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 存储中间件的数组\x3c\/span\x3e\n  \n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 提供给中间件的 API（其实都是 store 的 API）\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e middlewareAPI = {\n        \x3cspan class=\x22hljs-attr\x22\x3egetState\x3c\/span\x3e: store.getState,\n        \x3cspan class=\x22hljs-attr\x22\x3edispatch\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e dispatch(action)\n      }\n      \n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 给中间件“装上” API，见上面 ⊙Middleware【降低逼格写法】的【锚点-1】 \x3c\/span\x3e\n      chain = middlewares.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3emiddleware\x3c\/span\x3e =\x26gt;\x3c\/span\x3e middleware(middlewareAPI))\n      \n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 串联各个中间件，为各个中间件传入原 store.dispatch，见【降低逼格写法】的【锚点-2】\x3c\/span\x3e\n      dispatch = compose(...chain)(store.dispatch)\n  \n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        ...store, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ store 的 API 中保留 getState \/ subsribe \/ replaceReducer\x3c\/span\x3e\n        dispatch  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新 dispatch 覆盖原 dispatch，往后调用 dispatch 就会触发 chain 内的中间件链式串联执行\x3c\/span\x3e\n      }\n    }\n  }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最终返回的虽然还是 \x3ccode\x3estore\x3c\/code\x3e 的那四个 API，但其中的 \x3ccode\x3edispatch\x3c\/code\x3e 函数的功能被增强了，这就是所谓的 Store Enhancer\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3e⊙ 综合应用 ( \x3ca href=\x22http:\/\/jsbin.com\/luhira\/edit?html,console\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e在线演示\x3c\/a\x3e )\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n\x3chead\x3e\n  \x3cscript src=\x26quot;\/\/cdn.bootcss.com\/redux\/3.5.2\/redux.min.js\x26quot;\x3e\x3c\/script\x3e\n\x3c\/head\x3e\n\x3cbody\x3e\n\x3cscript\x3e\n\/** Action Creators *\/\nfunction inc() {\n  return { type: \x27INCREMENT\x27 };\n}\nfunction dec() {\n  return { type: \x27DECREMENT\x27 };\n}\n\nfunction reducer(state, action) {\n  state = state || { counter: 0 };\n\n  switch (action.type) {\n    case \x27INCREMENT\x27:\n      return { counter: state.counter \x2b 1 };\n    case \x27DECREMENT\x27:\n      return { counter: state.counter - 1 };\n    default:\n      return state;\n  }\n}\n\nfunction printStateMiddleware(middlewareAPI) {\n  return function (dispatch) {\n    return function (action) {\n      console.log(\x27dispatch 前：\x27, middlewareAPI.getState());\n      var returnValue = dispatch(action);\n      console.log(\x27dispatch 后：\x27, middlewareAPI.getState(), \x27\\n\x27);\n      return returnValue;\n    };\n  };\n}\n\nvar enhancedCreateStore = Redux.applyMiddleware(printStateMiddleware)(Redux.createStore);\nvar store = enhancedCreateStore(reducer);\n\nstore.dispatch(inc());\nstore.dispatch(inc());\nstore.dispatch(dec());\n\x3c\/script\x3e\n\x3c\/body\x3e\n\x3c\/html\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e\x26lt;!DOCTYPE html\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/\/cdn.bootcss.com\/redux\/3.5.2\/redux.min.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehead\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/** Action Creators *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einc\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27INCREMENT\x27\x3c\/span\x3e };\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edec\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27DECREMENT\x27\x3c\/span\x3e };\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estate, action\x3c\/span\x3e) \x3c\/span\x3e{\n  state = state || { \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e };\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27INCREMENT\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: state.counter \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e };\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27DECREMENT\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3ecounter\x3c\/span\x3e: state.counter - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e };\n    \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e state;\n  }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eprintStateMiddleware\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emiddlewareAPI\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27dispatch 前：\x27\x3c\/span\x3e, middlewareAPI.getState());\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e returnValue = dispatch(action);\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27dispatch 后：\x27\x3c\/span\x3e, middlewareAPI.getState(), \x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e returnValue;\n    };\n  };\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e enhancedCreateStore = Redux.applyMiddleware(printStateMiddleware)(Redux.createStore);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e store = enhancedCreateStore(reducer);\n\nstore.dispatch(inc());\nstore.dispatch(inc());\nstore.dispatch(dec());\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebody\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ehtml\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e控制台输出：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22dispatch 前：{ counter: 0 }\ndispatch 后：{ counter: 1 }\n\ndispatch 前：{ counter: 1 }\ndispatch 后：{ counter: 2 }\n\ndispatch 前：{ counter: 2 }\ndispatch 后：{ counter: 1 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3edispatch\x3c\/span\x3e 前：{ \x3cspan class=\x22hljs-attribute\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e }\n\x3cspan class=\x22hljs-selector-tag\x22\x3edispatch\x3c\/span\x3e 后：{ \x3cspan class=\x22hljs-attribute\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e }\n\n\x3cspan class=\x22hljs-selector-tag\x22\x3edispatch\x3c\/span\x3e 前：{ \x3cspan class=\x22hljs-attribute\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e }\n\x3cspan class=\x22hljs-selector-tag\x22\x3edispatch\x3c\/span\x3e 后：{ \x3cspan class=\x22hljs-attribute\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e }\n\n\x3cspan class=\x22hljs-selector-tag\x22\x3edispatch\x3c\/span\x3e 前：{ \x3cspan class=\x22hljs-attribute\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e }\n\x3cspan class=\x22hljs-selector-tag\x22\x3edispatch\x3c\/span\x3e 后：{ \x3cspan class=\x22hljs-attribute\x22\x3ecounter\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e }\x3c\/code\x3e\x3c\/pre\x3e\n\x3chr\x3e\n\x3cp\x3e实际上，上面生成 \x3ccode\x3estore\x3c\/code\x3e 的代码可以更加优雅：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 本代码块记为 code-10 **\/\nvar store = Redux.createStore(\n  reducer,\n  Redux.applyMiddleware(printStateMiddleware)\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 本代码块记为 code-10 **\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e store = Redux.createStore(\n  reducer,\n  Redux.applyMiddleware(printStateMiddleware)\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果有多个中间件以及多个增强器，还可以这样写（请留意序号顺序）：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e重温一下 \x3ccode\x3ecreateStore\x3c\/code\x3e 完整的函数签名：\x3ccode\x3efunction createStore(reducer, preloadedState, enhancer)\x3c\/code\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 本代码块记为 code-11 **\/\nimport { createStore, applyMiddleware, compose } from \x27redux\x27\n\nconst store = createStore(\n  reducer,\n  preloadedState, \/\/ \x3c----- 可选，前后端同构的数据同步\n  compose( \/\/ \x3c------------ 还记得吗？compose 是从右到左的哦！\n    applyMiddleware( \/\/ \x3c-- 这货也是 Store Enhancer 哦！但这是关乎中间件的增强器，必须置于 compose 执行链的最后\n      middleware1,\n      middleware2,\n      middleware3\n    ),\n    enhancer3,\n    enhancer2,\n    enhancer1\n  )\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 本代码块记为 code-11 **\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { createStore, applyMiddleware, compose } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e store = createStore(\n  reducer,\n  preloadedState, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt;----- 可选，前后端同构的数据同步\x3c\/span\x3e\n  compose( \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt;------------ 还记得吗？compose 是从右到左的哦！\x3c\/span\x3e\n    applyMiddleware( \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26lt;-- 这货也是 Store Enhancer 哦！但这是关乎中间件的增强器，必须置于 compose 执行链的最后\x3c\/span\x3e\n      middleware1,\n      middleware2,\n      middleware3\n    ),\n    enhancer3,\n    enhancer2,\n    enhancer1\n  )\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为什么会支持那么多种写法呢？在 \x3ccode\x3ecreateStore\x3c\/code\x3e 的源码分析的开头部分，我省略了一些代码，现在奉上该压轴部分：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/** 本代码块记为 code-12 **\/\nif (typeof preloadedState === \x27function\x27 \x26amp;\x26amp; typeof enhancer === \x27undefined\x27) {\n  \/\/ 这里就是上面 code-10 的情况，只传入 reducer 和 Store Enhancer 这两个参数\n  enhancer = preloadedState\n  preloadedState = undefined\n}\n\nif (typeof enhancer !== \x27undefined\x27) {\n  if (typeof enhancer !== \x27function\x27) {\n    throw new Error(\x27Expected the enhancer to be a function.\x27)\n  }\n  \/\/ 存在 enhancer 就立即执行，返回增强版的 createStore \x3c--------- 记为【锚点 12-1】\n  return enhancer(createStore)(reducer, preloadedState)\n}\n\nif (typeof reducer !== \x27function\x27) {\n  throw new Error(\x27Expected the reducer to be a function.\x27)\n}\n\n\/\/ 除 compose 外，createStore 竟然也在此为我们提供了书写的便利与自由度，实在是太体贴了\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/** 本代码块记为 code-12 **\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e preloadedState === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e enhancer === \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e) {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里就是上面 code-10 的情况，只传入 reducer 和 Store Enhancer 这两个参数\x3c\/span\x3e\n  enhancer = preloadedState\n  preloadedState = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e enhancer !== \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e enhancer !== \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Expected the enhancer to be a function.\x27\x3c\/span\x3e)\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 存在 enhancer 就立即执行，返回增强版的 createStore \x26lt;--------- 记为【锚点 12-1】\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e enhancer(createStore)(reducer, preloadedState)\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e reducer !== \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Expected the reducer to be a function.\x27\x3c\/span\x3e)\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 除 compose 外，createStore 竟然也在此为我们提供了书写的便利与自由度，实在是太体贴了\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果像 \x3ccode\x3ecode-11\x3c\/code\x3e 那样有多个 \x3ccode\x3eenhancer\x3c\/code\x3e，则 \x3ccode\x3ecode-12 【锚点 12-1】\x3c\/code\x3e 中的代码会执行多次  \x3cbr\x3e生成最终的超级增强版 \x3ccode\x3estore\x3c\/code\x3e。最后，奉上 \x3ccode\x3ecode-11\x3c\/code\x3e 中 \x3ccode\x3ecompose\x3c\/code\x3e 内部的执行顺序示意图：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22原 createStore ————\n                  │\n                  ↓\nreturn enhancer1(createStore)(reducer, preloadedState, enhancer2)\n   |\n   ├———————→ createStore 增强版 1\n                    │\n                    ↓\nreturn enhancer2(createStore1)(reducer, preloadedState, enhancer3)\n   |\n   ├———————————→ createStore 增强版 1\x2b2\n                        │\n                        ↓\nreturn enhancer3(createStore1\x2b2)(reducer, preloadedState, applyMiddleware(m1,m2,m3))\n   |\n   ├————————————————————→ createStore 增强版 1\x2b2\x2b3\n                                     │\n                                     ↓\nreturn appleMiddleware(m1,m2,m3)(createStore1\x2b2\x2b3)(reducer, preloadedState)\n   |\n   ├——————————————————————————————————→ 生成最终增强版 store\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode\x3e原 \x3cspan class=\x22hljs-selector-tag\x22\x3ecreateStore\x3c\/span\x3e ————\n                  │\n                  ↓\n\x3cspan class=\x22hljs-selector-tag\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eenhancer1\x3c\/span\x3e(createStore)(reducer, preloadedState, enhancer2)\n   |\n   ├———————→ \x3cspan class=\x22hljs-selector-tag\x22\x3ecreateStore\x3c\/span\x3e 增强版 \x3cspan class=\x22hljs-selector-tag\x22\x3e1\x3c\/span\x3e\n                    │\n                    ↓\n\x3cspan class=\x22hljs-selector-tag\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eenhancer2\x3c\/span\x3e(createStore1)(reducer, preloadedState, enhancer3)\n   |\n   ├———————————→ \x3cspan class=\x22hljs-selector-tag\x22\x3ecreateStore\x3c\/span\x3e 增强版 \x3cspan class=\x22hljs-selector-tag\x22\x3e1\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-selector-tag\x22\x3e2\x3c\/span\x3e\n                        │\n                        ↓\n\x3cspan class=\x22hljs-selector-tag\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eenhancer3\x3c\/span\x3e(createStore1\x2b\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)(reducer, preloadedState, applyMiddleware(m1,m2,m3))\n   |\n   ├————————————————————→ \x3cspan class=\x22hljs-selector-tag\x22\x3ecreateStore\x3c\/span\x3e 增强版 \x3cspan class=\x22hljs-selector-tag\x22\x3e1\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-selector-tag\x22\x3e2\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-selector-tag\x22\x3e3\x3c\/span\x3e\n                                     │\n                                     ↓\n\x3cspan class=\x22hljs-selector-tag\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eappleMiddleware\x3c\/span\x3e(m1,m2,m3)(createStore1\x2b\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e)(reducer, preloadedState)\n   |\n   ├——————————————————————————————————→ 生成最终增强版 \x3cspan class=\x22hljs-selector-tag\x22\x3estore\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3chr\x3e\n\x3ch2 id=\x22articleHeader17\x22\x3e§ 总结\x3c\/h2\x3e\n\x3cp\x3eRedux 有五个 API，分别是：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ecreateStore(reducer, [initialState])\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ecombineReducers(reducers)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eapplyMiddleware(...middlewares)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ebindActionCreators(actionCreators, dispatch)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ecompose(...functions)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3ccode\x3ecreateStore\x3c\/code\x3e 生成的 \x3ccode\x3estore\x3c\/code\x3e 有四个 API，分别是：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3egetState()\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3edispatch(action)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3esubscribe(listener)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ereplaceReducer(nextReducer)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e至此，若您已经理解上述 API 的作用机理，以及中间件与增强器的概念\/区别  \x3cbr\x3e本人将不胜荣幸，不妨点个 \x3ca href=\x22https:\/\/github.com\/kenberkeley\/redux-simple-tutorial\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3estar\x3c\/a\x3e 算是对我的赞赏  \x3cbr\x3e如您对本教程有任何意见或改进的建议，欢迎 \x3ca href=\x22https:\/\/github.com\/kenberkeley\/redux-simple-tutorial\/issues\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eissue\x3c\/a\x3e，我会尽快予您答复\x3c\/p\x3e\n\x3cp\x3e最后奉上 React \x2b Redux \x2b React Router 的简易留言板实例：\x3ca href=\x22https:\/\/github.com\/kenberkeley\/react-demo\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereact-demo\x3c\/a\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e拓展阅读：\x3ca href=\x22https:\/\/github.com\/kenberkeley\/redux-simple-tutorial\/blob\/master\/middleware-onion-model.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e中间件的洋葱模型\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Redux 莞式教程 之 进阶篇</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006701801">https://segmentfault.com/a/1190000006701801</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/fftzu3xv0qk/" target="_blank">https://alili.tech/archive/fftzu3xv0qk/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>