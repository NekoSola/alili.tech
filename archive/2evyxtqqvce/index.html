<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="浅谈Redux（之一)：Middleware原理"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>浅谈Redux（之一)：Middleware原理 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/2evyxtqqvce/",
				"appid": "1613049289050283", 
				"title": "浅谈Redux（之一)：Middleware原理 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-06T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/4hk02duunr7/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/8rqeqi4tz1/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f2evyxtqqvce%2f&text=%e6%b5%85%e8%b0%88Redux%ef%bc%88%e4%b9%8b%e4%b8%80%29%ef%bc%9aMiddleware%e5%8e%9f%e7%90%86"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f2evyxtqqvce%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f2evyxtqqvce%2f&text=%e6%b5%85%e8%b0%88Redux%ef%bc%88%e4%b9%8b%e4%b8%80%29%ef%bc%9aMiddleware%e5%8e%9f%e7%90%86"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f2evyxtqqvce%2f&title=%e6%b5%85%e8%b0%88Redux%ef%bc%88%e4%b9%8b%e4%b8%80%29%ef%bc%9aMiddleware%e5%8e%9f%e7%90%86"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f2evyxtqqvce%2f&is_video=false&description=%e6%b5%85%e8%b0%88Redux%ef%bc%88%e4%b9%8b%e4%b8%80%29%ef%bc%9aMiddleware%e5%8e%9f%e7%90%86"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%b5%85%e8%b0%88Redux%ef%bc%88%e4%b9%8b%e4%b8%80%29%ef%bc%9aMiddleware%e5%8e%9f%e7%90%86&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f2evyxtqqvce%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f2evyxtqqvce%2f&title=%e6%b5%85%e8%b0%88Redux%ef%bc%88%e4%b9%8b%e4%b8%80%29%ef%bc%9aMiddleware%e5%8e%9f%e7%90%86"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2evyxtqqvce%2f&title=%e6%b5%85%e8%b0%88Redux%ef%bc%88%e4%b9%8b%e4%b8%80%29%ef%bc%9aMiddleware%e5%8e%9f%e7%90%86"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2evyxtqqvce%2f&title=%e6%b5%85%e8%b0%88Redux%ef%bc%88%e4%b9%8b%e4%b8%80%29%ef%bc%9aMiddleware%e5%8e%9f%e7%90%86"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f2evyxtqqvce%2f&title=%e6%b5%85%e8%b0%88Redux%ef%bc%88%e4%b9%8b%e4%b8%80%29%ef%bc%9aMiddleware%e5%8e%9f%e7%90%86"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">浅谈Redux（之一)：Middleware原理</h1><div class="meta"><div class="postdate"><time datetime="2019-02-06" itemprop="datePublished">2019-02-06</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3eRedux作为目前最火的\x3ccode\x3eFlux\x3c\/code\x3e模式实现之一，它有很多的点值得研究。今天我们首先来看看它的Middleware。\x3c\/p\x3e\n\x3cp\x3e熟悉\x3ccode\x3eExpress\x3c\/code\x3e或者\x3ccode\x3ekoa\x3c\/code\x3e的朋友对Middleware的概念一定不陌生。例如Express中是这样使用一个中间件的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var app = express();\n\napp.use(function(req, res, next) {\n  console.log(\x27%s %s\x27, req.method, req.url);\n  next();\n});\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = express();\n\napp.use(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, next\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27%s %s\x27\x3c\/span\x3e, req.method, req.url);\n  next();\n});\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eapp.use\x3c\/code\x3e中的方法，可以在其后面的\x3ccode\x3ehttp VERB\x3c\/code\x3e调用之前，对\x3ccode\x3erequest\x3c\/code\x3e对象和\x3ccode\x3eresponse\x3c\/code\x3e对象进行处理，然后通过调用\x3ccode\x3enext\x3c\/code\x3e方法将处理过程转发到下一中间件或者通过返回响应来结束处理过程。（之后有机会的话再写一写\x3ccode\x3eNode\x3c\/code\x3e和\x3ccode\x3eExpress\x3c\/code\x3e）。\x3c\/p\x3e\n\x3cp\x3e我理解的所谓中间件其实就是，通过类似装饰者模式的形式，用代码预处理的方式，保证原本处理问题的函数（或方法）调用不变。\x3c\/p\x3e\n\x3cp\x3eRedux中的中间件可以使得在用户调用\x3ccode\x3estore.dispatch\x3c\/code\x3e之后，先对参数\x3ccode\x3estate\x3c\/code\x3e和\x3ccode\x3eactions\x3c\/code\x3e进行预处理，再让真正的\x3ccode\x3estore.dispatch\x3c\/code\x3e调用，以确保\x3ccode\x3ereducer\x3c\/code\x3e的\x3cem\x3e纯度\x3c\/em\x3e（函数式编程的概念）不变。\x3c\/p\x3e\n\x3cp\x3eRedux中提供了\x3ccode\x3eapplyMiddleware\x3c\/code\x3e方法，它的源码只有十几行，真的是非常精妙。\x3c\/p\x3e\n\x3cp\x3e下面我们就研究一下它的源代码。\x3c\/p\x3e\n\x3cp\x3e\x26lt;!--more--\x26gt;\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3eapplyMiddleware方法\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22applyMiddleware(...middlewares){\n    \n    return next =\x3e (reducer, initialState){\n       \n        var store = next(reducer, initialState),\n            dispatch = store.dispatch,\n            chain = [],\n            middlewareAPI = {\n                getState: store.getState,\n                dispatch: (action) =\x3e dispatch(action)\n            };\n            \n            chain = middlewares.map(middleware =\x3e\n                middleware(middlewareAPI));\n            \n            dispatch = compose(...chain, store.dispatch);\n            \n            return {\n                ...store,\n                dispatch\n            }\n    }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3eapplyMiddleware(...middlewares){\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e =\x26gt;\x3c\/span\x3e (reducer, initialState){\n       \n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e store = next(reducer, initialState),\n            dispatch = store.dispatch,\n            chain = [],\n            middlewareAPI = {\n                \x3cspan class=\x22hljs-attr\x22\x3egetState\x3c\/span\x3e: store.getState,\n                \x3cspan class=\x22hljs-attr\x22\x3edispatch\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e dispatch(action)\n            };\n            \n            chain = middlewares.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3emiddleware\x3c\/span\x3e =\x26gt;\x3c\/span\x3e\n                middleware(middlewareAPI));\n            \n            dispatch = compose(...chain, store.dispatch);\n            \n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n                ...store,\n                dispatch\n            }\n    }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码的意思就是，\x3ccode\x3eappleMiddleware\x3c\/code\x3e方法接收一个\x3ccode\x3eMiddleware\x3c\/code\x3e列表，以\x3ccode\x3eapplyMiddleware(middleware1, middleware2, middleware3)\x3c\/code\x3e的形式调用(参见ES6的rest参数语法)，然后再将创建store的方法传入（我想这个原因是Redux不仅仅可以在React中使用，也可以适用于任何Flux模式的框架和库），然后就会发生神奇的事情。\x3c\/p\x3e\n\x3cp\x3e这两次调用(假设：\x3ccode\x3evar newCreateSore = applyMiddleware(middleware1, middleware2)(createStore)\x3c\/code\x3e）会产生一个新的创建Store的方法，但是它改造了原本Store的\x3ccode\x3edispatch\x3c\/code\x3e方法，让这个\x3ccode\x3edispatch\x3c\/code\x3e可以做原生\x3ccode\x3edispatch\x3c\/code\x3e不能做的事情，这样我们就可以订制\x3ccode\x3edispatch\x3c\/code\x3e的行为，从而实现了\x3cem\x3e中间件\x3c\/em\x3e的概念。\x3c\/p\x3e\n\x3cp\x3e故而，\x3ccode\x3enewCreateStore\x3c\/code\x3e将作为\x3ccode\x3ecreateStore\x3c\/code\x3e的替代方法，使用\x3ccode\x3enewCreateStore\x3c\/code\x3e会产生带有中间件的store。\x3c\/p\x3e\n\x3cp\x3e在最内层是如何实现中间件的调用的呢？让我们继续研究。\x3c\/p\x3e\n\x3cp\x3e首先我们用传入的\x3ccode\x3enext\x3c\/code\x3e（一个可以创建Store的函数），创建一个原始的store，并且取出其原生的\x3ccode\x3estore.dispatch\x3c\/code\x3e方法和\x3ccode\x3estore.getState\x3c\/code\x3e方法成为一个对象，作为参数传入\x3cem\x3e中间件\x3c\/em\x3e函数中，让其第一次包装这个类似store的对象，并返回新的函数。\x3c\/p\x3e\n\x3cp\x3e然后我们使用\x3ccode\x3ecompose\x3c\/code\x3e函数，将这些包装过后的返回的函数一个接一个的嵌套调用。\x3c\/p\x3e\n\x3cp\x3e这里补充一下compose的概念：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e假设有若干函数f1, f2, f3...,compose指的是类似f1(f2(f3(x)))的调用方式，这在函数式编程中很常见。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e（这里的\x3ccode\x3ecompose\x3c\/code\x3e函数是redux中的一个方法，这里我们不上它的源码，有兴趣的朋友可以直接看源码。）\x3c\/p\x3e\n\x3cp\x3e被嵌套在compose最内层的是原生的\x3ccode\x3estore.dispatch\x3c\/code\x3e方法，这里我们就一层层的将其包装，在中间件函数中，我们可以利用store的其他方法，比如\x3ccode\x3estore.dispatch\x3c\/code\x3e和\x3ccode\x3estore.getState\x3c\/code\x3e，做一些有意思的事情，比如实现一个记录\x3ccode\x3estate\x3c\/code\x3e改变的日志中间件。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e中间件函数\x3c\/h2\x3e\n\x3cp\x3e从上面的分析中，我们不难写一个符合要求的中间件函数。\x3c\/p\x3e\n\x3cp\x3e首先中间件函数需要接受一个\x3ccode\x3emiddlewareAPI\x3c\/code\x3e，如果使用ES6的语法，这里可以看成是接收一个\x3ccode\x3e{dispatch, getState}\x3c\/code\x3e的形式的参数，这样我们就能在内层使用这两个方法。\x3c\/p\x3e\n\x3cp\x3e接收\x3ccode\x3emiddlewareAPI\x3c\/code\x3e参数之后，中间件函数返回另一个函数（为方便后面解释，假设返回的函数为\x3ccode\x3edispatch n\x3c\/code\x3e）。这个函数既然要用于compose，也就是说它接收一个形式为\x3ccode\x3edispatch\x3c\/code\x3e的函数，对其一层层嵌套（形式为\x3ccode\x3edispatch1(dispatch2(dispatch3(dispatch)))\x3c\/code\x3e）。在其内部我们可以在之前的\x3ccode\x3edispatch\x3c\/code\x3e调用之前和之后，进行一些逻辑的处理。\x3c\/p\x3e\n\x3cp\x3e写一个简单的记录state日志的中间件如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var middlewareLogger = ({getState}) =\x3e next =\x3e action =\x3e {\n    console.log(getState());\n    next(action);\n    console.log(getState());\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e middlewareLogger = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{getState}\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e next =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(getState());\n    next(action);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(getState());\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e怎么样，是不是特别简单？\x3c\/p\x3e\n\x3cp\x3e再写一个异步操作的中间件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const readyStatePromise = store =\x3e next =\x3e action =\x3e {\n  if (!action.promise) {\n    return next(action)\n  }\n\n  function makeAction(ready, data) {\n    let newAction = Object.assign({}, action, { ready }, data)\n    delete newAction.promise\n    return newAction\n  }\n\n  next(makeAction(false))\n  return action.promise.then(\n    result =\x3e next(makeAction(true, { result })),\n    error =\x3e next(makeAction(true, { error }))\n  )\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e readyStatePromise = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estore\x3c\/span\x3e =\x26gt;\x3c\/span\x3e next =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!action.promise) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(action)\n  }\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emakeAction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eready, data\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e newAction = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.assign({}, action, { ready }, data)\n    \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e newAction.promise\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e newAction\n  }\n\n  next(makeAction(\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e))\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e action.promise.then(\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e =\x26gt;\x3c\/span\x3e next(makeAction(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e, { result })),\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e =\x26gt;\x3c\/span\x3e next(makeAction(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e, { error }))\n  )\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个中间件让你可以发起带有一个 { promise } 属性的特殊 action。这个 middleware 会在开始时发起一个 action，并在这个 \x3ccode\x3epromise\x3c\/code\x3e resolve 时发起另一个成功（或失败）的 action。为了方便起见，\x3ccode\x3edispatch\x3c\/code\x3e 会返回这个 promise 让调用者可以等待。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e结束\x3c\/h2\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>浅谈Redux（之一)：Middleware原理</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006149647">https://segmentfault.com/a/1190000006149647</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/2evyxtqqvce/" target="_blank">https://alili.tech/archive/2evyxtqqvce/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>