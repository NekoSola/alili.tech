<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Stomp Over Websocket文档"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Stomp Over Websocket文档 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/u8kafrx7x4a/",
				"appid": "1613049289050283", 
				"title": "Stomp Over Websocket文档 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-05T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/j8ivsbl0u5/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/9b97vklvudf/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fu8kafrx7x4a%2f&text=Stomp%20Over%20Websocket%e6%96%87%e6%a1%a3"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fu8kafrx7x4a%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fu8kafrx7x4a%2f&text=Stomp%20Over%20Websocket%e6%96%87%e6%a1%a3"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fu8kafrx7x4a%2f&title=Stomp%20Over%20Websocket%e6%96%87%e6%a1%a3"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fu8kafrx7x4a%2f&is_video=false&description=Stomp%20Over%20Websocket%e6%96%87%e6%a1%a3"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Stomp%20Over%20Websocket%e6%96%87%e6%a1%a3&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fu8kafrx7x4a%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fu8kafrx7x4a%2f&title=Stomp%20Over%20Websocket%e6%96%87%e6%a1%a3"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fu8kafrx7x4a%2f&title=Stomp%20Over%20Websocket%e6%96%87%e6%a1%a3"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fu8kafrx7x4a%2f&title=Stomp%20Over%20Websocket%e6%96%87%e6%a1%a3"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fu8kafrx7x4a%2f&title=Stomp%20Over%20Websocket%e6%96%87%e6%a1%a3"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Stomp Over Websocket文档</h1><div class="meta"><div class="postdate"><time datetime="2019-02-05" itemprop="datePublished">2019-02-05</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e前两天整理了\x3ccode\x3ewebsocket\x3c\/code\x3e的资料，今天就把上次没说完的\x3ccode\x3eStomp.js\x3c\/code\x3e好好说一说~  \x3cbr\x3eStomp Over Webscoket参考文档：\x3ca href=\x22http:\/\/jmesnil.net\/stomp-websocket\/doc\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/jmesnil.net\/stomp-webs...\x3c\/a\x3e  \x3cbr\x3e本文为参考文档的部分翻译，技术不佳，如有失误请指正。\x3cbr\x3e本文转载自个人博客：\x3ca href=\x22http:\/\/lsxj615.com\/2016\/08\/17\/STOMP-over-WebSocket\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/lsxj615.com\/2016\/08\/17...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e什么是Stomp\x3c\/h2\x3e\n\x3cblockquote\x3eSTOMP即Simple (or Streaming) Text Orientated Messaging Protocol，简单(流)文本定向消息协议，它提供了一个可互操作的连接格式，允许STOMP客户端与任意STOMP消息代理（Broker）进行交互。STOMP协议由于设计简单，易于开发客户端，因此在多种语言和多种平台上得到广泛地应用。\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e协议支持\x3c\/h2\x3e\n\x3cp\x3e该库支持多种版本的STOMP协议：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/stomp.github.io\/stomp-specification-1.0.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eSTOMP 1.0\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e[STOMP 1.1]\x3ca\x3e2\x3c\/a\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e下载STOMP.JS\x3c\/h2\x3e\n\x3cp\x3e你可以下载 \x3ca href=\x22https:\/\/raw.githubusercontent.com\/jmesnil\/stomp-websocket\/master\/lib\/stomp.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3estomp.js\x3c\/a\x3e 并在你自己的WEB应用程序中使用。\x3cbr\x3e提供了\x3ca href=\x22https:\/\/raw.githubusercontent.com\/jmesnil\/stomp-websocket\/master\/lib\/stomp.min.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e多种版本\x3c\/a\x3e也可以直接用于生产。\x3cbr\x3e这个js文件由CoffeeScript文件构建，请查看\x3ca href=\x22http:\/\/jmesnil.net\/stomp-websocket\/doc\/#contribute\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eContribute\x3c\/a\x3e部分下载源码或浏览 \x3ca href=\x22http:\/\/jmesnil.net\/stomp-websocket\/doc\/stomp.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eannote source code\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e服务端要求\x3c\/h2\x3e\n\x3cp\x3e这个库不是单纯的Stomp 客户端。它旨在WebSockets上运行而不是TCP。基本上，WebSocket协议需要在浏览器客户端和服务端之间进行握手，确保浏览器的“same-origin”（同源）安全模型仍然有效。\x3c\/p\x3e\n\x3cp\x3e这意味着该库不能连接常规的STOMP代理，因为Websocket初始化的握手不是STOMP协议的一部分，他们不能理解从而会拒绝连接。\x3c\/p\x3e\n\x3cp\x3e有一些正在进行的工作添加了WebSocket支持STOMP代理，从而他们可以在WebSocket协议上接受STOMP连接。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3eHornetQ\x3c\/h3\x3e\n\x3cp\x3eHornetQ是由Red Hat and JBoss创立的开源消息系统.\x3c\/p\x3e\n\x3cp\x3e要使HornetQ支持STOMP Over WebSocket，下载最新版本并按照下列步骤执行：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ cd hornetq-x.y.z\/examples\/jms\/stomp-websockets\n$ mvn clean install\n...\nINFO: HQ221020: Started Netty Acceptor version 3.6.2.Final-c0d783c         localhost:61614 for STOMP_WS protocol\nApr 15, 2013 1:15:33 PM org.hornetq.core.server.impl.HornetQServerImpl$SharedStoreLiveActivation run\nINFO: HQ221007: Server is now live\nApr 15, 2013 1:15:33 PM org.hornetq.core.server.impl.HornetQServerImpl start\nINFO: HQ221001: HornetQ Server version 2.3.0.CR2 (black\x27n\x27yellow2, 123) [c9e29e45-a5bd-11e2-976a-b3fef7ceb5df]\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e$ cd hornetq-x\x3cspan class=\x22hljs-selector-class\x22\x3e.y\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.z\x3c\/span\x3e\/examples\/jms\/stomp-websockets\n$ mvn clean install\n...\nINFO: HQ221020: Started Netty Acceptor version \x3cspan class=\x22hljs-number\x22\x3e3.6\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.Final-c0d783c\x3c\/span\x3e         localhost:\x3cspan class=\x22hljs-number\x22\x3e61614\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e STOMP_WS protocol\nApr \x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2013\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e33\x3c\/span\x3e PM org\x3cspan class=\x22hljs-selector-class\x22\x3e.hornetq\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.core\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.server\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.impl\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.HornetQServerImpl\x3c\/span\x3e\x3cspan class=\x22hljs-variable\x22\x3e$SharedStoreLiveActivation\x3c\/span\x3e run\nINFO: HQ221007: Server is now live\nApr \x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2013\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e33\x3c\/span\x3e PM org\x3cspan class=\x22hljs-selector-class\x22\x3e.hornetq\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.core\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.server\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.impl\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.HornetQServerImpl\x3c\/span\x3e start\nINFO: HQ221001: HornetQ Server version \x3cspan class=\x22hljs-number\x22\x3e2.3\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.CR2\x3c\/span\x3e (black\x3cspan class=\x22hljs-string\x22\x3e\x27n\x27\x3c\/span\x3eyellow2, \x3cspan class=\x22hljs-number\x22\x3e123\x3c\/span\x3e) [c9e29e45-a5bd-\x3cspan class=\x22hljs-number\x22\x3e11\x3c\/span\x3ee2-\x3cspan class=\x22hljs-number\x22\x3e976\x3c\/span\x3ea-b3fef7ceb5df]\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e此时HornetQ已经开启了，并且61614在端口监听STOMP over WebSocket\x3cbr\x3e它从URL为ws:\/\/localhost:61614\/stomp 接受WebSocket的连接。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/docs.jboss.org\/hornetq\/2.3.0.CR2\/docs\/user-manual\/html\/interoperability.html#stomp.websockets\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e配置文档\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eActiveMQ\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/activemq.apache.org\/websockets.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e配置文档\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eActiveMQ Apollo\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/activemq.apache.org\/apollo\/documentation\/user-manual.html#WebSocket_Transports\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e配置文档\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3eRabbitMQ\x3c\/h3\x3e\n\x3cp\x3e\x3ca\x3e配置文档\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3eStilts \x26amp; Torquebox\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/stilts.projectodd.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eStilts\x3c\/a\x3e 是一个STOMP原生的消息框架。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/torquebox.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTorqueBox\x3c\/a\x3e 使用Stilts去提供它的\x3ca href=\x22http:\/\/torquebox.org\/documentation\/2.1.2\/stomp.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebsockets and STOMP stack\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3eStomp API\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3eSTOMP 帧（Frame）\x3c\/h3\x3e\n\x3cp\x3eSTOMP Over WebSocket 提供了一个直接从\x3ccode\x3eStomp Frame\x3c\/code\x3e映射到 Javascript 对象的方式。  \x3cbr\x3e\x3ccode\x3eStomp Frame\x3c\/code\x3e帧格式如下：\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3eProperty\x3c\/th\x3e\n\x3cth align=\x22center\x22\x3eType\x3c\/th\x3e\n\x3cth align=\x22right\x22\x3eNotes\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3ecommand\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3eString\x3c\/td\x3e\n\x3ctd align=\x22right\x22\x3ename of the frame (\x22CONNECT\x22, \x22SEND\x22, etc.)\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eheaders\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3eJavaScript object\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3ebody\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3eString\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e\x3ccode\x3ecommand\x3c\/code\x3e和\x3ccode\x3eheaders\x3c\/code\x3e属性始终会被定义，不过当这个\x3ccode\x3eframe\x3c\/code\x3e没有头部时，\x3ccode\x3eheaders\x3c\/code\x3e可以为空。若这个\x3ccode\x3eframe\x3c\/code\x3e没有\x3ccode\x3ebody\x3c\/code\x3e，\x3ccode\x3ebody\x3c\/code\x3e的值可以为\x3ccode\x3enull\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e创建\x3ccode\x3eSTOMP\x3c\/code\x3e客户端\x3c\/h3\x3e\n\x3ch4\x3e在web浏览器中使用普通的Web Socket\x3c\/h4\x3e\n\x3cp\x3eSTOMP javascript 客户端会使用\x3ccode\x3ews:\/\/\x3c\/code\x3e的URL与STOMP 服务端进行交互。\x3c\/p\x3e\n\x3cp\x3e为了创建一个STOMP客户端js对象，你需要使用\x3ccode\x3eStomp.client(url)\x3c\/code\x3e，而这个URL连接着服务端的WebSocket的代理：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var url = \x26quot;ws:\/\/localhost:61614\/stomp\x26quot;;\nvar client = Stomp.client(url);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-attribute\x22\x3evar url\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x22ws:\/\/localhost:61614\/stomp\x22\x3c\/span\x3e;\n\x3cspan class=\x22hljs-attribute\x22\x3evar client\x3c\/span\x3e = Stomp.client(url);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eStomp.client(url, protocols)\x3c\/code\x3e也可以用来覆盖默认的\x3ccode\x3esubprotocols\x3c\/code\x3e。第二个参数可以是一个字符串或一个字符串数组去指定多个\x3ccode\x3esubprotocols\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch4\x3e在web浏览器中使用定制的WebSocket\x3c\/h4\x3e\n\x3cp\x3e浏览器提供了不同的WebSocket的协议，一些老的浏览器不支持WebSocket的脚本或者使用别的名字。默认下，\x3ccode\x3estomp.js\x3c\/code\x3e会使用浏览器原生的\x3ccode\x3eWebSocket class\x3c\/code\x3e去创建WebSocket。\x3c\/p\x3e\n\x3cp\x3e但是利用\x3ccode\x3eStomp.over(ws)\x3c\/code\x3e这个方法可以使用其他类型的WebSockets。这个方法得到一个满足WebSocket定义的对象。\x3c\/p\x3e\n\x3cp\x3e例如，可以使用由\x3ccode\x3eSockJS\x3c\/code\x3e实现的Websocket：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript src=\x26quot;http:\/\/cdn.sockjs.org\/sockjs-0.3.min.js\x26quot;\x3e\x3c\/script\x3e\n\x3cscript\x3e\n    \/\/ use SockJS implementation instead of the browser\x27s native implementation\n    var ws = new SockJS(url);\n    var client = Stomp.over(ws);\n    [...]\n\x3c\/script\x3e\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/cdn.sockjs.org\/sockjs-0.3.min.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22actionscript\x22\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ use SockJS implementation instead of the browser\x27s native implementation\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ws = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e SockJS(url);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e client = Stomp.over(ws);\n    [...]\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果使用原生的Websockets就使用\x3ccode\x3eStomp.client(url)\x3c\/code\x3e，如果需要使用其他类型的Websocket（例如由SockJS包装的Websocket）就使用\x3ccode\x3eStomp.over(ws)\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e除了初始化有差别，Stomp API在这两种方式下是相同的。\x3c\/p\x3e\n\x3ch4\x3e在\x3ccode\x3enode.js\x3c\/code\x3e程序中\x3c\/h4\x3e\n\x3cp\x3e通过\x3ccode\x3estompjs npm package\x3c\/code\x3e同样也可以在\x3ccode\x3enode.js\x3c\/code\x3e程序中使用这个库。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ npm install stompjs\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cmake\x22\x3e\x3ccode\x3e$ npm \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e stompjs\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在node.js\x3ccode\x3eapp\x3c\/code\x3e中, \x3ccode\x3erequire\x3c\/code\x3e这个模块:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var Stomp = require(\x27stompjs\x27);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-attribute\x22\x3evar Stomp\x3c\/span\x3e = require(\x3cspan class=\x22hljs-string\x22\x3e\x27stompjs\x27\x3c\/span\x3e);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了与建立在TCP socket的STOMP-broker连接，使用\x3ccode\x3eStomp.overTCP(host, port)\x3c\/code\x3e方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var client = Stomp.overTCP(\x27localhost\x27, 61613);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-attribute\x22\x3evar client\x3c\/span\x3e = Stomp.overTCP(\x3cspan class=\x22hljs-string\x22\x3e\x27localhost\x27\x3c\/span\x3e, 61613);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了与建立在Web Socket的STOMP broker连接，使用\x3ccode\x3eStomp.overWS(url)\x3c\/code\x3e方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var client = Stomp.overWS(\x27ws:\/\/localhost:61614\/stomp\x27);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-attribute\x22\x3evar client\x3c\/span\x3e = Stomp.overWS(\x3cspan class=\x22hljs-string\x22\x3e\x27ws:\/\/localhost:61614\/stomp\x27\x3c\/span\x3e);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e除了初始化不同，无论是浏览器还是node.js环境下，Stomp API都是相同的。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e连接服务端\x3c\/h3\x3e\n\x3cp\x3e一旦Stomp 客户端建立了，必须调用它的\x3ccode\x3econnect()\x3c\/code\x3e方法去连接，从而Stomp服务端进行验证。这个方法需要两个参数，用户的登录和密码凭证。\x3c\/p\x3e\n\x3cp\x3e这种情况下，客户端会使用Websocket打开连接，并发送一个\x3ccode\x3eCONNECT frame\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e这个连接是异步进行的：你不能保证当这个方法返回时是有效连接的。为了知道连接的结果，你需要一个回调函数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var connect_callback = function() {\n    \/\/ called back after the client is connected and authenticated to the STOMP server\n};\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e connect_callback = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ called back after the client is connected and authenticated to the STOMP server\x3c\/span\x3e\n};\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但是如果连接失败会发生什么呢？\x3ccode\x3econnect()\x3c\/code\x3e方法接受一个可选的参数(\x3ccode\x3eerror_callback\x3c\/code\x3e)，当客户端不能连接上服务端时，这个回调函数\x3ccode\x3eerror_callback\x3c\/code\x3e会被调用，该函数的参数为对应的错误对象。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var error_callback = function(error) {\n    \/\/ display the error\x27s message header:\n    alert(error.headers.message);\n};\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e error_callback = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(error)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ display the error\x27s message header:\x3c\/span\x3e\n    alert(error.headers.message);\n};\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在大多数情况下，\x3ccode\x3econnect()\x3c\/code\x3e方法可接受不同数量的参数来提供简单的API：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22client.connect(login, passcode, connectCallback);\nclient.connect(login, passcode, connectCallback, errorCallback);\nclient.connect(login, passcode, connectCallback, errorCallback, host);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs arduino\x22\x3e\x3ccode\x3eclient.\x3cspan class=\x22hljs-built_in\x22\x3econnect\x3c\/span\x3e(login, passcode, connectCallback);\nclient.\x3cspan class=\x22hljs-built_in\x22\x3econnect\x3c\/span\x3e(login, passcode, connectCallback, errorCallback);\nclient.\x3cspan class=\x22hljs-built_in\x22\x3econnect\x3c\/span\x3e(login, passcode, connectCallback, errorCallback, host);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3elogin\x3c\/code\x3e和\x3ccode\x3epasscode\x3c\/code\x3e是strings，\x3ccode\x3econnectCallback\x3c\/code\x3e和\x3ccode\x3eerrorCallback\x3c\/code\x3e则是functions。（有些brokers（代理）还需要传递一个\x3ccode\x3ehost\x3c\/code\x3e（String类型）参数。）\x3c\/p\x3e\n\x3cp\x3e如果你需要附加一个\x3ccode\x3eheaders\x3c\/code\x3e头部，\x3ccode\x3econnect\x3c\/code\x3e方法还接受其他两种形式的参数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22client.connect(headers, connectCallback);\nclient.connect(headers, connectCallback, errorCallback);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs arduino\x22\x3e\x3ccode\x3eclient.\x3cspan class=\x22hljs-built_in\x22\x3econnect\x3c\/span\x3e(headers, connectCallback);\nclient.\x3cspan class=\x22hljs-built_in\x22\x3econnect\x3c\/span\x3e(headers, connectCallback, errorCallback);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eheader\x3c\/code\x3e是\x3ccode\x3emap\x3c\/code\x3e形式，\x3ccode\x3econnectCallback\x3c\/code\x3e和\x3ccode\x3eerrorCallback\x3c\/code\x3e为functions。\x3c\/p\x3e\n\x3cp\x3e需要注意：如果你使用上述这种方式，你需要自行在\x3ccode\x3eheaders\x3c\/code\x3e添加\x3ccode\x3elogin\x3c\/code\x3e,\x3ccode\x3epasscode\x3c\/code\x3e（甚至\x3ccode\x3ehost\x3c\/code\x3e）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var headers = {\n    login: \x27mylogin\x27,\n    passcode: \x27mypasscode\x27,\n    \/\/ additional header\n    \x27client-id\x27: \x27my-client-id\x27\n};\nclient.connect(headers, connectCallback);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e headers = {\n    login: \x3cspan class=\x22hljs-string\x22\x3e\x27mylogin\x27\x3c\/span\x3e,\n    passcode: \x3cspan class=\x22hljs-string\x22\x3e\x27mypasscode\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ additional header\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x27client-id\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27my-client-id\x27\x3c\/span\x3e\n};\nclient.connect(headers, connectCallback);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e断开连接时，调用\x3ccode\x3edisconnect\x3c\/code\x3e方法，这个方法也是异步的，当断开成功后会接收一个额外的回调函数的参数。如下所示。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22client.disconnect(function() {\n    alert(\x26quot;See you next time!\x26quot;);\n};\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3eclient.disconnect(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    alert(\x3cspan class=\x22hljs-string\x22\x3e\x22See you next time!\x22\x3c\/span\x3e);\n};\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当客户端与服务端断开连接，就不会再发送或接收消息了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3eHeart-beating\x3c\/h3\x3e\n\x3cp\x3e如果STOMP broker(代理)接收STOMP 1.1版本的帧，\x3ccode\x3eheart-beating\x3c\/code\x3e是默认启用的。\x3ccode\x3eheart-beating\x3c\/code\x3e也就是频率，\x3ccode\x3eincoming\x3c\/code\x3e是接收频率，\x3ccode\x3eoutgoing\x3c\/code\x3e是发送频率。\x3c\/p\x3e\n\x3cp\x3e通过改变\x3ccode\x3eincoming\x3c\/code\x3e和\x3ccode\x3eoutgoing\x3c\/code\x3e可以更改客户端的\x3ccode\x3eheart-beating\x3c\/code\x3e(默认为10000ms)：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22client.heartbeat.outgoing = 20000; \n\/\/ client will send heartbeats every 20000ms\nclient.heartbeat.incoming = 0;\n\/\/ client does not want to receive heartbeats\n\/\/ from the server\n\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs axapta\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclient\x3c\/span\x3e.heartbeat.outgoing = \x3cspan class=\x22hljs-number\x22\x3e20000\x3c\/span\x3e; \n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ client will send heartbeats every 20000ms\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eclient\x3c\/span\x3e.heartbeat.incoming = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ client does not want to receive heartbeats\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ from the server\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eheart-beating\x3c\/code\x3e是利用\x3ccode\x3ewindow.setInterval()\x3c\/code\x3e去规律地发送\x3ccode\x3eheart-beats\x3c\/code\x3e或者检查服务端的\x3ccode\x3eheart-beats\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e发送消息\x3c\/h3\x3e\n\x3cp\x3e当客户端与服务端连接成功后，可以调用\x3ccode\x3esend()\x3c\/code\x3e来发送STOMP消息。这个方法必须有一个参数，用来描述对应的STOMP的目的地。另外可以有两个可选的参数：\x3ccode\x3eheaders\x3c\/code\x3e，\x3ccode\x3eobject\x3c\/code\x3e类型包含额外的信息头部；\x3ccode\x3ebody\x3c\/code\x3e，一个String类型的参数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22client.send(\x26quot;\/queue\/test\x26quot;, {priority: 9}, \x26quot;Hello, STOMP\x26quot;);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs autoit\x22\x3e\x3ccode\x3eclient.\x3cspan class=\x22hljs-built_in\x22\x3esend\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22\/queue\/test\x22\x3c\/span\x3e, {priority: \x3cspan class=\x22hljs-number\x22\x3e9\x3c\/span\x3e}, \x3cspan class=\x22hljs-string\x22\x3e\x22Hello, STOMP\x22\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eclient会发送一个STOMP发送帧给\x3ccode\x3e\/queue\/test\x3c\/code\x3e，这个帧包含一个设置了\x3ccode\x3epriority\x3c\/code\x3e为9的\x3ccode\x3eheader\x3c\/code\x3e和内容为“Hello, STOMP”的\x3ccode\x3ebody\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e如果你想发送一个有\x3ccode\x3ebody\x3c\/code\x3e的信息，也必须传递\x3ccode\x3eheaders\x3c\/code\x3e参数。如果没有\x3ccode\x3eheaders\x3c\/code\x3e需要传递，那么就传\x3ccode\x3e{}\x3c\/code\x3e即可，如下所示：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22client.send(destination, {}, body);\n\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3eclient\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.send\x3c\/span\x3e(\x3cspan class=\x22hljs-selector-tag\x22\x3edestination\x3c\/span\x3e, {}, \x3cspan class=\x22hljs-selector-tag\x22\x3ebody\x3c\/span\x3e);\n\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader16\x22\x3e订阅（Subscribe）和接收（receive）消息\x3c\/h3\x3e\n\x3cp\x3e为了在浏览器中接收消息，STOMP客户端必须先订阅一个目的地\x3ccode\x3edestination\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e你可以使用\x3ccode\x3esubscribe()\x3c\/code\x3e去订阅。这个方法有2个必需的参数：目的地(\x3ccode\x3edestination\x3c\/code\x3e)，回调函数(\x3ccode\x3ecallback\x3c\/code\x3e)；还有一个可选的参数\x3ccode\x3eheaders\x3c\/code\x3e。其中\x3ccode\x3edestination\x3c\/code\x3e是String类型，对应目的地，回调函数是伴随着一个参数的\x3ccode\x3efunction\x3c\/code\x3e类型。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var subscription = client.subscribe(\x26quot;\/queue\/test\x26quot;, callback);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-attribute\x22\x3evar subscription\x3c\/span\x3e = client.subscribe(\x3cspan class=\x22hljs-string\x22\x3e\x22\/queue\/test\x22\x3c\/span\x3e, callback);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3esubscribe()\x3c\/code\x3e方法返回一个\x3ccode\x3eobject\x3c\/code\x3e，这个\x3ccode\x3eobject\x3c\/code\x3e包含一个\x3ccode\x3eid\x3c\/code\x3e属性，对应这个这个客户端的订阅ID。而\x3ccode\x3eunsubscribe()\x3c\/code\x3e可以用来取消客户端对这个目的地\x3ccode\x3edestination\x3c\/code\x3e的订阅。\x3c\/p\x3e\n\x3cp\x3e默认情况下，如果没有在\x3ccode\x3eheaders\x3c\/code\x3e额外添加，这个库会默认构建一个独一无二的\x3ccode\x3eID\x3c\/code\x3e。在传递\x3ccode\x3eheaders\x3c\/code\x3e这个参数时，可以使用你自己的\x3ccode\x3eID\x3c\/code\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var mysubid = \x27...\x27;\nvar subscription = client.subscribe(destination, callback, { id: mysubid });\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-attribute\x22\x3evar mysubid\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-attribute\x22\x3evar subscription\x3c\/span\x3e = client.subscribe(destination, callback, { id: mysubid });\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个客户端会向服务端发送一个STOMP订阅帧（\x3ccode\x3eSUBSCRIBE frame\x3c\/code\x3e）并注册回调事件。每次服务端向客户端发送消息时，客户端都会轮流调用回调函数，参数为对应消息的STOMP帧对象（\x3ccode\x3eFrame object\x3c\/code\x3e）。如下所示：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22callback = function(message) {\n    \/\/ called when the client receives a STOMP message from the server\n    if (message.body) {\n        alert(\x26quot;got message with body \x26quot; \x2b message.body)\n    } else {\n        alert(\x26quot;got empty message\x26quot;);\n    }\n});\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs protobuf\x22\x3e\x3ccode\x3ecallback = function(\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3emessage\x3c\/span\x3e) {\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ called when the client receives a STOMP message from the server\x3c\/span\x3e\n    if (\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3emessage\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3ebody\x3c\/span\x3e) \x3c\/span\x3e{\n        alert(\x3cspan class=\x22hljs-string\x22\x3e\x22got message with body \x22\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3emessage\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3ebody\x3c\/span\x3e)\n    } else \x3c\/span\x3e{\n        alert(\x3cspan class=\x22hljs-string\x22\x3e\x22got empty message\x22\x3c\/span\x3e);\n    }\n});\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3esubscribe()\x3c\/code\x3e方法，接受一个可选的\x3ccode\x3eheaders\x3c\/code\x3e参数用来标识附加的头部。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var headers = {ack: \x27client\x27, \x27selector\x27: \x26quot;location = \x27Europe\x27\x26quot;};\n\nclient.subscribe(\x26quot;\/queue\/test\x26quot;, message_callback, headers);\n\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e headers = {ack: \x3cspan class=\x22hljs-string\x22\x3e\x27client\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27selector\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22location = \x27Europe\x27\x22\x3c\/span\x3e};\n\nclient.subscribe(\x3cspan class=\x22hljs-string\x22\x3e\x22\/queue\/test\x22\x3c\/span\x3e, message_callback, headers);\n\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个客户端指定了它会确认接收的信息，只接收符合这个\x3ccode\x3eselector : location = \x27Europe\x27\x3c\/code\x3e的消息。\x3c\/p\x3e\n\x3cp\x3e如果想让客户端订阅多个目的地，你可以在接收所有信息的时候调用相同的回调函数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22onmessage = function(message) {\n    \/\/ called every time the client receives a message\n}\nvar sub1 = client.subscribe(\x26quot;queue\/test\x26quot;, onmessage);\nvar sub2 = client.subscribe(\x26quot;queue\/another\x26quot;, onmessage)\n\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3eonmessage = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(message)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ called every time the client receives a message\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sub1 = client.subscribe(\x3cspan class=\x22hljs-string\x22\x3e\x22queue\/test\x22\x3c\/span\x3e, onmessage);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sub2 = client.subscribe(\x3cspan class=\x22hljs-string\x22\x3e\x22queue\/another\x22\x3c\/span\x3e, onmessage)\n\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果要中止接收消息，客户端可以在\x3ccode\x3esubscribe()\x3c\/code\x3e返回的\x3ccode\x3eobject\x3c\/code\x3e对象调用\x3ccode\x3eunsubscribe()\x3c\/code\x3e来结束接收。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var subscription = client.subscribe(...);\n\n...\n\nsubscription.unsubscribe();\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs armasm\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-symbol\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3esubscription \x3c\/span\x3e= client.\x3cspan class=\x22hljs-keyword\x22\x3esubscribe(...);\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-symbol\x22\x3e...\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3esubscription.unsubscribe();\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader17\x22\x3e支持JSON\x3c\/h3\x3e\n\x3cp\x3eSTOMP消息的\x3ccode\x3ebody\x3c\/code\x3e必须为字符串。如果你需要发送\/接收\x3ccode\x3eJSON\x3c\/code\x3e对象，你可以使用\x3ccode\x3eJSON.stringify()\x3c\/code\x3e和\x3ccode\x3eJSON.parse()\x3c\/code\x3e去转换JSON对象。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var quote = {symbol: \x27APPL\x27, value: 195.46};\nclient.send(\x26quot;\/topic\/stocks\x26quot;, {}, JSON.stringify(quote));\n\nclient.subcribe(\x26quot;\/topic\/stocks\x26quot;, function(message) {\n    var quote = JSON.parse(message.body);\n    alert(quote.symbol \x2b \x26quot; is at \x26quot; \x2b quote.value);\n};\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e quote = {\x3cspan class=\x22hljs-attr\x22\x3esymbol\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27APPL\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e195.46\x3c\/span\x3e};\nclient.send(\x3cspan class=\x22hljs-string\x22\x3e\x22\/topic\/stocks\x22\x3c\/span\x3e, {}, \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(quote));\n\nclient.subcribe(\x3cspan class=\x22hljs-string\x22\x3e\x22\/topic\/stocks\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emessage\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e quote = \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.parse(message.body);\n    alert(quote.symbol \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22 is at \x22\x3c\/span\x3e \x2b quote.value);\n};\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader18\x22\x3eAcknowledgment(确认)\x3c\/h3\x3e\n\x3cp\x3e默认情况，在消息发送给客户端之前，服务端会自动确认（\x3ccode\x3eacknowledged\x3c\/code\x3e）。\x3c\/p\x3e\n\x3cp\x3e客户端可以选择通过订阅一个目的地时设置一个\x3ccode\x3eack header\x3c\/code\x3e为\x3ccode\x3eclient\x3c\/code\x3e或\x3ccode\x3eclient-individual\x3c\/code\x3e来处理消息确认。\x3c\/p\x3e\n\x3cp\x3e在下面这个例子，客户端必须调用\x3ccode\x3emessage.ack()\x3c\/code\x3e来通知服务端它已经接收了消息。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var subscription = client.subscribe(\x26quot;\/queue\/test\x26quot;,\n    function(message) {\n        \/\/ do something with the message\n        ...\n        \/\/ and acknowledge it\n        message.ack();\n    },\n    {ack: \x27client\x27}\n);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e subscription = client.subscribe(\x3cspan class=\x22hljs-string\x22\x3e\x22\/queue\/test\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(message)\x3c\/span\x3e \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ do something with the message\x3c\/span\x3e\n        ...\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ and acknowledge it\x3c\/span\x3e\n        message.ack();\n    },\n    {ack: \x3cspan class=\x22hljs-string\x22\x3e\x27client\x27\x3c\/span\x3e}\n);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eack()\x3c\/code\x3e接受\x3ccode\x3eheaders\x3c\/code\x3e参数用来附加确认消息。例如，将消息作为事务(transaction)的一部分，当要求接收消息时其实代理（broker）已经将\x3ccode\x3eACK STOMP frame\x3c\/code\x3e处理了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var tx = client.begin();\nmessage.ack({ transaction: tx.id, receipt: \x27my-receipt\x27 });\ntx.commit();\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs applescript\x22\x3e\x3ccode\x3evar tx = client.begin();\nmessage.ack({ \x3cspan class=\x22hljs-keyword\x22\x3etransaction\x3c\/span\x3e: tx.\x3cspan class=\x22hljs-built_in\x22\x3eid\x3c\/span\x3e, receipt: \x27\x3cspan class=\x22hljs-keyword\x22\x3emy\x3c\/span\x3e-receipt\x27 });\ntx.commit();\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3enack()\x3c\/code\x3e也可以用来通知STOMP 1.1.brokers（代理）：客户端不能消费这个消息。与\x3ccode\x3eack()\x3c\/code\x3e方法的参数相同。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader19\x22\x3e事务(Transactions)\x3c\/h3\x3e\n\x3cp\x3e可以在将消息的发送和确认接收放在一个事务中。\x3c\/p\x3e\n\x3cp\x3e客户端调用自身的\x3ccode\x3ebegin()\x3c\/code\x3e方法就可以开始启动事务了，\x3ccode\x3ebegin()\x3c\/code\x3e有一个可选的参数\x3ccode\x3etransaction\x3c\/code\x3e，一个唯一的可标识事务的字符串。如果没有传递这个参数，那么库会自动构建一个。\x3c\/p\x3e\n\x3cp\x3e这个方法会返回一个object。这个对象有一个\x3ccode\x3eid\x3c\/code\x3e属性对应这个事务的ID，还有两个方法：\x3cbr\x3e\x3ccode\x3ecommit()\x3c\/code\x3e提交事务\x3cbr\x3e\x3ccode\x3eabort()\x3c\/code\x3e中止事务\x3c\/p\x3e\n\x3cp\x3e在一个事务中，客户端可以在发送\/接受消息时指定transaction id来设置transaction。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ start the transaction\nvar tx = client.begin();\n\/\/ send the message in a transaction\nclient.send(\x26quot;\/queue\/test\x26quot;, {transaction: tx.id}, \x26quot;message in a transaction\x26quot;);\n\/\/ commit the transaction to effectively send the message\ntx.commit();\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs axapta\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ start the transaction\x3c\/span\x3e\nvar tx = \x3cspan class=\x22hljs-keyword\x22\x3eclient\x3c\/span\x3e.begin();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ send the message in a transaction\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eclient\x3c\/span\x3e.send(\x3cspan class=\x22hljs-string\x22\x3e\x22\/queue\/test\x22\x3c\/span\x3e, {transaction: tx.id}, \x3cspan class=\x22hljs-string\x22\x3e\x22message in a transaction\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ commit the transaction to effectively send the message\x3c\/span\x3e\ntx.commit();\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果你在调用\x3ccode\x3esend()\x3c\/code\x3e方法发送消息的时候忘记添加transction header，那么这不会称为事务的一部分，这个消息会直接发送，不会等到事务完成后才发送。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var txid = \x26quot;unique_transaction_identifier\x26quot;;\n\/\/ start the transaction\nvar tx = client.begin();\n\/\/ oops! send the message outside the transaction\nclient.send(\x26quot;\/queue\/test\x26quot;, {}, \x26quot;I thought I was in a transaction!\x26quot;);\ntx.abort(); \/\/ Too late! the message has been sent\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lasso\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e txid = \x3cspan class=\x22hljs-string\x22\x3e\x22unique_transaction_identifier\x22\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ start the transaction\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e tx = client.begin();\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ oops! send the message outside the transaction\x3c\/span\x3e\nclient.send(\x3cspan class=\x22hljs-string\x22\x3e\x22\/queue\/test\x22\x3c\/span\x3e, {}, \x3cspan class=\x22hljs-string\x22\x3e\x22I thought I was in a transaction!\x22\x3c\/span\x3e);\ntx.\x3cspan class=\x22hljs-keyword\x22\x3eabort\x3c\/span\x3e(); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Too late! the message has been sent\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader20\x22\x3e调试（Debug）\x3c\/h3\x3e\n\x3cp\x3e有一些测试代码能有助于你知道库发送或接收的是什么，从而来调试程序。\x3c\/p\x3e\n\x3cp\x3e客户端可以将其\x3ccode\x3edebug\x3c\/code\x3e属性设置为一个函数，传递一个字符串参数去观察库所有的debug语句。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22client.debug = function(str) {\n    \/\/ append the debug log to a #debug div somewhere in the page using JQuery:\n    $(\x26quot;#debug\x26quot;).append(str \x2b \x26quot;\\n\x26quot;);\n};\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3eclient.debug = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ append the debug log to a #debug div somewhere in the page using JQuery:\x3c\/span\x3e\n    $(\x3cspan class=\x22hljs-string\x22\x3e\x22#debug\x22\x3c\/span\x3e).append(str \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22\\n\x22\x3c\/span\x3e);\n};\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e默认情况，debug消息会被记录在在浏览器的控制台。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Stomp Over Websocket文档</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006617344">https://segmentfault.com/a/1190000006617344</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/u8kafrx7x4a/" target="_blank">https://alili.tech/archive/u8kafrx7x4a/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>