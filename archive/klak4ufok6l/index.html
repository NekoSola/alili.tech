<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="如何用 JavaScript 下载文件"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>如何用 JavaScript 下载文件 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/klak4ufok6l/",
				"appid": "1613049289050283", 
				"title": "如何用 JavaScript 下载文件 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-08T02:30:40"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/lx1emwg7w4/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/whiqr0hm4bk/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fklak4ufok6l%2f&text=%e5%a6%82%e4%bd%95%e7%94%a8%20JavaScript%20%e4%b8%8b%e8%bd%bd%e6%96%87%e4%bb%b6"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fklak4ufok6l%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fklak4ufok6l%2f&text=%e5%a6%82%e4%bd%95%e7%94%a8%20JavaScript%20%e4%b8%8b%e8%bd%bd%e6%96%87%e4%bb%b6"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fklak4ufok6l%2f&title=%e5%a6%82%e4%bd%95%e7%94%a8%20JavaScript%20%e4%b8%8b%e8%bd%bd%e6%96%87%e4%bb%b6"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fklak4ufok6l%2f&is_video=false&description=%e5%a6%82%e4%bd%95%e7%94%a8%20JavaScript%20%e4%b8%8b%e8%bd%bd%e6%96%87%e4%bb%b6"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%a6%82%e4%bd%95%e7%94%a8%20JavaScript%20%e4%b8%8b%e8%bd%bd%e6%96%87%e4%bb%b6&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fklak4ufok6l%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fklak4ufok6l%2f&title=%e5%a6%82%e4%bd%95%e7%94%a8%20JavaScript%20%e4%b8%8b%e8%bd%bd%e6%96%87%e4%bb%b6"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fklak4ufok6l%2f&title=%e5%a6%82%e4%bd%95%e7%94%a8%20JavaScript%20%e4%b8%8b%e8%bd%bd%e6%96%87%e4%bb%b6"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fklak4ufok6l%2f&title=%e5%a6%82%e4%bd%95%e7%94%a8%20JavaScript%20%e4%b8%8b%e8%bd%bd%e6%96%87%e4%bb%b6"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fklak4ufok6l%2f&title=%e5%a6%82%e4%bd%95%e7%94%a8%20JavaScript%20%e4%b8%8b%e8%bd%bd%e6%96%87%e4%bb%b6"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">如何用 JavaScript 下载文件</h1><div class="meta"><div class="postdate"><time datetime="2019-02-08" itemprop="datePublished">2019-02-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e简介\x3c\/h2\x3e\n\x3cp\x3e我们知道，下载文件是一个非常常见的需求，但由于浏览器的安全策略的限制，我们通常只能通过一个额外的页面，访问某个文件的 url 来实现下载功能，但是这种用户体验非常不好。\x3cbr\x3e幸好，HTML 5 里面为 \x3ccode\x3e\x26lt;a\x26gt;\x3c\/code\x3e 标签添加了一个 \x3ccode\x3edownload\x3c\/code\x3e 的属性，我们可以轻易的利用它来实现下载功能，再也不需要用以前的笨办法了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e原理\x3c\/h2\x3e\n\x3cp\x3e我们先看看 \x3ccode\x3edownload\x3c\/code\x3e 的使用方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ca href=\x26quot;http:\/\/somehost\/somefile.zip\x26quot; download=\x26quot;filename.zip\x26quot;\x3eDownload file\x3c\/a\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/somehost\/somefile.zip\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edownload\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22filename.zip\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eDownload file\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e看看上面的代码，只要为 \x3ccode\x3e\x26lt;a\x26gt;\x3c\/code\x3e 标签添加 \x3ccode\x3edownload\x3c\/code\x3e 属性，我们点击这个链接的时候就会自动下载文件了~\x3cbr\x3e顺便说下，\x3ccode\x3edownload\x3c\/code\x3e 的属性值是可选的，它用来指定下载文件的文件名。像上面的例子中，我们下载到本地的文件名就会是 filename.zip 拉，如果不指定的话，它就会是 somefile.zip 这个名字拉！\x3c\/p\x3e\n\x3cp\x3e看到这里，你可能会说，坑爹啊，这明明是用 HTML 5 的新特性来实现下载文件嘛，说好的用 JavaScript 下载文件呢？\x3c\/p\x3e\n\x3cp\x3e事实上，用 JavaScript 来下载文件也是利用这一特性来实现的，我们的 JavaScript 代码不外乎就是：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e用 JavaScript 创建一个隐藏的 \x3ccode\x3e\x26lt;a\x26gt;\x3c\/code\x3e 标签\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e设置它的 \x3ccode\x3ehref\x3c\/code\x3e 属性\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e设置它的 \x3ccode\x3edownload\x3c\/code\x3e 属性\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e用 JavaScript 来触发这个它的 \x3ccode\x3eclick\x3c\/code\x3e 事件\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e翻译成 JavaScript 代码就是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var a = document.createElement(\x27a\x27);\nvar url = window.URL.createObjectURL(blob);\nvar filename = \x27what-you-want.txt\x27;\na.href = url;\na.download = filename;\na.click();\nwindow.URL.revokeObjectURL(url);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e a = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.URL.createObjectURL(blob);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e filename = \x3cspan class=\x22hljs-string\x22\x3e\x27what-you-want.txt\x27\x3c\/span\x3e;\na.href = url;\na.download = filename;\na.click();\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.URL.revokeObjectURL(url);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e好拉，是不是看到有个陌生的东东呢？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3ewindow.URL\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3ewindow.URL\x3c\/code\x3e 里面有两个方法：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ecreateObjectURL\x3c\/code\x3e 用 blob 对象来创建一个 object URL(它是一个 \x3ccode\x3eDOMString\x3c\/code\x3e)，我们可以用这个 object URL 来表示某个 blob 对象，这个 object URL 可以用在 \x3ccode\x3ehref\x3c\/code\x3e 和 \x3ccode\x3esrc\x3c\/code\x3e 之类的属性上。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3erevokeObjectURL\x3c\/code\x3e 释放由 \x3ccode\x3ecreateObjectURL\x3c\/code\x3e 创建的 object URL，当该 object URL 不需要的时候，我们要主动调用这个方法来获取最佳性能和内存使用。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e知道了这两个方法之后，我们再回去看看上面的例子就很容易理解了吧！只是用 blob 对象来创建一条 URL，然后让 \x3ccode\x3e\x26lt;a\x26gt;\x3c\/code\x3e 标签引用该 URL，然后触发个点击事件，就可以下载文件了！\x3c\/p\x3e\n\x3cp\x3e那么问题来了，blob 对象哪里来？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3eBlob 对象\x3c\/h2\x3e\n\x3cp\x3eBlob 全称是 Binary large object，它表示一个类文件对象，可以用它来表示一个文件。根据 \x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/Blob\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eMDN\x3c\/a\x3e 上面的说法，\x3ccode\x3eFile API\x3c\/code\x3e 也是基于 blob 来实现的。\x3c\/p\x3e\n\x3cp\x3e由于本文的主题是讲 JavaScript 下载文件，那我们构建 blob 的方式就是通过服务器返回的文件来创建 blob 拉！\x3cbr\x3e而最简单的方式就是用 \x3ccode\x3efetch API\x3c\/code\x3e 了，我们可以整合上面的例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22fetch(\x27http:\/\/somehost\/somefile.zip\x27).then(res =\x3e res.blob().then(blob =\x3e {\n    var a = document.createElement(\x27a\x27);\n    var url = window.URL.createObjectURL(blob);\n    var filename = \x27myfile.zip\x27;\n    a.href = url;\n    a.download = filename;\n    a.click();\n    window.URL.revokeObjectURL(url);\n}))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3efetch(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/somehost\/somefile.zip\x27\x3c\/span\x3e).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e =\x26gt;\x3c\/span\x3e res.blob().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eblob\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e a = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.URL.createObjectURL(blob);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e filename = \x3cspan class=\x22hljs-string\x22\x3e\x27myfile.zip\x27\x3c\/span\x3e;\n    a.href = url;\n    a.download = filename;\n    a.click();\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.URL.revokeObjectURL(url);\n}))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e很简单对吧！\x3c\/p\x3e\n\x3cp\x3e你可能会问，何必这么麻烦呢？直接写成下面这样不就好了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3ca href=\x26quot;http:\/\/somehost\/somefile.zip\x26quot; download=\x26quot;myfile.zip\x26quot;\x3eDownload file\x3c\/a\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/somehost\/somefile.zip\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edownload\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22myfile.zip\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3eDownload file\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e嗯，对于这种写法，我只能说，你做的太正确了！如果你要下载的是已经存在服务器上面的静态文件的话，那么写成这样是最方便的。浏览器会帮你处理整个下载过程，不需要你干涉。如果你用 blob 的方式来下载文件的话，会有下面这些限制的：\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e限制一：不同浏览器对 blob 对象有不同的限制\x3c\/h3\x3e\n\x3cp\x3e具体看看下面这个表格（出自 \x3ca href=\x22https:\/\/github.com\/eligrey\/FileSaver.js#supported-browsers\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eFileSaver.js\x3c\/a\x3e）：\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3eBrowser\x3c\/th\x3e\n\x3cth\x3eConstructs as\x3c\/th\x3e\n\x3cth\x3eFilenames\x3c\/th\x3e\n\x3cth\x3eMax Blob Size\x3c\/th\x3e\n\x3cth\x3eDependencies\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3eFirefox 20\x2b\x3c\/td\x3e\n\x3ctd\x3eBlob\x3c\/td\x3e\n\x3ctd\x3eYes\x3c\/td\x3e\n\x3ctd\x3e800 MiB\x3c\/td\x3e\n\x3ctd\x3eNone\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eFirefox \x26lt; 20\x3c\/td\x3e\n\x3ctd\x3edata: URI\x3c\/td\x3e\n\x3ctd\x3eNo\x3c\/td\x3e\n\x3ctd\x3en\/a\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/eligrey\/Blob.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eBlob.js\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eChrome\x3c\/td\x3e\n\x3ctd\x3eBlob\x3c\/td\x3e\n\x3ctd\x3eYes\x3c\/td\x3e\n\x3ctd\x3e500 MiB\x3c\/td\x3e\n\x3ctd\x3eNone\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eChrome for Android\x3c\/td\x3e\n\x3ctd\x3eBlob\x3c\/td\x3e\n\x3ctd\x3eYes\x3c\/td\x3e\n\x3ctd\x3e500 MiB\x3c\/td\x3e\n\x3ctd\x3eNone\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eEdge\x3c\/td\x3e\n\x3ctd\x3eBlob\x3c\/td\x3e\n\x3ctd\x3eYes\x3c\/td\x3e\n\x3ctd\x3e?\x3c\/td\x3e\n\x3ctd\x3eNone\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eIE 10\x2b\x3c\/td\x3e\n\x3ctd\x3eBlob\x3c\/td\x3e\n\x3ctd\x3eYes\x3c\/td\x3e\n\x3ctd\x3e600 MiB\x3c\/td\x3e\n\x3ctd\x3eNone\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eOpera 15\x2b\x3c\/td\x3e\n\x3ctd\x3eBlob\x3c\/td\x3e\n\x3ctd\x3eYes\x3c\/td\x3e\n\x3ctd\x3e500 MiB\x3c\/td\x3e\n\x3ctd\x3eNone\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eOpera \x26lt; 15\x3c\/td\x3e\n\x3ctd\x3edata: URI\x3c\/td\x3e\n\x3ctd\x3eNo\x3c\/td\x3e\n\x3ctd\x3en\/a\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/eligrey\/Blob.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eBlob.js\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eSafari 6.1\x2b*\x3c\/td\x3e\n\x3ctd\x3eBlob\x3c\/td\x3e\n\x3ctd\x3eNo\x3c\/td\x3e\n\x3ctd\x3e?\x3c\/td\x3e\n\x3ctd\x3eNone\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eSafari \x26lt; 6\x3c\/td\x3e\n\x3ctd\x3edata: URI\x3c\/td\x3e\n\x3ctd\x3eNo\x3c\/td\x3e\n\x3ctd\x3en\/a\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/eligrey\/Blob.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eBlob.js\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e限制二：构建完 blob 对象后才会转换成文件\x3c\/h3\x3e\n\x3cp\x3e这一点限制对小文件(几十kb)可能没什么影响，但对稍微大一点的文件影响就很大了。试想，用户要下载一个 100mb 的文件，如果他点击了下载按钮之后没看到下载提示的话，他肯定会继续按，等他按了几次之后还没看到下载提示时，他就会抱怨我们的网站，然后离开了。\x3c\/p\x3e\n\x3cp\x3e然而事实上下载的的确确发生了，只是要等到下载完文件之后才能构建 blob 对象，再转化成文件。而且，用户再触发多几次下载就会造成一些资源上的浪费。\x3c\/p\x3e\n\x3cp\x3e因此，如果是要下载大文件的话，还是推荐直接创建一个 \x3ccode\x3e\x26lt;a\x26gt;\x3c\/code\x3e 标签拉~\x3cbr\x3e写 html 也好，写 JavaScript 动态创建也好，用自己喜欢的方式去创建就好了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e为什么要用 JavaScript 下载文件\x3c\/h2\x3e\n\x3cp\x3e好拉，说了半天，其实我们一直说的都是：「不要用 JavaScript 下载文件拉，限制多多，又不好用，直接用 html 就好拉，简单方便又快捷」这个论调。\x3cbr\x3e事实上也确实如此，但有些时候我们确实需要通过 JavaScript 来做一些\x3cstrong\x3e预\x3c\/strong\x3e处理。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e权限校验\x3c\/h3\x3e\n\x3cp\x3e有些时候，我们需要对下载做一些限制，最常见的就是权限校验了，如检查该用户是否有下载的权限，是否有高速下载的权限等等。这时候，我们可以利用 JavaScript 做一些预处理。如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22fetch(\x27http:\/\/somehost\/check-permission\x27, options).then(res =\x3e {\n    if (res.code === 0) {\n        var a = document.createElement(\x27a\x27);\n        var url = res.data.url;\n        var filename = \x27myfile.zip\x27;\n        a.href = url;\n        a.download = filename;\n        a.click();\n    } else {\n        alert(\x27You have no permission to download the file!\x27);\n    }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3efetch(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/somehost\/check-permission\x27\x3c\/span\x3e, options).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (res.code === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e a = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27a\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = res.data.url;\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e filename = \x3cspan class=\x22hljs-string\x22\x3e\x27myfile.zip\x27\x3c\/span\x3e;\n        a.href = url;\n        a.download = filename;\n        a.click();\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        alert(\x3cspan class=\x22hljs-string\x22\x3e\x27You have no permission to download the file!\x27\x3c\/span\x3e);\n    }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这个例子里面，我们没有用 blob 来构建 URL，而是通过后端服务器来计算出用户的下载链接，然后再利用之前提到的动态创建 \x3ccode\x3e\x26lt;a\x26gt;\x3c\/code\x3e 标签的方式来实现下载，很简单吧！\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e动态文件\x3c\/h3\x3e\n\x3cp\x3e动态生成文件然后返回给客户端也是一个很常见的需求，譬如我们有时候需要做导出数据的功能，把数据库中的某些数据导出到 Excel 中，然后再返回客户端。\x3cbr\x3e这时候我们就不能简单的指定 \x3ccode\x3ehref\x3c\/code\x3e 属性，因为对应的 URL 并不存在。\x3cbr\x3e我们只能通过 JavaScript 对服务器发出一个请求，通知它去生成某个文件，然后把对应的 URL 返回给客户端。\x3cbr\x3e有没有感觉这个过程和上面「权限校验」一节很像？肯定拉，因为我们只是对 URL 做了一些预处理而已嘛~\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e注意事项\x3c\/h2\x3e\n\x3cp\x3e由于 \x3ccode\x3edownload\x3c\/code\x3e 属性是 HTML 5 的新特性，因此它不支持旧版本的浏览器。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3eHTML 5 新的 \x3ccode\x3edownload\x3c\/code\x3e 特性真的很好用，结合 JavaScript 的动态能力我们可以很方便的做出复杂的下载功能~\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e出处\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/scarletsky.github.io\/2016\/07\/03\/download-file-using-javascript\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/scarletsky.github.io\/2016\/07\/03\/download-file-using-javascript\/\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e参考资料\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/eligrey\/FileSaver.js\/blob\/master\/FileSaver.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/eligrey\/FileSaver.js\/blob\/master\/FileSaver.js\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/URL\/createObjectURL\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/URL\/createObjectURL\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/Blob\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/developer.mozilla.org\/en-US\/docs\/Web\/API\/Blob\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/stackoverflow.com\/questions\/19327749\/javascript-blob-filename-without-link\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/stackoverflow.com\/questions\/19327749\/javascript-blob-filename-without-link\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/stackoverflow.com\/questions\/24501358\/how-to-set-a-header-for-a-http-get-request-and-trigger-file-download\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/stackoverflow.com\/questions\/24501358\/how-to-set-a-header-for-a-http-get-request-and-trigger-file-download\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22http:\/\/blog.bguiz.com\/2014\/07\/03\/file-download-with-http-request-header\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/blog.bguiz.com\/2014\/07\/03\/file-download-with-http-request-header\/\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>如何用 JavaScript 下载文件</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005863250">https://segmentfault.com/a/1190000005863250</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/klak4ufok6l/" target="_blank">https://alili.tech/archive/klak4ufok6l/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>