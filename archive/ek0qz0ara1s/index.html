<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React设计模式:深入理解React&amp;Redux原理套路"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React设计模式:深入理解React&amp;Redux原理套路 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ek0qz0ara1s/",
				"appid": "1613049289050283", 
				"title": "React设计模式:深入理解React&amp;Redux原理套路 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-06T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/re27ydnx5qp/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/5jwcyzoumjk/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fek0qz0ara1s%2f&text=React%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%3a%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3React%26Redux%e5%8e%9f%e7%90%86%e5%a5%97%e8%b7%af"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fek0qz0ara1s%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fek0qz0ara1s%2f&text=React%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%3a%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3React%26Redux%e5%8e%9f%e7%90%86%e5%a5%97%e8%b7%af"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fek0qz0ara1s%2f&title=React%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%3a%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3React%26Redux%e5%8e%9f%e7%90%86%e5%a5%97%e8%b7%af"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fek0qz0ara1s%2f&is_video=false&description=React%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%3a%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3React%26Redux%e5%8e%9f%e7%90%86%e5%a5%97%e8%b7%af"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%3a%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3React%26Redux%e5%8e%9f%e7%90%86%e5%a5%97%e8%b7%af&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fek0qz0ara1s%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fek0qz0ara1s%2f&title=React%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%3a%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3React%26Redux%e5%8e%9f%e7%90%86%e5%a5%97%e8%b7%af"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fek0qz0ara1s%2f&title=React%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%3a%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3React%26Redux%e5%8e%9f%e7%90%86%e5%a5%97%e8%b7%af"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fek0qz0ara1s%2f&title=React%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%3a%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3React%26Redux%e5%8e%9f%e7%90%86%e5%a5%97%e8%b7%af"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fek0qz0ara1s%2f&title=React%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%3a%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3React%26Redux%e5%8e%9f%e7%90%86%e5%a5%97%e8%b7%af"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React设计模式:深入理解React&amp;Redux原理套路</h1><div class="meta"><div class="postdate"><time datetime="2019-02-06" itemprop="datePublished">2019-02-06</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/krasimir\/react-in-patterns\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e原文地址\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/wxyyxc1992\/web-frontend-practice-handbook#react\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e本文从属于笔者的React入门与最佳实践系列\x3c\/a\x3e，推荐阅读\x3ca href=\x22https:\/\/github.com\/wxyyxc1992\/just-coder-handbook\/blob\/master\/SoftwareEngineering\/SoftwareArchitecture\/GUIArchitecture\/evolution-of-gui-architectural-patterns.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGUI应用程序架构的十年变迁:MVC,MVP,MVVM,Unidirectional,Clean\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch1 id=\x22articleHeader0\x22\x3eCommunication\x3c\/h1\x3e\n\x3cp\x3eReact组件一个很大的特性在于其拥有自己完整的生命周期，因此我们可以将React组件视作可自运行的小型系统，它拥有自己的内部状态、输入与输出。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eInput\x3c\/h2\x3e\n\x3cp\x3e对于React组件而言，其输入的来源就是Props，我们会用如下方式向某个React组件传入数据:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ Title.jsx\nclass Title extends React.Component {\n  render() {\n    return \x3ch1\x3e{ this.props.text }\x3c\/h1\x3e;\n  }\n};\nTitle.propTypes = {\n  text: React.PropTypes.string\n};\nTitle.defaultProps = {\n  text: \x27Hello world\x27\n};\n\n\/\/ App.jsx\nclass App extends React.Component {\n  render() {\n    return \x3cTitle text=\x27Hello React\x27 \/\x3e;\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Title.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTitle\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;h1\x26gt;{ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.text }\x26lt;\/h1\x26gt;;\n  }\n};\n\x3cspan class=\x22hljs-type\x22\x3eTitle\x3c\/span\x3e.propTypes = {\n  text: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.string\n};\n\x3cspan class=\x22hljs-type\x22\x3eTitle\x3c\/span\x3e.defaultProps = {\n  text: \x3cspan class=\x22hljs-symbol\x22\x3e\x27Hello\x3c\/span\x3e world\x27\n};\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ App.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;\x3cspan class=\x22hljs-type\x22\x3eTitle\x3c\/span\x3e text=\x3cspan class=\x22hljs-symbol\x22\x3e\x27Hello\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e\x27 \/\x26gt;;\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3etext\x3c\/code\x3e是\x3ccode\x3eText\x3c\/code\x3e组件自己的输入域，父组件\x3ccode\x3eApp\x3c\/code\x3e在使用子组件\x3ccode\x3eTitle\x3c\/code\x3e时候应该提供\x3ccode\x3etext\x3c\/code\x3e属性值。除了标准的属性名之外，我们还会用到如下两个设置:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3epropTypes:用于定义Props的类型，这有助于追踪运行时误设置的Prop值。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3edefaultProps:定义Props的默认值，这个在开发时很有帮助\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3eProps中还有一个特殊的属性\x3ccode\x3eprops.children\x3c\/code\x3e可以允许我们使用子组件:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nclass Title extends React.Component {\n  render() {\n    return (\n      \x3ch1\x3e\n        { this.props.text }\n        { this.props.children }\n      \x3c\/h1\x3e\n    );\n  }\n};\n\nclass App extends React.Component {\n  render() {\n    return (\n      \x3cTitle text=\x27Hello React\x27\x3e\n        \x3cspan\x3ecommunity\x3c\/span\x3e\n      \x3c\/Title\x3e\n    );\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTitle\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;h1\x26gt;\n        { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.text }\n        { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.children }\n      \x26lt;\/h1\x26gt;\n    );\n  }\n};\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;\x3cspan class=\x22hljs-type\x22\x3eTitle\x3c\/span\x3e text=\x3cspan class=\x22hljs-symbol\x22\x3e\x27Hello\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e\x27\x26gt;\n        \x26lt;span\x26gt;community\x26lt;\/span\x26gt;\n      \x26lt;\/\x3cspan class=\x22hljs-type\x22\x3eTitle\x3c\/span\x3e\x26gt;\n    );\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意，如果我们不主动在\x3ccode\x3eTitle\x3c\/code\x3e组件的\x3ccode\x3erender\x3c\/code\x3e函数中设置\x3ccode\x3e{this.props.children}\x3c\/code\x3e，那么\x3ccode\x3espan\x3c\/code\x3e标签是不会被渲染出来的。除了Props之外，另一个隐性的组件的输入即是\x3ccode\x3econtext\x3c\/code\x3e，整个React组件树会拥有一个\x3ccode\x3econtext\x3c\/code\x3e对象，它可以被树中挂载的每个组件所访问到，关于此部分更多的内容请参考\x3ca href=\x22https:\/\/github.com\/krasimir\/react-in-patterns\/tree\/master\/patterns\/dependency-injection\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e依赖注入\x3c\/a\x3e这一章节。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3eOutput\x3c\/h2\x3e\n\x3cp\x3e组件最明显的输出就是渲染后的HTML文本，即是React组件渲染结果的可视化展示。当然，部分包含了逻辑的组件也可能发送或者触发某些Action或者Event。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nclass Title extends React.Component {\n  render() {\n    return (\n      \x3ch1\x3e\n        \x3ca onClick={ this.props.logoClicked }\x3e\n          \x3cimg src=\x27path\/to\/logo.png\x27 \/\x3e\n        \x3c\/a\x3e\n      \x3c\/h1\x3e\n    );\n  }\n};\n\nclass App extends React.Component {\n  render() {\n    return \x3cTitle logoClicked={ this.logoClicked } \/\x3e;\n  }\n  logoClicked() {\n    console.log(\x27logo clicked\x27);\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTitle\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;h1\x26gt;\n        \x26lt;a onClick={ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.logoClicked }\x26gt;\n          \x26lt;img src=\x3cspan class=\x22hljs-symbol\x22\x3e\x27path\x3c\/span\x3e\/to\/logo.png\x27 \/\x26gt;\n        \x26lt;\/a\x26gt;\n      \x26lt;\/h1\x26gt;\n    );\n  }\n};\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;\x3cspan class=\x22hljs-type\x22\x3eTitle\x3c\/span\x3e logoClicked={ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.logoClicked } \/\x26gt;;\n  }\n  logoClicked() {\n    console.log(\x3cspan class=\x22hljs-symbol\x22\x3e\x27logo\x3c\/span\x3e clicked\x27);\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在\x3ccode\x3eApp\x3c\/code\x3e组件中我们向\x3ccode\x3eTitle\x3c\/code\x3e组件传入了可以从\x3ccode\x3eTitle\x3c\/code\x3e调用的回调函数，在\x3ccode\x3elogoClicked\x3c\/code\x3e函数中我们可以设置或者修改需要传回父组件的数据。需要注意的是，React并没有提供可以访问子组件状态的API，换言之，我们不能使用\x3ccode\x3ethis.props.children[0].state\x3c\/code\x3e或者类似的方法。正确的从子组件中获取数据的方法应该是在Props中传入回调函数，而这种隔离也有助于我们定义更加清晰的API并且促进了所谓单向数据流。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader3\x22\x3eComposition\x3c\/h1\x3e\n\x3cp\x3eReact最大的特性之一即是其强大的组件的可组合性，实际上除了React之外，笔者并不知道还有哪个框架能够提供如此简单易用的方式来创建与组合各式各样的组件。本章我们会一起讨论些常用的组合技巧，我们以一个简单的例子来进行讲解。假设在我们的应用中有一个页首栏目，并且其中放置了导航栏。我们创建了三个独立的React组件:\x3ccode\x3eApp\x3c\/code\x3e,\x3ccode\x3eHeader\x3c\/code\x3e以及\x3ccode\x3eNavigation\x3c\/code\x3e。将这三个组件依次嵌套组合，可以得到以下的代码:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\x3cApp\x3e\n  \x3cHeader\x3e\n    \x3cNavigation\x3e ... \x3c\/Navigation\x3e\n  \x3c\/Header\x3e\n\x3c\/App\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eApp\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eHeader\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eNavigation\x3c\/span\x3e\x26gt;\x3c\/span\x3e ... \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eNavigation\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eHeader\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eApp\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而在JSX中组合这些组件的方式就是在需要的时候引用它们:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ app.jsx\nimport Header from \x27.\/Header.jsx\x27;\n\nexport default class App extends React.Component {\n  render() {\n    return \x3cHeader \/\x3e;\n  }\n}\n\n\/\/ Header.jsx\nimport Navigation from \x27.\/Navigation.jsx\x27;\n\nexport default class Header extends React.Component {\n  render() {\n    return \x3cheader\x3e\x3cNavigation \/\x3e\x3c\/header\x3e;\n  }\n}\n\n\/\/ Navigation.jsx\nexport default class Navigation extends React.Component {\n  render() {\n    return (\x3cnav\x3e ... \x3c\/nav\x3e);\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ app.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eHeader\x3c\/span\x3e from \x27.\/\x3cspan class=\x22hljs-type\x22\x3eHeader\x3c\/span\x3e.jsx\x27;\n\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;\x3cspan class=\x22hljs-type\x22\x3eHeader\x3c\/span\x3e \/\x26gt;;\n  }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Header.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eNavigation\x3c\/span\x3e from \x27.\/\x3cspan class=\x22hljs-type\x22\x3eNavigation\x3c\/span\x3e.jsx\x27;\n\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHeader\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;header\x26gt;\x26lt;\x3cspan class=\x22hljs-type\x22\x3eNavigation\x3c\/span\x3e \/\x26gt;\x26lt;\/header\x26gt;;\n  }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Navigation.jsx\x3c\/span\x3e\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eNavigation\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\x26lt;nav\x26gt; ... \x26lt;\/nav\x26gt;);\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e不过这种方式却可能存在以下的问题:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e我们将\x3ccode\x3eApp\x3c\/code\x3e当做各个组件间的连接线，也是整个应用的入口，因此在\x3ccode\x3eApp\x3c\/code\x3e中进行各个独立组件的组合是个不错的方法。不过\x3ccode\x3eHeader\x3c\/code\x3e元素中可能包含像图标、搜索栏或者Slogan这样的元素。而如果我们需要另一个不包含\x3ccode\x3eNavigation\x3c\/code\x3e功能的\x3ccode\x3eHeader\x3c\/code\x3e组件时，像上面这种直接将\x3ccode\x3eNavigation\x3c\/code\x3e组件硬编码进入\x3ccode\x3eHeader\x3c\/code\x3e的方式就会难于修改。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e这种硬编码的方式会难以测试，如果我们在\x3ccode\x3eHeader\x3c\/code\x3e中加入一些自定义的业务逻辑代码，那么在测试的时候当我们要创建\x3ccode\x3eHeader\x3c\/code\x3e实例时，因为其依赖于其他组件而导致了这种依赖层次过深(这里不包含\x3ca href=\x22https:\/\/facebook.github.io\/react\/docs\/test-utils.html#shallow-rendering\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eShallow Rendering\x3c\/a\x3e这种仅渲染父组件而不渲染嵌套的子组件方式)。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e使用React的\x3ccode\x3echildren\x3c\/code\x3eAPI\x3c\/h2\x3e\n\x3cp\x3eReact为我们提供了\x3ccode\x3ethis.props.children\x3c\/code\x3e来允许父组件访问其子组件，这种方式有助于保证我们的\x3ccode\x3eHeader\x3c\/code\x3e独立并且不需要与其他组件解耦合。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ App.jsx\nexport default class App extends React.Component {\n  render() {\n    return (\n      \x3cHeader\x3e\n        \x3cNavigation \/\x3e\n      \x3c\/Header\x3e\n    );\n  }\n}\n\n\/\/ Header.jsx\nexport default class Header extends React.Component {\n  render() {\n    return \x3cheader\x3e{ this.props.children }\x3c\/header\x3e;\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ App.jsx\x3c\/span\x3e\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;\x3cspan class=\x22hljs-type\x22\x3eHeader\x3c\/span\x3e\x26gt;\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eNavigation\x3c\/span\x3e \/\x26gt;\n      \x26lt;\/\x3cspan class=\x22hljs-type\x22\x3eHeader\x3c\/span\x3e\x26gt;\n    );\n  }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Header.jsx\x3c\/span\x3e\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHeader\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;header\x26gt;{ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.children }\x26lt;\/header\x26gt;;\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这种方式也有助于测试，我们可以选择输入空白的\x3ccode\x3ediv\x3c\/code\x3e元素，从而将要测试的目标元素隔离开来而专注于我们需要测试的部分。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e将子组件以属性方式传入\x3c\/h2\x3e\n\x3cp\x3eReact组件可以接受Props作为输入，我们也可以选择将需要封装的组件以Props方式传入:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ App.jsx\nclass App extends React.Component {\n  render() {\n    var title = \x3ch1\x3eHello there!\x3c\/h1\x3e;\n\n    return (\n      \x3cHeader title={ title }\x3e\n        \x3cNavigation \/\x3e\n      \x3c\/Header\x3e\n    );\n  }\n};\n\n\/\/ Header.jsx\nexport default class Header extends React.Component {\n  render() {\n    return (\n      \x3cheader\x3e\n        { this.props.title }\n        \x3chr \/\x3e\n        { this.props.children }\n      \x3c\/header\x3e\n    );\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ App.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e title = \x26lt;h1\x26gt;\x3cspan class=\x22hljs-type\x22\x3eHello\x3c\/span\x3e there!\x26lt;\/h1\x26gt;;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;\x3cspan class=\x22hljs-type\x22\x3eHeader\x3c\/span\x3e title={ title }\x26gt;\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eNavigation\x3c\/span\x3e \/\x26gt;\n      \x26lt;\/\x3cspan class=\x22hljs-type\x22\x3eHeader\x3c\/span\x3e\x26gt;\n    );\n  }\n};\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Header.jsx\x3c\/span\x3e\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHeader\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;header\x26gt;\n        { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.title }\n        \x26lt;hr \/\x26gt;\n        { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.children }\n      \x26lt;\/header\x26gt;\n    );\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这种方式在我们需要对传入的待组合组件进行一些修正时非常适用。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader6\x22\x3eHigher-order components\x3c\/h1\x3e\n\x3cp\x3eHigher-Order Components模式看上去非常类似于装饰器模式，它会用于包裹某个组件然后为其添加一些新的功能。这里展示一个简单的用于构造Higher-Order Component的函数:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar enhanceComponent = (Component) =\x3e\n  class Enhance extends React.Component {\n    render() {\n      return (\n        \x3cComponent\n          {...this.state}\n          {...this.props}\n        \/\x3e\n      )\n    }\n  };\n\nexport default enhanceComponent;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e enhanceComponent = (\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e) =\x26gt;\n  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eEnhance\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    render() {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e\n          {...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state}\n          {...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props}\n        \/\x26gt;\n      )\n    }\n  };\n\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e enhanceComponent;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通常情况下我们会构建一个工厂函数，接收原始的组件然后返回一个所谓的增强或者包裹后的版本，譬如:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar OriginalComponent = () =\x3e \x3cp\x3eHello world.\x3c\/p\x3e;\n\nclass App extends React.Component {\n  render() {\n    return React.createElement(enhanceComponent(OriginalComponent));\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eOriginalComponent\x3c\/span\x3e = () =\x26gt; \x26lt;p\x26gt;\x3cspan class=\x22hljs-type\x22\x3eHello\x3c\/span\x3e world.\x26lt;\/p\x26gt;;\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.createElement(enhanceComponent(\x3cspan class=\x22hljs-type\x22\x3eOriginalComponent\x3c\/span\x3e));\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e一般来说，高阶组件的首要工作就是渲染原始的组件，我们经常也会将Props与State传递进去，将这两个属性传递进去会有助于我们建立一个数据代理。HOC模式允许我们控制组件的输入，即将需要传入的数据以Props传递进去。譬如我们需要为原始组件添加一些配置:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar config = require(\x27path\/to\/configuration\x27);\n\nvar enhanceComponent = (Component) =\x3e\n  class Enhance extends React.Component {\n    render() {\n      return (\n        \x3cComponent\n          {...this.state}\n          {...this.props}\n          title={ config.appTitle }\n        \/\x3e\n      )\n    }\n  };\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e config = require(\x3cspan class=\x22hljs-symbol\x22\x3e\x27path\x3c\/span\x3e\/to\/configuration\x27);\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e enhanceComponent = (\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e) =\x26gt;\n  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eEnhance\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    render() {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e\n          {...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state}\n          {...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props}\n          title={ config.appTitle }\n        \/\x26gt;\n      )\n    }\n  };\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里对于\x3ccode\x3econfiguration\x3c\/code\x3e的细节实现会被隐藏到高阶组件中，原始组件只需要了解从Props中获取到\x3ccode\x3etitle\x3c\/code\x3e变量然后渲染到界面上。原始组件并不会关心变量存于何地，从何而来，这种模式最大的优势在于我们能够以独立的模式对该组件进行测试，并且可以非常方便地对该组件进行Mocking。在HOC模式下我们的原始组件会变成这样子:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar OriginalComponent  = (props) =\x3e \x3cp\x3e{ props.title }\x3c\/p\x3e;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs maxima\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e OriginalComponent  = (\x3cspan class=\x22hljs-built_in\x22\x3eprops\x3c\/span\x3e) =\x26gt; \x26lt;p\x26gt;{ \x3cspan class=\x22hljs-built_in\x22\x3eprops\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3etitle\x3c\/span\x3e }\x26lt;\/p\x26gt;;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader7\x22\x3eDependency injection\x3c\/h1\x3e\n\x3cp\x3e我们写的大部分组件与模块都会包含一些依赖，合适的依赖管理有助于创建良好可维护的项目结构。而所谓的依赖注入技术正是解决这个问题的常用技巧，无论是在Java还是其他应用程序中，依赖注入都受到了广泛的使用。而React中对于依赖注入的需要也是显而易见的，让我们假设有如下的应用树结构:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ Title.jsx\nexport default function Title(props) {\n  return \x3ch1\x3e{ props.title }\x3c\/h1\x3e;\n}\n\n\/\/ Header.jsx\nimport Title from \x27.\/Title.jsx\x27;\nexport default function Header() {\n  return (\n    \x3cheader\x3e\n      \x3cTitle \/\x3e\n    \x3c\/header\x3e\n  );\n}\n\n\/\/ App.jsx\nimport Header from \x27.\/Header.jsx\x27;\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { title: \x27React in patterns\x27 };\n  }\n  render() {\n    return \x3cHeader \/\x3e;\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Title.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTitle\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eprops\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eh1\x3c\/span\x3e\x26gt;\x3c\/span\x3e{ props.title }\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eh1\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Header.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Title \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/Title.jsx\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eHeader\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n    \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eheader\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eTitle\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eheader\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n  );\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ App.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Header \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/Header.jsx\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(props) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = { \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27React in patterns\x27\x3c\/span\x3e };\n  }\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eHeader\x3c\/span\x3e \/\x26gt;\x3c\/span\x3e;\n  }\n};\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3etitle\x3c\/code\x3e这个变量的值是在\x3ccode\x3eApp\x3c\/code\x3e组件中被定义好的，我们需要将其传入到\x3ccode\x3eTitle\x3c\/code\x3e组件中。最直接的方法就是将其从\x3ccode\x3eApp\x3c\/code\x3e组件传入到\x3ccode\x3eHeader\x3c\/code\x3e组件，然后再由\x3ccode\x3eHeader\x3c\/code\x3e组件传入到\x3ccode\x3eTitle\x3c\/code\x3e组件中。这种方法在这里描述的简单的仅有三个组件的应用中还是非常清晰可维护的，不过随着项目功能与复杂度的增加，这种层次化的传值方式会导致很多的组件要去考虑它们并不需要的属性。在上文所讲的HOC模式中我们已经使用了数据注入的方式，这里我们使用同样的技术来注入\x3ccode\x3etitle\x3c\/code\x3e变量:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ enhance.jsx\nvar title = \x27React in patterns\x27;\nvar enhanceComponent = (Component) =\x3e\n  class Enhance extends React.Component {\n    render() {\n      return (\n        \x3cComponent\n          {...this.state}\n          {...this.props}\n          title={ title }\n        \/\x3e\n      )\n    }\n  };\nexport default enhanceComponent;\n\n\/\/ Header.jsx\nimport enhance from \x27.\/enhance.jsx\x27;\nimport Title from \x27.\/Title.jsx\x27;\n\nvar EnhancedTitle = enhance(Title);\nexport default function Header() {\n  return (\n    \x3cheader\x3e\n      \x3cEnhancedTitle \/\x3e\n    \x3c\/header\x3e\n  );\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ enhance.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e title = \x3cspan class=\x22hljs-symbol\x22\x3e\x27React\x3c\/span\x3e in patterns\x27;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e enhanceComponent = (\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e) =\x26gt;\n  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eEnhance\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    render() {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e\n          {...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state}\n          {...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props}\n          title={ title }\n        \/\x26gt;\n      )\n    }\n  };\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e enhanceComponent;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Header.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e enhance from \x27.\/enhance.jsx\x27;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eTitle\x3c\/span\x3e from \x27.\/\x3cspan class=\x22hljs-type\x22\x3eTitle\x3c\/span\x3e.jsx\x27;\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eEnhancedTitle\x3c\/span\x3e = enhance(\x3cspan class=\x22hljs-type\x22\x3eTitle\x3c\/span\x3e);\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e function \x3cspan class=\x22hljs-type\x22\x3eHeader\x3c\/span\x3e() {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n    \x26lt;header\x26gt;\n      \x26lt;\x3cspan class=\x22hljs-type\x22\x3eEnhancedTitle\x3c\/span\x3e \/\x26gt;\n    \x26lt;\/header\x26gt;\n  );\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上文这种HOC模式中，\x3ccode\x3etitle\x3c\/code\x3e变量被包含在了一个隐藏的中间层中，我们将其作为Props值传入到原始的\x3ccode\x3eTitle\x3c\/code\x3e变量中并且得到一个新的组件。这种方式思想是不错，不过还是只解决了部分问题。现在我们可以不去显式地将\x3ccode\x3etitle\x3c\/code\x3e变量传递到\x3ccode\x3eTitle\x3c\/code\x3e组件中即可以达到同样的\x3ccode\x3eenhance.jsx\x3c\/code\x3e效果。\x3c\/p\x3e\n\x3cp\x3eReact为我们提供了\x3ccode\x3econtext\x3c\/code\x3e的概念，\x3ccode\x3econtext\x3c\/code\x3e是贯穿于整个React组件树允许每个组件访问的对象。有点像所谓的Event Bus，一个简单的例子如下所示:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ a place where we\x27ll define the context\nvar context = { title: \x27React in patterns\x27 };\nclass App extends React.Component {\n  getChildContext() {\n    return context;\n  }\n  ...\n};\nApp.childContextTypes = {\n  title: React.PropTypes.string\n};\n\n\/\/ a place where we need data\nclass Inject extends React.Component {\n  render() {\n    var title = this.context.title;\n    ...\n  }\n}\nInject.contextTypes = {\n  title: React.PropTypes.string\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ a place where we\x27ll define the context\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e context = { title: \x3cspan class=\x22hljs-symbol\x22\x3e\x27React\x3c\/span\x3e in patterns\x27 };\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  getChildContext() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e context;\n  }\n  ...\n};\n\x3cspan class=\x22hljs-type\x22\x3eApp\x3c\/span\x3e.childContextTypes = {\n  title: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.string\n};\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ a place where we need data\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eInject\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e title = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context.title;\n    ...\n  }\n}\n\x3cspan class=\x22hljs-type\x22\x3eInject\x3c\/span\x3e.contextTypes = {\n  title: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.string\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意，我们要使用context对象必须要通过\x3ccode\x3echildContextTypes\x3c\/code\x3e与\x3ccode\x3econtextTypes\x3c\/code\x3e指明其构成。如果在\x3ccode\x3econtext\x3c\/code\x3e对象中未指明这些那么\x3ccode\x3econtext\x3c\/code\x3e会被设置为空，这可能会添加些额外的代码。因此我们最好不要将\x3ccode\x3econtext\x3c\/code\x3e当做一个简单的object对象而为其设置一些封装方法:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ dependencies.js\nexport default {\n  data: {},\n  get(key) {\n    return this.data[key];\n  },\n  register(key, value) {\n    this.data[key] = value;\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ dependencies.js\x3c\/span\x3e\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e: {},\n  \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e(key) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e[key];\n  },\n  register(key, value) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e[key] = value;\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样，我们的\x3ccode\x3eApp\x3c\/code\x3e组件会被改造成这样子:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nimport dependencies from \x27.\/dependencies\x27;\n\ndependencies.register(\x27title\x27, \x27React in patterns\x27);\n\nclass App extends React.Component {\n  getChildContext() {\n    return dependencies;\n  }\n  render() {\n    return \x3cHeader \/\x3e;\n  }\n};\nApp.childContextTypes = {\n  data: React.PropTypes.object,\n  get: React.PropTypes.func,\n  register: React.PropTypes.func\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e dependencies from \x27.\/dependencies\x27;\n\ndependencies.register(\x3cspan class=\x22hljs-symbol\x22\x3e\x27titl\x3c\/span\x3ee\x27, \x3cspan class=\x22hljs-symbol\x22\x3e\x27React\x3c\/span\x3e in patterns\x27);\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  getChildContext() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e dependencies;\n  }\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;\x3cspan class=\x22hljs-type\x22\x3eHeader\x3c\/span\x3e \/\x26gt;;\n  }\n};\n\x3cspan class=\x22hljs-type\x22\x3eApp\x3c\/span\x3e.childContextTypes = {\n  data: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eobject\x3c\/span\x3e,\n  get: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.func,\n  register: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.func\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而在\x3ccode\x3eTitle\x3c\/code\x3e组件中，我们需要进行如下设置:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ Title.jsx\nexport default class Title extends React.Component {\n  render() {\n    return \x3ch1\x3e{ this.context.get(\x27title\x27) }\x3c\/h1\x3e\n  }\n}\nTitle.contextTypes = {\n  data: React.PropTypes.object,\n  get: React.PropTypes.func,\n  register: React.PropTypes.func\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Title.jsx\x3c\/span\x3e\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTitle\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;h1\x26gt;{ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context.get(\x3cspan class=\x22hljs-symbol\x22\x3e\x27titl\x3c\/span\x3ee\x27) }\x26lt;\/h1\x26gt;\n  }\n}\n\x3cspan class=\x22hljs-type\x22\x3eTitle\x3c\/span\x3e.contextTypes = {\n  data: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eobject\x3c\/span\x3e,\n  get: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.func,\n  register: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.func\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当然我们不希望在每次要使用\x3ccode\x3econtextTypes\x3c\/code\x3e的时候都需要显式地声明一下，我们可以将这些声明细节包含在一个高阶组件中。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ Title.jsx\nimport wire from \x27.\/wire\x27;\n\nfunction Title(props) {\n  return \x3ch1\x3e{ props.title }\x3c\/h1\x3e;\n}\n\nexport default wire(Title, [\x27title\x27], function resolve(title) {\n  return { title };\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Title.jsx\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e wire \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/wire\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eTitle\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eprops\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eh1\x3c\/span\x3e\x26gt;\x3c\/span\x3e{ props.title }\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eh1\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e;\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e wire(Title, [\x3cspan class=\x22hljs-string\x22\x3e\x27title\x27\x3c\/span\x3e], \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolve\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etitle\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { title };\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里的\x3ccode\x3ewire\x3c\/code\x3e函数的第一个参数是React组件对象，第二个参数是一系列需要注入的依赖值，注意，这些依赖值务必已经调用过\x3ccode\x3eregister\x3c\/code\x3e函数。最后一个参数则是所谓的映射函数，它接收存储在\x3ccode\x3econtext\x3c\/code\x3e中的某个原始值然后返回React Props中需要的值。因为在这个例子里\x3ccode\x3econtext\x3c\/code\x3e中存储的值与\x3ccode\x3eTitle\x3c\/code\x3e组件中需要的值都是\x3ccode\x3etitle\x3c\/code\x3e变量，因此我们直接返回即可。不过在真实的应用中可能是一个数据集合、配置等等。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nexport default function wire(Component, dependencies, mapper) {\n  class Inject extends React.Component {\n    render() {\n      var resolved = dependencies.map(this.context.get.bind(this.context));\n      var props = mapper(...resolved);\n\n      return React.createElement(Component, props);\n    }\n  }\n  Inject.contextTypes = {\n    data: React.PropTypes.object,\n    get: React.PropTypes.func,\n    register: React.PropTypes.func\n  };\n  return Inject;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e function wire(\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e, dependencies, mapper) {\n  \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eInject\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n    render() {\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e resolved = dependencies.map(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context.get.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.context));\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e props = mapper(...resolved);\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e, props);\n    }\n  }\n  \x3cspan class=\x22hljs-type\x22\x3eInject\x3c\/span\x3e.contextTypes = {\n    data: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eobject\x3c\/span\x3e,\n    get: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.func,\n    register: \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-type\x22\x3ePropTypes\x3c\/span\x3e.func\n  };\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eInject\x3c\/span\x3e;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里的Inject就是某个可以访问\x3ccode\x3econtext\x3c\/code\x3e的高阶组件，而\x3ccode\x3emapper\x3c\/code\x3e就是用于接收\x3ccode\x3econtext\x3c\/code\x3e中的数据并将其转化为组件所需要的Props的函数。实际上现在大部分的依赖注入的解决方案都是基于\x3ccode\x3econtext\x3c\/code\x3e，我觉得了解这种方式的底层原理还是很有意义的。譬如现在流行的\x3ccode\x3eRedux\x3c\/code\x3e，其核心的\x3ccode\x3econnect\x3c\/code\x3e函数与\x3ccode\x3eProvider\x3c\/code\x3e组件都是基于\x3ccode\x3econtext\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader8\x22\x3eOne direction data flow\x3c\/h1\x3e\n\x3cp\x3e单向数据流是React中主要的数据驱动模式，其核心概念在于组件并不会修改它们接收到的数据，它们只是负责接收新的数据而后重新渲染到界面上或者发出某些Action以触发某些专门的业务代码来修改数据存储中的数据。我们先设置一个包含一个按钮的\x3ccode\x3eSwitcher\x3c\/code\x3e组件，当我们点击该按钮时会触发某个\x3ccode\x3eflag\x3c\/code\x3e变量的改变:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nclass Switcher extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { flag: false };\n    this._onButtonClick = e =\x3e this.setState({ flag: !this.state.flag });\n  }\n  render() {\n    return (\n      \x3cbutton onClick={ this._onButtonClick }\x3e\n        { this.state.flag ? \x27lights on\x27 : \x27lights off\x27 }\n      \x3c\/button\x3e\n    );\n  }\n};\n\n\/\/ ... and we render it\nclass App extends React.Component {\n  render() {\n    return \x3cSwitcher \/\x3e;\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eSwitcher\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  constructor(props) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = { flag: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e };\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._onButtonClick = e =\x26gt; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ flag: !\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.flag });\n  }\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;button onClick={ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._onButtonClick }\x26gt;\n        { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.flag ? \x3cspan class=\x22hljs-symbol\x22\x3e\x27lights\x3c\/span\x3e on\x27 : \x3cspan class=\x22hljs-symbol\x22\x3e\x27lights\x3c\/span\x3e off\x27 }\n      \x26lt;\/button\x26gt;\n    );\n  }\n};\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ... and we render it\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;\x3cspan class=\x22hljs-type\x22\x3eSwitcher\x3c\/span\x3e \/\x26gt;;\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e此时我们将所有的数据放置到组件内，换言之，\x3ccode\x3eSwitcher\x3c\/code\x3e是唯一的包含我们\x3ccode\x3eflag\x3c\/code\x3e变量的地方，我们来尝试下将这些数据托管于专门的Store中:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar Store = {\n  _flag: false,\n  set: function(value) {\n    this._flag = value;\n  },\n  get: function() {\n    return this._flag;\n  }\n};\n\nclass Switcher extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { flag: false };\n    this._onButtonClick = e =\x3e {\n      this.setState({ flag: !this.state.flag }, () =\x3e {\n        this.props.onChange(this.state.flag);\n      });\n    }\n  }\n  render() {\n    return (\n      \x3cbutton onClick={ this._onButtonClick }\x3e\n        { this.state.flag ? \x27lights on\x27 : \x27lights off\x27 }\n      \x3c\/button\x3e\n    );\n  }\n};\n\nclass App extends React.Component {\n  render() {\n    return \x3cSwitcher onChange={ Store.set.bind(Store) } \/\x3e;\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eStore\x3c\/span\x3e = {\n  _flag: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n  set: function(value) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._flag = value;\n  },\n  get: function() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._flag;\n  }\n};\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eSwitcher\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  constructor(props) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state = { flag: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e };\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._onButtonClick = e =\x26gt; {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ flag: !\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.flag }, () =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.onChange(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.flag);\n      });\n    }\n  }\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;button onClick={ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._onButtonClick }\x26gt;\n        { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.flag ? \x3cspan class=\x22hljs-symbol\x22\x3e\x27lights\x3c\/span\x3e on\x27 : \x3cspan class=\x22hljs-symbol\x22\x3e\x27lights\x3c\/span\x3e off\x27 }\n      \x26lt;\/button\x26gt;\n    );\n  }\n};\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;\x3cspan class=\x22hljs-type\x22\x3eSwitcher\x3c\/span\x3e onChange={ \x3cspan class=\x22hljs-type\x22\x3eStore\x3c\/span\x3e.set.bind(\x3cspan class=\x22hljs-type\x22\x3eStore\x3c\/span\x3e) } \/\x26gt;;\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里的\x3ccode\x3eStore\x3c\/code\x3e对象是一个简单的单例对象，可以帮助我们设置与获取\x3ccode\x3e_flag\x3c\/code\x3e属性值。而通过将\x3ccode\x3egetter\x3c\/code\x3e函数传递到组件内，可以允许我们在\x3ccode\x3eStore\x3c\/code\x3e外部修改这些变量，此时我们的应用工作流大概是这样的:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nUser\x27s input\n     |\n  Switcher -------\x3e Store\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3e\nUser\x3cspan class=\x22hljs-symbol\x22\x3e\x27s\x3c\/span\x3e input\n     |\n  Switcher \x3cspan class=\x22hljs-comment\x22\x3e-------\x26gt; Store\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e假设我们已经将\x3ccode\x3eflag\x3c\/code\x3e值保存到某个后端服务中，我们需要为该组件设置一个合适的初始状态。此时就会存在一个问题在于同一份数据保存在了两个地方，对于UI与\x3ccode\x3eStore\x3c\/code\x3e分别保存了各自独立的关于\x3ccode\x3eflag\x3c\/code\x3e的数据状态，我们等于在\x3ccode\x3eStore\x3c\/code\x3e与\x3ccode\x3eSwitcher\x3c\/code\x3e之间建立了双向的数据流:\x3ccode\x3eStore ---\x26gt; Switcher\x3c\/code\x3e与\x3ccode\x3eSwitcher ---\x26gt; Store\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\/\/ ... in App component\n\x3cSwitcher\n  value={ Store.get() }\n  onChange={ Store.set.bind(Store) } \/\x3e\n\n\/\/ ... in Switcher component\nconstructor(props) {\n  super(props);\n  this.state = { flag: this.props.value };\n  ...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs delphi\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ... in App component\x3c\/span\x3e\n\x26lt;Switcher\n  value=\x3cspan class=\x22hljs-comment\x22\x3e{ Store.get() }\x3c\/span\x3e\n  onChange=\x3cspan class=\x22hljs-comment\x22\x3e{ Store.set.bind(Store) }\x3c\/span\x3e \/\x26gt;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ... in Switcher component\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(props)\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{\n  super(props);\n  this.state = { flag: this.props.value }\x3c\/span\x3e;\x3c\/span\x3e\n  ...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e此时我们的数据流向变成了:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nUser\x27s input\n     |\n  Switcher \x3c-------\x3e Store\n                      ^ |\n                      | |\n                      | |\n                      | v\n    Service communicating\n    with our backend\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gherkin\x22\x3e\x3ccode\x3e\nUser\x27s input\n     |\x3cspan class=\x22hljs-string\x22\x3e\n  Switcher \x26lt;-------\x26gt; Store\n                      ^ \x3c\/span\x3e|\n                      |\x3cspan class=\x22hljs-string\x22\x3e \x3c\/span\x3e|\n                      |\x3cspan class=\x22hljs-string\x22\x3e \x3c\/span\x3e|\n                      |\x3cspan class=\x22hljs-string\x22\x3e v\n    Service communicating\n    with our backend\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这种双向数据流下，如果我们在外部改变了\x3ccode\x3eStore\x3c\/code\x3e中的状态之后，我们需要将改变之后的最新值更新到\x3ccode\x3eSwitcher\x3c\/code\x3e中，这样也在无形之间增加了应用的复杂度。而单向数据流则是解决了这个问题，它强制在全局只保留一个状态存储，通常是存放在Store中。在单向数据流下，我们需要添加一些订阅Store中状态改变的响应函数:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar Store = {\n  _handlers: [],\n  _flag: \x27\x27,\n  onChange: function(handler) {\n    this._handlers.push(handler);\n  },\n  set: function(value) {\n    this._flag = value;\n    this._handlers.forEach(handler =\x3e handler())\n  },\n  get: function() {\n    return this._flag;\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Store = {\n  _handlers: [],\n  _flag: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\n  onChange: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(handler)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._handlers.push(handler);\n  },\n  \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(value)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._flag = value;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._handlers.forEach(handler =\x26gt; handler())\n  },\n  \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._flag;\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后我们在\x3ccode\x3eApp\x3c\/code\x3e组件中设置了钩子函数，这样每次\x3ccode\x3eStore\x3c\/code\x3e改变其值的时候我们都会强制重新渲染:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    Store.onChange(this.forceUpdate.bind(this));\n  }\n  render() {\n    return (\n      \x3cdiv\x3e\n        \x3cSwitcher\n          value={ Store.get() }\n          onChange={ Store.set.bind(Store) } \/\x3e\n      \x3c\/div\x3e\n    );\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  constructor(props) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n    \x3cspan class=\x22hljs-type\x22\x3eStore\x3c\/span\x3e.onChange(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.forceUpdate.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e));\n  }\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;div\x26gt;\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eSwitcher\x3c\/span\x3e\n          value={ \x3cspan class=\x22hljs-type\x22\x3eStore\x3c\/span\x3e.get() }\n          onChange={ \x3cspan class=\x22hljs-type\x22\x3eStore\x3c\/span\x3e.set.bind(\x3cspan class=\x22hljs-type\x22\x3eStore\x3c\/span\x3e) } \/\x26gt;\n      \x26lt;\/div\x26gt;\n    );\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意，这里使用的\x3ccode\x3eforceUpdate\x3c\/code\x3e并不是一个推荐的用法，我们通常会使用HOC模式来进行重渲染，这里使用\x3ccode\x3eforceUpdate\x3c\/code\x3e只是用于演示说明。在基于上述的改造，我们就不需要在组件中继续保留内部状态:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nclass Switcher extends React.Component {\n  constructor(props) {\n    super(props);\n    this._onButtonClick = e =\x3e {\n      this.props.onChange(!this.props.value);\n    }\n  }\n  render() {\n    return (\n      \x3cbutton onClick={ this._onButtonClick }\x3e\n        { this.props.value ? \x27lights on\x27 : \x27lights off\x27 }\n      \x3c\/button\x3e\n    );\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eSwitcher\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  constructor(props) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._onButtonClick = e =\x26gt; {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.onChange(!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.value);\n    }\n  }\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;button onClick={ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._onButtonClick }\x26gt;\n        { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.value ? \x3cspan class=\x22hljs-symbol\x22\x3e\x27lights\x3c\/span\x3e on\x27 : \x3cspan class=\x22hljs-symbol\x22\x3e\x27lights\x3c\/span\x3e off\x27 }\n      \x26lt;\/button\x26gt;\n    );\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这种模式的优势在于会将我们的组件改造为简单的\x3ccode\x3eStore\x3c\/code\x3e中数据的呈现，此时才是真正无状态的View。我们可以以完全声明式的方式来编写组件，而将应用中复杂的业务逻辑放置到单独的地方。此时我们应用程序的流图变成了:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nService communicating\nwith our backend\n    ^\n    |\n    v\n  Store \x3c-----\n    |        |\n    v        |\nSwitcher ----\x3e\n    ^\n    |\n    |\nUser input\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coq\x22\x3e\x3ccode\x3e\nService communicating\n\x3cspan class=\x22hljs-built_in\x22\x3ewith\x3c\/span\x3e our backend\n    ^\n    |\n    \x3cspan class=\x22hljs-type\x22\x3ev\x3c\/span\x3e\n  Store \x26lt;-----\n    |        \x3cspan class=\x22hljs-type\x22\x3e|\n    v\x3c\/span\x3e        |\n\x3cspan class=\x22hljs-type\x22\x3eSwitcher\x3c\/span\x3e ----\x26gt;\n    ^\n    |\n    \x3cspan class=\x22hljs-type\x22\x3e|\nUser\x3c\/span\x3e input\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在这种单向数据流中我们不再需要同步系统中的多个部分，这种单向数据流的概念并不仅仅适用于基于React的应用。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader9\x22\x3eFlux\x3c\/h1\x3e\n\x3cblockquote\x3e\x3cp\x3e关于Flux的简单了解可以参考笔者的\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000006016817#articleHeader33\x22\x3eGUI应用程序架构的十年变迁:MVC,MVP,MVVM,Unidirectional,Clean\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3eFlux是用于构建用户交互界面的架构模式，最早由Facebook在f8大会上提出，自此之后，很多的公司开始尝试这种概念并且貌似这是个很不错的构建前端应用的模式。Flux经常和React一起搭配使用，笔者本身在日常的工作中也是使用React\x2bFlux的搭配，给自己带来了很大的遍历。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006770026\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006770026\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eFlux中最主要的角色为Dispatcher，它是整个系统中所有的Events的中转站。Dispatcher负责接收我们称之为Actions的消息通知并且将其转发给所有的Stores。每个Store实例本身来决定是否对该Action感兴趣并且是否相应地改变其内部的状态。当我们将Flux与熟知的MVC相比较，你就会发现Store在某些意义上很类似于Model，二者都是用于存放状态与状态中的改变。而在系统中，除了View层的用户交互可能触发Actions之外，其他的类似于Service层也可能触发Actions，譬如在某个HTTP请求完成之后，请求模块也会发出相应类型的Action来触发Store中对于状态的变更。\x3c\/p\x3e\n\x3cp\x3e而在Flux中有个最大的陷阱就是对于数据流的破坏，我们可以在Views中访问Store中的数据，但是我们不应该在Views中修改任何Store的内部状态，所有对于状态的修改都应该通过Actions进行。作者在这里介绍了其维护的某个Flux变种的项目\x3ca href=\x22https:\/\/github.com\/krasimir\/fluxiny\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3efluxiny\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3eDispatcher\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006770027\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006770027\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e大部分情况下我们在系统中只需要单个的Dispatcher，它是类似于粘合剂的角色将系统的其他部分有机结合在一起。Dispatcher一般而言有两个输入:Actions与Stores。其中Actions需要被直接转发给Stores，因此我们并不需要记录Actions的对象，而Stores的引用则需要保存在Dispatcher中。基于这个考虑，我们可以编写一个简单的Dispatcher:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar Dispatcher = function () {\n  return {\n    _stores: [],\n    register: function (store) {  \n      this._stores.push({ store: store });\n    },\n    dispatch: function (action) {\n      if (this._stores.length \x3e 0) {\n        this._stores.forEach(function (entry) {\n          entry.store.update(action);\n        });\n      }\n    }\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Dispatcher = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    _stores: [],\n    register: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(store)\x3c\/span\x3e \x3c\/span\x3e{  \n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.push({ store: store });\n    },\n    dispatch: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(action)\x3c\/span\x3e \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(entry)\x3c\/span\x3e \x3c\/span\x3e{\n          entry.store.update(action);\n        });\n      }\n    }\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上述实现中我们会发现，每个传入的\x3ccode\x3eStore\x3c\/code\x3e对象都应该拥有一个\x3ccode\x3eupdate\x3c\/code\x3e方法，因此我们在进行Store的注册时也要来检测该方法是否存在:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nregister: function (store) {\n  if (!store || !store.update) {\n    throw new Error(\x27You should provide a store that has an `update` method.\x27);\n  } else {\n    this._stores.push({ store: store });\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs monkey\x22\x3e\x3ccode\x3e\nregister: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3c\/span\x3estore) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!store || !store.update) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-comment\x22\x3e\x27You should provide a store that has an `update` method.\x27);\x3c\/span\x3e\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    this._stores.push({ store: store });\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在完成了对于Store的注册之后，下一步我们就是需要将View与Store关联起来，从而在Store发生改变的时候能够触发View的重渲染:\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006112128\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006112128\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e很多flux的实现中都会使用如下的辅助函数:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nFramework.attachToStore(view, store);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cos\x22\x3e\x3ccode\x3e\nFramework.attachToStore(\x3cspan class=\x22hljs-keyword\x22\x3eview\x3c\/span\x3e, store)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e不过作者并不是很喜欢这种方式，这样这样会要求View中需要调用某个具体的API，换言之，在View中就需要了解到Store的实现细节，而使得View与Store又陷入了紧耦合的境地。当开发者打算切换到其他的Flux框架时就不得不修改每个View中的相对应的API，那又会增加项目的复杂度。另一种可选的方式就是使用\x3ccode\x3eReact mixins\x3c\/code\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar View = React.createClass({\n  mixins: [Framework.attachToStore(store)]\n  ...\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-attribute\x22\x3evar View\x3c\/span\x3e = React.createClass({\n  mixins: [Framework.attachToStore(store)]\n  ...\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用\x3ccode\x3emixin\x3c\/code\x3e是个不错的修改现有的React 组件而不影响其原有代码的方式，不过这种方式的缺陷在于它不能够以一种Predictable的方式去修改组件，用户的可控性较低。还有一种方式就是使用\x3ccode\x3eReact context\x3c\/code\x3e，这种方式允许我们将值跨层次地传递给React组件树中的组件而不需要了解它们处于组件树中的哪个层级。这种方式和mixins可能有相同的问题，开发者并不知道该数据从何而来。\x3c\/p\x3e\n\x3cp\x3e作者最终选用的方式即是上面提及到的Higher-Order Components模式，它建立了一个包裹函数来对现有组件进行重新打包处理:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nfunction attachToStore(Component, store, consumer) {\n  const Wrapper = React.createClass({\n    getInitialState() {\n      return consumer(this.props, store);\n    },\n    componentDidMount() {\n      store.onChangeEvent(this._handleStoreChange);\n    },\n    componentWillUnmount() {\n      store.offChangeEvent(this._handleStoreChange);\n    },\n    _handleStoreChange() {\n      if (this.isMounted()) {\n        this.setState(consumer(this.props, store));\n      }\n    },\n    render() {\n      return \x3cComponent {...this.props} {...this.state} \/\x3e;\n    }\n  });\n  return Wrapper;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e\nfunction attachToStore(Component, store, consumer) {\n  const Wrapper = React.createClass({\n    getInitialState() {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e consumer(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props, store);\n    },\n    componentDidMount() {\n      store.onChangeEvent(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._handleStoreChange);\n    },\n    componentWillUnmount() {\n      store.offChangeEvent(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._handleStoreChange);\n    },\n    _handleStoreChange() {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.isMounted()) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState(consumer(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props, store));\n      }\n    },\n    render() {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;Component {...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props} {...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state} \/\x26gt;;\n    }\n  });\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Wrapper;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中\x3ccode\x3eComponent\x3c\/code\x3e代指我们需要附着到\x3ccode\x3eStore\x3c\/code\x3e中的View，而\x3ccode\x3econsumer\x3c\/code\x3e则是应该被传递给View的Store中的部分的状态，简单的用法为:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nclass MyView extends React.Component {\n  ...\n}\n\nProfilePage = connectToStores(MyView, store, (props, store) =\x3e ({\n  data: store.get(\x27key\x27)\n}));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eMyView\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  ...\n}\n\n\x3cspan class=\x22hljs-type\x22\x3eProfilePage\x3c\/span\x3e = connectToStores(\x3cspan class=\x22hljs-type\x22\x3eMyView\x3c\/span\x3e, store, (props, store) =\x26gt; ({\n  data: store.get(\x3cspan class=\x22hljs-symbol\x22\x3e\x27ke\x3c\/span\x3ey\x27)\n}));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这种模式的优势在于其有效地分割了各个模块间的职责，在该模式中Store并不需要主动地推送消息给View，而主需要简单地修改数据然后广播说我的状态已经更新了，然后由HOC去主动地抓取数据。那么在作者具体的实现中，就是选用了HOC模式:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nregister: function (store) {\n  if (!store || !store.update) {\n    throw new Error(\x27You should provide a store that has an `update` method.\x27);\n  } else {\n    var consumers = [];\n    var change = function () {\n      consumers.forEach(function (l) {\n        l(store);\n      });\n    };\n    var subscribe = function (consumer) {\n      consumers.push(consumer);\n    };\n\n    this._stores.push({ store: store, change: change });\n    return subscribe;\n  }\n  return false;\n},\ndispatch: function (action) {\n  if (this._stores.length \x3e 0) {\n    this._stores.forEach(function (entry) {\n      entry.store.update(action, entry.change);\n    });\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\nregister: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3estore\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!store || !store.update) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27You should provide a store that has an `update` method.\x27\x3c\/span\x3e);\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e consumers = [];\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e change = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      consumers.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3el\x3c\/span\x3e) \x3c\/span\x3e{\n        l(store);\n      });\n    };\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e subscribe = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3econsumer\x3c\/span\x3e) \x3c\/span\x3e{\n      consumers.push(consumer);\n    };\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.push({ \x3cspan class=\x22hljs-attr\x22\x3estore\x3c\/span\x3e: store, \x3cspan class=\x22hljs-attr\x22\x3echange\x3c\/span\x3e: change });\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e subscribe;\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n},\n\x3cspan class=\x22hljs-attr\x22\x3edispatch\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eentry\x3c\/span\x3e) \x3c\/span\x3e{\n      entry.store.update(action, entry.change);\n    });\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006112122\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006112122\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e另一个常见的用户场景就是我们需要为界面提供一些默认的状态，换言之当每个\x3ccode\x3econsumer\x3c\/code\x3e注册的时候需要提供一些初始化的默认数据:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar subscribe = function (consumer, noInit) {\n  consumers.push(consumer);\n  !noInit ? consumer(store) : null;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3e\nvar subscribe = \x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e\x3c\/span\x3e(consumer, noInit) {\n  consumers.push(consumer);\n  !noInit ? consumer(store) : \x3cspan class=\x22hljs-keyword\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3enull\x3c\/span\x3e\x3c\/span\x3e;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e综上所述，最终的Dispatcher函数如下所示:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar Dispatcher = function () {\n  return {\n    _stores: [],\n    register: function (store) {\n      if (!store || !store.update) {\n        throw new Error(\x27You should provide a store that has an `update` method.\x27);\n      } else {\n        var consumers = [];\n        var change = function () {\n          consumers.forEach(function (l) {\n            l(store);\n          });\n        };\n        var subscribe = function (consumer, noInit) {\n          consumers.push(consumer);\n          !noInit ? consumer(store) : null;\n        };\n\n        this._stores.push({ store: store, change: change });\n        return subscribe;\n      }\n      return false;\n    },\n    dispatch: function (action) {\n      if (this._stores.length \x3e 0) {\n        this._stores.forEach(function (entry) {\n          entry.store.update(action, entry.change);\n        });\n      }\n    }\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Dispatcher = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attr\x22\x3e_stores\x3c\/span\x3e: [],\n    \x3cspan class=\x22hljs-attr\x22\x3eregister\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3estore\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!store || !store.update) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27You should provide a store that has an `update` method.\x27\x3c\/span\x3e);\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e consumers = [];\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e change = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n          consumers.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3el\x3c\/span\x3e) \x3c\/span\x3e{\n            l(store);\n          });\n        };\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e subscribe = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3econsumer, noInit\x3c\/span\x3e) \x3c\/span\x3e{\n          consumers.push(consumer);\n          !noInit ? consumer(store) : \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n        };\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.push({ \x3cspan class=\x22hljs-attr\x22\x3estore\x3c\/span\x3e: store, \x3cspan class=\x22hljs-attr\x22\x3echange\x3c\/span\x3e: change });\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e subscribe;\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3edispatch\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eentry\x3c\/span\x3e) \x3c\/span\x3e{\n          entry.store.update(action, entry.change);\n        });\n      }\n    }\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3eActions\x3c\/h2\x3e\n\x3cp\x3eActions就是在系统中各个模块之间传递的消息载体，作者觉得应该使用标准的Flux Action模式:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n{\n  type: \x27USER_LOGIN_REQUEST\x27,\n  payload: {\n    username: \x27...\x27,\n    password: \x27...\x27\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\n{\n  \x3cspan class=\x22hljs-attribute\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27USER_LOGIN_REQUEST\x27\x3c\/span\x3e,\n  payload: {\n    username: \x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e,\n    password: \x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中的\x3ccode\x3etype\x3c\/code\x3e属性表明该Action所代表的操作而\x3ccode\x3epayload\x3c\/code\x3e中包含了相关的数据。另外，在某些情况下Action中没有带有Payload,因此可以使用Partial Application方式来创建标准的Action请求:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar createAction = function (type) {\n  if (!type) {\n    throw new Error(\x27Please, provide action\\\x27s type.\x27);\n  } else {\n    return function (payload) {\n      return dispatcher.dispatch({ type: type, payload: payload });\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e createAction = function (\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-symbol\x22\x3e\x27Please\x3c\/span\x3e, provide action\\\x3cspan class=\x22hljs-symbol\x22\x3e\x27s\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e.\x27)\x3c\/span\x3e;\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e function (payload) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e dispatcher.dispatch({ \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e: \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e, \x3cspan class=\x22hljs-title\x22\x3epayload\x3c\/span\x3e\x3c\/span\x3e: payload });\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006112125\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006112125\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3eFinal Code\x3c\/h2\x3e\n\x3cp\x3e上文我们已经了解了核心的Dispatcher与Action的构造过程，那么在这里我们将这二者组合起来:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar createSubscriber = function (store) {\n  return dispatcher.register(store);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e createSubscriber = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(store)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e dispatcher.register(store);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e并且为了不直接暴露dispatcher对象，我们可以允许用户使用\x3ccode\x3ecreateAction\x3c\/code\x3e与\x3ccode\x3ecreateSubscriber\x3c\/code\x3e这两个函数:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\nvar Dispatcher = function () {\n  return {\n    _stores: [],\n    register: function (store) {\n      if (!store || !store.update) {\n        throw new Error(\x27You should provide a store that has an `update` method.\x27);\n      } else {\n        var consumers = [];\n        var change = function () {\n          consumers.forEach(function (l) {\n            l(store);\n          });\n        };\n        var subscribe = function (consumer, noInit) {\n          consumers.push(consumer);\n          !noInit ? consumer(store) : null;\n        };\n\n        this._stores.push({ store: store, change: change });\n        return subscribe;\n      }\n      return false;\n    },\n    dispatch: function (action) {\n      if (this._stores.length \x3e 0) {\n        this._stores.forEach(function (entry) {\n          entry.store.update(action, entry.change);\n        });\n      }\n    }\n  }\n};\n\nmodule.exports = {\n  create: function () {\n    var dispatcher = Dispatcher();\n\n    return {\n      createAction: function (type) {\n        if (!type) {\n          throw new Error(\x27Please, provide action\\\x27s type.\x27);\n        } else {\n          return function (payload) {\n            return dispatcher.dispatch({ type: type, payload: payload });\n          }\n        }\n      },\n      createSubscriber: function (store) {\n        return dispatcher.register(store);\n      }\n    }\n  }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Dispatcher = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attr\x22\x3e_stores\x3c\/span\x3e: [],\n    \x3cspan class=\x22hljs-attr\x22\x3eregister\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3estore\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!store || !store.update) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27You should provide a store that has an `update` method.\x27\x3c\/span\x3e);\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e consumers = [];\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e change = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n          consumers.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3el\x3c\/span\x3e) \x3c\/span\x3e{\n            l(store);\n          });\n        };\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e subscribe = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3econsumer, noInit\x3c\/span\x3e) \x3c\/span\x3e{\n          consumers.push(consumer);\n          !noInit ? consumer(store) : \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n        };\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.push({ \x3cspan class=\x22hljs-attr\x22\x3estore\x3c\/span\x3e: store, \x3cspan class=\x22hljs-attr\x22\x3echange\x3c\/span\x3e: change });\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e subscribe;\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3edispatch\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._stores.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eentry\x3c\/span\x3e) \x3c\/span\x3e{\n          entry.store.update(action, entry.change);\n        });\n      }\n    }\n  }\n};\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n  \x3cspan class=\x22hljs-attr\x22\x3ecreate\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dispatcher = Dispatcher();\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attr\x22\x3ecreateAction\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3etype\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!type) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27Please, provide action\\\x27s type.\x27\x3c\/span\x3e);\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3epayload\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e dispatcher.dispatch({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: type, \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: payload });\n          }\n        }\n      },\n      \x3cspan class=\x22hljs-attr\x22\x3ecreateSubscriber\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3estore\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e dispatcher.register(store);\n      }\n    }\n  }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006112127\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006112127\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React设计模式:深入理解React&amp;Redux原理套路</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006112093">https://segmentfault.com/a/1190000006112093</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/ek0qz0ara1s/" target="_blank">https://alili.tech/archive/ek0qz0ara1s/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>