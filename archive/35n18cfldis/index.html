<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="探索vue源码之缓存篇"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>探索vue源码之缓存篇 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/35n18cfldis/",
				"appid": "1613049289050283", 
				"title": "探索vue源码之缓存篇 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-05T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/bahnaw6eleo/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/2elau3mrovk/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f35n18cfldis%2f&text=%e6%8e%a2%e7%b4%a2vue%e6%ba%90%e7%a0%81%e4%b9%8b%e7%bc%93%e5%ad%98%e7%af%87"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f35n18cfldis%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f35n18cfldis%2f&text=%e6%8e%a2%e7%b4%a2vue%e6%ba%90%e7%a0%81%e4%b9%8b%e7%bc%93%e5%ad%98%e7%af%87"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f35n18cfldis%2f&title=%e6%8e%a2%e7%b4%a2vue%e6%ba%90%e7%a0%81%e4%b9%8b%e7%bc%93%e5%ad%98%e7%af%87"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f35n18cfldis%2f&is_video=false&description=%e6%8e%a2%e7%b4%a2vue%e6%ba%90%e7%a0%81%e4%b9%8b%e7%bc%93%e5%ad%98%e7%af%87"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%8e%a2%e7%b4%a2vue%e6%ba%90%e7%a0%81%e4%b9%8b%e7%bc%93%e5%ad%98%e7%af%87&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f35n18cfldis%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f35n18cfldis%2f&title=%e6%8e%a2%e7%b4%a2vue%e6%ba%90%e7%a0%81%e4%b9%8b%e7%bc%93%e5%ad%98%e7%af%87"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f35n18cfldis%2f&title=%e6%8e%a2%e7%b4%a2vue%e6%ba%90%e7%a0%81%e4%b9%8b%e7%bc%93%e5%ad%98%e7%af%87"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f35n18cfldis%2f&title=%e6%8e%a2%e7%b4%a2vue%e6%ba%90%e7%a0%81%e4%b9%8b%e7%bc%93%e5%ad%98%e7%af%87"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f35n18cfldis%2f&title=%e6%8e%a2%e7%b4%a2vue%e6%ba%90%e7%a0%81%e4%b9%8b%e7%bc%93%e5%ad%98%e7%af%87"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">探索vue源码之缓存篇</h1><div class="meta"><div class="postdate"><time datetime="2019-02-05" itemprop="datePublished">2019-02-05</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e\x3ccode\x3evue.js\x3c\/code\x3e入坑也有了小半年的时间了，圈子里一直流传着其源码优雅、简洁的传说。\x3cbr\x3e最近的一次技术分享会，同事分享\x3ccode\x3evue.js\x3c\/code\x3e源码的缓存部分，鄙人将其整理出来，与大家一起学习\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e一、从链表说起\x3c\/h3\x3e\n\x3cp\x3e首先我们来看一下\x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\/%E9%93%BE%E8%A1%A8\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e链表\x3c\/a\x3e的定义：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e链表（Linked list）是一种常见的基础数据结构，是一种线性表，但是并不会按线性的顺序存储数据，而是在每一个节点里存到下一个节点的指针(Pointer)\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e其中的双向链表是我们今天的主角：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3cstrong\x3e双向链表\x3c\/strong\x3e也叫\x3cstrong\x3e双链表\x3c\/strong\x3e。双向链表中不仅有指向后一个节点的指针，还有指向前一个节点的指针。这样可以从任何一个节点访问前一个节点，当然也可以访问后一个节点，以至整个链表。一般是在需要大批量的另外储存数据在链表中的位置的时候用。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e图示如下（图片来自\x3ca href=\x22https:\/\/zh.wikipedia.org\/wiki\/%E9%93%BE%E8%A1%A8\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e维基百科-链表\x3c\/a\x3e）：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVB9lU?w=610\x26amp;h=41\x22 src=\x22https:\/\/static.alili.tech\/img\/bVB9lU?w=610\x26amp;h=41\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e想象一群人手拉手站成一排，除了队头跟队尾，可以根据每个人的左手以及右手找到排在其左边或者右边的人，这也可以看成一种双向链表\x3c\/p\x3e\n\x3cp\x3e在\x3ccode\x3eJavaScript\x3c\/code\x3e中，我们可以通过对象的属性来实现双向链表。\x3c\/p\x3e\n\x3cp\x3e而在\x3ccode\x3evue.js\x3c\/code\x3e中，作者正是利用类似双向链表的方式实现缓存的利用\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e二、LRU算法\x3c\/h3\x3e\n\x3cp\x3e在缓存中，利用类似双向链表来管理缓存并不难的。难的是如何更加高效的管理缓存，如何在缓存达到其最大内存空间，删除程序中最不常用的变量，而不是随机删除，造成最常用的变量被误删的情况。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3evue.js\x3c\/code\x3e中采用\x3ccode\x3eLRU算法\x3c\/code\x3e来实现缓存的高效管理。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eLRU\x3c\/code\x3e是\x3ccode\x3eLeast Recently Used\x3c\/code\x3e的简称，具体内容可以查看\x3ca href=\x22https:\/\/github.com\/rsms\/js-lru\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGitHub\x3c\/a\x3e，其有以下优点：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e基于双向链表改变缓存对象中\x3ccode\x3eentry\x3c\/code\x3e的排序，复杂度低\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e缓存对象有一个\x3ccode\x3ehead\x3c\/code\x3e（最近最少使用的项）和一个\x3ccode\x3etail\x3c\/code\x3e（最近最多使用的项）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ehead\x3c\/code\x3e和\x3ccode\x3etail\x3c\/code\x3e都是\x3ccode\x3eentry\x3c\/code\x3e，一个\x3ccode\x3eentry\x3c\/code\x3e可能会有一个\x3ccode\x3enewer entry\x3c\/code\x3e以及一个\x3ccode\x3eolder entry\x3c\/code\x3e（双向链接，\x3ccode\x3eolder entry\x3c\/code\x3e更接近\x3ccode\x3ehead\x3c\/code\x3e，\x3ccode\x3enewer entry\x3c\/code\x3e更接近\x3ccode\x3etail\x3c\/code\x3e）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e使用一个\x3ccode\x3ekey\x3c\/code\x3e就可以遍历这个缓存对象，也就意味着只有\x3ccode\x3eo(1)\x3c\/code\x3e的复杂度，内存消耗非常小\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e可以通过下面的图来更好的理解\x3ccode\x3eLRU算法\x3c\/code\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    entry             entry             entry             entry        \n    ______            ______            ______            ______       \n   | head |.newer =\x3e |      |.newer =\x3e |      |.newer =\x3e | tail |      \n   |  A   |          |  B   |          |  C   |          |  D   |      \n   |______| \x3c= older.|______| \x3c= older.|______| \x3c= older.|______|      \n                                                                       \nremoved  \x3c--  \x3c--  \x3c--  \x3c--  \x3c--  \x3c--  \x3c--  \x3c--  \x3c--  \x3c--  \x3c--  added\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gherkin\x22\x3e\x3ccode\x3e    entry             entry             entry             entry        \n    ______            ______            ______            ______       \n   |\x3cspan class=\x22hljs-string\x22\x3e head \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e.newer =\x26gt; \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e      \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e.newer =\x26gt; \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e      \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e.newer =\x26gt; \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e tail \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e      \n   \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e  A   \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e          \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e  B   \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e          \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e  C   \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e          \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e  D   \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e      \n   \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e______\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e \x26lt;= older.\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e______\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e \x26lt;= older.\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e______\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e \x26lt;= older.\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e______\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e      \n                                                                       \nremoved  \x26lt;--  \x26lt;--  \x26lt;--  \x26lt;--  \x26lt;--  \x26lt;--  \x26lt;--  \x26lt;--  \x26lt;--  \x26lt;--  \x26lt;--  added\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果缓存达到最大，那么每次只需要将\x3ccode\x3ehead\x3c\/code\x3e删除就行了，保证了删除的项是\x3cstrong\x3e最不常用的项\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e还是拿站成一排的人来举例。\x3c\/p\x3e\n\x3cp\x3e有两个指示牌，上面分别写着\x3ccode\x3etail\x3c\/code\x3e以及\x3ccode\x3ehead\x3c\/code\x3e。\x3ccode\x3ehead\x3c\/code\x3e指向队伍的第一个人，\x3ccode\x3etail\x3c\/code\x3e指向队伍的最后一个人。\x3c\/p\x3e\n\x3cp\x3e假设队伍有10个人，按照队伍的排列从队首到队尾依次编号\x3ccode\x3ea b c d ··· j\x3c\/code\x3e，\x3ccode\x3ehead\x3c\/code\x3e指向\x3ccode\x3ea\x3c\/code\x3e，\x3ccode\x3etail\x3c\/code\x3e指向\x3ccode\x3ej\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e下面分成五种情况来说明队伍的变化：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e如果叫到\x3ccode\x3ea\x3c\/code\x3e（使用了数组里面第一个变量），就将\x3ccode\x3ea\x3c\/code\x3e放到队尾，再手拉手重新组成一个新的队伍。并将原来指向\x3ccode\x3ej\x3c\/code\x3e的\x3ccode\x3etail\x3c\/code\x3e现在指向\x3ccode\x3ea\x3c\/code\x3e。再让原来指向\x3ccode\x3ea\x3c\/code\x3e的\x3ccode\x3ehead\x3c\/code\x3e指向现在队伍的第一个人\x3ccode\x3eb\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果叫到\x3ccode\x3eb c d ··· i\x3c\/code\x3e之间任何一个人，则将其从队伍中抽出，放到队尾，重新排队，再改变\x3ccode\x3etail\x3c\/code\x3e的指向为这个人\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果叫到\x3ccode\x3ej\x3c\/code\x3e,则保持队伍不变\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e队伍达到最大人数，则去掉\x3ccode\x3ehead\x3c\/code\x3e指向的编号\x3ccode\x3ea\x3c\/code\x3e，并改变\x3ccode\x3ehead\x3c\/code\x3e指向编号\x3ccode\x3eb\x3c\/code\x3e,再在队尾增加一个人，假定编号为\x3ccode\x3ek\x3c\/code\x3e，最后则将\x3ccode\x3etail\x3c\/code\x3e指向编号\x3ccode\x3ek\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e队伍没有达到最大人数，需要增加队伍人数。只需要在队尾增加编号为\x3ccode\x3ek\x3c\/code\x3e的人。再将\x3ccode\x3etail\x3c\/code\x3e指向编号\x3ccode\x3ek\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e三、源码分析\x3c\/h3\x3e\n\x3cp\x3e我们可以通过一张图来先简单理解作者的数据结构：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVCjvA?w=733\x26amp;h=1290\x22 src=\x22https:\/\/static.alili.tech\/img\/bVCjvA?w=733\x26amp;h=1290\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e作者在\x3ccode\x3ecaches\x3c\/code\x3e对象的\x3ccode\x3e_keymap\x3c\/code\x3e里面保存所需要缓存的变量，通过\x3ccode\x3eolder\x3c\/code\x3e以及\x3ccode\x3enewer\x3c\/code\x3e这两个属性来实现双向链表。\x3ccode\x3eolder\x3c\/code\x3e指向其前一个对象，\x3ccode\x3enewer\x3c\/code\x3e指向其后一个对象。通过这两个属性，将缓存中的变量连接起来。\x3c\/p\x3e\n\x3cp\x3e以上图举例：\x3cbr\x3e缓存\x3ccode\x3ecaches\x3c\/code\x3e这个对象中保存了三个变量:\x3ccode\x3ekey1\x3c\/code\x3e、\x3ccode\x3ekey2\x3c\/code\x3e、\x3ccode\x3ekey3\x3c\/code\x3e。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eheader\x3c\/code\x3e指向\x3ccode\x3ekey1\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3etail\x3c\/code\x3e指向\x3ccode\x3ekey2\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e指向如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22         key1              key2              key3       \n        ______            ______            ______       \n       | head |.newer =\x3e |      |.newer =\x3e | tail |      \n       |      |          |      |          |      |      \n       |______| \x3c= older.|______| \x3c= older.|______|  \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gherkin\x22\x3e\x3ccode\x3e         key1              key2              key3       \n        ______            ______            ______       \n       |\x3cspan class=\x22hljs-string\x22\x3e head \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e.newer =\x26gt; \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e      \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e.newer =\x26gt; \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e tail \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e      \n       \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e      \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e          \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e      \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e          \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e      \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e      \n       \x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e______\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e \x26lt;= older.\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e______\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e \x26lt;= older.\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e______\x3c\/span\x3e|\x3cspan class=\x22hljs-string\x22\x3e  \x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e下面我们来看作者对这些数据的处理所使用的方法\x3c\/p\x3e\n\x3cp\x3e文件位置：\x3ccode\x3esrc\/cache.js\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e首先\x3ccode\x3eexport\x3c\/code\x3e构造函数\x3ccode\x3eCache\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export default function Cache (limit) {\n  \/\/ 标识当前缓存数组的大小\n  this.size = 0\n  \/\/ 标识缓存数组能达到的最大长度\n  this.limit = limit\n  \/\/ head（最不常用的项），tail（最常用的项）全部初始化为undefined\n  this.head = this.tail = undefined\n  this._keymap = Object.create(null)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eCache\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3elimit\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 标识当前缓存数组的大小\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.size = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 标识缓存数组能达到的最大长度\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.limit = limit\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ head（最不常用的项），tail（最常用的项）全部初始化为undefined\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.head = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tail = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._keymap = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.create(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来作者在\x3ccode\x3eCache\x3c\/code\x3e的原型链上面分别定义了：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eput\x3c\/code\x3e：在缓存中加入一个\x3ccode\x3ekey-value\x3c\/code\x3e对象，如果缓存数组已经达到最大值，则返回被删除的\x3ccode\x3eentry\x3c\/code\x3e，即\x3ccode\x3ehead\x3c\/code\x3e,否则返回\x3ccode\x3eundefined\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eshift\x3c\/code\x3e：在缓存数组中移除最少使用的\x3ccode\x3eentry\x3c\/code\x3e，即\x3ccode\x3ehead\x3c\/code\x3e，返回被删除的\x3ccode\x3eentry\x3c\/code\x3e。如果缓存数组为空，则返回\x3ccode\x3eundefined\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eget\x3c\/code\x3e：将\x3ccode\x3ekey\x3c\/code\x3e为传入参数的缓存对象标识为最常使用的\x3ccode\x3eentry\x3c\/code\x3e，即\x3ccode\x3etail\x3c\/code\x3e，并调整双向链表，返回改变后的\x3ccode\x3etail\x3c\/code\x3e。如果不存在\x3ccode\x3ekey\x3c\/code\x3e为传入参数的缓存对象，则返回\x3ccode\x3eundefined\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3ea) \x3ccode\x3eget\x3c\/code\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Cache.prototype.get = function (key, returnEntry) {\n  var entry = this._keymap[key]\n  \/\/ 如果查找不到含有`key`这个属性的缓存对象\n  if (entry === undefined) return\n  \/\/ 如果查找到的缓存对象已经是 tail (最近使用过的)\n  if (entry === this.tail) {\n    return returnEntry\n      ? entry\n      : entry.value\n  }\n  \/\/ HEAD--------------TAIL\n  \/\/   \x3c.older   .newer\x3e\n  \/\/  \x3c--- add direction --\n  \/\/   A  B  C  \x3cD\x3e  E\n  if (entry.newer) {\n  \/\/ 处理 newer 指向\n    if (entry === this.head) {\n      \/\/ 如果查找到的缓存对象是 head (最近最少使用过的)\n      \/\/ 则将 head 指向原 head 的 newer 所指向的缓存对象\n      this.head = entry.newer\n    }\n    \/\/ 将所查找的缓存对象的下一级的 older 指向所查找的缓存对象的older所指向的值\n    \/\/ 例如：A B C D E\n    \/\/ 如果查找到的是D，那么将E指向C，不再指向D\n    entry.newer.older = entry.older \/\/ C \x3c-- E.\n  }\n  if (entry.older) {\n  \/\/ 处理 older 指向\n    \/\/ 如果查找到的是D，那么C指向E，不再指向D\n    entry.older.newer = entry.newer \/\/ C. --\x3e E\n  }\n  \/\/ 处理所查找到的对象的 newer 以及 older 指向\n  entry.newer = undefined \/\/ D --x\n  \/\/ older指向之前使用过的变量，即D指向E\n  entry.older = this.tail \/\/ D. --\x3e E\n  if (this.tail) {\n    \/\/ 将E的newer指向D\n    this.tail.newer = entry \/\/ E. \x3c-- D\n  }\n  \/\/ 改变 tail 为D \n  this.tail = entry\n  return returnEntry\n    ? entry\n    : entry.value\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eCache.prototype.get = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ekey, returnEntry\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e entry = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._keymap[key]\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果查找不到含有`key`这个属性的缓存对象\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (entry === \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果查找到的缓存对象已经是 tail (最近使用过的)\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (entry === \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tail) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e returnEntry\n      ? entry\n      : entry.value\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ HEAD--------------TAIL\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/   \x26lt;.older   .newer\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/  \x26lt;--- add direction --\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/   A  B  C  \x26lt;D\x26gt;  E\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (entry.newer) {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 处理 newer 指向\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (entry === \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.head) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果查找到的缓存对象是 head (最近最少使用过的)\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 则将 head 指向原 head 的 newer 所指向的缓存对象\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.head = entry.newer\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将所查找的缓存对象的下一级的 older 指向所查找的缓存对象的older所指向的值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 例如：A B C D E\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果查找到的是D，那么将E指向C，不再指向D\x3c\/span\x3e\n    entry.newer.older = entry.older \x3cspan class=\x22hljs-comment\x22\x3e\/\/ C \x26lt;-- E.\x3c\/span\x3e\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (entry.older) {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 处理 older 指向\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果查找到的是D，那么C指向E，不再指向D\x3c\/span\x3e\n    entry.older.newer = entry.newer \x3cspan class=\x22hljs-comment\x22\x3e\/\/ C. --\x26gt; E\x3c\/span\x3e\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 处理所查找到的对象的 newer 以及 older 指向\x3c\/span\x3e\n  entry.newer = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ D --x\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ older指向之前使用过的变量，即D指向E\x3c\/span\x3e\n  entry.older = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tail \x3cspan class=\x22hljs-comment\x22\x3e\/\/ D. --\x26gt; E\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tail) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将E的newer指向D\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tail.newer = entry \x3cspan class=\x22hljs-comment\x22\x3e\/\/ E. \x26lt;-- D\x3c\/span\x3e\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 改变 tail 为D \x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tail = entry\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e returnEntry\n    ? entry\n    : entry.value\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eb) \x3ccode\x3eput\x3c\/code\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Cache.prototype.put = function (key, value) {\n  var removed\n\n  var entry = this.get(key, true)\n  \/\/ 如果不存在 key 这样属性的缓存对象，才能调用 put 方法\n  if (!entry) {\n    if (this.size === this.limit) {\n    \/\/ 如果缓存数组达到上限，则先删除 head 指向的缓存对象\n      removed = this.shift()\n    }\n    \/\/ 初始化赋值\n    entry = {\n      key: key\n    }\n    this._keymap[key] = entry\n    if (this.tail) {\n    \/\/ 如果存在tail（缓存数组的长度不为0），将tail指向新的 entry\n      this.tail.newer = entry\n      entry.older = this.tail\n    } else {\n    \/\/ 如果缓存数组的长度为0，将head指向新的entry\n      this.head = entry\n    }\n    this.tail = entry\n    this.size\x2b\x2b\n  }\n  entry.value = value\n\n  return removed\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eCache.prototype.put = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ekey, value\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e removed\n\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e entry = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.get(key, \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果不存在 key 这样属性的缓存对象，才能调用 put 方法\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!entry) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.size === \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.limit) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果缓存数组达到上限，则先删除 head 指向的缓存对象\x3c\/span\x3e\n      removed = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.shift()\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 初始化赋值\x3c\/span\x3e\n    entry = {\n      \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e: key\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._keymap[key] = entry\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tail) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果存在tail（缓存数组的长度不为0），将tail指向新的 entry\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tail.newer = entry\n      entry.older = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tail\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果缓存数组的长度为0，将head指向新的entry\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.head = entry\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tail = entry\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.size\x2b\x2b\n  }\n  entry.value = value\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e removed\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ec) \x3ccode\x3eshift\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Cache.prototype.shift = function () {\n  var entry = this.head\n  if (entry) {\n    \/\/ 删除 head ，并改变指向\n    this.head = this.head.newer\n    this.head.older = undefined\n    entry.newer = entry.older = undefined\n    \/\/ 同步更新 _keymap 里面的属性值\n    this._keymap[entry.key] = undefined\n    \/\/ 同步更新 缓存数组的长度\n    this.size--\n  }\n  return entry\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eCache.prototype.shift = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e entry = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.head\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (entry) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 删除 head ，并改变指向\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.head = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.head.newer\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.head.older = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n    entry.newer = entry.older = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 同步更新 _keymap 里面的属性值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._keymap[entry.key] = \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 同步更新 缓存数组的长度\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.size--\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e entry\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e四、后记\x3c\/h3\x3e\n\x3cp\x3e从整个的代码来看，需要学习的不仅仅是\x3ccode\x3eLRU算法\x3c\/code\x3e，作者的对于\x3ccode\x3eObject\x3c\/code\x3e的处理方式也值的我们评味一番。\x3c\/p\x3e\n\x3cp\x3e没有选择去遍历\x3ccode\x3eentry\x3c\/code\x3e，选择通过在\x3ccode\x3eCache\x3c\/code\x3e内增加一个\x3ccode\x3e_keymap\x3c\/code\x3e属性，通过这个属性来管理\x3ccode\x3eentry\x3c\/code\x3e，实现\x3ccode\x3ekey\x3c\/code\x3e与\x3ccode\x3enewer\x3c\/code\x3e、\x3ccode\x3eolder\x3c\/code\x3e状态的分离，减少代码的复杂度\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e五、附\x3c\/h3\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e源码版本为\x3ccode\x3ev1.0.26\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e主要内容来自\x3cstrong\x3e爱屋吉屋FE团队\x3c\/strong\x3e的技术分享会\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>探索vue源码之缓存篇</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006670689">https://segmentfault.com/a/1190000006670689</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/35n18cfldis/" target="_blank">https://alili.tech/archive/35n18cfldis/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>