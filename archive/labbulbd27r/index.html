<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Redux中利用函数式组件替代onEnter进行登录状态验证的实践"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Redux中利用函数式组件替代onEnter进行登录状态验证的实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/labbulbd27r/",
				"appid": "1613049289050283", 
				"title": "Redux中利用函数式组件替代onEnter进行登录状态验证的实践 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-09T02:30:59"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/k8a4x58upm/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/xngdlbl5vmm/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2flabbulbd27r%2f&text=Redux%e4%b8%ad%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bb%84%e4%bb%b6%e6%9b%bf%e4%bb%a3onEnter%e8%bf%9b%e8%a1%8c%e7%99%bb%e5%bd%95%e7%8a%b6%e6%80%81%e9%aa%8c%e8%af%81%e7%9a%84%e5%ae%9e%e8%b7%b5"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2flabbulbd27r%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2flabbulbd27r%2f&text=Redux%e4%b8%ad%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bb%84%e4%bb%b6%e6%9b%bf%e4%bb%a3onEnter%e8%bf%9b%e8%a1%8c%e7%99%bb%e5%bd%95%e7%8a%b6%e6%80%81%e9%aa%8c%e8%af%81%e7%9a%84%e5%ae%9e%e8%b7%b5"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2flabbulbd27r%2f&title=Redux%e4%b8%ad%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bb%84%e4%bb%b6%e6%9b%bf%e4%bb%a3onEnter%e8%bf%9b%e8%a1%8c%e7%99%bb%e5%bd%95%e7%8a%b6%e6%80%81%e9%aa%8c%e8%af%81%e7%9a%84%e5%ae%9e%e8%b7%b5"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2flabbulbd27r%2f&is_video=false&description=Redux%e4%b8%ad%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bb%84%e4%bb%b6%e6%9b%bf%e4%bb%a3onEnter%e8%bf%9b%e8%a1%8c%e7%99%bb%e5%bd%95%e7%8a%b6%e6%80%81%e9%aa%8c%e8%af%81%e7%9a%84%e5%ae%9e%e8%b7%b5"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Redux%e4%b8%ad%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bb%84%e4%bb%b6%e6%9b%bf%e4%bb%a3onEnter%e8%bf%9b%e8%a1%8c%e7%99%bb%e5%bd%95%e7%8a%b6%e6%80%81%e9%aa%8c%e8%af%81%e7%9a%84%e5%ae%9e%e8%b7%b5&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2flabbulbd27r%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2flabbulbd27r%2f&title=Redux%e4%b8%ad%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bb%84%e4%bb%b6%e6%9b%bf%e4%bb%a3onEnter%e8%bf%9b%e8%a1%8c%e7%99%bb%e5%bd%95%e7%8a%b6%e6%80%81%e9%aa%8c%e8%af%81%e7%9a%84%e5%ae%9e%e8%b7%b5"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2flabbulbd27r%2f&title=Redux%e4%b8%ad%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bb%84%e4%bb%b6%e6%9b%bf%e4%bb%a3onEnter%e8%bf%9b%e8%a1%8c%e7%99%bb%e5%bd%95%e7%8a%b6%e6%80%81%e9%aa%8c%e8%af%81%e7%9a%84%e5%ae%9e%e8%b7%b5"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2flabbulbd27r%2f&title=Redux%e4%b8%ad%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bb%84%e4%bb%b6%e6%9b%bf%e4%bb%a3onEnter%e8%bf%9b%e8%a1%8c%e7%99%bb%e5%bd%95%e7%8a%b6%e6%80%81%e9%aa%8c%e8%af%81%e7%9a%84%e5%ae%9e%e8%b7%b5"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2flabbulbd27r%2f&title=Redux%e4%b8%ad%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bb%84%e4%bb%b6%e6%9b%bf%e4%bb%a3onEnter%e8%bf%9b%e8%a1%8c%e7%99%bb%e5%bd%95%e7%8a%b6%e6%80%81%e9%aa%8c%e8%af%81%e7%9a%84%e5%ae%9e%e8%b7%b5"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Redux中利用函数式组件替代onEnter进行登录状态验证的实践</h1><div class="meta"><div class="postdate"><time datetime="2019-02-09" itemprop="datePublished">2019-02-09</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e最近使用React和Redux构建一个后台项目，在做登录系统的时候，看了网上很多资料，一般都是使用sessionStorage(包括Cookie，下略)或者localStorage保存从服务器获取的token，然后使用react-router中\x3cstrong\x3eonEnter\x3c\/strong\x3e这个方法依据sessionStorage或者localStorage中是否存在相应的token来判定登录状态。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3eCookie, LocalStorage 与 SessionStorage的详解可以参考：\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000002723469\x22\x3e详说 Cookie, LocalStorage 与 SessionStorage\x3c\/a\x3e一文。\x3c\/p\x3e\n\x3cp\x3ereact-router的onEnter方法使用可以参考react-router官方的用例：auth-flow。\x3cbr\x3e仓库地址：\x3ca href=\x22https:\/\/github.com\/reactjs\/react-router\/tree\/master\/examples\/auth-flow\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3c\/a\x3e\x3ca href=\x22https:\/\/github.com\/reactjs\/react-router\/tree\/master\/examples\/auth-flow\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/reactjs\/re...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3eauth-flow这个用例使用localStorage来保存token，react-router的onEnter调用requireAuth方法来判断auth.loggedIn()是否能正确返回localStorage.token,来维持登录状态，这也是目前常用的做法。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eapp.js\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React from \x27react\x27\nimport { render } from \x27react-dom\x27\nimport { browserHistory, Router, Route, Link, withRouter } from \x27react-router\x27\nimport auth from \x27.\/auth\x27\n\nconst App = React.createClass({\n  getInitialState() {\n    return {\n      loggedIn: auth.loggedIn()\n    }\n  },\n\n  updateAuth(loggedIn) {\n    this.setState({\n      loggedIn: loggedIn\n    })\n  },\n\n  componentWillMount() {\n    auth.onChange = this.updateAuth\n    auth.login()\n  },\n\n  render() {\n    return (\n      \x3cdiv\x3e\n        \x3cul\x3e\n          \x3cli\x3e\n            {this.state.loggedIn ? (\n              \x3cLink to=\x26quot;\/logout\x26quot;\x3eLog out\x3c\/Link\x3e\n            ) : (\n              \x3cLink to=\x26quot;\/login\x26quot;\x3eSign in\x3c\/Link\x3e\n            )}\n          \x3c\/li\x3e\n          \x3cli\x3e\x3cLink to=\x26quot;\/about\x26quot;\x3eAbout\x3c\/Link\x3e\x3c\/li\x3e\n          \x3cli\x3e\x3cLink to=\x26quot;\/dashboard\x26quot;\x3eDashboard\x3c\/Link\x3e (authenticated)\x3c\/li\x3e\n        \x3c\/ul\x3e\n        {this.props.children || \x3cp\x3eYou are {!this.state.loggedIn \x26amp;\x26amp; \x27not\x27} logged in.\x3c\/p\x3e}\n      \x3c\/div\x3e\n    )\n  }\n})\n\nconst Dashboard = React.createClass({\n  render() {\n    const token = auth.getToken()\n\n    return (\n      \x3cdiv\x3e\n        \x3ch1\x3eDashboard\x3c\/h1\x3e\n        \x3cp\x3eYou made it!\x3c\/p\x3e\n        \x3cp\x3e{token}\x3c\/p\x3e\n      \x3c\/div\x3e\n    )\n  }\n})\n\nconst Login = withRouter(\n  React.createClass({\n\n    getInitialState() {\n      return {\n        error: false\n      }\n    },\n\n    handleSubmit(event) {\n      event.preventDefault()\n\n      const email = this.refs.email.value\n      const pass = this.refs.pass.value\n\n      auth.login(email, pass, (loggedIn) =\x3e {\n        if (!loggedIn)\n          return this.setState({ error: true })\n\n        const { location } = this.props\n\n        if (location.state \x26amp;\x26amp; location.state.nextPathname) {\n          this.props.router.replace(location.state.nextPathname)\n        } else {\n          this.props.router.replace(\x27\/\x27)\n        }\n      })\n    },\n\n    render() {\n      return (\n        \x3cform onSubmit={this.handleSubmit}\x3e\n          \x3clabel\x3e\x3cinput ref=\x26quot;email\x26quot; placeholder=\x26quot;email\x26quot; defaultValue=\x26quot;joe@example.com\x26quot; \/\x3e\x3c\/label\x3e\n          \x3clabel\x3e\x3cinput ref=\x26quot;pass\x26quot; placeholder=\x26quot;password\x26quot; \/\x3e\x3c\/label\x3e (hint: password1)\x3cbr \/\x3e\n          \x3cbutton type=\x26quot;submit\x26quot;\x3elogin\x3c\/button\x3e\n          {this.state.error \x26amp;\x26amp; (\n            \x3cp\x3eBad login information\x3c\/p\x3e\n          )}\n        \x3c\/form\x3e\n      )\n    }\n  })\n)\n\nconst About = React.createClass({\n  render() {\n    return \x3ch1\x3eAbout\x3c\/h1\x3e\n  }\n})\n\nconst Logout = React.createClass({\n  componentDidMount() {\n    auth.logout()\n  },\n\n  render() {\n    return \x3cp\x3eYou are now logged out\x3c\/p\x3e\n  }\n})\n\nfunction requireAuth(nextState, replace) {\n  if (!auth.loggedIn()) {\n    replace({\n      pathname: \x27\/login\x27,\n      state: { nextPathname: nextState.location.pathname }\n    })\n  }\n}\n\nrender((\n  \x3cRouter history={browserHistory}\x3e\n    \x3cRoute path=\x26quot;\/\x26quot; component={App}\x3e\n      \x3cRoute path=\x26quot;login\x26quot; component={Login} \/\x3e\n      \x3cRoute path=\x26quot;logout\x26quot; component={Logout} \/\x3e\n      \x3cRoute path=\x26quot;about\x26quot; component={About} \/\x3e\n      \x3cRoute path=\x26quot;dashboard\x26quot; component={Dashboard} onEnter={requireAuth} \/\x3e\n    \x3c\/Route\x3e\n  \x3c\/Router\x3e\n), document.getElementById(\x27example\x27))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e React from \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { render } from \x3cspan class=\x22hljs-string\x22\x3e\x27react-dom\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { browserHistory, Router, Route, Link, withRouter } from \x3cspan class=\x22hljs-string\x22\x3e\x27react-router\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e auth from \x3cspan class=\x22hljs-string\x22\x3e\x27.\/auth\x27\x3c\/span\x3e\n\nconst App = React.createClass({\n  getInitialState() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n      loggedIn: auth.loggedIn()\n    }\n  },\n\n  updateAuth(loggedIn) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({\n      loggedIn: loggedIn\n    })\n  },\n\n  componentWillMount() {\n    auth.onChange = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.updateAuth\n    auth.login()\n  },\n\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;div\x26gt;\n        \x26lt;ul\x26gt;\n          \x26lt;li\x26gt;\n            {\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.loggedIn ? (\n              \x26lt;Link to=\x3cspan class=\x22hljs-string\x22\x3e\x22\/logout\x22\x3c\/span\x3e\x26gt;Log \x3cspan class=\x22hljs-keyword\x22\x3eout\x3c\/span\x3e\x26lt;\/Link\x26gt;\n            ) : (\n              \x26lt;Link to=\x3cspan class=\x22hljs-string\x22\x3e\x22\/login\x22\x3c\/span\x3e\x26gt;Sign \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e\x26lt;\/Link\x26gt;\n            )}\n          \x26lt;\/li\x26gt;\n          \x26lt;li\x26gt;\x26lt;Link to=\x3cspan class=\x22hljs-string\x22\x3e\x22\/about\x22\x3c\/span\x3e\x26gt;About\x26lt;\/Link\x26gt;\x26lt;\/li\x26gt;\n          \x26lt;li\x26gt;\x26lt;Link to=\x3cspan class=\x22hljs-string\x22\x3e\x22\/dashboard\x22\x3c\/span\x3e\x26gt;Dashboard\x26lt;\/Link\x26gt; (authenticated)\x26lt;\/li\x26gt;\n        \x26lt;\/ul\x26gt;\n        {\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.children || \x26lt;p\x26gt;You are {!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.loggedIn \x26amp;\x26amp; \x3cspan class=\x22hljs-string\x22\x3e\x27not\x27\x3c\/span\x3e} logged \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e.\x26lt;\/p\x26gt;}\n      \x26lt;\/div\x26gt;\n    )\n  }\n})\n\nconst Dashboard = React.createClass({\n  render() {\n    const token = auth.getToken()\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x26lt;div\x26gt;\n        \x26lt;h1\x26gt;Dashboard\x26lt;\/h1\x26gt;\n        \x26lt;p\x26gt;You made it!\x26lt;\/p\x26gt;\n        \x26lt;p\x26gt;{token}\x26lt;\/p\x26gt;\n      \x26lt;\/div\x26gt;\n    )\n  }\n})\n\nconst Login = withRouter(\n  React.createClass({\n\n    getInitialState() {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        error: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n      }\n    },\n\n    handleSubmit(event) {\n      event.preventDefault()\n\n      const email = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.refs.email.value\n      const pass = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.refs.pass.value\n\n      auth.login(email, pass, (loggedIn) =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!loggedIn)\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.setState({ error: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e })\n\n        const { location } = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (location.state \x26amp;\x26amp; location.state.nextPathname) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.router.replace(location.state.nextPathname)\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.router.replace(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e)\n        }\n      })\n    },\n\n    render() {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n        \x26lt;form onSubmit={\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleSubmit}\x26gt;\n          \x26lt;label\x26gt;\x26lt;input ref=\x3cspan class=\x22hljs-string\x22\x3e\x22email\x22\x3c\/span\x3e placeholder=\x3cspan class=\x22hljs-string\x22\x3e\x22email\x22\x3c\/span\x3e defaultValue=\x3cspan class=\x22hljs-string\x22\x3e\x22joe@example.com\x22\x3c\/span\x3e \/\x26gt;\x26lt;\/label\x26gt;\n          \x26lt;label\x26gt;\x26lt;input ref=\x3cspan class=\x22hljs-string\x22\x3e\x22pass\x22\x3c\/span\x3e placeholder=\x3cspan class=\x22hljs-string\x22\x3e\x22password\x22\x3c\/span\x3e \/\x26gt;\x26lt;\/label\x26gt; (hint: password1)\x26lt;br \/\x26gt;\n          \x26lt;button type=\x3cspan class=\x22hljs-string\x22\x3e\x22submit\x22\x3c\/span\x3e\x26gt;login\x26lt;\/button\x26gt;\n          {\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.state.error \x26amp;\x26amp; (\n            \x26lt;p\x26gt;Bad login information\x26lt;\/p\x26gt;\n          )}\n        \x26lt;\/form\x26gt;\n      )\n    }\n  })\n)\n\nconst About = React.createClass({\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;h1\x26gt;About\x26lt;\/h1\x26gt;\n  }\n})\n\nconst Logout = React.createClass({\n  componentDidMount() {\n    auth.logout()\n  },\n\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x26lt;p\x26gt;You are now logged \x3cspan class=\x22hljs-keyword\x22\x3eout\x3c\/span\x3e\x26lt;\/p\x26gt;\n  }\n})\n\nfunction requireAuth(nextState, replace) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!auth.loggedIn()) {\n    replace({\n      pathname: \x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e,\n      state: { nextPathname: nextState.location.pathname }\n    })\n  }\n}\n\nrender((\n  \x26lt;Router history={browserHistory}\x26gt;\n    \x26lt;Route path=\x3cspan class=\x22hljs-string\x22\x3e\x22\/\x22\x3c\/span\x3e component={App}\x26gt;\n      \x26lt;Route path=\x3cspan class=\x22hljs-string\x22\x3e\x22login\x22\x3c\/span\x3e component={Login} \/\x26gt;\n      \x26lt;Route path=\x3cspan class=\x22hljs-string\x22\x3e\x22logout\x22\x3c\/span\x3e component={Logout} \/\x26gt;\n      \x26lt;Route path=\x3cspan class=\x22hljs-string\x22\x3e\x22about\x22\x3c\/span\x3e component={About} \/\x26gt;\n      \x26lt;Route path=\x3cspan class=\x22hljs-string\x22\x3e\x22dashboard\x22\x3c\/span\x3e component={Dashboard} onEnter={requireAuth} \/\x26gt;\n    \x26lt;\/Route\x26gt;\n  \x26lt;\/Router\x26gt;\n), document.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27example\x27\x3c\/span\x3e))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3eauth.js\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22module.exports = {\n  login(email, pass, cb) {\n    cb = arguments[arguments.length - 1]\n    if (localStorage.token) {\n      if (cb) cb(true)\n      this.onChange(true)\n      return\n    }\n    pretendRequest(email, pass, (res) =\x3e {\n      if (res.authenticated) {\n        localStorage.token = res.token\n        if (cb) cb(true)\n        this.onChange(true)\n      } else {\n        if (cb) cb(false)\n        this.onChange(false)\n      }\n    })\n  },\n\n  getToken() {\n    return localStorage.token\n  },\n\n  logout(cb) {\n    delete localStorage.token\n    if (cb) cb()\n    this.onChange(false)\n  },\n\n  loggedIn() {\n    return !!localStorage.token\n  },\n\n  onChange() {}\n}\n\nfunction pretendRequest(email, pass, cb) {\n  setTimeout(() =\x3e {\n    if (email === \x27joe@example.com\x27 \x26amp;\x26amp; pass === \x27password1\x27) {\n      cb({\n        authenticated: true,\n        token: Math.random().toString(36).substring(7)\n      })\n    } else {\n      cb({ authenticated: false })\n    }\n  }, 0)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n  login(email, pass, cb) {\n    cb = \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e[\x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e.length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (localStorage.token) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (cb) cb(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onChange(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n    }\n    pretendRequest(email, pass, \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (res.authenticated) {\n        localStorage.token = res.token\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (cb) cb(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onChange(\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e)\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (cb) cb(\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onChange(\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n      }\n    })\n  },\n\n  getToken() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e localStorage.token\n  },\n\n  logout(cb) {\n    \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e localStorage.token\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (cb) cb()\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.onChange(\x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n  },\n\n  loggedIn() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e !!localStorage.token\n  },\n\n  onChange() {}\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epretendRequest\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eemail, pass, cb\x3c\/span\x3e) \x3c\/span\x3e{\n  setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (email === \x3cspan class=\x22hljs-string\x22\x3e\x27joe@example.com\x27\x3c\/span\x3e \x26amp;\x26amp; pass === \x3cspan class=\x22hljs-string\x22\x3e\x27password1\x27\x3c\/span\x3e) {\n      cb({\n        authenticated: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        token: \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random().toString(\x3cspan class=\x22hljs-number\x22\x3e36\x3c\/span\x3e).substring(\x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e)\n      })\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      cb({ authenticated: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e })\n    }\n  }, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3elocalStorage等本地存储容器保存一些用户信息，多少可能会有潜在的风险，那么可不可以不使用这些本地存储来维持用户状态呢？\x3c\/p\x3e\n\x3cp\x3e于是我尝试用redux结合react-router来保持用户的登录状态，最开始的思路是用onEnter调用一个方法来获取store里的登录状态信息，但是发现react-router的路由声明中并不能从store中拿到props，只有路由的history等信息。可能水平有限，只能到处翻文档，无意间在Github中发现一个用例：\x3ca href=\x22https:\/\/github.com\/joshgeller\/react-redux-jwt-auth-example\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereact-redux-jwt-auth-example\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e这个用例使用了一个高级函数(high-order function，用例中为requireAuthentication)来包装需要登录权限的Compenent(用例中为ProtectedView)，这个Compenent位于所有需要登录权限的顶层：\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3erouters.js\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import {HomeView, LoginView, ProtectedView, AView, BView } from \x27..\/views\x27;\nimport {requireAuthentication} from \x27..\/components\/AuthenticatedComponent\x27;\n\nexport default(\n    \x3cRoute path=\x27\/\x27 component={App}\x3e\n        \x3cIndexRoute component={HomeView}\/\x3e\n        \x3cRoute path=\x26quot;login\x26quot; component={LoginView}\/\x3e\n        \x3cRoute path=\x26quot;protected\x26quot; component={requireAuthentication(ProtectedView)}\n            \x3cRoute path=\x26quot;a\x26quot; component={AView}\/\x3e\n            \x3cRoute path=\x26quot;b\x26quot; component={BVieew}\/\x3e\n        \x3c\/Route\x3e\n    \x3c\/Route\x3e\n);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dust\x22\x3e\x3ccode\x3e\x3cspan class=\x22xml\x22\x3eimport \x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e{HomeView, LoginView, ProtectedView, AView, BView }\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e from \x27..\/views\x27;\nimport \x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e{requireAuthentication}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e from \x27..\/components\/AuthenticatedComponent\x27;\n\nexport default(\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRoute\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e=\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e{App}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eIndexRoute\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e=\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e{HomeView}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\/\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRoute\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22login\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e=\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e{LoginView}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\/\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRoute\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22protected\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e=\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e{requireAuthentication(ProtectedView)}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\n            \x26lt;\x3cspan class=\x22hljs-attr\x22\x3eRoute\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22a\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e=\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e{AView}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\/\x26gt;\x3c\/span\x3e\n            \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRoute\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22b\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e=\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e{BVieew}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\/\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eRoute\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eRoute\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n);\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e利用requireAuthentication()这个高阶函数将ProtectedView这个Compenent作为参数传人，requireAuthentication()中生成一个Compenent，然后调用react-redux中的connect结合mapStateToProps就能将store中的登录状态，token等信息塞入Props中，当前这个requireAuthentication中的Compenent根据Props中的状态信息来决定是否继续渲染ProtectedView Compenent，或者在用户进行页面跳转，检测到登录状态为false时，就会重定向到登录页面。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eAuthenticatedComponent.js\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import React from \x27react\x27;\nimport {connect} from \x27react-redux\x27;\nimport {pushState} from \x27redux-router\x27;\n\nexport function requireAuthentication(Component) {\n\n    class AuthenticatedComponent extends React.Component {\n\n        componentWillMount() {\n            this.checkAuth();\n        }\n\n        componentWillReceiveProps(nextProps) {\n            this.checkAuth();\n        }\n\n        checkAuth() {\n            if (!this.props.isAuthenticated) {\n                let redirectAfterLogin = this.props.location.pathname;\n                this.props.dispatch(pushState(null, `\/login?next=${redirectAfterLogin}`));\n            }\n        }\n\n        render() {\n            return (\n                \x3cdiv\x3e\n                    {this.props.isAuthenticated === true\n                        ? \x3cComponent {...this.props}\/\x3e\n                        : null\n                    }\n                \x3c\/div\x3e\n            )\n\n        }\n    }\n\n    const mapStateToProps = (state) =\x3e ({\n        token: state.auth.token,\n        userName: state.auth.userName,\n        isAuthenticated: state.auth.isAuthenticated\n    });\n\n    return connect(mapStateToProps)(AuthenticatedComponent);\n\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eReact\x3c\/span\x3e from \x3cspan class=\x22hljs-symbol\x22\x3e\x27reac\x3c\/span\x3et\x27;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {connect} from \x3cspan class=\x22hljs-symbol\x22\x3e\x27react\x3c\/span\x3e-redux\x27;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {pushState} from \x3cspan class=\x22hljs-symbol\x22\x3e\x27redux\x3c\/span\x3e-router\x27;\n\nexport function requireAuthentication(\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e) {\n\n    \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eAuthenticatedComponent\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n\n        componentWillMount() {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.checkAuth();\n        }\n\n        componentWillReceiveProps(nextProps) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.checkAuth();\n        }\n\n        checkAuth() {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.isAuthenticated) {\n                let redirectAfterLogin = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.location.pathname;\n                \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.dispatch(pushState(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, `\/login?next=${redirectAfterLogin}`));\n            }\n        }\n\n        render() {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n                \x26lt;div\x26gt;\n                    {\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props.isAuthenticated === \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n                        ? \x26lt;\x3cspan class=\x22hljs-type\x22\x3eComponent\x3c\/span\x3e {...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props}\/\x26gt;\n                        : \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n                    }\n                \x26lt;\/div\x26gt;\n            )\n\n        }\n    }\n\n    const mapStateToProps = (state) =\x26gt; ({\n        token: state.auth.token,\n        userName: state.auth.userName,\n        isAuthenticated: state.auth.isAuthenticated\n    });\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e connect(mapStateToProps)(\x3cspan class=\x22hljs-type\x22\x3eAuthenticatedComponent\x3c\/span\x3e);\n\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面是作者给的用法，其中需要注意的是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import {pushState} from \x27redux-router\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {pushState} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-router\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e由于\x3ca href=\x22https:\/\/segmentfault.com\/q\/1010000004959826\x22\x3e几个react-router的区别\x3c\/a\x3e这个问题，打包编译后可能报错，我项目中使用的是react-router-redux。\x3c\/p\x3e\n\x3cp\x3e参考\x3ca href=\x22https:\/\/github.com\/reactjs\/react-router-redux\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereact-router-redux\x3c\/a\x3e文档中\x3cstrong\x3eWhat if I want to issue navigation events via Redux actions?\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e使用方法是在AuthenticatedComponent中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import {push} react-router-redux\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs elm\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {push} react-router-redux\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e也就是push代替了原例子中的pushState，作用都差不多。\x3c\/p\x3e\n\x3cp\x3e然后就是加一个中间件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { routerMiddleware, push } from \x27react-router-redux\x27\n\n\/\/ Apply the middleware to the store\nconst middleware = routerMiddleware(browserHistory)\nconst store = createStore(\n  reducers,\n  applyMiddleware(middleware)\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { routerMiddleware, push } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react-router-redux\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Apply the middleware to the store\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e middleware = routerMiddleware(browserHistory)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e store = createStore(\n  reducers,\n  applyMiddleware(middleware)\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样就可以在AuthenticatedComponent中愉快地重定向了。\x3c\/p\x3e\n\x3cp\x3e以上利用react-redux，redux-router || react-router-redux基于redux来保持登录状态和进行登录权限验证，可以避免使用Cookie\x26amp;localStroge等来保存登录信息，其中的缺点就是，用户刷新页面或关闭浏览器后，登录状态就被销毁了，如果有记住用户名等需求，可能依然会用到本地存储容器。\x3c\/p\x3e\n\x3cp\x3e翻阅这个用例最后还发现作者已经写了一个登录权限验证的library：\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/mjrussell\/redux-auth-wrapper\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-auth-wrapper\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e不想搬运代码的兄弟可以参考文档直接拿来用~\x3c\/p\x3e\n\x3cp\x3e第一次写文章，如果有概念错误的地方，请多多指正！！感谢！！\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Redux中利用函数式组件替代onEnter进行登录状态验证的实践</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005607817">https://segmentfault.com/a/1190000005607817</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/labbulbd27r/" target="_blank">https://alili.tech/archive/labbulbd27r/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>