<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="webpack使用优化（react篇）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>webpack使用优化（react篇） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/zh7st1s4rui/",
				"appid": "1613049289050283", 
				"title": "webpack使用优化（react篇） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-09T02:30:59"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/2xqtorzid0w/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/957bsgd0at/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fzh7st1s4rui%2f&text=webpack%e4%bd%bf%e7%94%a8%e4%bc%98%e5%8c%96%ef%bc%88react%e7%af%87%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fzh7st1s4rui%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fzh7st1s4rui%2f&text=webpack%e4%bd%bf%e7%94%a8%e4%bc%98%e5%8c%96%ef%bc%88react%e7%af%87%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fzh7st1s4rui%2f&title=webpack%e4%bd%bf%e7%94%a8%e4%bc%98%e5%8c%96%ef%bc%88react%e7%af%87%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fzh7st1s4rui%2f&is_video=false&description=webpack%e4%bd%bf%e7%94%a8%e4%bc%98%e5%8c%96%ef%bc%88react%e7%af%87%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=webpack%e4%bd%bf%e7%94%a8%e4%bc%98%e5%8c%96%ef%bc%88react%e7%af%87%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fzh7st1s4rui%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fzh7st1s4rui%2f&title=webpack%e4%bd%bf%e7%94%a8%e4%bc%98%e5%8c%96%ef%bc%88react%e7%af%87%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzh7st1s4rui%2f&title=webpack%e4%bd%bf%e7%94%a8%e4%bc%98%e5%8c%96%ef%bc%88react%e7%af%87%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzh7st1s4rui%2f&title=webpack%e4%bd%bf%e7%94%a8%e4%bc%98%e5%8c%96%ef%bc%88react%e7%af%87%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzh7st1s4rui%2f&title=webpack%e4%bd%bf%e7%94%a8%e4%bc%98%e5%8c%96%ef%bc%88react%e7%af%87%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">webpack使用优化（react篇）</h1><div class="meta"><div class="postdate"><time datetime="2019-02-09" itemprop="datePublished">2019-02-09</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/lcxfs1991\/blog\/issues\/7\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e原文链接\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/lcxfs1991\/blog\/issues\/8\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《React移动web极致优化》\x3c\/a\x3e也提到了，构建工具是前端优化的重要一环。而React的推荐构建工具则是Webpack。这篇文章我们就来聊聊如何在Webpack构建的过程中如何针对React的应用做一些优化。\x3c\/p\x3e\n\x3cp\x3e如果还没看过\x3ca href=\x22https:\/\/github.com\/lcxfs1991\/blog\/issues\/2\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《webpack使用优化（基本篇）》\x3c\/a\x3e这篇文章，建议去看看，因为针对React的优化往往也离不开Webpack那些最基本的优化点。此外，在这里将Webpack视作构建可能招来一些人的反对，他们会将Webpack定位成打包的工具。但实际项目中，除了合图以外，家校群项目已将Webpack将为最核心的构建工具。\x3c\/p\x3e\n\x3cp\x3e本篇文章的成果最终都会转化成一个开源的boilerplate, \x3ca href=\x22https:\/\/github.com\/lcxfs1991\/steamer-react\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esteamer-react\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e目录结构\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006767128\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006767128\x22 alt=\x2215\x22 title=\x2215\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e构建工具离不开目录的设计，我们需要安排号文件存放的位置才便于构建工程的开展。在src目录下一级的文件，除了page文件夹是react的主体逻辑文件之外，其它的像img, js, css, libs，都属于各个页面都会用到的公共文件，如utils, 上报等。\x3c\/p\x3e\n\x3cp\x3epage目录下，common文件夹主要旋转跟React相关的一些公共的文件，如公共的component，中间件等。而其它的文件夹就是每个页面的主体逻辑和资源，另外就是页面对应的html文件。\x3c\/p\x3e\n\x3cp\x3e由于家校群采用的是React\x2b Redux这套方案，我们文件夹的名字也很能体现这套方案的特色。首先组件Component方面，我们比较认同Redux推崇的smart component(container)和dump component，因此它们分别放置在container和component文件夹下。那container和component文件夹下面放在什么呢？我们放置了组件相关的逻辑js和样式scss文件。我们暂时没将图片放在组件这一层，而是放在页面这一层，是因为我们业务不同组件间共用了不少图片，因此放在更上一层更为合适。\x3c\/p\x3e\n\x3cp\x3e而store, reducer, action, connect都是跟Redux这个数据处理框架相关。像root这样的文件夹则是项目的主入口，里面有root.dev.js和root.prod.js，用于区分开发环境与生产环境对应需要引入的组件。\x3c\/p\x3e\n\x3cp\x3e如果你还用到React-Router，可能你还需要多加一个route的文件夹，里面用存放项目route的配置文件。\x3c\/p\x3e\n\x3cp\x3e这套文件架构比较传统的gulp和grunt复杂，但却更符合React \x2b Redux这套方案的开发思路。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e针对React的优化点\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e需要维护两套构建配置\x3c\/h3\x3e\n\x3cp\x3eWebpack跟Gulp和Grunt不同，前者属于配置型构建（当然也可以通过插件去做一些流程），后两者属于任务型的构建。以前在用Gulp开发的时候，也会写一些任务专门针对开发或者生产的环境，分别再建两条任务流，分别去处理开发与生产环境的构建。同理Webpack也需要去处理开发与生产环境的构建，因此也需要两套配置去实现。\x3c\/p\x3e\n\x3cp\x3e如果搞不清楚什么任务应该放在开发环境，什么应该放在生产环境，可以参考\x3ca href=\x22https:\/\/github.com\/lcxfs1991\/blog\/issues\/4\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《性能优化三部曲之一——构建篇》\x3c\/a\x3e，里有有详情参考；如果不知道如何去区分开发与生产环境，可以参考《webpack使用优化（基本篇）》(\x3ca href=\x22https:\/\/github.com\/lcxfs1991\/blog\/issues\/2)\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/lcxfs1991\/blog\/issues\/2)\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e这里想提出来说的有2点：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e第一，是建议开发环境的配置是生产环境的子集。\x3cbr\x3e这样顺着写下来比较流畅，毕竟我们是先考虑开发，等开发完之后才会去构思生产环境的部署。这时我们可以直接用Object.assign去复制开发环境写好的配置，进行修改便是。也可以添加一些方法方便处理更新配置，例如生产环境想去添加新的插件，我参考了之前看过的一个boilerplate：\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22devConfig.addPlugins = function(plugin, opt) {\n    devConfig.plugins.push(new plugin(opt));\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3edevConfig.addPlugins = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(plugin, opt)\x3c\/span\x3e \x3c\/span\x3e{\n    devConfig.plugins.push(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e plugin(opt));\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e第二，是React是否使用外链问题。在开发环境下，建议直接引入node_modules包的，因为里面有许多有用的报错和提示，方便开发时快速发现问题。而生产环境自然是建议外链，否则Webpack就会自作主线地把React和你的业务逻辑打包到一起，比分开打包要大得多。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3eReact的ES2015编译\x3c\/h3\x3e\n\x3cp\x3eES2015近2年很火热，我们也来尝尝鲜。用ES2015的最大好处就是可以使用许多方便的特性，但有一个小小的坏处就是，你可能忽略ES5的写法，而ES5的写法很多时候能够清楚地表示出React的实现方式，对理解框架和原理更有帮助。\x3c\/p\x3e\n\x3cp\x3e另外就是，用这些新的特性，会有一些不稳定的因素，就是不知道转换之后会成什么样子，转换后的代码兼容性如何（具体可参\x3ca href=\x22https:\/\/github.com\/lcxfs1991\/blog\/issues\/9\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《babel到底将代码转换成什么鸟样？》\x3c\/a\x3e]）。果不其然，我们发布列表页之后发现一个报错：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Uncaught TypeError: Cannot assign to read only property \x27__esModule\x27 of #\x3cObject\x3e。\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs delphi\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3eUncaught TypeError: Cannot assign \x3cspan class=\x22hljs-keyword\x22\x3eto\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eread\x3c\/span\x3e only \x3cspan class=\x22hljs-keyword\x22\x3eproperty\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27__esModule\x27\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e #\x26lt;\x3cspan class=\x22hljs-keyword\x22\x3eObject\x3c\/span\x3e\x26gt;。\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e解决办法，就是babel编译使用ES2015-Loose而不是ES2015的preset。具体转换的代码如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000005606962\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000005606962\x22 alt=\x2216\x22 title=\x2216\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e具体在Webpack的loaders里可以这样写你的编译配置\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{ \n    test: \/\\.js?$\/,\n    loader: \x27babel\x27,\n    query: {\n        plugins: [\x27transform-decorators-legacy\x27],   \/\/\/ 使用decorator写法\n        presets: [\n            \x27es2015-loose\x27,    \/\/ ES2015 loose mode\n            \x27react\x27,\n        ]\n    },\n    exclude: \/node_modules\/,\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gradle\x22\x3e\x3ccode\x3e{ \n    test: \x3cspan class=\x22hljs-regexp\x22\x3e\/\\.js?$\/\x3c\/span\x3e,\n    loader: \x3cspan class=\x22hljs-string\x22\x3e\x27babel\x27\x3c\/span\x3e,\n    query: {\n        plugins: [\x3cspan class=\x22hljs-string\x22\x3e\x27transform-decorators-legacy\x27\x3c\/span\x3e],   \x3cspan class=\x22hljs-comment\x22\x3e\/\/\/ 使用decorator写法\x3c\/span\x3e\n        presets: [\n            \x3cspan class=\x22hljs-string\x22\x3e\x27es2015-loose\x27\x3c\/span\x3e,    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ES2015 loose mode\x3c\/span\x3e\n            \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e,\n        ]\n    },\n    \x3cspan class=\x22hljs-keyword\x22\x3eexclude\x3c\/span\x3e: \x3cspan class=\x22hljs-regexp\x22\x3e\/node_modules\/\x3c\/span\x3e,\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e除此之外，我们也发现每个Webpack打包的模块，最终编译都会生成一堆类似的代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n    function _interopRequireDefault(obj) { return obj \x26amp;\x26amp; obj.__esModule ? obj : { default: obj }; }\n\n    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\x26quot;Cannot call a class as a function\x26quot;); } }\n\n    ......\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e_interopRequireDefault\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e obj \x26amp;\x26amp; obj.__esModule ? obj : { \x3cspan class=\x22hljs-attr\x22\x3edefault\x3c\/span\x3e: obj }; }\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e_classCallCheck\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3einstance, Constructor\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(instance \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e Constructor)) { \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eTypeError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22Cannot call a class as a function\x22\x3c\/span\x3e); } }\n\n    ......\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这些是Babel对ES2015转义生成的代码片段。多的时候，每个模块生成的这些代码都接近1kb。如果你的component多，例如像家校群有超过20组件，后面的详情页的组件可能更多，这么多组件合起来重复的代码可能就近20kb。在PC端20kb没有所谓，但到移动端却对bundle的大小锱铢必较。建议写一个Webpack plugin\/loader对这些代码进行去重（反正没看到Webpack有插件，机会就留给你们了）。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e如何热替换css\x3c\/h3\x3e\n\x3cp\x3e打包css的时候，我们习惯使用ExtractTextPlugin让css单独生成一个文件。但如果你想让css也能够热替换，在开发环境的时候请去掉这个插件让样式内联。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eWebpack慎用devtools的inline-source-map模式\x3c\/h3\x3e\n\x3cp\x3e使用此模式会内联一大段便于定位bug的字符串，查错时可以开启，不是查错时建议\x3cbr\x3e关闭，否则开发时加载的包会非常大。\x3c\/p\x3e\n\x3cp\x3e如果不使用devtools查错，你看到的会是合成之后的bundle，上万行代码，也不知道是哪个文件：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000005606964\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000005606964\x22 alt=\x2217\x22 title=\x2217\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e。\x3c\/p\x3e\n\x3cp\x3e使用了之后，你就很很清晰是在哪个文件，哪一行了：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000005606966\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000005606966\x22 alt=\x2218\x22 title=\x2218\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e如果无法使用服务器构建，开发时请让小伙伴统一开发路径\x3c\/h3\x3e\n\x3cp\x3ewebpack的bug导致如果本地开发目录路径不一致，编译出来的md5会不一致。所以推荐使用服务器构建。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3eReact项目的合图\x3c\/h2\x3e\n\x3cp\x3e在搭项目构建的时候，曾经尝试过用Webpack一个合图插件，但因不够成熟而弃用，转而考虑转投向gulp的合图插件的怀抱。由于家校群功能页面是一个多页项目，每个页面都会有合图，因此我们选用了\x3ca href=\x22https:\/\/www.npmjs.com\/package\/gulp.spritesmith-multi\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egulp.spritesmith-multi\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e以前使用gulp的构建项目，css都同一放在一层，引用图片的路径都放在一个css里面。但面对React的项目，我们每一个component都有自己对应的index.js（处理逻辑）和index.scss（处理样式），由于这个合图插件只能标出一个图片路径，因此如果合图的引用发生在不同层次的component，绝对会发生找不到文件的报错，因此我们统一将引用放在container的样式文件中，权宜地解决这个问题，以下是大致gulpfile写法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22gulp.task(\x27sprites\x27, function (cb) {\n    var spriteData = gulp.src(Config.filePath.src \x2b \x27img\/sprites\/**\/*.png\x27)\n                        .pipe(spritesmith({\n                            spritesmith: function(options) {\n                                options.imgPath = Config.sprites.imgPath \x2b options.imgName;\n\n                                options.cssName = options.cssName.replace(\x27.css\x27, \x27.scss\x27);\n                                \/\/ customized generated css template\n                                options.cssTemplate = \x27.\/config\/scss.template.handlebars\x27;\n                            }\n                          }));\n    \n      \/\/ Pipe image stream through image optimizer and onto disk\n      var imgStream = spriteData.img\n    \/\/ DEV: We must buffer our stream into a Buffer for `imagemin`\n    .pipe(gulp.dest(Config.sprites.imgDest));\n\n      \/\/ Pipe CSS stream through CSS optimizer and onto disk\n      var cssStream = spriteData.css\n    .pipe(gulp.dest(Config.sprites.cssDest));\n\n      \/\/ Return a merged stream to handle both `end` events\n      return merge(imgStream, cssStream);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3egulp.task(\x3cspan class=\x22hljs-string\x22\x3e\x27sprites\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(cb)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e spriteData = gulp.src(Config.filePath.src \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27img\/sprites\/**\/*.png\x27\x3c\/span\x3e)\n                        .pipe(spritesmith({\n                            spritesmith: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(options)\x3c\/span\x3e \x3c\/span\x3e{\n                                options.imgPath = Config.sprites.imgPath \x2b options.imgName;\n\n                                options.cssName = options.cssName.replace(\x3cspan class=\x22hljs-string\x22\x3e\x27.css\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27.scss\x27\x3c\/span\x3e);\n                                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ customized generated css template\x3c\/span\x3e\n                                options.cssTemplate = \x3cspan class=\x22hljs-string\x22\x3e\x27.\/config\/scss.template.handlebars\x27\x3c\/span\x3e;\n                            }\n                          }));\n    \n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Pipe image stream through image optimizer and onto disk\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e imgStream = spriteData.img\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ DEV: We must buffer our stream into a Buffer for `imagemin`\x3c\/span\x3e\n    .pipe(gulp.dest(Config.sprites.imgDest));\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Pipe CSS stream through CSS optimizer and onto disk\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e cssStream = spriteData.css\n    .pipe(gulp.dest(Config.sprites.cssDest));\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Return a merged stream to handle both `end` events\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e merge(imgStream, cssStream);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e以下是样式引用办法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22@import\x26quot;..\/..\/..\/css\/sprites\/list_s\x26quot;;\n\n......\n\n.info-right.tiku-status3 {\n    @include sprite($remark);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scss\x22\x3e\x3ccode\x3e@\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22..\/..\/..\/css\/sprites\/list_s\x22\x3c\/span\x3e;\n\n......\n\n\x3cspan class=\x22hljs-selector-class\x22\x3e.info-right\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.tiku-status3\x3c\/span\x3e {\n    @\x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e sprite(\x3cspan class=\x22hljs-variable\x22\x3e$remark\x3c\/span\x3e);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如有错误，恳请斧正!\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>webpack使用优化（react篇）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000005606957">https://segmentfault.com/a/1190000005606957</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/zh7st1s4rui/" target="_blank">https://alili.tech/archive/zh7st1s4rui/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>