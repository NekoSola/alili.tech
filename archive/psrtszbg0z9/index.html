<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="在Nodejs中贯彻单元测试"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>在Nodejs中贯彻单元测试 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/psrtszbg0z9/",
				"appid": "1613049289050283", 
				"title": "在Nodejs中贯彻单元测试 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-12T02:30:12"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/3hcs2kda7ld/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/byzaznryth5/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fpsrtszbg0z9%2f&text=%e5%9c%a8Nodejs%e4%b8%ad%e8%b4%af%e5%bd%bb%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fpsrtszbg0z9%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fpsrtszbg0z9%2f&text=%e5%9c%a8Nodejs%e4%b8%ad%e8%b4%af%e5%bd%bb%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fpsrtszbg0z9%2f&title=%e5%9c%a8Nodejs%e4%b8%ad%e8%b4%af%e5%bd%bb%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fpsrtszbg0z9%2f&is_video=false&description=%e5%9c%a8Nodejs%e4%b8%ad%e8%b4%af%e5%bd%bb%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%9c%a8Nodejs%e4%b8%ad%e8%b4%af%e5%bd%bb%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fpsrtszbg0z9%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fpsrtszbg0z9%2f&title=%e5%9c%a8Nodejs%e4%b8%ad%e8%b4%af%e5%bd%bb%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpsrtszbg0z9%2f&title=%e5%9c%a8Nodejs%e4%b8%ad%e8%b4%af%e5%bd%bb%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpsrtszbg0z9%2f&title=%e5%9c%a8Nodejs%e4%b8%ad%e8%b4%af%e5%bd%bb%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fpsrtszbg0z9%2f&title=%e5%9c%a8Nodejs%e4%b8%ad%e8%b4%af%e5%bd%bb%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">在Nodejs中贯彻单元测试</h1><div class="meta"><div class="postdate"><time datetime="2019-02-12" itemprop="datePublished">2019-02-12</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3e原文链接：\x3ca href=\x22http:\/\/huang-jerryc.com\/2015\/07\/30\/%E5%9C%A8Nodejs%E4%B8%AD%E8%B4%AF%E5%BD%BB%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eBlueSun | 在Nodejs中贯彻单元测试\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e在团队合作中，你写好了一个函数，供队友使用，跑去跟你的队友说，你传个A值进去，他就会返回B结果了。过了一会，你队友跑过来说，我传个A值却返回C结果，怎么回事？你丫的有没有测试过啊？\x3c\/p\x3e\n\x3cp\x3e大家一起写个项目，难免会有我要写的函数里面依赖别人的函数，但是这个函数到底值不值得信赖？单元测试是衡量代码质量的一重要标准，纵观Github的受欢迎项目，都是有test文件夹，并且buliding-pass的。如果你也为社区贡献过module，想更多人使用的话，加上单元测试吧，让你的module值得别人信赖。\x3c\/p\x3e\n\x3cp\x3e要在Nodejs中写单元测试的话，你需要知道用什么测试框架，怎么测试异步函数，怎么测试私有方法，怎么模拟测试环境，怎么测试依赖HTTP协议的web应用，需要了解TDD和BDD，还有需要提供测试的覆盖率。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e本文的示例代码会备份到 Github : \x3ca href=\x22https:\/\/github.com\/JerryC8080\/unittest-demo\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eunittest-demo\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e目录\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e测试框架\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e断言库\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e需求变更\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e异步测试\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e异常测试\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e测试私有方法\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e测试Web应用\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e覆盖率\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e使用Makefile把测试串起来\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e持续集成，Travis-cli\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e一些观点\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e彩蛋\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e整理\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e测试框架\x3c\/h2\x3e\n\x3cp\x3eNodejs的测试框架还用说？大家都在用，Mocha。\x3c\/p\x3e\n\x3cp\x3eMocha 是一个功能丰富的Javascript测试框架，它能运行在Node.js和浏览器中，支持\x3cstrong\x3eBDD\x3c\/strong\x3e、\x3cstrong\x3eTDD\x3c\/strong\x3e、\x3cstrong\x3eQUnit\x3c\/strong\x3e、\x3cstrong\x3eExports\x3c\/strong\x3e式的测试，本文主要示例是使用更接近与思考方式的BDD，如果了解更多可以访问Mocha的\x3ca href=\x22http:\/\/mochajs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e官网\x3c\/a\x3e\x3c\/p\x3e\n\x3ch4\x3e\x3c\/h4\x3e\n\x3ch4\x3e测试接口\x3c\/h4\x3e\n\x3cp\x3eMocha的BDD接口有：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3edescribe()\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eit()\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ebefore()\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eafter()\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ebeforeEach()\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eafterEach()\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e安装\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3enpm install mocha -g\x3c\/code\x3e\x3c\/p\x3e\n\x3ch4\x3e编写一个稳定可靠的模块\x3c\/h4\x3e\n\x3cp\x3e模块具备limit方法，输入一个数值，小于0的时候返回0，其余正常返回\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22exports.limit = function (num) {\n  if (num \x3c 0) {\n    return 0;\n  }\n  return num;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eexports.limit = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enum\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (num \x26lt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e目录分配\x3c\/h4\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3elib\x3c\/code\x3e，存放模块代码的地方\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3etest\x3c\/code\x3e，存放单元测试代码的地方\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eindex.js\x3c\/code\x3e，向外导出模块的地方\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3epackage.json\x3c\/code\x3e，包描述文件\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e测试\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var lib = require(\x27index\x27);\n\ndescribe(\x27module\x27, function () {\n  describe(\x27limit\x27, function () {\n    it(\x27limit should success\x27, function () {\n      lib.limit(10);\n    });\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e lib = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27index\x27\x3c\/span\x3e);\n\ndescribe(\x3cspan class=\x22hljs-string\x22\x3e\x27module\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  describe(\x3cspan class=\x22hljs-string\x22\x3e\x27limit\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    it(\x3cspan class=\x22hljs-string\x22\x3e\x27limit should success\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      lib.limit(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e);\n    });\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e结果\x3c\/h4\x3e\n\x3cp\x3e在当前目录下执行\x3ccode\x3emocha\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ mocha\n\n  ․\n\n  ✔ 1 test complete (2ms)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3e$ mocha\n\n  ․\n\n  ✔ \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e test complete (\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3ems)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e断言库\x3c\/h2\x3e\n\x3cp\x3e上面的代码只是运行了代码，并没有对结果进行检查，这时候就要用到断言库了，Node.js中常用的断言库有：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eshould.js\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eexpect.js\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3echai\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e加上断言\x3c\/h4\x3e\n\x3cp\x3e使用\x3ccode\x3eshould\x3c\/code\x3e库为测试用例加上断言\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22it(\x27limit should success\x27, function () {\n  lib.limit(10).should.be.equal(10);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eit(\x3cspan class=\x22hljs-string\x22\x3e\x27limit should success\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  lib.limit(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e).should.be.equal(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e需求变更\x3c\/h2\x3e\n\x3cp\x3e需求变更啦：\x26nbsp;\x3ccode\x3elimit\x3c\/code\x3e这个方法还要求返回值大于100时返回100。\x3c\/p\x3e\n\x3cp\x3e针对需求重构代码之后，正是测试用例的价值所在了，\x3c\/p\x3e\n\x3cp\x3e它能确保你的改动对原有成果没有造成破坏。\x3c\/p\x3e\n\x3cp\x3e但是，你要多做的一些工作的是，需要为新的需求编写新的测试代码。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e异步测试\x3c\/h2\x3e\n\x3ch4\x3e测试异步回调\x3c\/h4\x3e\n\x3cp\x3elib库中新增async函数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22exports.async = function (callback) {\n  setTimeout(function () {\n    callback(10);\n  }, 10);\n};    \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eexports.async = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e) \x3c\/span\x3e{\n  setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    callback(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e);\n  }, \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e);\n};    \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e测试异步代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22describe(\x27async\x27, function () {\n  it(\x27async\x27, function (done) {\n    lib.async(function (result) {\n      done();\n    });\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edescribe(\x3cspan class=\x22hljs-string\x22\x3e\x27async\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  it(\x3cspan class=\x22hljs-string\x22\x3e\x27async\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edone\x3c\/span\x3e) \x3c\/span\x3e{\n    lib.async(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e) \x3c\/span\x3e{\n      done();\n    });\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e测试Promise\x3c\/h4\x3e\n\x3cp\x3e使用should提供的Promise断言接口:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3efinally\x3c\/code\x3e | \x3ccode\x3eeventually\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3efulfilled\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3efulfilledWith\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3erejected\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3erejectedWith\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ethen\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e测试代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22describe(\x27should\x27, function () {\n  describe(\x27#Promise\x27, function () {\n    it(\x27should.reject\x27, function () {\n      (new Promise(function (resolve, reject) {\n        reject(new Error(\x27wrong\x27));\n      })).should.be.rejectedWith(\x27wrong\x27);\n    });\n\n    it(\x27should.fulfilled\x27, function () {\n      (new Promise(function (resolve, reject) {\n        resolve({username: \x27jc\x27, age: 18, gender: \x27male\x27})\n      })).should.be.fulfilled().then(function (it) {\n          it.should.have.property(\x27username\x27, \x27jc\x27);\n        })\n    });\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edescribe(\x3cspan class=\x22hljs-string\x22\x3e\x27should\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  describe(\x3cspan class=\x22hljs-string\x22\x3e\x27#Promise\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    it(\x3cspan class=\x22hljs-string\x22\x3e\x27should.reject\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      (\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n        reject(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27wrong\x27\x3c\/span\x3e));\n      })).should.be.rejectedWith(\x3cspan class=\x22hljs-string\x22\x3e\x27wrong\x27\x3c\/span\x3e);\n    });\n\n    it(\x3cspan class=\x22hljs-string\x22\x3e\x27should.fulfilled\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      (\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n        resolve({\x3cspan class=\x22hljs-attr\x22\x3eusername\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27jc\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e18\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3egender\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27male\x27\x3c\/span\x3e})\n      })).should.be.fulfilled().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eit\x3c\/span\x3e) \x3c\/span\x3e{\n          it.should.have.property(\x3cspan class=\x22hljs-string\x22\x3e\x27username\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27jc\x27\x3c\/span\x3e);\n        })\n    });\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e异步方法的超时支持\x3c\/h4\x3e\n\x3cp\x3eMocha的超时设定默认是2s，如果执行的测试超过2s的话，就会报timeout错误。\x3c\/p\x3e\n\x3cp\x3e可以主动修改超时时间，有两种方法。\x3c\/p\x3e\n\x3ch4\x3e命令行式\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3emocha -t 10000\x3c\/code\x3e\x3c\/p\x3e\n\x3ch4\x3eAPI式\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22describe(\x27async\x27, function () {\n  this.timeout(10000);\n  it(\x27async\x27, function (done) {\n    lib.async(function (result) {\n      done();\n    });\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edescribe(\x3cspan class=\x22hljs-string\x22\x3e\x27async\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.timeout(\x3cspan class=\x22hljs-number\x22\x3e10000\x3c\/span\x3e);\n  it(\x3cspan class=\x22hljs-string\x22\x3e\x27async\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edone\x3c\/span\x3e) \x3c\/span\x3e{\n    lib.async(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e) \x3c\/span\x3e{\n      done();\n    });\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样的话\x3ccode\x3easync\x3c\/code\x3e执行时间不超过10s，就不会报错timeout错误了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e异常测试\x3c\/h2\x3e\n\x3cp\x3e异常应该怎么测试，现在有\x3ccode\x3egetContent\x3c\/code\x3e方法，他会读取指定文件的内容，但是不一定会成功，会抛出异常。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22exports.getContent = function (filename, callback) {\n  fs.readFile(filename, \x27utf-8\x27, callback);\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eexports.getContent = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3efilename, callback\x3c\/span\x3e) \x3c\/span\x3e{\n  fs.readFile(filename, \x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e, callback);\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这时候就应该模拟(mock)错误环境了\x3c\/p\x3e\n\x3ch4\x3e简单Mock\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22describe(\x26quot;getContent\x26quot;, function () {\n  var _readFile;\n  before(function () {\n    _readFile = fs.readFile;\n    fs.readFile = function (filename, encoding, callback) {\n      process.nextTick(function () {\n        callback(new Error(\x26quot;mock readFile error\x26quot;));\n      });\n    };    \n  });\n  \/\/ it();\n  after(function () {\n    \/\/ 用完之后记得还原。否则影响其他case\n    fs.readFile = _readFile;\n  })\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edescribe(\x3cspan class=\x22hljs-string\x22\x3e\x22getContent\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e _readFile;\n  before(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    _readFile = fs.readFile;\n    fs.readFile = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3efilename, encoding, callback\x3c\/span\x3e) \x3c\/span\x3e{\n      process.nextTick(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        callback(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22mock readFile error\x22\x3c\/span\x3e));\n      });\n    };    \n  });\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ it();\x3c\/span\x3e\n  after(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用完之后记得还原。否则影响其他case\x3c\/span\x3e\n    fs.readFile = _readFile;\n  })\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3eMock库\x3c\/h4\x3e\n\x3cp\x3eMock小模块：\x3ca href=\x22https:\/\/github.com\/fent\/node-muk\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3emuk\x3c\/code\x3e\x3c\/a\x3e ，略微优美的写法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var fs = require(\x27fs\x27);\nvar muk = require(\x27muk\x27);\n\nbefore(function () {\n  muk(fs, \x27readFile\x27, function(path, encoding, callback) {\n    process.nextTick(function () {\n      callback(new Error(\x26quot;mock readFile error\x26quot;));\n    });\n  });\n});\n\/\/ it();\nafter(function () {\n  muk.restore();\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27fs\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e muk = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27muk\x27\x3c\/span\x3e);\n\nbefore(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  muk(fs, \x3cspan class=\x22hljs-string\x22\x3e\x27readFile\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epath, encoding, callback\x3c\/span\x3e) \x3c\/span\x3e{\n    process.nextTick(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      callback(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22mock readFile error\x22\x3c\/span\x3e));\n    });\n  });\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ it();\x3c\/span\x3e\nafter(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  muk.restore();\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e测试私有方法\x3c\/h2\x3e\n\x3cp\x3e针对一些内部的方法，没有通过exports暴露出来，怎么测试它？\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function _adding(num1, num2) {\n  return num1 \x2b num2;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e_adding\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enum1, num2\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e num1 \x2b num2;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e通过rewire导出方法\x3c\/h4\x3e\n\x3cp\x3e模块：\x3ca href=\x22http:\/\/jhnns.github.com\/rewire\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3erewire\x3c\/code\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22it(\x27limit should return success\x27, function () {\n  var lib = rewire(\x27..\/lib\/index.js\x27);\n  var litmit = lib.__get__(\x27limit\x27);\n  litmit(10);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3eit(\x3cspan class=\x22hljs-string\x22\x3e\x27limit should return success\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e lib = rewire(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/lib\/index.js\x27\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e litmit = lib.__get__(\x3cspan class=\x22hljs-string\x22\x3e\x27limit\x27\x3c\/span\x3e);\n  litmit(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e测试Web应用\x3c\/h2\x3e\n\x3cp\x3e在开发Web项目的时候，要测试某一个API，如：\x3ccode\x3e\/user\x3c\/code\x3e，到底怎么编写测试用例呢？\x3c\/p\x3e\n\x3cp\x3e使用：\x3ca href=\x22https:\/\/github.com\/visionmedia\/supertest\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3esupertest\x3c\/code\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var express = require(\x26quot;express\x26quot;);\nvar request = require(\x26quot;supertest\x26quot;);\nvar app = express();\n\n\/\/ 定义路由\napp.get(\x27\/user\x27, function(req, res){\n  res.send(200, { name: \x27jerryc\x27 });\n});\n\ndescribe(\x27GET \/user\x27, function(){\n  it(\x27respond with json\x27, function(done){\n    request(app)\n      .get(\x27\/user\x27)\n      .set(\x27Accept\x27, \x27application\/json\x27)\n      .expect(\x27Content-Type\x27, \/json\/)\n      .expect(200)\n      .end(function (err, res) {\n        if (err){\n          done(err);\n        }\n        res.body.name.should.be.eql(\x27jerryc\x27);\n        done();\n      })\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e express = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22express\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e request = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22supertest\x22\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = express();\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 定义路由\x3c\/span\x3e\napp.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/user\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res\x3c\/span\x3e)\x3c\/span\x3e{\n  res.send(\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27jerryc\x27\x3c\/span\x3e });\n});\n\ndescribe(\x3cspan class=\x22hljs-string\x22\x3e\x27GET \/user\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  it(\x3cspan class=\x22hljs-string\x22\x3e\x27respond with json\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edone\x3c\/span\x3e)\x3c\/span\x3e{\n    request(app)\n      .get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/user\x27\x3c\/span\x3e)\n      .set(\x3cspan class=\x22hljs-string\x22\x3e\x27Accept\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json\x27\x3c\/span\x3e)\n      .expect(\x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e, \/json\/)\n      .expect(\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e)\n      .end(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, res\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err){\n          done(err);\n        }\n        res.body.name.should.be.eql(\x3cspan class=\x22hljs-string\x22\x3e\x27jerryc\x27\x3c\/span\x3e);\n        done();\n      })\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e覆盖率\x3c\/h2\x3e\n\x3cp\x3e测试的时候，我们常常关心，是否所有代码都测试到了。\x3c\/p\x3e\n\x3cp\x3e这个指标就叫做\x3ca href=\x22http:\/\/en.wikipedia.org\/wiki\/Code_coverage\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x22代码覆盖率\x22\x3c\/a\x3e（code coverage）。它有四个测量维度。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e行覆盖率\x3c\/strong\x3e（line coverage）：是否每一行都执行了？\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e函数覆盖率\x3c\/strong\x3e（function coverage）：是否每个函数都调用了？\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e分支覆盖率\x3c\/strong\x3e（branch coverage）：是否每个if代码块都执行了？\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e语句覆盖率\x3c\/strong\x3e（statement coverage）：是否每个语句都执行了？\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/gotwarlost\/istanbul\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eIstanbul\x3c\/a\x3e\x26nbsp;是 JavaScript 程序的代码覆盖率工具。\x3c\/p\x3e\n\x3ch4\x3e安装\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3e$ npm install -g istanbul\x3c\/code\x3e\x3c\/p\x3e\n\x3ch4\x3e覆盖率测试\x3c\/h4\x3e\n\x3cp\x3e在编写过以上的测试用例之后，执行命令：\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eistanbul cover _mocha\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e就能得到覆盖率:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22JerryC% istanbul cover _mocha                                                                                                                                                                \n\n\n  module\n    limit\n      ✓ limit should success\n    async\n      ✓ async\n    getContent\n      ✓ getContent\n    add\n      ✓ add\n\n  should\n    #Promise\n      ✓ should.reject\n      ✓ should fulfilled\n\n\n  6 passing (32ms)\n\n\n================== Coverage summary ======================\nStatements   : 100% ( 10\/10 )\nBranches     : 100% ( 2\/2 )\nFunctions    : 100% ( 5\/5 )\nLines        : 100% ( 10\/10 )\n==========================================================\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eJerryC% istanbul cover _mocha                                                                                                                                                                \n\n\n  \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e\n    limit\n      ✓ limit should success\n    \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e\n      ✓ \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e\n    getContent\n      ✓ getContent\n    add\n      ✓ add\n\n  should\n    #\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e\n      ✓ should.reject\n      ✓ should fulfilled\n\n\n  \x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e passing (\x3cspan class=\x22hljs-number\x22\x3e32\x3c\/span\x3ems)\n\n\n================== Coverage summary ======================\nStatements   : \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e% ( \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\/\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e )\nBranches     : \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e% ( \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\/\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e )\nFunctions    : \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e% ( \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e\/\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e )\nLines        : \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e% ( \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\/\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e )\n==========================================================\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这条命令同时还生成了一个 coverage 子目录，其中的 coverage.json 文件包含覆盖率的原始数据，coverage\/lcov-report 是可以在浏览器打开的覆盖率报告，其中有详细信息，到底哪些代码没有覆盖到。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/xia-dev.b0.upaiyun.com\/eac87dbf-4e4b-426e-80ac-7c50e1b9a1cb.jpg\x22 src=\x22https:\/\/static.alili.techhttp:\/\/xia-dev.b0.upaiyun.com\/eac87dbf-4e4b-426e-80ac-7c50e1b9a1cb.jpg\x22 alt=\x22覆盖率html\x22 title=\x22覆盖率html\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e上面命令中，\x3ccode\x3eistanbul cover\x3c\/code\x3e 命令后面跟的是 \x3ccode\x3e_mocha\x3c\/code\x3e 命令，前面的下划线是不能省略的。\x3c\/p\x3e\n\x3cp\x3e因为，\x3ca href=\x22https:\/\/github.com\/gotwarlost\/istanbul\/issues\/44\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emocha 和 _mocha 是两个不同的命令\x3c\/a\x3e，前者会新建一个进程执行测试，而后者是在当前进程（即 istanbul 所在的进程）执行测试，只有这样， istanbul 才会捕捉到覆盖率数据。其他测试框架也是如此，必须在同一个进程执行测试。\x3c\/p\x3e\n\x3cp\x3e如果要向 mocha 传入参数，可以写成下面的样子。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22$ istanbul cover _mocha -- tests\/test.sqrt.js -R spec\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e$ istanbul cover _mocha -- tests\/test\x3cspan class=\x22hljs-selector-class\x22\x3e.sqrt\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e -R spec\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面命令中，两根连词线后面的部分，都会被当作参数传入 Mocha 。如果不加那两根连词线，它们就会被当作 istanbul 的参数（参考链接\x3ca href=\x22http:\/\/www.clock.co.uk\/blog\/npm-module-code-coverage-in-2-simple-steps\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e1\x3c\/a\x3e，\x3ca href=\x22http:\/\/www.vapidspace.com\/coding\/2014\/10\/29\/code-coverage-metrics-with-mocha-and-istanbul\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e2\x3c\/a\x3e）。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e使用Makefile串起项目\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22TESTS = test\/*.test.js\nREPORTER = spec\nTIMEOUT = 10000\nJSCOVERAGE = .\/node_modules\/jscover\/bin\/jscover\n\ntest:\n    @NODE_ENV=test .\/node_modules\/mocha\/bin\/mocha -R $(REPORTER) -t $(TIMEOUT) $(TESTS)\n\ntest-cov: lib-cov\n    @LIB_COV=1 $(MAKE) test REPORTER=dot\n    @LIB_COV=1 $(MAKE) test REPORTER=html-cov \x3e coverage.html\n\nlib-cov:\n    @rm -rf .\/lib-cov\n    @$(JSCOVERAGE) lib lib-cov\n\n.PHONY: test test-cov lib-cov\n\nmake test\nmake test-cov\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crystal\x22\x3e\x3ccode\x3eTESTS = test\/*.test.js\nREPORTER = spec\nTIMEOUT = \x3cspan class=\x22hljs-number\x22\x3e10000\x3c\/span\x3e\nJSCOVERAGE = .\/node_modules\/jscover\/bin\/jscover\n\n\x3cspan class=\x22hljs-symbol\x22\x3etest:\x3c\/span\x3e\n    @NODE_ENV=test .\/node_modules\/mocha\/bin\/mocha -R $(REPORTER) -t $(TIMEOUT) $(TESTS)\n\ntest-\x3cspan class=\x22hljs-symbol\x22\x3ecov:\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elib\x3c\/span\x3e-\x3cspan class=\x22hljs-title\x22\x3ecov\x3c\/span\x3e\x3c\/span\x3e\n    @LIB_COV=\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e $(MAKE) test REPORTER=dot\n    @LIB_COV=\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e $(MAKE) test REPORTER=html-cov \x26gt; coverage.html\n\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elib\x3c\/span\x3e-\x3cspan class=\x22hljs-title\x22\x3ecov\x3c\/span\x3e:\x3c\/span\x3e\n    @rm -rf .\/\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elib\x3c\/span\x3e-\x3cspan class=\x22hljs-title\x22\x3ecov\x3c\/span\x3e\x3c\/span\x3e\n    @$(JSCOVERAGE) \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elib\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3elib\x3c\/span\x3e-\x3cspan class=\x22hljs-title\x22\x3ecov\x3c\/span\x3e\x3c\/span\x3e\n\n.\x3cspan class=\x22hljs-symbol\x22\x3ePHONY:\x3c\/span\x3e test test-cov \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elib\x3c\/span\x3e-\x3cspan class=\x22hljs-title\x22\x3ecov\x3c\/span\x3e\x3c\/span\x3e\n\nmake test\nmake test-cov\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e用项目自身的jscover和mocha，避免版本冲突和混乱\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e持续集成，Travis-cli\x3c\/h2\x3e\n\x3cul\x3e\x3cli\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/travis-ci.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eTravis-ci\x3c\/a\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e绑定Github帐号\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在Github仓库的Admin打开Services hook\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e打开Travis\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e每次push将会hook触发执行\x3ccode\x3enpm test\x3c\/code\x3e命令\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e注意：Travis会将未描述的项目当作Ruby项目。所以需要在根目录下加入\x3ccode\x3e.travis.yml\x3c\/code\x3e文件。内容如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22language: node_js\nnode_js:\n  - \x26quot;0.12\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22yaml hljs\x22\x3e\x3ccode class=\x22yaml\x22\x3e\x3cspan class=\x22hljs-attr\x22\x3elanguage:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3enode_js\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3enode_js:\x3c\/span\x3e\n\x3cspan class=\x22hljs-bullet\x22\x3e  -\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x220.12\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eTravis-cli还会对项目颁发标签，\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/camo.githubusercontent.com\/f479d6cf4ac300093da5a90d70565cebf8c8ed40\/68747470733a2f2f7365637572652e7472617669732d63692e6f72672f4a61636b736f6e5469616e2f626167706970652e706e67\x22 src=\x22https:\/\/static.alili.techhttps:\/\/camo.githubusercontent.com\/f479d6cf4ac300093da5a90d70565cebf8c8ed40\/68747470733a2f2f7365637572652e7472617669732d63692e6f72672f4a61636b736f6e5469616e2f626167706970652e706e67\x22 alt=\x22\/\x22 title=\x22\/\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3eor\x26nbsp;\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/camo.githubusercontent.com\/08478cd5a732822aec47e6e60d5f823ef0898dec\/68747470733a2f2f7365637572652e7472617669732d63692e6f72672f54424544502f64617461766a732e706e67\x22 src=\x22https:\/\/static.alili.techhttps:\/\/camo.githubusercontent.com\/08478cd5a732822aec47e6e60d5f823ef0898dec\/68747470733a2f2f7365637572652e7472617669732d63692e6f72672f54424544502f64617461766a732e706e67\x22 alt=\x22\/\x22 title=\x22\/\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如果项目通过所有测试，就会build-passing，\x3c\/p\x3e\n\x3cp\x3e如果项目没有通过所有测试，就会build-failing\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e一些观点\x3c\/h2\x3e\n\x3cp\x3e实施单元测试的时候, 如果没有一份经过实践证明的详细规范, 很难掌握测试的 \x22度\x22, 范围太小施展不开, 太大又侵犯 \x22别人的\x22 地盘. 上帝的归上帝, 凯撒的归凯撒, 给单元测试念念紧箍咒不见得是件坏事, 反而更有利于发挥单元测试的威力, 为代码重构和提高代码质量提供动力.\x3c\/p\x3e\n\x3cp\x3e这份文档来自 Geotechnical, 是一份非常难得的经验准则. 你完全可以以这份准则作为模板, 结合所在团队的经验, 整理出一份内部单元测试准则.\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/yangyubo\/zh-unit-testing-guidelines\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e单元测试准则\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader12\x22\x3e彩蛋\x3c\/h2\x3e\n\x3cp\x3e最后，介绍一个库：\x3ca href=\x22https:\/\/github.com\/Marak\/Faker.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3efaker\x3c\/code\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e他是一个能伪造用户数据的库，包括用户常包含的属性：个人信息、头像、地址等等。\x3c\/p\x3e\n\x3cp\x3e是一个开发初期，模拟用户数据的绝佳好库。\x3c\/p\x3e\n\x3cp\x3e支持Node.js和浏览器端。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/xia-dev.b0.upaiyun.com\/43075e5e-026f-4acb-a51f-a998cf1a6e11.jpg\x22 src=\x22https:\/\/static.alili.techhttp:\/\/xia-dev.b0.upaiyun.com\/43075e5e-026f-4acb-a51f-a998cf1a6e11.jpg\x22 alt=\x22生成用户\x22 title=\x22生成用户\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e整理\x3c\/h2\x3e\n\x3ch4\x3eNodejs的单元测试工具\x3c\/h4\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e测试框架 mocha\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e断言库：should.js、expect.js、chai\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e覆盖率：istanbul、jscover、blanket\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eMock库：muk\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e测试私有方法：rewire\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eWeb测试：supertest\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e持续集成：Travis-cli\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader14\x22\x3e参考\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/JacksonTian\/unittesting\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/JacksonTian\/unittesting\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/html5ify.com\/unittesting\/slides\/index.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e]()[http:\/\/html5ify.com\/unittesting\/slides\/index.html\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2015\/06\/istanbul.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.ruanyifeng.com\/blog\/2015\/06\/istanbul.html\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/coolshell.cn\/articles\/8209.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/coolshell.cn\/articles\/8209.html\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/stackoverflow.com\/questions\/153234\/how-deep-are-your-unit-tests\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/stackoverflow.com\/questions\/153234\/how-deep-are-your-unit-tests\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/yangyubo\/zh-unit-testing-guidelines\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/yangyubo\/zh-unit-testing-guidelines\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.codedata.com.tw\/java\/unit-test-the-way-changes-my-programming\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.codedata.com.tw\/java\/unit-test-the-way-changes-my-programming\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/wiki.ubuntu.org.cn\/%E8%B7%9F%E6%88%91%E4%B8%80%E8%B5%B7%E5%86%99Makefile:MakeFile%E4%BB%8B%E7%BB%8D\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/wiki.ubuntu.org.cn\/%E8%B7%9F%E6%88%91%E4%B8%80%E8%B5%B7%E5%86%99Makefile:MakeFile%E4%BB%8B%E7%BB%8D\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/yangyubo\/zh-unit-testing-guidelines\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/yangyubo\/zh-unit-testing-guidelines\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/visionmedia\/superagent\/blob\/master\/Makefile\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/visionmedia\/superagent\/blob\/master\/Makefile\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3chr\x3e\n\x3cp\x3e如果本文对您有用\x3cbr\x3e请不要吝啬你们的Follow与Start\x3cbr\x3e这会大大支持我们继续创作\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e「Github」\x3c\/strong\x3e\x3cbr\x3eMZMonster ：\x3ca href=\x22https:\/\/github.com\/MZMonster\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e@MZMonster\x3c\/a\x3e\x3cbr\x3eJC_Huang ：\x3ca href=\x22https:\/\/github.com\/JerryC8080\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e@JerryC8080\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>在Nodejs中贯彻单元测试</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000004627859">https://segmentfault.com/a/1190000004627859</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/psrtszbg0z9/" target="_blank">https://alili.tech/archive/psrtszbg0z9/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>